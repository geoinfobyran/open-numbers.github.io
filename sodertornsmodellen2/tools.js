(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{40:function(t,e){t.exports="./assets/barchart-ds.css"},41:function(t,e){!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(2);var i,r=n(1),o=(i=r)&&i.__esModule?i:{default:i};var a=Vizabi.Tool.extend("BarChartDS",{init:function(t,e){this.name="barchartds",this.components=[{component:o.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","state.marker_order","state.entities","state.entities_side","state.entities_allpossible","state.entities_geodomain","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.time","locale","ui"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),!this.model){var e=t.state.entities;if(Object.keys(e.show).length>0){var n={};e.show[e.dim]&&1!==Object.keys(e.show).length&&(n[e.dim]=e.show[e.dim]),e.show[e.dim]&&1==Object.keys(e.show).length||(e.show=n)}var i=t.state.entities_geodomain;i.skipFilter=t.state.entities.dim===i.dim||t.state.entities_side.dim===i.dim}},default_model:{state:{},ui:{chart:{stacked:!0,inpercent:!1,flipSides:!0},buttons:["colors","inpercent","find","side","moreoptions","fullscreen"],dialogs:{popup:["timedisplay","colors","find","side","moreoptions"],sidebar:["timedisplay","colors","find"],moreoptions:["opacity","speed","colors","side","presentation","about"]},presentation:!1},locale:{}},versionInfo:{version:"2.1.1",build:1527869537191}});e.default=a},function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=Vizabi,o=r.utils,a=r.Component,s=r.helpers["d3.axisWithLabelPicker"],l=r.iconset.question,u=a.extend("barchartds",{init:function(t,e){this.name="barchartds",this.template=n(3),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"marker_order",type:"marker"},{name:"entities",type:"entities"},{name:"entities_side",type:"entities"},{name:"entities_allpossible",type:"entities"},{name:"entities_geodomain",type:"entities"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var i=this;this.model_binds={"change:time.value":function(t){if(i._readyOnce){if(1!=i.model.time.step&&!i.snapped&&!i.model.time.playing&&!i.model.time.dragging){var e=d3.bisectLeft(i.timeSteps,i.model.time.value);if(0!=e&&i.timeSteps[e]-i.model.time.value){i.snapped=!0;var n=i.model.time.value,r=i.timeSteps[e-1],o=n-r<(e=i.timeSteps[e])-n?r:e;i.model.time.value=new Date(o)}}i.snapped||i.model.marker.getFrame(i.model.time.value,function(t){i.frame=t,i.frameAxisX=t.axis_x,i.model.marker_order.getFrame(i.model.time.value,function(t){i.frameOrder=t.hook_order,i._reorderBars(),i._updateEntities(!0),i.updateBarsOpacity()})}),i.snapped=!1}},"change:marker":function(t,e){i._readyOnce&&e.indexOf("scaleType")>-1&&i.ready()},"change:marker.select":function(t){i.someSelected=i.model.marker.select.length>0,i.nonSelectedOpacityZero=!1,i.updateBarsOpacity()},"change:marker.highlight":function(t,e){i._readyOnce&&i._highlightBars()},"change:marker.opacitySelectDim":function(){i.updateBarsOpacity()},"change:marker.opacityRegular":function(){i.updateBarsOpacity()},"change:marker.color.palette":function(t){i._readyOnce&&i._updateEntities()},"change:marker.color.scaleType":function(t){i._readyOnce&&i._updateEntities()},"change:marker.color.which":function(t){i._readyOnce&&(i.model.marker_order.hook_order.which=i.model.marker.color.which)},"change:marker.side.which":function(t){if(i._readyOnce){var e=void 0,n={},r={};if("constant"==i.model.marker.side.use)e=null;else{var o=i.model.marker.side.getConceptprops();e="entity_set"==o.concept_type?o.domain:i.model.marker.side.which}i.model.marker.side.clearSideState();var a=e!==i.geoDomainDimension;a||(n["is--"+i.model.marker.side.which]=!0),i.model.entities_side.skipFilter=a,r.show=n,r.dim=e,i.model.entities_side.set(r),i.model.entities_geodomain.skipFilter=(e===i.geoDomainDimension||i.STACKDIM===i.geoDomainDimension)&&(Boolean(i.model.entities.getFilteredEntities().length)||!i.model.entities_side.skipFilter)}},"change:entities.show":function(t){if(i._readyOnce){if(i.model.entities.dim===i.model.entities_side.dim&&!o.isEmpty(i.model.entities_side.show)){var e=i.model.entities_side.getFilteredEntities().filter(function(t){return!i.model.entities.isShown(t)});e.length&&(i.model.marker.side.clearSideState(),i.model.entities_side.showEntity(e))}i.model.entities_geodomain.skipFilter=(i.SIDEDIM===i.geoDomainDimension||i.STACKDIM===i.geoDomainDimension)&&(Boolean(i.model.entities.getFilteredEntities().length)||!i.model.entities_side.skipFilter)}},"change:entities_side.show":function(t){if(i._readyOnce){var e=!1,n=null;if(o.forEach(i.model.marker.side._space,function(t){t.dim===i.model.entities_side.dim&&t._name!==i.model.entities_side._name&&t._name!==i.model.entities_geodomain._name&&(n=t)}),n){i.model.entities.getFilteredEntities();var r=i.model.entities_side.getFilteredEntities().filter(function(t){return!n.isShown(t)});r.length&&(n.showEntity(r),e=!0)}i.SIDEDIM!==i.model.entities_side.dim&&(e=!0),e||(i._updateIndicators(),i.model.ready&&i.frame&&(i._updateLimits(),i.resize(),i._updateEntities(!0)))}},"change:ui.chart.inpercent":function(t){i._readyOnce&&(i._updateLimits(),i.resize(),i._updateEntities())},"change:ui.chart.flipSides":function(t){i._readyOnce&&(i.model.marker.side.switchSideState(),i._updateIndicators(),i.resize(),i._updateEntities(!0))}},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=s("bottom"),this.xAxisLeft=s("bottom"),this.yAxis=s("left"),this.xScales=[],this.totalFieldName="Total"},checkDimensions:function(){var t=this.model.entities.dim,e=this.model.entities_side.dim;this.colorUseNotProperty="constant"==this.model.marker.color.use||this.model.marker.color.which==this.TIME,this.stackSkip=t==e,this.geoLess=t!==this.geoDomainDimension&&e!==this.geoDomainDimension,this.sideSkip="constant"==this.model.marker.side.use},readyOnce:function(){var t=this;this.el=this.el?this.el:d3.select(this.element),this.element=this.el,this.interaction=this._interaction(),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.xAxisLeftEl=this.graph.select(".vzb-bc-axis-x-left"),this.xTitleEl=this.element.select(".vzb-bc-axis-x-title"),this.xInfoEl=this.element.select(".vzb-bc-axis-x-info"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.barsCrop=this.graph.select(".vzb-bc-bars-crop"),this.labelsCrop=this.graph.select(".vzb-bc-labels-crop"),this.bars=this.graph.select(".vzb-bc-bars"),this.labels=this.graph.select(".vzb-bc-labels"),this.labels.select(".vzb-bc-stack").attr("y",-10),this.title=this.element.select(".vzb-bc-title"),this.titleRight=this.element.select(".vzb-bc-title-right"),this.year=this.element.select(".vzb-bc-year"),this.geoDomainDimension=this.model.entities_geodomain.getDimension(),this.geoDomainDefaultValue=((this.model.entities_geodomain.show[this.geoDomainDimension]||{}).$in||{})[0],t.someSelected=t.model.marker.select.length>0,t.nonSelectedOpacityZero=!1,this.on("resize",function(){t._updateEntities()}),this._attributeUpdaters={_newWidth:function(e,n){e.x_=0;var i=t.frameAxisX[o.getKey(e,t.KEYS)];return e.width_=i?t.xScale(i):0,t.ui.chart.inpercent&&(e.width_/=t.total[e[t.PREFIXEDSIDEDIM]]),e.width_},_newX:function(t,e){var n=this.previousSibling;if(n){var i=d3.select(n).datum();t.x_=i.x_+i.width_}else t.x_=0;return t.x_},_newColor:function(e,n){return t.cScale(t.colorUseNotProperty?t.frame.color[e[t.STACKDIM]]:t.frame.color[o.getKey(e,t.COLORKEYS)])}}},ready:function(){var t=this;if(this.model.marker._ready){var e=this;this.timeSteps=this.model.time.getAllSteps(),this.TIME=this.model.marker._getFirstDimension({type:"time"}),this.KEYS=o.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.side=this.model.marker.label_side.getEntity(),this.SIDEDIM=this.side.getDimension(),this.PREFIXEDSIDEDIM="side_"+this.SIDEDIM,this.stack=this.model.marker.axis_y.getEntity(),this.STACKDIM=this.stack.getDimension(),this.PREFIXEDSTACKDIM="stack_"+this.STACKDIM,this.TIMEDIM=this.model.time.getDimension(),this.COLORKEYS=[this.STACKDIM,this.PREFIXEDSIDEDIM],this.checkDimensions(),this.updateUIStrings(),this._updateIndicators(),this.frame=null,this.model.marker.getFrame(e.model.time.value,function(n){e.frame=n,e.frameAxisX=n.axis_x,e.model.marker_order.getFrame(e.model.time.value,function(n){e.frameOrder=n.hook_order,e.items=e.model.marker.getKeys(),e._createLimits(),e._updateLimits(),e._reorderBars(),e.markers=t.model.marker.getKeys(e.STACKDIM),e.resize(),e._updateEntities(!0),e.updateBarsOpacity()})})}},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=this.xTitleEl.selectAll("text").data([0]);e.enter().append("text"),e.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()});var n=this.model.marker.axis_x.getConceptprops();o.setIcon(this.xInfoEl,l).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(n.description||n.sourceLink))),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),n=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),i=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(n.x+r.left-i.left,n.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()})},_updateIndicators:function(){var t=this;this.duration=this.model.time.delayAnimations,this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.yAxis.tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this.xAxisLeft.tickFormat(this.model.marker.axis_x.getTickFormatter());var e,n=this.SIDEDIM,i=this.STACKDIM;e=this.model.marker.getKeys(i).map(function(t){return t[i]}),this.stackKeys=e;var r=this.model.marker.label_side.getItems(),a=[];if(!o.isEmpty(r)){var s=!!this.model.marker.side.getEntity().show[n];if((a=this.model.marker.getKeys(n).filter(function(e){return!s||t.model.marker.side.getEntity().isShown(e)}).map(function(t){return t[n]})).length>2&&(a.length=2),a.length>1){var l=this.ui.chart.flipSides?d3.ascending:d3.descending;a.sort(l)}}if(a.length||a.push("undefined"),this.sideKeys=a,this.twoSided=this.sideKeys.length>1,this.titleRight.classed("vzb-hidden",!this.twoSided),this.twoSided)this.xScaleLeft=this.xScale.copy(),this.title.text(r[this.sideKeys[1]]),this.titleRight.text(r[this.sideKeys[0]]);else{var u=this.sideKeys.length&&r[this.sideKeys[0]]?r[this.sideKeys[0]]:"";this.title.text(u)}this.cScale=this.model.marker.color.getScale()},_reorderBars:function(){var t=this,e=this.yScale.domain(),n=this.sideKeys;e.sort(function(e,i){var r=d3.ascending(t.frameOrder[e]||0,t.frameOrder[i]||0);return 0!==r?r:d3.ascending((t.frameAxisX[e]||{})[n[0]]||0,(t.frameAxisX[i]||{})[n[0]]||0)}),this.yScale.domain(e)},_createLimits:function(){var t=this,e=this.model.marker.axis_x,n=Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));n.length||n.push("undefined");var r=this.sideSkip?[]:[this.SIDEDIM],a=e.getLimitsByDimensions(r.concat([this.STACKDIM,this.TIMEDIM])),s=e.getUnique(),l={},u={},c={},h=void 0;n.forEach(function(t){c[t]=[],u[t]=[]}),t.sideSkip?o.forEach(s,function(e){l[e]={};var i=0,r=[];o.forEach(t.stackKeys,function(t){if(a[t]&&a[t][e]){var n=a[t][e].max;i+=n,r.push(n)}}),l[e][n[0]]=i;var s=Math.max.apply(Math,r);u[n[0]].push(s/i),c[n[0]].push(s)}):o.forEach(s,function(e){l[e]={},o.forEach(n,function(n){var i=0,r=[];o.forEach(t.stackKeys,function(t){if(a[h=n+","+t]&&a[h][e]){var o=a[h][e].max;i+=o,r.push(o)}}),l[e][n]=i;var s=Math.max.apply(Math,r);u[n].push(s/i),c[n].push(s)})}),this.maxLimits={},this.inpercentMaxLimits={},n.forEach(function(e){t.maxLimits[e]=Math.max.apply(Math,i(c[e])),t.inpercentMaxLimits[e]=Math.max.apply(Math,i(u[e]))}),this.totals=l},_updateLimits:function(){var t=this,e=this.model.marker.axis_x,n="log"==e.scaleType?.01:0,r=void 0;r=this.ui.chart.inpercent?[.01*n,Math.max.apply(Math,i(this.sideKeys.map(function(e){return t.inpercentMaxLimits[e]})))]:null!=e.domainMin&&null!=e.domainMax?[+e.domainMin,+e.domainMax]:[n,Math.max.apply(Math,i(this.sideKeys.map(function(e){return t.maxLimits[e]})))],this.xScale.domain(r),this.xScaleLeft&&this.xScaleLeft.domain(this.xScale.domain())},_interpolateBetweenTotals:function(t,e,n){var i=d3.bisectLeft(t,n),r=(n-t[i-1])/(t[i]-t[i-1]),a={};return o.forEach(this.sideKeys,function(n){a[n]=e[t[i]][n]*r+e[t[i-1]][n]*(1-r)}),a},_updateEntities:function(t){var e=this,n=this.model.time,i=this.SIDEDIM,r=this.PREFIXEDSIDEDIM,o=this.STACKDIM,a=(this.PREFIXEDSTACKDIM,this.TIMEDIM,n.playing?n.delayAnimations:0);this.ui.chart.inpercent&&(this.total=this.totals[n.value]?this.totals[n.value]:this._interpolateBetweenTotals(this.timeSteps,this.totals,n.value));this.yScale.domain();var s=this.markers.slice(0);this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(s,function(t){return t[o]}),this.entityBars.exit().remove();var l=this.barHeight,u=this.firstBarOffsetY;this.entityBars=this.entityBars.enter().append("g").attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[o]}).attr("transform",function(t,n){return"translate(0,"+(u-e.yScale(t[o]))+")"}).merge(this.entityBars);var c=this._attributeUpdaters;if(this.sideBars=this.entityBars.selectAll(".vzb-bc-side").data(function(t){return e.sideKeys.map(function(e){var n={};return n[o]=t[o],n[r]=e,n[i]=e,n})},function(t){return t[r]}),this.sideBars.exit().remove(),this.sideBars=this.sideBars.enter().append("g").attr("class",function(t,n){return"vzb-bc-side vzb-bc-side-"+(!n!=!e.twoSided?"right":"left")}).call(function(t){t.append("rect").attr("class",function(t,n){return"vzb-bc-stack vzb-bc-stack-"+n+(e.highlighted?" vzb-dimmed":"")}).attr("y",0).attr("height",l).attr("fill",c._newColor).attr("width",c._newWidth).attr("x",c._newX).on("mouseover",e.interaction.mouseover).on("mouseout",e.interaction.mouseout).on("click",e.interaction.click).onTap(e.interaction.tap)}).merge(this.sideBars),t&&this.sideBars.attr("transform",function(t,n){return n?"scale(-1,1) translate("+e.activeProfile.centerWidth+",0)":""}),this.stackBars=this.sideBars.selectAll(".vzb-bc-stack"),t&&this.stackBars.attr("fill",c._newColor),a){var h=d3.transition().duration(a).ease(d3.easeLinear);this.entityBars.attr("transform",function(t,n){return"translate(0,"+(u-e.yScale(t[o]))+")"}),this.stackBars.transition(h).attr("width",c._newWidth).attr("x",c._newX)}else this.entityBars.interrupt().attr("transform",function(t,n){return"translate(0,"+(u-e.yScale(t[o]))+")"}),this.stackBars.interrupt().attr("width",c._newWidth).attr("x",c._newX);a?this.year.transition().duration(a).ease(d3.easeLinear).on("end",this._setYear(n.value)):this.year.interrupt().text(n.formatDate(n.value)).transition()},_setYear:function(t){var e=this.model.time.formatDate(t);return function(){d3.select(this).text(e)}},_interaction:function(){var t=this;return{mouseover:function(e,n){o.isTouchDevice()||t.model.marker.highlightMarker(e)},mouseout:function(e,n){o.isTouchDevice()||t.model.marker.clearHighlighted()},click:function(e,n){o.isTouchDevice()||t.model.marker.selectMarker(e)},tap:function(e){d3.event.stopPropagation(),t.model.marker.selectMarker(e)}}},_highlightBars:function(t){this.someHighlighted=this.model.marker.highlight.length>0,this.updateBarsOpacity(),this.someHighlighted?this._showLabel(this.model.marker.highlight[0]):this.labels.selectAll(".vzb-hovered").classed("vzb-hovered",!1)},_showLabel:function(t){if(this.frame){var e=this,n=e.ui.chart.inpercent?d3.format(".2%"):e.model.marker.axis_x.getTickFormatter(),i=e.SIDEDIM,r=e.STACKDIM,a=this.KEYS,s=e.sideKeys.indexOf(t[i]),l=e.labels.select(".vzb-bc-label"),u=e.bars.select(".vzb-bc-bar-"+t[r]);l.attr("transform",u.attr("transform")).select(".vzb-bc-stack").text(function(s){var l=e.frame.label_stack[t[r]];l=e.twoSided?l:l+" "+e.stackItems[t[r]];var u=e.ui.chart.inpercent?e.total[t[i]]:1,c=e.frameAxisX[o.getKey(t,a)]/u;return l+": "+n(c)}).attr("x",(s?-1:1)*(.5*e.activeProfile.centerWidth+7)).classed("vzb-text-left",s),l.classed("vzb-hovered",!0)}},presentationProfileChanges:{medium:{margin:{right:80,bottom:80},infoElHeight:32},large:{margin:{top:100,right:100,left:100,bottom:80},infoElHeight:32}},profiles:{small:{margin:{top:70,right:20,left:40,bottom:40},infoElHeight:16,centerWidth:2,titlesSpacing:5},medium:{margin:{top:80,right:60,left:60,bottom:40},infoElHeight:20,centerWidth:2,titlesSpacing:10},large:{margin:{top:100,right:60,left:60,bottom:40},infoElHeight:22,centerWidth:2,titlesSpacing:20}},resize:function(){var t=this;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=this.activeProfile.margin,n=this.activeProfile.infoElHeight;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return o.warn("BarchartDS resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),this.barsCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsCrop.attr("width",this.width).attr("height",Math.max(0,this.height));var i=this.yScale.domain(),r=this.barHeight="ordinal"==this.model.marker.axis_y.scaleType?this.height/i.length:this.height/Math.abs(i[1]-i[0]);this.firstBarOffsetY=this.height-this.barHeight,this.stackBars&&this.stackBars.attr("height",r),this.sideBars&&this.sideBars.attr("transform",function(e,n){return n?"scale(-1,1) translate("+t.activeProfile.centerWidth+",0)":""}),this.yScale.range([this.height,0]);var a=this.twoSided?.5*(this.width-this.activeProfile.centerWidth):this.width;this.xScale.range([0,a]),this.yAxis.scale(this.yScale).tickValues([]).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:e,limitMaxTickNumber:1});var s=this.ui.chart.inpercent?d3.format(".1%"):this.model.marker.axis_x.getTickFormatter();this.xAxis.scale(this.xScale).tickFormat(s).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6});var l=this.twoSided?.5*(this.width+t.activeProfile.centerWidth):0;if(this.xAxisEl.attr("transform","translate("+l+","+this.height+")").call(this.xAxis),this.yAxisEl.attr("transform","translate(0,0)").call(this.yAxis),this.xAxisLeftEl.classed("vzb-hidden",!this.twoSided),this.twoSided){"ordinal"!==this.model.marker.axis_x.scaleType?this.xScaleLeft.range([.5*(this.width-this.activeProfile.centerWidth),0]):this.xScaleLeft.rangePoints([.5*(this.width-this.activeProfile.centerWidth),0]).range(),this.xAxisLeft.scale(this.xScaleLeft).tickFormat(s).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6}),this.xAxisLeftEl.attr("transform","translate(0,"+this.height+")").call(this.xAxisLeft);var u=this.xAxisEl.select(".tick text");if(!u.empty()){var c=u.node().getBBox().width;u.attr("dx",.5*-(this.activeProfile.centerWidth+c))}this.xAxisEl.select(".tick line").classed("vzb-hidden",!0);var h=this.xAxisLeftEl.selectAll(".tick").nodes();d3.select(h[h.length-1]).classed("vzb-hidden",!0)}var d=this.model.locale.isRTL();if(this.bars.attr("transform","translate("+l+",0)"),this.labels.attr("transform","translate("+l+",0)"),this.title.attr("x",e.left+(this.twoSided?l-this.activeProfile.titlesSpacing:0)).style("text-anchor",this.twoSided?"end":"").attr("y",.7*e.top),this.titleRight.attr("x",e.left+l+this.activeProfile.titlesSpacing).attr("y",.7*e.top),this.xTitleEl.style("font-size",n+"px").attr("transform","translate("+(d?this.width:.4*e.left)+","+.4*e.top+")"),this.xTitleEl.select("text").text(this.model.marker.axis_x.getConceptprops().name),this.xInfoEl.select("svg").node()){var f=this.xTitleEl.node().getBBox(),p=o.transform(this.xTitleEl.node()),m=d?f.x+p.translateX-1.4*n:f.x+p.translateX+f.width+.4*n;this.xInfoEl.select("svg").attr("width",n+"px").attr("height",n+"px"),this.xInfoEl.attr("transform","translate("+m+","+(p.translateY-.8*n)+")")}this.year.attr("x",this.width+e.left).attr("y",.4*e.top)},updateBarsOpacity:function(t){var e=this,n=this.model.marker.opacityHighlightDim,i=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim;this.stackBars.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?1:e.someSelected?e.model.marker.isSelected(t)?1:r:e.someHighlighted?n:i}),this.stackBars.style("stroke",function(t){return e.model.marker.isSelected(t)?"#333":null});var o=e.model.marker.opacitySelectDim<.01;o!=this.nonSelectedOpacityZero&&this.stackBars.style("pointer-events",function(t){return e.someSelected&&o&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=u},function(t,e){},function(t,e){t.exports='\x3c!-- BarChartDS Component --\x3e\n<svg class="vzb-barchartds">\n    <g class="vzb-bc-header">\n        <g class="vzb-bc-axis-x-title"></g>\n        <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n        <text class="vzb-bc-title"></text>\n        <text class="vzb-bc-title vzb-bc-title-right"></text>\n        <text class="vzb-bc-year"></text>\n    </g>\n    <g class="vzb-bc-graph">\n\n        <g class="vzb-bc-axis-y-title"></g>\n\n        <g class="vzb-bc-axis-y"></g>\n\n        <svg class="vzb-bc-bars-crop">\n            <g class="vzb-bc-bars"></g>\n        </svg>\n\n        <g class="vzb-bc-axis-x"></g>\n        <g class="vzb-bc-axis-x vzb-bc-axis-x-left"></g>\n\n        <svg class="vzb-bc-labels-crop">\n            <g class="vzb-bc-labels">\n                <g class="vzb-bc-label"><text class="vzb-bc-stack"></text></g>\n            </g>\n        </svg>\n\n        <g class="vzb-bc-axis-labels">\n            \x3c!-- <text class="vzb-x_label">Lifespan</text>\n                  <text class="vzb-y_label">Lifespan</text> --\x3e\n        </g>\n    </g>\n</svg>\n'},function(t,e,n){t.exports=n(0)}])},42:function(t,e){t.exports="./assets/combo.css"},43:function(t,e){Vizabi.Tool.extend("combo",{init:function(t,e){this.name="combo",this.template='<div class="vzb-tool vzb-tool-'+this.name+' vzb-split-vertical"><div class="vzb-tool-stage"><div class="vzb-tool-viz vzb-tool-viz-bubble"></div><div class="vzb-tool-viz vzb-tool-viz-map"></div><div class="vzb-tool-time-speed-sliders"><div class="vzb-tool-timeslider"></div><div class="vzb-tool-stepped-speed-slider"></div></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>',this.components=this.components=[{component:Vizabi.Component.get("bubblechart"),placeholder:".vzb-tool-viz-bubble",model:["state.time","state.marker","locale","ui"]},{component:Vizabi.Component.get("extapimap"),placeholder:".vzb-tool-viz-map",model:["state.time","state.marker","locale","ui","data"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{},entities:{},entities_colorlegend:{},entities_tags:{},marker_tags:{space:["entities_tags"],label:{},hook_parent:{}},marker:{space:["entities","time"],axis_x:{},axis_y:{},label:{},size:{},color:{},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33],allow:{names:["_default"]}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{decorations:{},superhighlightOnMinimapHover:!0,whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},margin:{left:0,top:0},trails:!1,lockNonSelected:0},presentation:!1,panWithArrow:!0,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!0,buttons:["colors","find","trails","lock","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","zoom","moreoptions"],sidebar:["colors","find","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","presentation","about"]}}}})},44:function(t,e){t.exports="./assets/extapimap.css"},45:function(t,e){!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(6);var i,r=n(1),o=(i=r)&&i.__esModule?i:{default:i};n(3),n(2);var a=Vizabi.Tool.extend("ExtApiMap",{init:function(t,e){this.name="extapimap",this.components=[{component:o.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui","data"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.time","locale","ui"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_map_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},marker:{limit:1e3,space:["entities","time"],label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},size:{autoconfig:{index:0,type:"measure"}},color:{syncModels:["marker_colorlegend"],autoconfig:{index:1,type:"measure"}},color_map:{syncModels:["marker_colorlegend"],autoconfig:{}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{map:{overflowBottom:50},cursorMode:"arrow",panWithArrow:!0,adaptMinMaxZoom:!1,zoomOnScrolling:!0,buttons:["colors","size","find","moreoptions","mapcolors","zoom","fullscreen","presentation"],dialogs:{popup:["colors","mapcolors","find","size","zoom","moreoptions"],sidebar:["colors","find","mapoptions","zoom"],moreoptions:["mapoptions","opacity","speed","size","colors","mapcolors","zoom","presentation","about"]},chart:{labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}},versionInfo:{version:"2.2.1",build:1527869735945}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(4),o=(i=r)&&i.__esModule?i:{default:i};var a=Vizabi,s=a.utils,l=a.helpers,u=l.labels,c=l["d3.dynamicBackground"],h=a.iconset,d=h.warn,f=h.question,p=Vizabi.Component.extend("extapimap",{init:function(t,e){this.name="extapimap",this.template=n(10),this.bubblesDrawing=null,this.isMobile=s.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"},{name:"data",type:"data"}];var i=this;this.model_binds={"change:time.value":function(t){i._readyOnce&&i.model.marker.getFrame(i.model.time.value,i.frameChanged.bind(i))},"change:marker.highlight":function(t){i._readyOnce&&(i.highlightMarkers(),i.updateOpacity())},"change:marker":function(t,e){i._readyOnce&&e.indexOf("scaleType")>-1&&i.ready()},"change:marker.size.extent":function(t,e){i._readyOnce&&i.entityBubbles&&(i.updateMarkerSizeLimits(),i.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){i._readyOnce&&i.redrawDataPoints(null,!1)},"change:marker.select":function(t){i._readyOnce&&(i.selectMarkers(),i.redrawDataPoints(null,!1),i.updateLabels(null),i.updateOpacity(),i.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(t){i.updateOpacity()},"change:marker.opacityRegular":function(t){i.updateOpacity()},"change:ui.map.mapStyle":function(t){i.map.layerChanged()},"change:ui.map.showBubbles":function(t){i.updateEntities(),i.redrawDataPoints(null,!0),i._reorderEntities(),i.updateOpacity()},"change:ui.map.showAreas":function(t){i.map.layerChanged()},"change:ui.map.showMap":function(t){i.map.layerChanged()},"change:ui.cursorMode":function(){var t=i.chartSvg;"plus"===i.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1)):"minus"===i.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0),t.classed("vzb-panhand",!1)):"hand"===i.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1))}},this._super(t,e),this.sScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),i.COLOR_WHITEISH="#fdfdfd",i.COLOR_WHITEISH="#fdfdfd",this._labels=new u(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.chartSvg=this.element.select("svg"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new c(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var e=this;this.on("resize",function(){e.updateSize()||e.map.rescaleMap()}),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=s.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce();var n=d3.drag().on("start",function(n,i){if((d3.event.sourceEvent.metaKey||d3.event.sourceEvent.ctrlKey)&&"arrow"==e.model.ui.cursorMode||"plus"==e.model.ui.cursorMode){e.dragAction="zooming",e.zooming=!0;var r=d3.mouse(t.graph.node());e.origin={x:r[0],y:r[1]},e.zoomRect.classed("vzb-invisible",!1)}else("hand"==e.model.ui.cursorMode||e.ui.panWithArrow&&"arrow"===e.ui.cursorMode)&&(e.dragAction="panning",e._hideEntities(),e.map.panStarted(),e.chartSvg.classed("vzb-zooming",!0))}).on("drag",function(n,i){switch(e.dragAction){case"zooming":var r=d3.mouse(t.graph.node());e.zoomRect.attr("x",Math.min(r[0],e.origin.x)).attr("y",Math.min(r[1],e.origin.y)).attr("width",Math.abs(r[0]-e.origin.x)).attr("height",Math.abs(r[1]-e.origin.y));break;case"panning":e.map.moveOver(d3.event.dx,d3.event.dy)}}).on("end",function(n,i){switch(e.dragAction){case"zooming":if(e.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),e.zooming){var r=d3.mouse(t.graph.node());Math.abs(e.origin.x-r[0])<5||Math.abs(e.origin.y-r[1])<5?(e._hideEntities(),e.map.zoomMap(r,1).then(function(){e._showEntities(300)})):e.map.zoomRectangle(e.origin.x,e.origin.y,r[0],r[1])}break;case"panning":e.map.panFinished(),e._showEntities(300),e.chartSvg.classed("vzb-zooming",!1)}if("minus"==e.model.ui.cursorMode){var o=d3.mouse(t.graph.node());e._hideEntities(),e.map.zoomMap(o,-1).then(function(){e._showEntities(300)})}e.dragAction=null,e.zooming=!1}),i=function(){if(e.model.ui.zoomOnScrolling){var t=d3.mouse(e.graph.node());return e._hideEntities(),e.map.zoomMap(t,d3.event.wheelDelta>0?1:-1).then(function(){e._showEntities(100)}),d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}};this.element.call(n),this.element.on("mousewheel",i).on("wheel",i),d3.select("body").on("keydown",function(){"arrow"!==e.model.ui.cursorMode&&"hand"!==e.model.ui.cursorMode||(d3.event.metaKey||d3.event.ctrlKey)&&e.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"!==e.model.ui.cursorMode&&"hand"!==e.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||e.element.select("svg").classed("vzb-zoomin",!1)}).on("mouseenter",function(){"arrow"!==e.model.ui.cursorMode&&"hand"!==e.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||(e.model.ui.cursorMode="arrow")}),this.root.on("resetZoom",function(){e._hideEntities(),e.map.resetZoom(500).then(function(){e._showEntities()})})},_hideEntities:function(t){this.graph.select("."+this._labels.options.LABELS_CONTAINER_CLASS).transition().duration(t).style("opacity",0),this.graph.select("."+this._labels.options.LINES_CONTAINER_CLASS).transition().duration(t).style("opacity",0),this.bubbleContainer.transition().duration(t).style("opacity",0)},_showEntities:function(t){this.graph.select("."+this._labels.options.LABELS_CONTAINER_CLASS).transition().duration(t).style("opacity",1),this.graph.select("."+this._labels.options.LINES_CONTAINER_CLASS).transition().duration(t).style("opacity",1),this.bubbleContainer.transition().duration(t).style("opacity",1)},ready:function(){var t=this;this.KEYS=s.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.map.rescaleMap(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,n){n.toString()==t.model.time.value.toString()?e&&(t.values=e,t.updateEntities(),t.updateTime(),t.map.ready(),t.map.updateColors(),t._labels.ready(),t.highlightMarkers(),t.selectMarkers(),t.updateDoubtOpacity(),t.updateOpacity()):s.defer(function(){t.ready()})})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1),this._reorderEntities(),this.map.updateColors())},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=t.model.marker.size.getConceptprops(),n=t.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:n.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),s.setIcon(this.dataWarningEl,d).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(f).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),n=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),i=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(n.x+r.left-i.left,n.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(f).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(n.description||n.sourceLink))),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),n=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),i=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(n.x+r.left-i.left,n.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t=void 0;if(this.isMobile&&this.model.marker.select&&1===this.model.marker.select.length&&(t=this.model.marker.select[0]),this.hovered||t){var e=this.model.marker.size.getConceptprops(),n=this.model.marker.color.getConceptprops(),i=this.hovered||t,r=this.model.marker.size.getTickFormatter(),o=this.model.marker.color.getTickFormatter(),a=e.unit||"",l=n.unit||"",u=this.values.size[s.getKey(i,this.dataKeys.size)],c=this.values.color[s.getKey(i,this.dataKeys.color)];this.model.marker.color.isDiscrete()&&c&&(c=this.model.marker.color.getColorlegendMarker().label.getItems()[c]||""),this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+r(u)+" "+a),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+(c||0===c?o(c)+" "+l:this.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this;this.map.updateOpacity(),this.entityBubbles.style("opacity",function(e){return t.getOpacity(e)}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var e=t.model.marker.opacitySelectDim<.01;e!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(n){return t.someSelected&&e&&!t.model.marker.isSelected(n)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},getMapOpacity:function(t){if(this.model.ui.map.showBubbles)return this.model.marker.opacitySelectDim;var e={};return e[this.KEY]=t,this.getOpacity(e)},getOpacity:function(t){return this.someHighlighted&&this.model.marker.isHighlighted(t)?this.model.marker.opacityRegular:this.someSelected?this.model.marker.isSelected(t)?this.model.marker.opacityRegular:this.model.marker.opacitySelectDim:this.someHighlighted?this.model.marker.opacitySelectDim:this.model.marker.opacityRegular},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this.mcScale=this.model.marker.color_map.getScale()},updateEntities:function(){var t=this,e=this.KEYS,n=this.KEY,i=this.TIMEDIM,r=this.model.time.end;this.model.marker.setVisible(function(o){return o=o||"",t.model.marker.getKeys().map(function(a){var l=Object.assign({},a);return l[i]=r,l.sortValue=t.values.size[s.getKey(a,t.dataKeys.size)]||0,l[n]=o+s.getKey(a,e),l}).sort(function(t,e){return e.sortValue-t.sortValue})}.call(this)),this.model.time.splash||this.unselectBubblesWithNoData();var o=[];this.model.ui.map.showBubbles&&(o=this.model.marker.getVisible()),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(o,function(t){return t[n]}),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,n){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t._interact()._mouseover(e,n)}).on("mouseout",function(e,n){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t._interact()._mouseout(e,n)}).on("click",function(e,n){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||(t._interact()._click(e,n),t.highlightMarkers())}).onTap(function(e,n){t._interact()._click(e,n),d3.event.stopPropagation()}).onLongTap(function(t,e){}).merge(this.entityBubbles),this._reorderEntities()},_reorderEntities:function(){var t=this;this.KEY;this.bubbleContainer.selectAll(".vzb-bmc-bubble").sort(function(e,n){var i=t.values.size[s.getKey(e,t.dataKeys.size)],r=t.values.size[s.getKey(n,t.dataKeys.size)];return void 0===i&&void 0!==r?-1:void 0!==i&&void 0===r?1:d3.descending(i,r)})},unselectBubblesWithNoData:function(t){var e=this;this.KEY;t||(t=this.values),t&&t.size&&this.model.marker.select.forEach(function(n){var i=t.size[s.getKey(n,e.dataKeys.size)];i||0===i||e.model.marker.selectMarker(n)})},_getPosition:function(t){var e=this.dataKeys;return this.values.hook_lat&&this.values.hook_lat[s.getKey(t,e.hook_lat)]?this.map.geo2Point(this.values.hook_lat[s.getKey(t,e.hook_lat)],this.values.hook_lng[s.getKey(t,e.hook_lng)]):this.values.hook_centroid&&this.values.hook_centroid[s.getKey(t,e.hook_centroid)]?this.map.centroid(this.values.hook_centroid[s.getKey(t,e.hook_centroid)]):(s.warn("_getPosition(): was unable to resolve bubble positions either via lat/long or centroid"),[0,0])},redrawDataPoints:function(t,e){var n=this;if(t||(t=this.duration),!this.entityBubbles)return s.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!");var i=this.dataKeys,r=this.values;this.entityBubbles.each(function(o,a){var l=d3.select(this),u=r.size[s.getKey(o,i.size)],c=r.color[s.getKey(o,i.color)],h=r.label[s.getKey(o,i.label)],d=r.hook_centroid[s.getKey(o,i.hook_centroid)];if(o.hidden_1=o.hidden,e){var f=n._getPosition(o);f&&(o.cLoc=f,l.attr("cx",o.cLoc[0]).attr("cy",o.cLoc[1]))}o.hidden=!u&&0!==u||null==d||!o.cLoc,o.hidden!==o.hidden_1&&(t?l.transition().duration(t).ease(d3.easeLinear).style("opacity",0).on("end",function(){return l.classed("vzb-hidden",o.hidden).style("opacity",n.model.marker.opacityRegular)}):o.hidden?l.classed("vzb-hidden",o.hidden):o.cLoc&&l.classed("vzb-hidden",o.hidden)),o.hidden?n._updateLabel(o,a,0,0,u,c,h,t):(o.r=s.areaToRadius(n.sScale(u||0)),o.label=h,l.classed("vzb-hidden",!1).attr("fill",null!=c?n.cScale(c):n.COLOR_WHITEISH),t?l.transition().duration(t).ease(d3.easeLinear).attr("r",o.r):l.interrupt().attr("r",o.r).transition(),n._updateLabel(o,a,o.cLoc[0],o.cLoc[1],u,c,o.label,t))})},updateLabels:function(t){var e=this,n=this,i=this.dataKeys;this.model.marker.getSelected().map(function(r){var o=void 0,a=void 0,l=e.values.label[s.getKey(r,i.label)];if(r.cLoc)o=r.cLoc[0],a=r.cLoc[1];else{var u=n._getPosition(r);u&&(o=u[0],a=u[1])}var c=s.areaToRadius(n.sScale(n.values.size[s.getKey(r,i.size)]||0)),h=null!=n.values.color[s.getKey(r,i.color)]?n.cScale(n.values.color[s.getKey(r,i.color)]):n.COLOR_WHITEISH;n._updateLabel(r,null,o,a,c,h,l,t)})},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text");t.style("font-size",null);var e=this.cTitleEl.select("text");e.style("font-size",null);var n=t.node().getBBox(),i=this.cTitleEl.classed("vzb-hidden")?n:e.node().getBBox(),r=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(n.width,i.width);Math.max(n.width,i.width)>this.width?(t.style("font-size",r+"px"),e.style("font-size",r+"px")):(t.style("font-size",null),e.style("font-size",null))},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadiusPx:.5,maxRadiusEm:.05},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadiusPx:1,maxRadiusEm:.05},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadiusPx:1,maxRadiusEm:.05}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var t=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*s.hypotenuse(t.width,t.height));var e=this.activeProfile.margin;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.chartSvg.style("width",this.width+e.left+e.right+"px").style("height",this.height+e.top+e.bottom+(this.model.ui.map.overflowBottom||0)+"px"),this.height<=0||this.width<=0)return s.warn("Bubble map updateSize() abort: vizabi container is too little or has display:none");this.repositionElements()},mapBoundsChanged:function(){this.updateMarkerSizeLimits(),this.redrawDataPoints(null,!0),this.updateLabels(null)},repositionElements:function(){var t=this.activeProfile.margin,e=this.activeProfile.infoElHeight,n=this.model.locale.isRTL();this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height+t.bottom),this.yTitleEl.style("font-size",e).attr("transform","translate("+(n?this.width:0)+","+t.top+")");var i=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(n?this.width:0)+","+(t.top+i.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var r=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*r.height)+")").select("text"),this.yInfoEl.select("svg").node()){var o=this.yTitleEl.node().getBBox(),a=s.transform(this.yTitleEl.node()),l=n?o.x+a.translateX-1.4*e:o.x+a.translateX+o.width+.4*e;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+l+","+(a.translateY-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var u=this.cTitleEl.node().getBBox(),c=s.transform(this.cTitleEl.node()),h=n?u.x+c.translateX-1.4*e:u.x+c.translateX+u.width+.4*e;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+h+","+(c.translateY-.8*e)+")")}},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return s.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var e=this.activeProfile.minRadiusPx,n=this.activeProfile.maxRadiusPx,i=s.radiusToArea(Math.max(n*t[0],e)),r=s.radiusToArea(Math.max(n*t[1],e)),o=i===r?[i,r]:d3.range(i,r,(r-i)/this.sScale.domain().length).concat(r);this.sScale.range(o)},_mapIteract:function(){var t=this,e={};return{_mouseover:function(n,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t.model.ui.map.showBubbles||!t.map.keys[n]||(e[t.KEY]=t.map.keys[n],t._interact()._mouseover(e))},_mouseout:function(n,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t.model.ui.map.showBubbles||!t.map.keys[n]||(e[t.KEY]=t.map.keys[n],t._interact()._mouseout(e))},_click:function(n,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t.model.ui.map.showBubbles||!t.map.keys[n]||(e[t.KEY]=t.map.keys[n],t._interact()._click(e))}}},_interact:function(){var t=this;return{_mouseover:function(e,n){t.model.time.dragging||(t.model.marker.highlightMarker(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,n){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.clearHighlighted())},_click:function(e,n){t.model.marker.selectMarker(e)}}},highlightMarkers:function(){this.someHighlighted=this.model.marker.highlight.length>0,s.isTouchDevice()&&(this.someHighlighted?this.hovered=this.model.marker.highlight[0]:this.hovered=null,this.updateTitleNumbers(),this.fitSizeOfTitles())},_updateLabel:function(t,e,n,i,r,o,a,l){if(t[this.KEY]!=this.druging&&(null==l&&(l=this.duration),this.model.marker.isSelected(t))){var u=t.hidden!==t.hidden_1,c={};c.labelX0=n/this.width,c.labelY0=i/this.height,c.scaledS0=r?s.areaToRadius(this.sScale(r)):null,c.scaledC0=null!=o?this.cScale(o):this.COLOR_WHITEISH;var h=this.model.marker.getCompoundLabelText(t,this.values);this._labels.updateLabel(t,e,c,n/this.width,i/this.height,r,o,h,null,l,u)}},selectMarkers:function(){this.KEY;this.someSelected=this.model.marker.select.length>0,s.isTouchDevice()?(this._labels.showCloseCross(null,!1),this.someHighlighted?this.model.marker.clearHighlighted():(this.updateTitleNumbers(),this.fitSizeOfTitles())):this.hovered&&!this.model.marker.isSelected(this.hovered)||this._setTooltip(),this.nonSelectedOpacityZero=!1},_setTooltip:function(t){if(t){this.KEY;var e=this.values,n={},i={},r=t.cLoc?t.cLoc:this._getPosition(t),o=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),a=r[0]||o[0],l=r[1]||o[1];n.valueS=e.size[s.getKey(t,this.dataKeys.size)],n.labelText=this.model.marker.getCompoundLabelText(t,e),i.labelX0=n.valueX=a/this.width,i.labelY0=n.valueY=l/this.height;t.r||s.areaToRadius(this.sScale(n.valueS)||0);i.scaledS0=t.r,i.scaledC0=null,this._labels.setTooltip(t,n.labelText,i,n)}else this._labels.setTooltip()},preload:function(){return this.initMap()},initMap:function(){return this.map=new o.default(this,"#vzb-map-background").getMap(),this.map.initMap()}});e.default=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Vizabi.Component.get("_dialog").extend("mapcolors",{init:function(t,e){this.name="mapcolors",this.components=[{component:Vizabi.Component.get("indicatorpicker"),placeholder:".vzb-caxis-selector",model:["state.time","state.marker.color_map","locale"],showHoverValues:!0},{component:Vizabi.Component.get("colorlegend"),placeholder:".vzb-clegend-container",model:["state.time","state.entities","state.marker","state.marker.color_map","locale","ui"]}],this._super(t,e),this.template=n(8)}});e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(5);var i=[{title:"Google",value:"google"},{title:"Mapbox",value:"mapbox"}],r={google:[{title:"Terrain",value:"terrain"},{title:"Grayscale",value:"terrain grayscale"},{title:"Satellite",value:"satellite"}],mapbox:[{title:"Land",value:"mapbox://styles/mapbox/streets-v9"},{title:"Grayscale",value:"mapbox://styles/mapbox/light-v9"},{title:"Satellite",value:"mapbox://styles/mapbox/satellite-v9"},{title:"Satellite Street",value:"mapbox://styles/mapbox/satellite-streets-v9"}]},o=Vizabi.Component.get("_dialog").extend("mapoptions",{init:function(t,e){var i=this;this.name="mapoptions",this.components=[],this.model_binds={"change:ui.map":function(){i._ready&&i.updateView()}},this._super(t,e),this.template=n(9)},readyOnce:function(){this._super();var t=this;this.mapLayersEl=this.element.select(".vzb-map-layers"),this.mapEngineFormEl=this.element.select(".vzb-dialog-paragraph.vzb-map-engine"),this.mapStyleFormEl=this.element.select(".vzb-dialog-paragraph.vzb-map-style");var e=this.mapEngineFormEl.selectAll("label").data(i);e.exit().remove(),e.enter().append("label").attr("for",function(t,e){return"a"+e}).each(function(e,n){d3.select(this).append("input").attr("id","a"+n).attr("type","radio").attr("name","engine").attr("value",e.value).on("change",function(){return t.setModel("mapEngine",e.value)}),d3.select(this).append("span").text(e.title)}),this.mapLayersEl.select("input[name='showBubbles']").property("checked",function(e){return t.model.ui.map.showBubbles}).on("change",function(){t.setModel("showBubbles",d3.select(this).property("checked"))}),this.mapLayersEl.select("input[name='showAreas']").property("checked",t.model.ui.map.showAreas).on("change",function(){t.setModel("showAreas",d3.select(this).property("checked"))}),this.mapLayersEl.select("input[name='showMap']").property("checked",t.model.ui.map.showMap).on("change",function(){t.setModel("showMap",d3.select(this).property("checked"))}),this.updateView()},updateView:function(){var t=this,e=this;this.mapStyleFormEl.selectAll("label").remove();var n=this.mapStyleFormEl.selectAll("label").data(r[this.model.ui.map.mapEngine]||[]);n.exit().remove(),n.enter().append("label").attr("for",function(t,e){return"a"+e}).each(function(t,n){d3.select(this).append("input").attr("id","a"+n).attr("type","radio").attr("name","layer").attr("value",t.value).on("change",function(){return e.setModel("mapStyle",t.value)}),d3.select(this).append("span").text(t.title)}),this.mapEngineFormEl.selectAll("input").property("checked",function(e){return e.value===t.model.ui.map.mapEngine}),this.mapStyleFormEl.selectAll("input").property("checked",function(e){return e.value===t.model.ui.map.mapStyle}),this.mapLayersEl.select("input[name='showBubbles']").property("checked",this.model.ui.map.showBubbles),this.mapLayersEl.select("input[name='showAreas']").property("checked",this.model.ui.map.showAreas),this.mapLayersEl.select("input[name='showMap']").property("checked",this.model.ui.map.showMap)},setModel:function(t,e){"mapEngine"===t&&this.model.ui.map.set({mapEngine:e,mapStyle:r[e][0].value}),"mapStyle"===t&&(this.model.ui.map.mapStyle=e),"showBubbles"!==t&&"showAreas"!==t&&"showMap"!==t||(this.model.ui.map[t]=e)}});e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(7)),r=o(n(11));function o(t){return t&&t.__esModule?t:{default:t}}var a=Vizabi,s=a.utils,l=a.helpers,u=l.topojson,c=l["d3.geoProjection"],h=Vizabi.Class.extend({init:function(t,e){console.warn("init method should be implemented in map instance")},initMap:function(){console.warn("initMap method should be implemented in map instance")},rescaleMap:function(){console.warn("rescaleMap method should be implemented in map instance")},moveOver:function(t,e){console.warn("moveOver method should be implemented in map instance")},getCanvas:function(){return console.warn("getCanvas method should be implemented in map instance"),[[0,0],[0,0]]},getCenter:function(){return console.warn("getCenter method should be implemented in map instance"),{lat:0,lng:0}},zoomMap:function(t,e){console.warn("zoomMap method should be implemented in map instance")},geo2Point:function(t,e){return console.warn("geo2Point method should be implemented in map instance"),[0,0]},point2Geo:function(t,e){return console.warn("point2Geo method should be implemented in map instance"),[0,0]}}),d=h.extend({init:function(t,e){this.shapes=null,this.mapLands=[],this.parent=e,this.resolvedCentroidCache={},this.context=t,this.parent=e,this.paths={},this.areasAreShown=!1,c()},initMap:function(){var t=this,e=this;this.mapGraph=this.parent.mapSvg.html("").append("g").attr("class","vzb-bmc-map-graph");var n=s.getProp(this.context,["model","ui","map","topology","path"])||"assets/world-50m.json",i="geo"+s.capitalize(this.context.model.ui.map.projection);return this.zeroProjection=d3[i](),this.zeroProjection.scale(1).translate([0,0]),this.projection=d3[i](),this.projection.scale(1).translate([0,0]),this.mapPath=d3.geoPath().projection(this.projection),this.context.model.ui.map.scale=1,this._loadShapes(n).then(function(n){e.shapes=n,e.mapFeature=u.feature(e.shapes,e.shapes.objects[t.context.model.ui.map.topology.objects.geo]),e.mapBounds=e.mapPath.bounds(e.mapFeature),e.boundaries=u.mesh(e.shapes,e.shapes.objects[e.context.model.ui.map.topology.objects.boundaries],function(t,e){return t!==e}),e.mapFeature.features&&s.forEach(e.mapFeature.features,function(t,n){t.key=t.properties[e.context.model.ui.map.topology.geoIdProperty]?t.properties[e.context.model.ui.map.topology.geoIdProperty].toString().toLowerCase():t.id,e.paths[t.key]=t})})},showAreas:function(){var t=this;this.areasAreShown=!0,t.mapFeature.features?t.mapLands=t.mapGraph.selectAll(".land").data(t.mapFeature.features).enter().insert("path").attr("d",t.mapPath).attr("class","land").style("opacity",t.context.model.marker.opacitySelectDim).on("mouseover",function(e,n){t.parent._interact()._mouseover(e.key)}).on("mouseout",function(e,n){t.parent._interact()._mouseout(e.key)}).on("click",function(e,n){t.parent._interact()._click(e.key)}).onTap(function(e,n){t.parent._interact()._click(e.key),d3.event.stopPropagation()}).each(function(e,n){d3.select(this).attr("id",e.key).style("opacity",function(e){return t.parent.getOpacity(e.key)}).style("fill",function(e){return t.parent.getMapColor(e.key)})}):t.mapGraph.insert("path").datum(t.mapFeature).attr("class","land"),t.mapGraph.insert("path").datum(t.boundaries).attr("class","boundary")},hideAreas:function(){this.areasAreShown=!1,this.mapGraph.selectAll("*").remove()},updateOpacity:function(){var t=this;this.mapLands.style("opacity",function(e){return t.parent.getOpacity(e.key)})},updateMapColors:function(){var t=this;this.mapLands.style("fill",function(e){return t.parent.getMapColor(e.key)})},_loadShapes:function(t){var e=this;return new Promise(function(n,i){e.context.model.data.getAsset(t,function(e){if(!1===e.success)return console.warn("Failed loading json "+t+". "+e.message);n(e)})})},rescaleMap:function(t,e){var n=!1,i=this.context.activeProfile?this.context.activeProfile.margin:{left:0,top:0},r=this.zeroProjection([this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north]),o=this.zeroProjection([this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south]),a=1,s=0,l=0;if(!t||e){t||(n=!0,t=[[0,0],[this.context.width,this.context.height]],s=i.top,l=i.left);var u=Math.abs((t[1][0]-t[0][0])/(o[0]-r[0])),c=Math.abs((t[1][1]-t[0][1])/(o[1]-r[1]));u!=c&&(u>c?(a=c,l+=(Math.abs(t[1][0]-t[0][0])-Math.abs(a*(r[1]-o[1])))/2):(a=u,s+=(Math.abs(t[1][1]-t[0][1])-Math.abs(a*(r[0]-o[0])))/2))}else a=Math.abs((t[1][0]-t[0][0])/(o[0]-r[0]));this.projection.translate([t[0][0]-r[0]*a+l-i.left,t[0][1]-r[1]*a+s-i.top]).scale(a).precision(.1),this.mapGraph.selectAll("path").attr("d",this.mapPath),this.parent.mapSvg.style("transform","translate("+i.left+"px,"+i.top+"px)").attr("width",this.context.width).attr("height",this.context.height);this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south);n&&this.parent.boundsChanged(!1)},centroid:function(t){if((t||0==t)&&this.paths[t]){if(this.resolvedCentroidCache[t])return this.geo2Point(this.resolvedCentroidCache[t][0],this.resolvedCentroidCache[t][1]);var e=this.mapPath.centroid(this.paths[t]);return this.resolvedCentroidCache[t]=this.point2Geo(e[0],e[1]),e}return null},geo2Point:function(t,e){return this.projection([t||0,e||0])},point2Geo:function(t,e){return this.projection.invert([t||0,e||0])},getCanvas:function(){return[this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},moveOver:function(t,e){var n=this.projection.translate();this.projection.translate([n[0]+t,n[1]+e]),this.mapGraph.selectAll("path").attr("d",this.mapPath)},zoomMap:function(t,e){var n=this;return new Promise(function(i){var r=n.geo2Point(t[0],t[1]),o=n.context.activeProfile?n.context.activeProfile.margin:{left:0,top:0},a=o.left,s=o.top,l=Math.min(2,Math.max(0,r[0]/n.context.width*2)),u=Math.min(2,Math.max(0,r[1]/n.context.height*2)),c=.1*n.context.width*e,h=.1*n.context.height*e;n.rescaleMap([[-c*l+a,-h*u+s],[n.context.width+c*(2-l)+a,n.context.height+h*(2-u)+s]],!0),i()})}}),f=h.extend({init:function(t,e){this.context=t,this.parent=e,this.bounds=null,this.transformation=null},initMap:function(t){var e=this,n=this;return this.mapCanvas=this.parent.mapRoot,this.mapCanvas.style("width","100%").style("height","100%"),i.default.KEY="AIzaSyAP0vMZwYojifwGYHTnEtYV40v6-MdLGFM",new Promise(function(t,r){i.default.load(function(i){n.map=new i.maps.Map(n.mapCanvas.node(),{draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0,disableDefaultUI:!0,backgroundColor:"#FFFFFF"}),n.updateLayer(),n.overlay=new i.maps.OverlayView,n.overlay.draw=function(){},n.overlay.setMap(n.map),i.maps.event.addListener(n.map,"bounds_changed",function(){!e.transformation instanceof Promise&&(e.transformation=new Promise(function(t){i.maps.event.addListenerOnce(n.map,"idle",function(){t(),e.transformation=null})}))}),i.maps.event.addListenerOnce(n.map,"idle",function(){var t=new i.maps.LatLngBounds(new i.maps.LatLng(n.context.model.ui.map.bounds.north,n.context.model.ui.map.bounds.west),new i.maps.LatLng(n.context.model.ui.map.bounds.south,n.context.model.ui.map.bounds.east));n.map.fitBounds(t),i.maps.event.trigger(n.map,"resize")}),t()})})},_waitMap:function(){return this.transformation instanceof Promise?this.transformation:new Promise(function(t){return t()})},updateLayer:function(){if(this.map){var t=this.context.model.ui.map.mapStyle.split(" ");if(this.map.setMapTypeId(t[0]),t[1])switch(t[1]){case"grayscale":this.map.setOptions({styles:[{stylers:[{saturation:-100}]}]});break;default:this.map.setOptions({styles:[]})}else this.map.setOptions({styles:[]})}},rescaleMap:function(){var t=this;this._waitMap().then(function(){var e=new google.maps.LatLngBounds(new google.maps.LatLng(t.context.model.ui.map.bounds.north,t.context.model.ui.map.bounds.west),new google.maps.LatLng(t.context.model.ui.map.bounds.south,t.context.model.ui.map.bounds.east));t.map.fitBounds(e),google.maps.event.trigger(t.map,"resize"),google.maps.event.addListener(t.map,"idle",function(){var e=t.map.getBounds();!e||t.bounds&&t.bounds==e||(t.bounds=e,t.parent.boundsChanged())})})},zoomMap:function(t,e){var n=this,i=this;return new Promise(function(r,o){var a=n.geo2Point(t[0],t[1]);i.map.setZoom(i.map.getZoom()+1*e);var s=n.geo2Point(t[0],t[1]);i.map.panBy(s[0]-a[0],s[1]-a[1]),google.maps.event.addListenerOnce(i.map,"idle",function(){r()})})},geo2Point:function(t,e){var n=this.overlay.getProjection();if(!n)return null;var i=n.fromLatLngToContainerPixel(new google.maps.LatLng(e,t));return[i.x,i.y]},point2Geo:function(t,e){var n=this.map.getProjection(),i=this.map.getBounds().getNorthEast(),r=this.map.getBounds().getSouthWest(),o=n.fromLatLngToPoint(i),a=n.fromLatLngToPoint(r),s=Math.pow(2,this.map.getZoom()),l=n.fromPointToLatLng(new google.maps.Point(t/s+a.x,e/s+o.y));return[l.lng(),l.lat()]},moveOver:function(t,e){var n=this;return new Promise(function(i,r){n.map.panBy(-t,-e),google.maps.event.addListenerOnce(n.map,"idle",function(){i()})})},getZoom:function(){return this.map.getZoom()},getCanvas:function(){return[this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},getCenter:function(){var t=this.map.getCenter();return{lat:t.lat(),lng:t.lng()}}}),p=h.extend({init:function(t,e){r.default.accessToken=t.model.ui.map.accessToken||"pk.eyJ1Ijoic2VyZ2V5ZiIsImEiOiJjaXlqeWo5YnYwMDBzMzJwZnlwZXJ2bnA2In0.e711ku9KzcFW_x5wmOZTag",this.context=t,this.parent=e},initMap:function(){var t=this,e=this;return this.mapCanvas=this.parent.mapRoot,new Promise(function(n,i){e.map=new r.default.Map({container:e.mapCanvas.node(),interactive:!1,style:t.context.model.ui.map.mapStyle,hash:!1}),e.bounds=[[e.context.model.ui.map.bounds.west,e.context.model.ui.map.bounds.south],[e.context.model.ui.map.bounds.east,e.context.model.ui.map.bounds.north]],e.map.fitBounds(e.bounds),n()})},rescaleMap:function(t){var e=this;e.bounds=[[e.context.model.ui.map.bounds.west,e.context.model.ui.map.bounds.south],[e.context.model.ui.map.bounds.east,e.context.model.ui.map.bounds.north]],s.defer(function(){t||(t=0),e.map.fitBounds(e.bounds,{duration:t}),e.map.resize(),t?s.delay(t).then(function(){e.parent.boundsChanged()}):e.parent.boundsChanged()})},getCenter:function(){var t=this.map.getCenter();return{lat:t.lat,lng:t.lng}},moveOver:function(t,e){this.map.panBy([-t,-e],{duration:0})},zoomMap:function(t,e){var n=this,i=this;return new Promise(function(r,o){n.map.easeTo({duration:300,around:t,zoom:i.map.getZoom()+1*e}),s.delay(300).then(function(){r()})})},updateLayer:function(){this.map&&this.map.setStyle(this.context.model.ui.map.mapStyle)},getCanvas:function(){return[this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},geo2Point:function(t,e){var n=this.map.project([t,e]);return[n.x,n.y]},point2Geo:function(t,e){var n=this.map.unproject([t,e]);return[n.lng,n.lat]}});e.default=Vizabi.Class.extend({init:function(t,e){return this.context=t,this.domSelector=e,this.zooming=!1,this.topojsonMap=null,this.keys={},this.mapEngine=this.context.model.ui.map.mapEngine,this.mapInstance=null,this.context.element instanceof d3.selection?(this.mapRoot=this.context.element.select(e),this.mapSvg=this.context.element.select(".vzb-bmc-map-background")):(this.mapRoot=d3.select(this.context.element).select(e),this.mapSvg=d3.select(this.context.element).select(".vzb-bmc-map-background")),this.mapRoot.html(""),this.mapSvg.html(""),this},getMap:function(){if(!this.mapInstance){if(this.context.model.ui.map.showMap)switch(this.context.model.ui.map.mapEngine){case"google":this.mapInstance=new f(this.context,this);break;case"mapbox":this.mapInstance=new p(this.context,this)}return this.topojsonMap||(this.topojsonMap=new d(this.context,this)),this}},initMap:function(){var t=this;if(!this.mapInstance)return this.topojsonMap.initMap(this.domSelector).then(function(){t.topojsonMap.showAreas()});var e=this.topojsonMap.initMap(this.domSelector);return this.context.model.ui.map.showAreas&&e.then(function(){t.topojsonMap.showAreas()}),Promise.all([this.mapInstance.initMap(this.domSelector),e])},ready:function(){var t=this,e=this;this._bounds=null;var n=void 0,i=void 0,r=void 0,o=void 0;if(this.keys=Object.keys(e.context.values.hook_centroid).reduce(function(t,n){return t[e.context.values.hook_centroid[n]]=n,t},{}),s.forEach(this.keys,function(e,a){var s=t.topojsonMap.centroid(a);s&&((!n&&0!=n||n>s[0])&&(n=s[0]),(!r&&0!=r||r<s[0])&&(r=s[0]),(!i&&0!=i||i>s[1])&&(i=s[1]),(!o&&0!=o||o<s[1])&&(o=s[1]))}),n<r&&i<o){var a=this.topojsonMap.point2Geo(n,i),l=this.topojsonMap.point2Geo(r,o);this._bounds={west:a[0],north:a[1],east:l[0],south:l[1]}}this.context.mapBoundsChanged()},rescaleMap:function(){if(this.mapInstance){var t=this.context.activeProfile.margin;this.mapRoot.style("position","absolute").style("left",0).style("right",0).style("top",0).style("bottom",0).style("width",this.context.width+t.left+t.right+"px").style("height",this.context.height+t.top+t.bottom+(this.context.model.ui.map.overflowBottom||0)+"px"),this.mapInstance.rescaleMap()}else this.topojsonMap.rescaleMap()},layerChanged:function(){var t=this;this.mapEngine==this.context.model.ui.map.mapEngine&&this.context.model.ui.map.showMap&&this.mapInstance?(this.topojsonMap.areasAreShown!=this.context.model.ui.map.showAreas&&(this.context.model.ui.map.showAreas?this.topojsonMap.showAreas():this.topojsonMap.hideAreas()),this.mapInstance.updateLayer()):(this.mapEngine=this.context.model.ui.map.mapEngine,this.mapInstance=null,this.mapRoot.html(""),this.getMap(),this.initMap(this.domSelector).then(function(){t.mapInstance?t.mapInstance.rescaleMap():t.topojsonMap.rescaleMap()}))},getMapColor:function(t){return this.keys[t]?this.context.mcScale(this.context.values.color_map[this.keys[t]]):this.context.COLOR_WHITEISH},getOpacity:function(t){return this.keys[t]?this.context.getMapOpacity(this.keys[t]):this.context.COLOR_WHITEISH},updateColors:function(){this.context.model.ui.map.showAreas&&this.topojsonMap.updateMapColors()},_getCenter:function(){return this.mapInstance?this.mapInstance.getCenter():this.topojsonMap.getCenter()},resetZoom:function(t){var e=this;if(this._bounds)return this._hideTopojson(),this.context.model.ui.map.bounds={west:this._bounds.west,north:this._bounds.north,east:this._bounds.east,south:this._bounds.south},this.mapInstance?this.mapInstance.rescaleMap(t):this.topojsonMap.rescaleMap(t),t||(t=0),new Promise(function(n,i){s.delay(t).then(function(){e._showTopojson(300),n()})})},panStarted:function(){this.zooming=!0,this.context.model.ui.map.showMap&&this._hideTopojson(),this.canvasBefore=this.getCanvas()},panFinished:function(){var t=this.point2Geo(this.canvasBefore[0][0],this.canvasBefore[0][1]),e=this.point2Geo(this.canvasBefore[1][0],this.canvasBefore[1][1]);this.context.model.ui.map.bounds={west:t[0],north:t[1],east:e[0],south:e[1]},this.zooming=!1,this.boundsChanged(),this._showTopojson(300)},zoomRectangle:function(t,e,n,i){var r=this.point2Geo(Math.min(t,n),Math.min(e,i)),o=this.point2Geo(Math.max(t,n),Math.max(e,i));this.context.model.ui.map.bounds={west:r[0],north:r[1],east:o[0],south:o[1]},this.zooming=!1,this.mapInstance?this.mapInstance.rescaleMap():this.topojsonMap.rescaleMap(),this._showTopojson(300)},moveOver:function(t,e){if(this.mapInstance)return this.mapInstance.moveOver(t,e);this.topojsonMap.moveOver(t,e)},_interact:function(){return this.context._mapIteract()},updateOpacity:function(){this.context.model.ui.map.showAreas&&this.topojsonMap.updateOpacity()},_hideTopojson:function(t){this.context.model.ui.map.showAreas&&(t?this.topojsonMap.mapGraph.transition().duration(t).style("opacity",0):this.topojsonMap.mapGraph.style("opacity",0))},_showTopojson:function(t){this.context.model.ui.map.showAreas&&this.topojsonMap.mapGraph.interrupt().transition().duration(t).style("opacity",t)},zoomMap:function(t,e){var n=this,i=this,r=this.point2Geo(t[0],t[1]);this.canvasBefore=this.getCanvas(),this.zooming=!0,this.context.model.ui.map.showMap&&this._hideTopojson(100);var o=void 0;return this.mapInstance?o=this.mapInstance.zoomMap(r,e):this.context.model.ui.map.showAreas&&(o=this.topojsonMap.zoomMap(r,e)),o.then(function(t){var e=n.point2Geo(n.canvasBefore[0][0],n.canvasBefore[0][1]),r=n.point2Geo(n.canvasBefore[1][0],n.canvasBefore[1][1]);i.context.model.ui.map.bounds={west:e[0],north:e[1],east:r[0],south:r[1]},n.zooming=!1,n.boundsChanged(),n._showTopojson(300)})},boundsChanged:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.zooming){if(t){var e=void 0;this.mapInstance&&(e=this.mapInstance.getCanvas()),this.topojsonMap.rescaleMap(e)}this.context.mapBoundsChanged()}},centroid:function(t){return this.topojsonMap?this.topojsonMap.centroid(t):null},getCanvas:function(){return this.mapInstance?this.mapInstance.getCanvas():this.context.model.ui.map.showAreas?this.topojsonMap.getCanvas():[[0,0],[0,0]]},point2Geo:function(t,e){return this.mapInstance?this.mapInstance.point2Geo(t,e):this.context.model.ui.map.showAreas?this.topojsonMap.point2Geo(t,e):[0,0]},geo2Point:function(t,e){return this.mapInstance?this.mapInstance.geo2Point(t,e):this.context.model.ui.map.showAreas?this.topojsonMap.geo2Point(t,e):[0,0]}})},function(t,e){},function(t,e){},function(t,e,n){var i,r;!function(o,a){if(null===o)throw new Error("Google-maps package can be used only in browser");void 0===(r="function"==typeof(i=a)?i.call(e,n,e,t):i)||(t.exports=r)}("undefined"!=typeof window?window:null,function(){"use strict";var t=null,e=null,n=!1,i=[],r=[],o=null,a={URL:"https://maps.googleapis.com/maps/api/js",KEY:null,LIBRARIES:[],CLIENT:null,CHANNEL:null,LANGUAGE:null,REGION:null,VERSION:"3.31",WINDOW_CALLBACK_NAME:"__google_maps_api_provider_initializator__",_googleMockApiObject:{},load:function(t){null===e?!0===n?t&&i.push(t):(n=!0,window[a.WINDOW_CALLBACK_NAME]=function(){s(t)},a.createLoader()):t&&t(e)},createLoader:function(){(t=document.createElement("script")).type="text/javascript",t.src=a.createUrl(),document.body.appendChild(t)},isLoaded:function(){return null!==e},createUrl:function(){var t=a.URL;return t+="?callback="+a.WINDOW_CALLBACK_NAME,a.KEY&&(t+="&key="+a.KEY),a.LIBRARIES.length>0&&(t+="&libraries="+a.LIBRARIES.join(",")),a.CLIENT&&(t+="&client="+a.CLIENT),a.CHANNEL&&(t+="&channel="+a.CHANNEL),a.LANGUAGE&&(t+="&language="+a.LANGUAGE),a.REGION&&(t+="&region="+a.REGION),a.VERSION&&(t+="&v="+a.VERSION),t},release:function(s){var l=function(){a.KEY=null,a.LIBRARIES=[],a.CLIENT=null,a.CHANNEL=null,a.LANGUAGE=null,a.REGION=null,a.VERSION="3.31",e=null,n=!1,i=[],r=[],void 0!==window.google&&delete window.google,void 0!==window[a.WINDOW_CALLBACK_NAME]&&delete window[a.WINDOW_CALLBACK_NAME],null!==o&&(a.createLoader=o,o=null),null!==t&&(t.parentElement.removeChild(t),t=null),s&&s()};n?a.load(function(){l()}):l()},onLoad:function(t){r.push(t)},makeMock:function(){o=a.createLoader,a.createLoader=function(){window.google=a._googleMockApiObject,window[a.WINDOW_CALLBACK_NAME]()}}},s=function(t){var o;for(n=!1,null===e&&(e=window.google),o=0;o<r.length;o++)r[o](e);for(t&&t(e),o=0;o<i.length;o++)i[o](e);i=[]};return a})},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="mapcolors" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="mapcolors" data-click="dragDialog"></span>\n\n  <div class="vzb-dialog-title">\n      <%=t ("buttons/mapcolors") %>\n      <span class="vzb-caxis-selector"></span>\n  </div>\n\n\n\n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-clegend-container"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="mapoptions" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="mapoptions" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title">\n        <%=t ("buttons/mapoptions") %>\n    </div>\n    <div class="vzb-dialog-content">\n        <div class="vzb-lmap-container vzb-lmap-layers">\n            <form class="vzb-dialog-paragraph  vzb-map-layers">\n                <label for="showBubblesChk"><input id="showBubblesChk" type="checkbox" name="showBubbles"><%=t ("hints/extapimap/showBubbles") %></label>\n                <label for="showAreasChk"><input id="showAreasChk" type="checkbox" name="showAreas"><%=t ("hints/extapimap/showAreas") %></label>\n                <label for="showMapChk"><input id="showMapChk" type="checkbox" name="showMap"><%=t ("hints/extapimap/showMap") %></label>\n            </form>\n        </div>\n        <div class="vzb-lmap-container vzb-lmap-engine">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/extapimap/mapEngine") %></p>\n            <form class="vzb-dialog-paragraph vzb-map-engine"></form>\n        </div>\n        <div class="vzb-lmap-container vzb-lmap-style">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/extapimap/mapStyle") %></p>\n            <form class="vzb-dialog-paragraph  vzb-map-style"></form>\n        </div>\n    </div>\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <%=t ("buttons/ok") %>\n        </div>\n    </div>\n</div>'},function(t,e){t.exports='\x3c!-- Bubble Map Chart Component --\x3e\n<div class="vzb-extapimap">\n    <div id="vzb-map-background"></div>\n    <svg class="vzb-extapimap-svg vzb-export">\n        <g class="vzb-bmc-map-background"></g>\n        <g class="vzb-bmc-graph">\n            <g class="vzb-bmc-year"></g>\n\n            <g class="vzb-bmc-lines"></g>\n            <g class="vzb-bmc-bubbles"></g>\n\n            <g class="vzb-bmc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-c-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-y-info vzb-noexport">\n            </g>\n\n            <g class="vzb-bmc-axis-c-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n            <g class="vzb-bmc-labels"></g>\n\n            <rect class="vzb-bc-zoom-rect"></rect>\n        </g>\n    </svg>\n</div>\n'},function(t,e,n){(function(e){var n,i;i=function(){return function t(e,i,r){function o(s,l){if(!i[s]){if(!e[s]){if(!l&&("function"==typeof n&&n))return n(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n||t)},c,c.exports,t,e,i,r)}return i[s].exports}for(var a="function"==typeof n&&n,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){var i,r;i=this,r=function(){"use strict";return function(){var t=new Float32Array(3);t[0]=0,t[1]=0,t[2]=0}(),function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}(),{vec3:{transformMat3:function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t}},vec4:{transformMat4:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*a,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*a,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*a,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*a,t}},mat2:{create:function(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},rotate:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*s,t[1]=r*l+a*s,t[2]=i*-s+o*l,t[3]=r*-s+a*l,t},scale:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],l=n[1];return t[0]=i*s,t[1]=r*s,t[2]=o*l,t[3]=a*l,t}},mat3:{create:function(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromRotation:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}},mat4:{create:function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},translate:function(t,e,n){var i,r,o,a,s,l,u,c,h,d,f,p,m=n[0],v=n[1],g=n[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=d,t[10]=f,t[11]=p,t[12]=i*m+s*v+h*g+e[12],t[13]=r*m+l*v+d*g+e[13],t[14]=o*m+u*v+f*g+e[14],t[15]=a*m+c*v+p*g+e[15]),t},scale:function(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},multiply:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*i+b*s+x*h+w*m,t[1]=_*r+b*l+x*d+w*v,t[2]=_*o+b*u+x*f+w*g,t[3]=_*a+b*c+x*p+w*y,_=n[4],b=n[5],x=n[6],w=n[7],t[4]=_*i+b*s+x*h+w*m,t[5]=_*r+b*l+x*d+w*v,t[6]=_*o+b*u+x*f+w*g,t[7]=_*a+b*c+x*p+w*y,_=n[8],b=n[9],x=n[10],w=n[11],t[8]=_*i+b*s+x*h+w*m,t[9]=_*r+b*l+x*d+w*v,t[10]=_*o+b*u+x*f+w*g,t[11]=_*a+b*c+x*p+w*y,_=n[12],b=n[13],x=n[14],w=n[15],t[12]=_*i+b*s+x*h+w*m,t[13]=_*r+b*l+x*d+w*v,t[14]=_*o+b*u+x*f+w*g,t[15]=_*a+b*c+x*p+w*y,t},perspective:function(t,e,n,i,r){var o=1/Math.tan(e/2),a=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=0,t},rotateX:function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*i,t[5]=a*r+c*i,t[6]=s*r+h*i,t[7]=l*r+d*i,t[8]=u*r-o*i,t[9]=c*r-a*i,t[10]=h*r-s*i,t[11]=d*r-l*i,t},rotateZ:function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*i,t[1]=a*r+c*i,t[2]=s*r+h*i,t[3]=l*r+d*i,t[4]=u*r-o*i,t[5]=c*r-a*i,t[6]=h*r-s*i,t[7]=d*r-l*i,t},invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=n*s-i*a,_=n*l-r*a,b=n*u-o*a,x=i*l-r*s,w=i*u-o*s,S=r*u-o*l,M=c*m-h*p,E=c*v-d*p,z=c*g-f*p,k=h*v-d*m,T=h*g-f*m,O=d*g-f*v,P=y*O-_*T+b*k+x*z-w*E+S*M;return P?(P=1/P,t[0]=(s*O-l*T+u*k)*P,t[1]=(r*T-i*O-o*k)*P,t[2]=(m*S-v*w+g*x)*P,t[3]=(d*w-h*S-f*x)*P,t[4]=(l*z-a*O-u*E)*P,t[5]=(n*O-r*z+o*E)*P,t[6]=(v*b-p*S-g*_)*P,t[7]=(c*S-d*b+f*_)*P,t[8]=(a*T-s*z+u*M)*P,t[9]=(i*z-n*T-o*M)*P,t[10]=(p*w-m*b+g*y)*P,t[11]=(h*b-c*w-f*y)*P,t[12]=(s*E-a*k-l*M)*P,t[13]=(n*k-i*E+r*M)*P,t[14]=(m*_-p*x-v*y)*P,t[15]=(c*x-h*_+d*y)*P,t):null},ortho:function(t,e,n,i,r,o,a){var s=1/(e-n),l=1/(i-r),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*l,t[14]=(a+o)*u,t[15]=1,t}}}},"object"==typeof n&&void 0!==e?e.exports=r():i.glMatrix=r()},{}],2:[function(t,e,n){var i,r;i=this,r=function(){function t(t,e,n){n=n||{},this.w=t||64,this.h=e||64,this.autoResize=!!n.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function e(t,e,n){this.x=0,this.y=t,this.w=this.free=e,this.h=n}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var n,i,r,o,a=[],s=0;s<t.length;s++)if(n=t[s].w||t[s].width,i=t[s].h||t[s].height,r=t[s].id,n&&i){if(!(o=this.packOne(n,i,r)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),a.push(o)}if(this.shelves.length>0){for(var l=0,u=0,c=0;c<this.shelves.length;c++){var h=this.shelves[c];u+=h.h,l=Math.max(h.w-h.free,l)}this.resize(l,u)}return a},t.prototype.packOne=function(t,n,i){var r,o,a,s,l,u,c,h,d={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof i||"number"==typeof i){if(r=this.getBin(i))return this.ref(r),r;"number"==typeof i&&(this.maxId=Math.max(i,this.maxId))}else i=++this.maxId;for(s=0;s<this.freebins.length;s++){if(n===(r=this.freebins[s]).maxh&&t===r.maxw)return this.allocFreebin(s,t,n,i);n>r.maxh||t>r.maxw||n<=r.maxh&&t<=r.maxw&&((a=r.maxw*r.maxh-t*n)<d.waste&&(d.waste=a,d.freebin=s))}for(s=0;s<this.shelves.length;s++)if(f+=(o=this.shelves[s]).h,!(t>o.free)){if(n===o.h)return this.allocShelf(s,t,n,i);n>o.h||n<o.h&&((a=(o.h-n)*t)<d.waste&&(d.freebin=-1,d.waste=a,d.shelf=s))}return-1!==d.freebin?this.allocFreebin(d.freebin,t,n,i):-1!==d.shelf?this.allocShelf(d.shelf,t,n,i):n<=this.h-f&&t<=this.w?(o=new e(f,this.w,n),this.allocShelf(this.shelves.push(o)-1,t,n,i)):this.autoResize?(l=u=this.h,((c=h=this.w)<=l||t>c)&&(h=2*Math.max(t,c)),(l<c||n>l)&&(u=2*Math.max(n,l)),this.resize(h,u),this.packOne(t,n,i)):null},t.prototype.allocFreebin=function(t,e,n,i){var r=this.freebins.splice(t,1)[0];return r.id=i,r.w=e,r.h=n,r.refcount=0,this.bins[i]=r,this.ref(r),r},t.prototype.allocShelf=function(t,e,n,i){var r=this.shelves[t].alloc(e,n,i);return this.bins[i]=r,this.ref(r),r},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var n=0;n<this.shelves.length;n++)this.shelves[n].resize(t);return!0},e.prototype.alloc=function(t,e,n){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new function(t,e,n,i,r,o,a){this.id=t,this.x=e,this.y=n,this.w=i,this.h=r,this.maxw=o||i,this.maxh=a||r,this.refcount=0}(n,i,this.y,t,e,t,this.h)},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t},"object"==typeof n&&void 0!==e?e.exports=r():i.ShelfPack=r()},{}],3:[function(t,e,n){function i(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}e.exports=i,i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var n,i,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if(i=1,(r=t)<(n=0))return n;if(r>i)return i;for(;n<i;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},{}],4:[function(t,e,n){var i;i=this,function(t){function e(t,e,i){var r=n(256*t,256*(e=Math.pow(2,i)-e-1),i),o=n(256*(t+1),256*(e+1),i);return r[0]+","+r[1]+","+o[0]+","+o[1]}function n(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}t.getURL=function(t,n,i,r,o,a){return a=a||{},t+"?"+["bbox="+e(i,r,o),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+n].join("&")},t.getTileBBox=e,t.getMercCoords=n,Object.defineProperty(t,"__esModule",{value:!0})}("object"==typeof n&&void 0!==e?n:i.WhooTS=i.WhooTS||{})},{}],5:[function(t,e,n){"use strict";function i(t,e,n){n=n||2;var i,s,l,u,c,f,m,v=e&&e.length,g=v?e[0]*n:t.length,y=r(t,0,g,n,!0),_=[];if(!y)return _;if(v&&(y=function(t,e,n,i){var a,s,l,u,c,f=[];for(a=0,s=e.length;a<s;a++)l=e[a]*i,u=a<s-1?e[a+1]*i:t.length,(c=r(t,l,u,i,!1))===c.next&&(c.steiner=!0),f.push(p(c));for(f.sort(h),a=0;a<f.length;a++)d(f[a],n),n=o(n,n.next);return n}(t,e,y,n)),t.length>80*n){i=l=t[0],s=u=t[1];for(var b=n;b<g;b+=n)c=t[b],f=t[b+1],c<i&&(i=c),f<s&&(s=f),c>l&&(l=c),f>u&&(u=f);m=Math.max(l-i,u-s)}return a(y,_,n,i,s,m),_}function r(t,e,n,i,r){var o,a;if(r===E(t,e,n,i)>0)for(o=e;o<n;o+=i)a=w(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=w(o,t[o],t[o+1],a);return a&&y(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!y(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(S(i),(i=e=i.prev)===i.next)return null;n=!0}}while(n||i!==e);return e}function a(t,e,n,i,r,h,d){if(t){!d&&h&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=f(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,a,s,l,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,i=n,s=0,e=0;e<u&&(s++,i=i.nextZ);e++);for(l=u;s>0||l>0&&i;)0===s?(r=i,i=i.nextZ,l--):0!==l&&i?n.z<=i.z?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--):(r=n,n=n.nextZ,s--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,u*=2}while(a>1)}(r)}(t,i,r,h);for(var p,m,v=t;t.prev!==t.next;)if(p=t.prev,m=t.next,h?l(t,i,r,h):s(t))e.push(p.i/n),e.push(t.i/n),e.push(m.i/n),S(t),t=m.next,v=m.next;else if((t=m)===v){d?1===d?a(t=u(t,e,n),e,n,i,r,h,2):2===d&&c(t,e,n,i,r,h):a(o(t),e,n,i,r,h,1);break}}}function s(t){var e=t.prev,n=t,i=t.next;if(g(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(m(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(t,e,n,i){var r=t.prev,o=t,a=t.next;if(g(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=f(s,l,e,n,i),d=f(u,c,e,n,i),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function u(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!y(r,o)&&_(r,i,i.next,o)&&b(r,o)&&b(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),S(i),S(i.next),i=t=o),i=i.next}while(i!==t);return i}function c(t,e,n,i,r,s){var l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&v(l,u)){var c=x(l,u);return l=o(l,l.next),c=o(c,c.next),a(l,e,n,i,r,s),void a(c,e,n,i,r,s)}u=u.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n.prev;var l,u=n,c=n.x,h=n.y,d=1/0;for(i=n.next;i!==u;)r>=i.x&&i.x>=c&&m(o<h?r:a,o,c,h,o<h?a:r,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(r-i.x))<d||l===d&&i.x>n.x)&&b(i,t)&&(n=i,d=l),i=i.next;return n}(t,e)){var n=x(e,t);o(n,n.next)}}function f(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function m(t,e,n,i,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&_(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function _(t,e,n,i){return!!(y(t,e)&&y(n,i)||y(t,i)&&y(n,e))||g(t,e,n)>0!=g(t,e,i)>0&&g(n,i,t)>0!=g(n,i,e)>0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function x(t,e){var n=new M(t.i,t.x,t.y),i=new M(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function w(t,e,n,i){var r=new M(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function M(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,n,i){for(var r=0,o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}e.exports=i,i.deviation=function(t,e,n,i){var r=e&&e.length,o=r?e[0]*n:t.length,a=Math.abs(E(t,0,o,n));if(r)for(var s=0,l=e.length;s<l;s++){var u=e[s]*n,c=s<l-1?e[s+1]*n:t.length;a-=Math.abs(E(t,u,c,n))}var h=0;for(s=0;s<i.length;s+=3){var d=i[s]*n,f=i[s+1]*n,p=i[s+2]*n;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},i.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[r][o][a]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n}},{}],6:[function(t,e,n){function i(t){var e=0;if(t&&t.length>0){e+=Math.abs(r(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(r(t[n]))}return e}function r(t){var e=0;if(t.length>2){for(var n,i,r=0;r<t.length-1;r++)n=t[r],e+=o((i=t[r+1])[0]-n[0])*(2+Math.sin(o(n[1]))+Math.sin(o(i[1])));e=e*a.RADIUS*a.RADIUS/2}return e}function o(t){return t*Math.PI/180}var a=t("wgs84");e.exports.geometry=function(t){if("Polygon"===t.type)return i(t.coordinates);if("MultiPolygon"===t.type){for(var e=0,n=0;n<t.coordinates.length;n++)e+=i(t.coordinates[n]);return e}return null},e.exports.ring=r},{wgs84:42}],7:[function(t,e,n){function i(t,e){return function(n){return t(n,e)}}function r(t,e){e=!!e,t[0]=o(t[0],!e);for(var n=1;n<t.length;n++)t[n]=o(t[n],e);return t}function o(t,e){return function(t){return a.ring(t)>=0}(t)===e?t:t.reverse()}var a=t("geojson-area");e.exports=function t(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(i(t,n)),e;case"Feature":return e.geometry=t(e.geometry,n),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=r(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(i(r,e))),t}(e,n);default:return e}}},{"geojson-area":6}],8:[function(t,e,n){"use strict";function i(t,e,n,i){for(var r=[],o=0;o<t.length;o++){var a=t[o],s=a[i];s>=e&&s<=n&&r.push(a)}return r}function r(t,e,n,i,r,a){for(var s=[],l=0;l<t.length;l++){var u,c,h,d=0,f=0,p=null,m=t[l],v=m.area,g=m.dist,y=m.outer,_=m.length,b=[];for(c=0;c<_-1;c++)u=p||m[c],p=m[c+1],d=f||u[i],f=p[i],d<e?f>n?(b.push(r(u,p,e),r(u,p,n)),a||(b=o(s,b,v,g,y))):f>=e&&b.push(r(u,p,e)):d>n?f<e?(b.push(r(u,p,n),r(u,p,e)),a||(b=o(s,b,v,g,y))):f<=n&&b.push(r(u,p,n)):(b.push(u),f<e?(b.push(r(u,p,e)),a||(b=o(s,b,v,g,y))):f>n&&(b.push(r(u,p,n)),a||(b=o(s,b,v,g,y))));(d=(u=m[_-1])[i])>=e&&d<=n&&b.push(u),h=b[b.length-1],a&&h&&(b[0][0]!==h[0]||b[0][1]!==h[1])&&b.push(b[0]),o(s,b,v,g,y)}return s}function o(t,e,n,i,r){return e.length&&(e.area=n,e.dist=i,void 0!==r&&(e.outer=r),t.push(e)),[]}e.exports=function(t,e,n,o,s,l,u,c){if(o/=e,u>=(n/=e)&&c<=o)return t;if(u>o||c<n)return null;for(var h=[],d=0;d<t.length;d++){var f,p,m=t[d],v=m.geometry,g=m.type;if(f=m.min[s],p=m.max[s],f>=n&&p<=o)h.push(m);else if(!(f>o||p<n)){var y=1===g?i(v,n,o,s):r(v,n,o,s,l,3===g);y.length&&h.push(a(m.tags,g,y,m.id))}}return h.length?h:null};var a=t("./feature")},{"./feature":10}],9:[function(t,e,n){"use strict";function i(t,e,n){if(null!==e.geometry){var a,l,u,c,h=e.geometry,d=h.type,f=h.coordinates,p=e.properties,m=e.id;if("Point"===d)t.push(s(p,1,[o(f)],m));else if("MultiPoint"===d)t.push(s(p,1,r(f),m));else if("LineString"===d)t.push(s(p,2,[r(f,n)],m));else if("MultiLineString"===d||"Polygon"===d){for(u=[],a=0;a<f.length;a++)c=r(f[a],n),"Polygon"===d&&(c.outer=0===a),u.push(c);t.push(s(p,"Polygon"===d?3:2,u,m))}else if("MultiPolygon"===d){for(u=[],a=0;a<f.length;a++)for(l=0;l<f[a].length;l++)(c=r(f[a][l],n)).outer=0===l,u.push(c);t.push(s(p,3,u,m))}else{if("GeometryCollection"!==d)throw new Error("Input data is not a valid GeoJSON object.");for(a=0;a<h.geometries.length;a++)i(t,{geometry:h.geometries[a],properties:p},n)}}}function r(t,e){for(var n=[],i=0;i<t.length;i++)n.push(o(t[i]));return e&&(a(n,e),function(t){for(var e,n,i=0,r=0,o=0;o<t.length-1;o++)e=n||t[o],n=t[o+1],i+=e[0]*n[1]-n[0]*e[1],r+=Math.abs(n[0]-e[0])+Math.abs(n[1]-e[1]);t.area=Math.abs(i/2),t.dist=r}(n)),n}function o(t){var e=Math.sin(t[1]*Math.PI/180),n=t[0]/360+.5,i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return[n,i=i<0?0:i>1?1:i,0]}e.exports=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)i(n,t.features[r],e);else"Feature"===t.type?i(n,t,e):i(n,{geometry:t},e);return n};var a=t("./simplify"),s=t("./feature")},{"./feature":10,"./simplify":12}],10:[function(t,e,n){"use strict";function i(t,e,n){for(var i,r=0;r<n.length;r++)i=n[r],t[0]=Math.min(i[0],t[0]),e[0]=Math.max(i[0],e[0]),t[1]=Math.min(i[1],t[1]),e[1]=Math.max(i[1],e[1])}e.exports=function(t,e,n,r){var o={id:r||null,type:e,geometry:n,tags:t||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(t){var e=t.geometry,n=t.min,r=t.max;if(1===t.type)i(n,r,e);else for(var o=0;o<e.length;o++)i(n,r,e[o])}(o),o}},{}],11:[function(t,e,n){"use strict";function i(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;n&&console.time("preprocess data");var i=1<<e.maxZoom,r=l(t,e.tolerance/(i*e.extent));this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=h(r,e.buffer/e.extent,o)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function r(t,e,n){return 32*((1<<t)*n+e)+t}function o(t,e,n){return[n,(n-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1],1]}function a(t,e,n){return[(n-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],n,1]}function s(t,e,n){var i=t.source;if(1!==i.length)return!1;var r=i[0];if(3!==r.type||r.geometry.length>1)return!1;var o=r.geometry[0].length;if(5!==o)return!1;for(var a=0;a<o;a++){var s=u.point(r.geometry[0][a],e,t.z2,t.x,t.y);if(s[0]!==-n&&s[0]!==e+n||s[1]!==-n&&s[1]!==e+n)return!1}return!0}e.exports=function(t,e){return new i(t,e)};var l=t("./convert"),u=t("./transform"),c=t("./clip"),h=t("./wrap"),d=t("./tile");i.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},i.prototype.splitTile=function(t,e,n,i,l,u,h){for(var f=[t,e,n,i],p=this.options,m=p.debug,v=null;f.length;){i=f.pop(),n=f.pop(),e=f.pop(),t=f.pop();var g=1<<e,y=r(e,n,i),_=this.tiles[y],b=e===p.maxZoom?0:p.tolerance/(g*p.extent);if(!_&&(m>1&&console.time("creation"),_=this.tiles[y]=d(t,g,n,i,b,e===p.maxZoom),this.tileCoords.push({z:e,x:n,y:i}),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,_.numFeatures,_.numPoints,_.numSimplified),console.timeEnd("creation"));var x="z"+e;this.stats[x]=(this.stats[x]||0)+1,this.total++}if(_.source=t,l){if(e===p.maxZoom||e===l)continue;var w=1<<l-e;if(n!==Math.floor(u/w)||i!==Math.floor(h/w))continue}else if(e===p.indexMaxZoom||_.numPoints<=p.indexMaxPoints)continue;if(p.solidChildren||!s(_,p.extent,p.buffer)){_.source=null,m>1&&console.time("clipping");var S,M,E,z,k,T,O=.5*p.buffer/p.extent,P=.5-O,C=.5+O,A=1+O;S=M=E=z=null,k=c(t,g,n-O,n+C,0,o,_.min[0],_.max[0]),T=c(t,g,n+P,n+A,0,o,_.min[0],_.max[0]),k&&(S=c(k,g,i-O,i+C,1,a,_.min[1],_.max[1]),M=c(k,g,i+P,i+A,1,a,_.min[1],_.max[1])),T&&(E=c(T,g,i-O,i+C,1,a,_.min[1],_.max[1]),z=c(T,g,i+P,i+A,1,a,_.min[1],_.max[1])),m>1&&console.timeEnd("clipping"),t.length&&(f.push(S||[],e+1,2*n,2*i),f.push(M||[],e+1,2*n,2*i+1),f.push(E||[],e+1,2*n+1,2*i),f.push(z||[],e+1,2*n+1,2*i+1))}else l&&(v=e)}return v},i.prototype.getTile=function(t,e,n){var i=this.options,o=i.extent,a=i.debug,l=1<<t,c=r(t,e=(e%l+l)%l,n);if(this.tiles[c])return u.tile(this.tiles[c],o);a>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var h,d=t,f=e,p=n;!h&&d>0;)d--,f=Math.floor(f/2),p=Math.floor(p/2),h=this.tiles[r(d,f,p)];if(!h||!h.source)return null;if(a>1&&console.log("found parent tile z%d-%d-%d",d,f,p),s(h,o,i.buffer))return u.tile(h,o);a>1&&console.time("drilling down");var m=this.splitTile(h.source,d,f,p,t,e,n);if(a>1&&console.timeEnd("drilling down"),null!==m){var v=1<<t-m;c=r(m,Math.floor(e/v),Math.floor(n/v))}return this.tiles[c]?u.tile(this.tiles[c],o):null}},{"./clip":8,"./convert":9,"./tile":13,"./transform":14,"./wrap":15}],12:[function(t,e,n){"use strict";function i(t,e,n){var i=e[0],r=e[1],o=n[0],a=n[1],s=t[0],l=t[1],u=o-i,c=a-r;if(0!==u||0!==c){var h=((s-i)*u+(l-r)*c)/(u*u+c*c);h>1?(i=o,r=a):h>0&&(i+=u*h,r+=c*h)}return(u=s-i)*u+(c=l-r)*c}e.exports=function(t,e){var n,r,o,a,s=e*e,l=0,u=t.length-1,c=[];for(t[l][2]=1,t[u][2]=1;u;){for(r=0,n=l+1;n<u;n++)(o=i(t[n],t[l],t[u]))>r&&(a=n,r=o);r>s?(t[a][2]=r,c.push(l),c.push(a),l=a):(u=c.pop(),l=c.pop())}}},{}],13:[function(t,e,n){"use strict";function i(t,e,n,i){var o,a,s,l,u=e.geometry,c=e.type,h=[],d=n*n;if(1===c)for(o=0;o<u.length;o++)h.push(u[o]),t.numPoints++,t.numSimplified++;else for(o=0;o<u.length;o++)if(s=u[o],i||!(2===c&&s.dist<n||3===c&&s.area<d)){var f=[];for(a=0;a<s.length;a++)l=s[a],(i||l[2]>d)&&(f.push(l),t.numSimplified++),t.numPoints++;3===c&&r(f,s.outer),h.push(f)}else t.numPoints+=s.length;if(h.length){var p={geometry:h,type:c,tags:e.tags||null};null!==e.id&&(p.id=e.id),t.features.push(p)}}function r(t,e){(function(t){for(var e,n,i=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],n=t[a],i+=(n[0]-e[0])*(e[1]+n[1]);return i})(t)<0===e&&t.reverse()}e.exports=function(t,e,n,r,o,a){for(var s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z2:e,transformed:!1,min:[2,1],max:[-1,0]},l=0;l<t.length;l++){s.numFeatures++,i(s,t[l],o,a);var u=t[l].min,c=t[l].max;u[0]<s.min[0]&&(s.min[0]=u[0]),u[1]<s.min[1]&&(s.min[1]=u[1]),c[0]>s.max[0]&&(s.max[0]=c[0]),c[1]>s.max[1]&&(s.max[1]=c[1])}return s}},{}],14:[function(t,e,n){"use strict";function i(t,e,n,i,r){return[Math.round(e*(t[0]*n-i)),Math.round(e*(t[1]*n-r))]}n.tile=function(t,e){if(t.transformed)return t;var n,r,o,a=t.z2,s=t.x,l=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],c=u.geometry;if(1===u.type)for(r=0;r<c.length;r++)c[r]=i(c[r],e,a,s,l);else for(r=0;r<c.length;r++){var h=c[r];for(o=0;o<h.length;o++)h[o]=i(h[o],e,a,s,l)}}return t.transformed=!0,t},n.point=i},{}],15:[function(t,e,n){"use strict";function i(t,e){for(var n=[],i=0;i<t.length;i++){var o,s=t[i],l=s.type;if(1===l)o=r(s.geometry,e);else{o=[];for(var u=0;u<s.geometry.length;u++)o.push(r(s.geometry[u],e))}n.push(a(s.tags,l,o,s.id))}return n}function r(t,e){var n=[];n.area=t.area,n.dist=t.dist;for(var i=0;i<t.length;i++)n.push([t[i][0]+e,t[i][1],t[i][2]]);return n}var o=t("./clip"),a=t("./feature");e.exports=function(t,e,n){var r=t,a=o(t,1,-1-e,e,0,n,-1,2),s=o(t,1,1-e,2+e,0,n,-1,2);return(a||s)&&(r=o(t,1,-e,1+e,0,n,-1,2)||[],a&&(r=i(a,1).concat(r)),s&&(r=r.concat(i(s,-1)))),r}},{"./clip":8,"./feature":10}],16:[function(t,e,n){"use strict";function i(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],e=o[1],n=o[2],this.d=e+2*n;for(var a=0;a<this.d*this.d;a++){var s=o[r+a],l=o[r+a+1];i.push(s===l?null:o.subarray(s,l))}var u=o[r+i.length],c=o[r+i.length+1];this.keys=o.subarray(u,c),this.bboxes=o.subarray(c),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var h=0;h<this.d*this.d;h++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var d=n/e*t;this.min=-d,this.max=t+d}e.exports=i;var r=3;i.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(t,e,n,i,r,o){this.cells[r].push(o)},i.prototype.query=function(t,e,n,i){var r=this.min,o=this.max;if(t<=r&&e<=r&&o<=n&&o<=i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,n,i,this._queryCell,a,{}),a},i.prototype._queryCell=function(t,e,n,i,r,o,a){var s=this.cells[r];if(null!==s)for(var l=this.keys,u=this.bboxes,c=0;c<s.length;c++){var h=s[c];if(void 0===a[h]){var d=4*h;t<=u[d+2]&&e<=u[d+3]&&n>=u[d+0]&&i>=u[d+1]?(a[h]=!0,o.push(l[h])):a[h]=!1}}},i.prototype._forEachCell=function(t,e,n,i,r,o,a){for(var s=this._convertToCellCoord(t),l=this._convertToCellCoord(e),u=this._convertToCellCoord(n),c=this._convertToCellCoord(i),h=s;h<=u;h++)for(var d=l;d<=c;d++){var f=this.d*d+h;if(r.call(this,t,e,n,i,f,o,a))return}},i.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=r+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var o=new Int32Array(e+n+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var a=e,s=0;s<t.length;s++){var l=t[s];o[r+s]=a,o.set(l,a),a+=l.length}return o[r+t.length]=a,o.set(this.keys,a),a+=this.keys.length,o[r+t.length+1]=a,o.set(this.bboxes,a),a+=this.bboxes.length,o.buffer}},{}],17:[function(t,e,n){n.read=function(t,e,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=n?r-1:0,d=n?-1:1,f=t[e+h];for(h+=d,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=d,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+t[e+h],h+=d,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),o-=u}return(f?-1:1)*a*Math.pow(2,o-i)},n.write=function(t,e,n,i,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,p=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;t[n+f]=255&s,f+=p,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;t[n+f]=255&a,f+=p,a/=256,u-=8);t[n+f-p]|=128*m}},{}],18:[function(t,e,n){"use strict";function i(t,e,n,i,s){e=e||r,n=n||o,s=s||Array,this.nodeSize=i||64,this.points=t,this.ids=new s(t.length),this.coords=new s(2*t.length);for(var l=0;l<t.length;l++)this.ids[l]=l,this.coords[2*l]=e(t[l]),this.coords[2*l+1]=n(t[l]);a(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function r(t){return t[0]}function o(t){return t[1]}var a=t("./sort"),s=t("./range"),l=t("./within");e.exports=function(t,e,n,r,o){return new i(t,e,n,r,o)},i.prototype={range:function(t,e,n,i){return s(this.ids,this.coords,t,e,n,i,this.nodeSize)},within:function(t,e,n){return l(this.ids,this.coords,t,e,n,this.nodeSize)}}},{"./range":19,"./sort":20,"./within":21}],19:[function(t,e,n){"use strict";e.exports=function(t,e,n,i,r,o,a){for(var s,l,u=[0,t.length-1,0],c=[];u.length;){var h=u.pop(),d=u.pop(),f=u.pop();if(d-f<=a)for(var p=f;p<=d;p++)s=e[2*p],l=e[2*p+1],s>=n&&s<=r&&l>=i&&l<=o&&c.push(t[p]);else{var m=Math.floor((f+d)/2);s=e[2*m],l=e[2*m+1],s>=n&&s<=r&&l>=i&&l<=o&&c.push(t[m]);var v=(h+1)%2;(0===h?n<=s:i<=l)&&(u.push(f),u.push(m-1),u.push(v)),(0===h?r>=s:o>=l)&&(u.push(m+1),u.push(d),u.push(v))}}return c}},{}],20:[function(t,e,n){"use strict";function i(t,e,n,i){r(t,n,i),r(e,2*n,2*i),r(e,2*n+1,2*i+1)}function r(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}e.exports=function t(e,n,r,o,a,s){if(!(a-o<=r)){var l=Math.floor((o+a)/2);(function t(e,n,r,o,a,s){for(;a>o;){if(a-o>600){var l=a-o+1,u=r-o+1,c=Math.log(l),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(l-h)/l)*(u-l/2<0?-1:1),f=Math.max(o,Math.floor(r-u*h/l+d)),p=Math.min(a,Math.floor(r+(l-u)*h/l+d));t(e,n,r,f,p,s)}var m=n[2*r+s],v=o,g=a;for(i(e,n,o,r),n[2*a+s]>m&&i(e,n,o,a);v<g;){for(i(e,n,v,g),v++,g--;n[2*v+s]<m;)v++;for(;n[2*g+s]>m;)g--}n[2*o+s]===m?i(e,n,o,g):i(e,n,++g,a),g<=r&&(o=g+1),r<=g&&(a=g-1)}})(e,n,l,o,a,s%2),t(e,n,r,o,l-1,s+1),t(e,n,r,l+1,a,s+1)}}},{}],21:[function(t,e,n){"use strict";function i(t,e,n,i){var r=t-n,o=e-i;return r*r+o*o}e.exports=function(t,e,n,r,o,a){for(var s=[0,t.length-1,0],l=[],u=o*o;s.length;){var c=s.pop(),h=s.pop(),d=s.pop();if(h-d<=a)for(var f=d;f<=h;f++)i(e[2*f],e[2*f+1],n,r)<=u&&l.push(t[f]);else{var p=Math.floor((d+h)/2),m=e[2*p],v=e[2*p+1];i(m,v,n,r)<=u&&l.push(t[p]);var g=(c+1)%2;(0===c?n-o<=m:r-o<=v)&&(s.push(d),s.push(p-1),s.push(g)),(0===c?n+o>=m:r+o>=v)&&(s.push(p+1),s.push(h),s.push(g))}}return l}},{}],22:[function(t,e,n){"use strict";function i(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&"Worker"in window&&"Uint8ClampedArray"in window&&function(t){return void 0===r[t]&&(r[t]=function(t){var e=document.createElement("canvas"),n=Object.create(i.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,e.probablySupportsContext?e.probablySupportsContext("webgl",n)||e.probablySupportsContext("experimental-webgl",n):e.supportsContext?e.supportsContext("webgl",n)||e.supportsContext("experimental-webgl",n):e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}(t)),r[t]}(t&&t.failIfMajorPerformanceCaveat))}void 0!==e&&e.exports?e.exports=i:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=i);var r={};i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}},{}],23:[function(t,e,n){(function(t){function e(t,e){for(var n=0,i=t.length-1;i>=0;i--){var r=t[i];"."===r?t.splice(i,1):".."===r?(t.splice(i,1),n++):n&&(t.splice(i,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function i(t,e){if(t.filter)return t.filter(e);for(var n=[],i=0;i<t.length;i++)e(t[i],i,t)&&n.push(t[i]);return n}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};n.resolve=function(){for(var n="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(n=a+"/"+n,r="/"===a.charAt(0))}return n=e(i(n.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+n||"."},n.normalize=function(t){var r=n.isAbsolute(t),o="/"===a(t,-1);return(t=e(i(t.split("/"),function(t){return!!t}),!r).join("/"))||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},n.isAbsolute=function(t){return"/"===t.charAt(0)},n.join=function(){var t=Array.prototype.slice.call(arguments,0);return n.normalize(i(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},n.relative=function(t,e){function i(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=n.resolve(t).substr(1),e=n.resolve(e).substr(1);for(var r=i(t.split("/")),o=i(e.split("/")),a=Math.min(r.length,o.length),s=a,l=0;l<a;l++)if(r[l]!==o[l]){s=l;break}var u=[];for(l=s;l<r.length;l++)u.push("..");return(u=u.concat(o.slice(s))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(t){var e=o(t),n=e[0],i=e[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},n.basename=function(t,e){var n=o(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},n.extname=function(t){return o(t)[3]};var a="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,t("_process"))},{_process:27}],24:[function(t,e,n){"use strict";function i(t){var e;t&&t.length&&(t=(e=t).length);var n=new Uint8Array(t||0);return e&&n.set(e),n.readUInt32LE=o.readUInt32LE,n.writeUInt32LE=o.writeUInt32LE,n.readInt32LE=o.readInt32LE,n.writeInt32LE=o.writeInt32LE,n.readFloatLE=o.readFloatLE,n.writeFloatLE=o.writeFloatLE,n.readDoubleLE=o.readDoubleLE,n.writeDoubleLE=o.writeDoubleLE,n.toString=o.toString,n.write=o.write,n.slice=o.slice,n.copy=o.copy,n._isBuffer=!0,n}function r(t){for(var e,n,i=t.length,r=[],o=0;o<i;o++){if((e=t.charCodeAt(o))>55295&&e<57344){if(!n){e>56319||o+1===i?r.push(239,191,189):n=e;continue}if(e<56320){r.push(239,191,189),n=e;continue}e=n-55296<<10|e-56320|65536,n=null}else n&&(r.push(239,191,189),n=null);e<128?r.push(e):e<2048?r.push(e>>6|192,63&e|128):e<65536?r.push(e>>12|224,e>>6&63|128,63&e|128):r.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return r}e.exports=i;var o,a,s,l=t("ieee754");(o={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return l.read(this,t,!0,23,4)},readDoubleLE:function(t){return l.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return l.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return l.write(this,t,e,!0,52,8)},toString:function(t,e,n){var i="",r="";e=e||0,n=Math.min(this.length,n||this.length);for(var o=e;o<n;o++){var a=this[o];a<=127?(i+=decodeURIComponent(r)+String.fromCharCode(a),r=""):r+="%"+a.toString(16)}return i+decodeURIComponent(r)},write:function(t,e){for(var n=t===a?s:r(t),i=0;i<n.length;i++)this[e+i]=n[i]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var n=0;n<this.length;n++)t[e+n]=this[n]}}).writeInt32LE=o.writeUInt32LE,i.byteLength=function(t){return a=t,(s=r(t)).length},i.isBuffer=function(t){return!(!t||!t._isBuffer)}},{ieee754:17}],25:[function(t,n,i){(function(e){"use strict";function i(t){this.buf=f.isBuffer(t)?t:new f(t||0),this.pos=0,this.length=this.buf.length}function r(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function o(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function a(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function s(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function l(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function u(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function c(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function h(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}n.exports=i;var f=e.Buffer||t("./buffer");i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var p=Math.pow(2,63);i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readUInt32LE(this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readInt32LE(this.pos+4);return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,e,n=this.buf;return t=127&(e=n[this.pos++]),e<128?t:(t|=(127&(e=n[this.pos++]))<<7,e<128?t:(t|=(127&(e=n[this.pos++]))<<14,e<128?t:(t|=(127&(e=n[this.pos++]))<<21,e<128?t:function(t,e){var n,i=e.buf;if(t+=268435456*(127&(n=i[e.pos++])),n<128)return t;if(t+=34359738368*(127&(n=i[e.pos++])),n<128)return t;if(t+=4398046511104*(127&(n=i[e.pos++])),n<128)return t;if(t+=562949953421312*(127&(n=i[e.pos++])),n<128)return t;if(t+=72057594037927940*(127&(n=i[e.pos++])),n<128)return t;if(t+=0x8000000000000000*(127&(n=i[e.pos++])),n<128)return t;throw new Error("Expected varint not more than 10 bytes")}(t,this))))},readVarint64:function(){var t=this.pos,e=this.readVarint();if(e<p)return e;for(var n=this.pos-2;255===this.buf[n];)n--;n<t&&(n=t),e=0;for(var i=0;i<n-t+1;i++){var r=127&~this.buf[t+i];e+=i<4?r<<7*i:r*Math.pow(2,7*i)}return-e-1},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.buf.toString("utf8",this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.slice(this.pos,t);return this.pos=t,e},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readVarint());return e},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new f(e);this.buf.copy(n),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeUInt32LE(Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeInt32LE(Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){return(t=+t)>268435455?void function(t,e){e.realloc(10);for(var n=e.pos+10;t>=1;){if(e.pos>=n)throw new Error("Given varint doesn't fit into 10 bytes");var i=255&t;e.buf[e.pos++]=i|(t>=128?128:0),t/=128}}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),void(t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var e=f.byteLength(t);this.writeVarint(e),this.realloc(e),this.buf.write(t,this.pos),this.pos+=e},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&function(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,i.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){this.writeMessage(t,r,e)},writePackedSVarint:function(t,e){this.writeMessage(t,o,e)},writePackedBoolean:function(t,e){this.writeMessage(t,l,e)},writePackedFloat:function(t,e){this.writeMessage(t,a,e)},writePackedDouble:function(t,e){this.writeMessage(t,s,e)},writePackedFixed32:function(t,e){this.writeMessage(t,u,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,c,e)},writePackedFixed64:function(t,e){this.writeMessage(t,h,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,d,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":24}],26:[function(t,e,n){"use strict";function i(t,e){this.x=t,this.y=e}e.exports=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t}},{}],27:[function(t,e,n){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(){m&&f&&(m=!1,f.length?p=f.concat(p):v=-1,p.length&&s())}function s(){if(!m){var t=o(a);m=!0;for(var e=p.length;e;){for(f=p,p=[];++v<e;)f&&f[v].run();v=-1,e=p.length}f=null,m=!1,function(t){if(h===clearTimeout)return clearTimeout(t);if((h===r||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}(t)}}function l(t,e){this.fun=t,this.array=e}function u(){}var c,h,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{h="function"==typeof clearTimeout?clearTimeout:r}catch(t){h=r}}();var f,p=[],m=!1,v=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new l(t,e)),1!==p.length||m||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],28:[function(t,e,n){"use strict";function i(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function r(t,e){return t<e?-1:t>e?1:0}e.exports=function t(e,n,o,a,s){for(o=o||0,a=a||e.length-1,s=s||r;a>o;){if(a-o>600){var l=a-o+1,u=n-o+1,c=Math.log(l),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(l-h)/l)*(u-l/2<0?-1:1);t(e,n,Math.max(o,Math.floor(n-u*h/l+d)),Math.min(a,Math.floor(n+(l-u)*h/l+d)),s)}var f=e[n],p=o,m=a;for(i(e,o,n),s(e[a],f)>0&&i(e,o,a);p<m;){for(i(e,p,m),p++,m--;s(e[p],f)<0;)p++;for(;s(e[m],f)>0;)m--}0===s(e[o],f)?i(e,o,m):i(e,++m,a),m<=n&&(o=m+1),n<=m&&(a=m-1)}}},{}],29:[function(t,e,n){"use strict";function i(t){this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function r(t,e,n,i){return{x:t,y:e,zoom:1/0,id:i,numPoints:n}}function o(t,e){var n=t.geometry.coordinates;return r(l(n[0]),u(n[1]),1,e)}function a(t){return{type:"Feature",properties:s(t),geometry:{type:"Point",coordinates:[function(t){return 360*(t-.5)}(t.x),function(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(t.y)]}}}function s(t){var e=t.numPoints;return{cluster:!0,point_count:e,point_count_abbreviated:e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e}}function l(t){return t/360+.5}function u(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function c(t){return t.x}function h(t){return t.y}var d=t("kdbush");e.exports=function(t){return new i(t)},i.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1},load:function(t){var e=this.options.log;e&&console.time("total time");var n="prepare "+t.length+" points";e&&console.time(n),this.points=t;var i=t.map(o);e&&console.timeEnd(n);for(var r=this.options.maxZoom;r>=this.options.minZoom;r--){var a=+Date.now();this.trees[r+1]=d(i,c,h,this.options.nodeSize,Float32Array),i=this._cluster(i,r),e&&console.log("z%d: %d clusters in %dms",r,i.length,+Date.now()-a)}return this.trees[this.options.minZoom]=d(i,c,h,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var n=this.trees[this._limitZoom(e)],i=n.range(l(t[0]),u(t[3]),l(t[2]),u(t[1])),r=[],o=0;o<i.length;o++){var s=n.points[i[o]];r.push(-1!==s.id?this.points[s.id]:a(s))}return r},getTile:function(t,e,n){var i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options.extent,a=this.options.radius/o,s=(n-a)/r,l=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((e-a)/r,s,(e+1+a)/r,l),i.points,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-a/r,s,1,l),i.points,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,s,a/r,l),i.points,-1,n,r,u),u.features.length?u:null},_addTileFeatures:function(t,e,n,i,r,o){for(var a=0;a<t.length;a++){var l=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(l.x*r-n)),Math.round(this.options.extent*(l.y*r-i))]],tags:-1!==l.id?this.points[l.id].properties:s(l)})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var n=[],i=this.options.radius/(this.options.extent*Math.pow(2,e)),o=0;o<t.length;o++){var a=t[o];if(!(a.zoom<=e)){a.zoom=e;for(var s=this.trees[e+1],l=s.within(a.x,a.y,i),u=!1,c=a.numPoints,h=a.x*c,d=a.y*c,f=0;f<l.length;f++){var p=s.points[l[f]];e<p.zoom&&(u=!0,p.zoom=e,h+=p.x*p.numPoints,d+=p.y*p.numPoints,c+=p.numPoints)}n.push(u?r(h/c,d/c,c,-1):a)}}return n}}},{kdbush:18}],30:[function(t,e,n){"use strict";function i(t,e){if(!(this instanceof i))return new i(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||r,t)for(var n=Math.floor(this.length/2);n>=0;n--)this._down(n)}function r(t,e){return t<e?-1:t>e?1:0}function o(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}e.exports=i,i.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){var t=this.data[0];return this.data[0]=this.data[this.length-1],this.length--,this.data.pop(),this._down(0),t},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare;t>0;){var i=Math.floor((t-1)/2);if(!(n(e[t],e[i])<0))break;o(e,i,t),t=i}},_down:function(t){for(var e=this.data,n=this.compare,i=this.length;;){var r=2*t+1,a=r+1,s=t;if(r<i&&n(e[r],e[s])<0&&(s=r),a<i&&n(e[a],e[s])<0&&(s=a),s===t)return;o(e,s,t),t=s}}}},{}],31:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],32:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],33:[function(t,n,i){(function(e,n){function r(t,e){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(e)?n.showHidden=e:e&&i._extend(n,e),m(n.showHidden)&&(n.showHidden=!1),m(n.depth)&&(n.depth=2),m(n.colors)&&(n.colors=!1),m(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),s(n,t,n.depth)}function o(t,e){var n=r.styles[e];return n?"["+r.colors[n][0]+"m"+t+"["+r.colors[n][1]+"m":t}function a(t,e){return t}function s(t,e,n){if(t.customInspect&&e&&b(e.inspect)&&e.inspect!==i.inspect&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(n,t);return p(r)||(r=s(t,r,n)),r}var o=function(t,e){if(m(e))return t.stylize("undefined","undefined");if(p(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return f(e)?t.stylize(""+e,"number"):h(e)?t.stylize(""+e,"boolean"):d(e)?t.stylize("null","null"):void 0}(t,e);if(o)return o;var a=Object.keys(e),g=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(e)),_(e)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(e);if(0===a.length){if(b(e)){var x=e.name?": "+e.name:"";return t.stylize("[Function"+x+"]","special")}if(v(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(y(e))return t.stylize(Date.prototype.toString.call(e),"date");if(_(e))return l(e)}var w,M="",E=!1,z=["{","}"];(c(e)&&(E=!0,z=["[","]"]),b(e))&&(M=" [Function"+(e.name?": "+e.name:"")+"]");return v(e)&&(M=" "+RegExp.prototype.toString.call(e)),y(e)&&(M=" "+Date.prototype.toUTCString.call(e)),_(e)&&(M=" "+l(e)),0!==a.length||E&&0!=e.length?n<0?v(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),w=E?function(t,e,n,i,r){for(var o=[],a=0,s=e.length;a<s;++a)S(e,String(a))?o.push(u(t,e,n,i,String(a),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(u(t,e,n,i,r,!0))}),o}(t,e,n,g,a):a.map(function(i){return u(t,e,n,g,i,E)}),t.seen.pop(),function(t,e,n){return t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}(w,M,z)):z[0]+M+z[1]}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function u(t,e,n,i,r,o){var a,l,u;if((u=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?l=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(l=t.stylize("[Setter]","special")),S(i,r)||(a="["+r+"]"),l||(t.seen.indexOf(u.value)<0?(l=d(n)?s(t,u.value,null):s(t,u.value,n-1)).indexOf("\n")>-1&&(l=o?l.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+l.split("\n").map(function(t){return"   "+t}).join("\n")):l=t.stylize("[Circular]","special")),m(a)){if(o&&r.match(/^\d+$/))return l;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+l}function c(t){return Array.isArray(t)}function h(t){return"boolean"==typeof t}function d(t){return null===t}function f(t){return"number"==typeof t}function p(t){return"string"==typeof t}function m(t){return void 0===t}function v(t){return g(t)&&"[object RegExp]"===x(t)}function g(t){return"object"==typeof t&&null!==t}function y(t){return g(t)&&"[object Date]"===x(t)}function _(t){return g(t)&&("[object Error]"===x(t)||t instanceof Error)}function b(t){return"function"==typeof t}function x(t){return Object.prototype.toString.call(t)}function w(t){return t<10?"0"+t.toString(10):t.toString(10)}function S(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var M=/%[sdj%]/g;i.format=function(t){if(!p(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(r(arguments[n]));return e.join(" ")}n=1;for(var i=arguments,o=i.length,a=String(t).replace(M,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return t}}),s=i[n];n<o;s=i[++n])a+=d(s)||!g(s)?" "+s:" "+r(s);return a},i.deprecate=function(t,r){if(m(n.process))return function(){return i.deprecate(t,r).apply(this,arguments)};if(!0===e.noDeprecation)return t;var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),o=!0}return t.apply(this,arguments)}};var E,z={};i.debuglog=function(t){if(m(E)&&(E=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!z[t])if(new RegExp("\\b"+t+"\\b","i").test(E)){var n=e.pid;z[t]=function(){var e=i.format.apply(i,arguments);console.error("%s %d: %s",t,n,e)}}else z[t]=function(){};return z[t]},i.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=c,i.isBoolean=h,i.isNull=d,i.isNullOrUndefined=function(t){return null==t},i.isNumber=f,i.isString=p,i.isSymbol=function(t){return"symbol"==typeof t},i.isUndefined=m,i.isRegExp=v,i.isObject=g,i.isDate=y,i.isError=_,i.isFunction=b,i.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},i.isBuffer=t("./support/isBuffer");var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[w(t.getHours()),w(t.getMinutes()),w(t.getSeconds())].join(":"),[t.getDate(),k[t.getMonth()],e].join(" ")),i.format.apply(i,arguments))},i.inherits=t("inherits"),i._extend=function(t,e){if(!e||!g(e))return t;for(var n=Object.keys(e),i=n.length;i--;)t[n[i]]=e[n[i]];return t}}).call(this,t("_process"),void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":32,_process:27,inherits:31}],34:[function(t,e,n){e.exports.VectorTile=t("./lib/vectortile.js"),e.exports.VectorTileFeature=t("./lib/vectortilefeature.js"),e.exports.VectorTileLayer=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":35,"./lib/vectortilefeature.js":36,"./lib/vectortilelayer.js":37}],35:[function(t,e,n){"use strict";function i(t,e,n){if(3===t){var i=new r(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var r=t("./vectortilelayer");e.exports=function(t,e){this.layers=t.readFields(i,{},e)}},{"./vectortilelayer":37}],36:[function(t,e,n){"use strict";function i(t,e,n,i,o){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=o,t.readFields(r,this,e)}function r(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function o(t){for(var e,n,i=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],i+=((n=t[a]).x-e.x)*(e.y+n.y);return i}var a=t("point-geometry");e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,r=0,o=0,s=0,l=[];t.pos<n;){if(!r){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&l.push(e),e=[]),e.push(new a(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&l.push(e),l},i.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!i){var c=t.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)r+=t.readSVarint(),o+=t.readSVarint(),r<a&&(a=r),r>s&&(s=r),o<l&&(l=o),o>u&&(u=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,l,s,u]},i.prototype.toGeoJSON=function(t,e,n){function r(t){for(var e=0;e<t.length;e++){var n=t[e],i=180-360*(n.y+c)/l;t[e]=[360*(n.x+u)/l-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}var a,s,l=this.extent*Math.pow(2,n),u=this.extent*t,c=this.extent*e,h=this.loadGeometry(),d=i.types[this.type];switch(this.type){case 1:var f=[];for(a=0;a<h.length;a++)f[a]=h[a][0];r(h=f);break;case 2:for(a=0;a<h.length;a++)r(h[a]);break;case 3:for(h=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],a=0;a<e;a++){var s=o(t[a]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[t[a]]):n.push(t[a]))}return n&&r.push(n),r}(h),a=0;a<h.length;a++)for(s=0;s<h[a].length;s++)r(h[a][s])}1===h.length?h=h[0]:d="Multi"+d;var p={type:"Feature",geometry:{type:d,coordinates:h},properties:this.properties};return"id"in this&&(p.id=this.id),p}},{"point-geometry":26}],37:[function(t,e,n){"use strict";function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(r,this,e),this.length=this._features.length}function r(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}var o=t("./vectortilefeature.js");e.exports=i,i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,e,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":36}],38:[function(t,e,n){function i(t){var e=[];for(var n in t.layers)e.push(r(t.layers[n]));var i=new u;return c.tile.write({layers:e},i),i.finish()}function r(t){for(var e={name:t.name||"",version:t.version||1,extent:t.extent||4096,keys:[],values:[],features:[]},n={},i={},r=0;r<t.length;r++){var o=t.feature(r);o.geometry=s(o.loadGeometry());var a=[];for(var u in o.properties){var c=n[u];void 0===c&&(e.keys.push(u),c=e.keys.length-1,n[u]=c);var h=l(o.properties[u]),d=i[h.key];void 0===d&&(e.values.push(h),d=e.values.length-1,i[h.key]=d),a.push(c),a.push(d)}o.tags=a,e.features.push(o)}return e}function o(t,e){return(e<<3)+(7&t)}function a(t){return t<<1^t>>31}function s(t){for(var e=[],n=0,i=0,r=t.length,s=0;s<r;s++){var l=t[s];e.push(o(1,1));for(var u=0;u<l.length;u++){1===u&&e.push(o(2,l.length-1));var c=l[u].x-n,h=l[u].y-i;e.push(a(c),a(h)),n+=c,i+=h}}return e}function l(t){var e,n=typeof t;return"string"===n?e={string_value:t}:"boolean"===n?e={bool_value:t}:"number"===n?e=t%1!=0?{double_value:t}:t<0?{sint_value:t}:{uint_value:t}:e={string_value:t=JSON.stringify(t)},e.key=n+":"+t,e}var u=t("pbf"),c=t("./vector-tile-pb"),h=t("./lib/geojson_wrapper");e.exports=i,e.exports.fromVectorTileJs=i,e.exports.fromGeojsonVt=function(t){var e={};for(var n in t)e[n]=new h(t[n].features),e[n].name=n;return i({layers:e})},e.exports.GeoJSONWrapper=h},{"./lib/geojson_wrapper":39,"./vector-tile-pb":40,pbf:25}],39:[function(t,e,n){"use strict";function i(t){this.features=t,this.length=t.length}function r(t){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=4096}var o=t("point-geometry"),a=t("vector-tile").VectorTileFeature;e.exports=i,i.prototype.feature=function(t){return new r(this.features[t])},r.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var n=t[e],i=[],r=0;r<n.length;r++)i.push(new o(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[e,i,n,r]},r.prototype.toGeoJSON=a.prototype.toGeoJSON},{"point-geometry":26,"vector-tile":34}],40:[function(t,e,n){"use strict";function i(t,e,n){3===t&&e.layers.push(c(n,n.readVarint()+n.pos))}function r(t,e){return t.readFields(o,{},e)}function o(t,e,n){1===t?e.string_value=n.readString():2===t?e.float_value=n.readFloat():3===t?e.double_value=n.readDouble():4===t?e.int_value=n.readVarint():5===t?e.uint_value=n.readVarint():6===t?e.sint_value=n.readSVarint():7===t&&(e.bool_value=n.readBoolean())}function a(t,e){void 0!==t.string_value&&e.writeStringField(1,t.string_value),void 0!==t.float_value&&e.writeFloatField(2,t.float_value),void 0!==t.double_value&&e.writeDoubleField(3,t.double_value),void 0!==t.int_value&&e.writeVarintField(4,t.int_value),void 0!==t.uint_value&&e.writeVarintField(5,t.uint_value),void 0!==t.sint_value&&e.writeSVarintField(6,t.sint_value),void 0!==t.bool_value&&e.writeBooleanField(7,t.bool_value)}function s(t,e){var n=t.readFields(l,{},e);return void 0===n.type&&(n.type="Unknown"),n}function l(t,e,n){1===t?e.id=n.readVarint():2===t?e.tags=n.readPackedVarint():3===t?e.type=n.readVarint():4===t&&(e.geometry=n.readPackedVarint())}function u(t,e){void 0!==t.id&&e.writeVarintField(1,t.id),void 0!==t.tags&&e.writePackedVarint(2,t.tags),void 0!==t.type&&e.writeVarintField(3,t.type),void 0!==t.geometry&&e.writePackedVarint(4,t.geometry)}function c(t,e){return t.readFields(h,{features:[],keys:[],values:[]},e)}function h(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():2===t?e.features.push(s(n,n.readVarint()+n.pos)):3===t?e.keys.push(n.readString()):4===t?e.values.push(r(n,n.readVarint()+n.pos)):5===t&&(e.extent=n.readVarint())}function d(t,e){var n;if(void 0!==t.version&&e.writeVarintField(15,t.version),void 0!==t.name&&e.writeStringField(1,t.name),void 0!==t.features)for(n=0;n<t.features.length;n++)e.writeMessage(2,u,t.features[n]);if(void 0!==t.keys)for(n=0;n<t.keys.length;n++)e.writeStringField(3,t.keys[n]);if(void 0!==t.values)for(n=0;n<t.values.length;n++)e.writeMessage(4,a,t.values[n]);void 0!==t.extent&&e.writeVarintField(5,t.extent)}var f=n.tile={read:function(t,e){return t.readFields(i,{layers:[]},e)},write:function(t,e){var n;if(void 0!==t.layers)for(n=0;n<t.layers.length;n++)e.writeMessage(3,d,t.layers[n])}};f.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},f.value={read:r,write:a},f.feature={read:s,write:u},f.layer={read:c,write:d}},{}],41:[function(t,e,n){var i=arguments[3],r=arguments[4],o=arguments[5],a=JSON.stringify;e.exports=function(t,e){for(var n,s=Object.keys(o),l=0,u=s.length;l<u;l++){var c=s[l],h=o[c].exports;if(h===t||h&&h.default===t){n=c;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var d={};for(l=0,u=s.length;l<u;l++){d[c=s[l]]=c}r[n]=[Function(["require","module","exports"],"("+t+")(self)"),d]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[n]=n,r[f]=[Function(["require"],"var f = require("+a(n)+");(f.default ? f.default : f)(self);"),p];var m={};!function t(e){for(var n in m[e]=!0,r[e][1]){var i=r[e][1][n];m[i]||t(i)}}(f);var v="("+i+")({"+Object.keys(m).map(function(t){return a(t)+":["+r[t][0]+","+a(r[t][1])+"]"}).join(",")+"},{},["+a(f)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([v],{type:"text/javascript"});if(e&&e.bare)return y;var _=g.createObjectURL(y),b=new Worker(_);return b.objectURL=_,b}},{}],42:[function(t,e,n){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},{}],43:[function(t,e,n){e.exports={version:"0.34.0"}},{}],44:[function(t,e,n){"use strict";var i=t("./program_configuration"),r=function(t,e){this.vertexOffset=t,this.primitiveOffset=e,this.vertexLength=0,this.primitiveLength=0},o=function(t,e,n){this.globalProperties={zoom:n};var r=t.layoutVertexArrayType;this.layoutVertexArray=new r;var o=t.elementArrayType;o&&(this.elementArray=new o);var a=t.elementArrayType2;a&&(this.elementArray2=new a),this.layerData={};for(var s=0,l=e;s<l.length;s+=1){var u=l[s],c=i.createDynamic(t.paintAttributes||[],u,n);this.layerData[u.id]={layer:u,programConfiguration:c,paintVertexArray:new c.PaintVertexArray,paintPropertyStatistics:c.createPaintPropertyStatistics()}}this.segments=[],this.segments2=[]};o.prototype.prepareSegment=function(t){var e=this.segments[this.segments.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new r(this.layoutVertexArray.length,this.elementArray.length),this.segments.push(e)),e},o.prototype.prepareSegment2=function(t){var e=this.segments2[this.segments2.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new r(this.layoutVertexArray.length,this.elementArray2.length),this.segments2.push(e)),e},o.prototype.populatePaintArrays=function(t){var e=this;for(var n in e.layerData){var i=e.layerData[n];0!==i.paintVertexArray.bytesPerElement&&i.programConfiguration.populatePaintArray(i.layer,i.paintVertexArray,i.paintPropertyStatistics,e.layoutVertexArray.length,e.globalProperties,t)}},o.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},o.prototype.serialize=function(t){return{layoutVertexArray:this.layoutVertexArray.serialize(t),elementArray:this.elementArray&&this.elementArray.serialize(t),elementArray2:this.elementArray2&&this.elementArray2.serialize(t),paintVertexArrays:function(t,e){var n={};for(var i in t){var r=t[i].paintVertexArray;if(0!==r.length){var o=r.serialize(e),a=r.constructor.serialize();n[i]={array:o,type:a}}}return n}(this.layerData,t),segments:this.segments,segments2:this.segments2}},o.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,e.exports=o},{"./program_configuration":58}],45:[function(t,e,n){"use strict";var i=t("./array_group"),r=t("./buffer_group"),o=t("../util/util"),a=function(t,e){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,t.arrays?this.buffers=new r(e,t.layers,t.zoom,t.arrays):this.arrays=new i(e,t.layers,t.zoom)};a.prototype.populate=function(t,e){for(var n=this,i=0,r=t;i<r.length;i+=1){var o=r[i];n.layers[0].filter(o)&&(n.addFeature(o),e.featureIndex.insert(o,n.index))}},a.prototype.getPaintPropertyStatistics=function(){return o.mapObject(this.arrays.layerData,function(t){return t.paintPropertyStatistics})},a.prototype.isEmpty=function(){return this.arrays.isEmpty()},a.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),arrays:this.arrays.serialize(t)}},a.prototype.destroy=function(){this.buffers&&(this.buffers.destroy(),this.buffers=null)},e.exports=a,a.deserialize=function(t,e){if(e){for(var n={},i=0,r=t;i<r.length;i+=1){var a=r[i],s=a.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==s.length)for(var l=s[0].createBucket(o.extend({layers:s},a)),u=0,c=s;u<c.length;u+=1){n[c[u].id]=l}}return n}}},{"../util/util":212,"./array_group":44,"./buffer_group":52}],46:[function(t,e,n){"use strict";function i(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}var r=t("../bucket"),o=t("../vertex_array_type"),a=t("../element_array_type"),s=t("../load_geometry"),l=t("../extent"),u={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:a(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]},c=function(t){function e(e){t.call(this,e,u)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,n=0,r=s(t);n<r.length;n+=1)for(var o=0,a=r[n];o<a.length;o+=1){var u=a[o],c=u.x,h=u.y;if(!(c<0||c>=l||h<0||h>=l)){var d=e.prepareSegment(4),f=d.vertexLength;i(e.layoutVertexArray,c,h,-1,-1),i(e.layoutVertexArray,c,h,1,-1),i(e.layoutVertexArray,c,h,1,1),i(e.layoutVertexArray,c,h,-1,1),e.elementArray.emplaceBack(f,f+1,f+2),e.elementArray.emplaceBack(f,f+3,f+2),d.vertexLength+=4,d.primitiveLength+=2}}e.populatePaintArrays(t.properties)},e}(r);c.programInterface=u,e.exports=c},{"../bucket":45,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60}],47:[function(t,e,n){"use strict";var i=t("../bucket"),r=t("../vertex_array_type"),o=t("../element_array_type"),a=t("../load_geometry"),s=t("earcut"),l=t("../../util/classify_rings"),u={layoutVertexArrayType:r([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:o(3),elementArrayType2:o(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]},c=function(t){function e(e){t.call(this,e,u)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,n=0,i=l(a(t),500);n<i.length;n+=1){for(var r=i[n],o=0,u=0,c=r;u<c.length;u+=1){o+=c[u].length}for(var h=e.prepareSegment(o),d=h.vertexLength,f=[],p=[],m=0,v=r;m<v.length;m+=1){var g=v[m];if(0!==g.length){g!==r[0]&&p.push(f.length/2);var y=e.prepareSegment2(g.length),_=y.vertexLength;e.layoutVertexArray.emplaceBack(g[0].x,g[0].y),e.elementArray2.emplaceBack(_+g.length-1,_),f.push(g[0].x),f.push(g[0].y);for(var b=1;b<g.length;b++)e.layoutVertexArray.emplaceBack(g[b].x,g[b].y),e.elementArray2.emplaceBack(_+b-1,_+b),f.push(g[b].x),f.push(g[b].y);y.vertexLength+=g.length,y.primitiveLength+=g.length}}for(var x=s(f,p),w=0;w<x.length;w+=3)e.elementArray.emplaceBack(d+x[w],d+x[w+1],d+x[w+2]);h.vertexLength+=o,h.primitiveLength+=x.length/3}e.populatePaintArrays(t.properties)},e}(i);c.programInterface=u,e.exports=c},{"../../util/classify_rings":195,"../bucket":45,"../element_array_type":53,"../load_geometry":56,"../vertex_array_type":60,earcut:5}],48:[function(t,e,n){"use strict";function i(t,e,n,i,r,o,a,s){t.emplaceBack(e,n,2*Math.floor(i*f)+a,r*f*2,o*f*2,Math.round(s))}function r(t,e){return t.x===e.x&&(t.x<0||t.x>u)||t.y===e.y&&(t.y<0||t.y>u)}var o=t("../bucket"),a=t("../vertex_array_type"),s=t("../element_array_type"),l=t("../load_geometry"),u=t("../extent"),c=t("earcut"),h=t("../../util/classify_rings"),d={layoutVertexArrayType:a([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:s(3),paintAttributes:[{property:"fill-extrusion-base",type:"Uint16"},{property:"fill-extrusion-height",type:"Uint16"},{property:"fill-extrusion-color",type:"Uint8"}]},f=Math.pow(2,13),p=function(t){function e(e){t.call(this,e,d)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,n=0,o=h(l(t),500);n<o.length;n+=1){for(var a=o[n],s=0,u=0,d=a;u<d.length;u+=1){s+=d[u].length}for(var f=e.prepareSegment(5*s),p=[],m=[],v=[],g=0,y=a;g<y.length;g+=1){var _=y[g];if(0!==_.length){_!==a[0]&&m.push(p.length/2);for(var b=0,x=0;x<_.length;x++){var w=_[x];if(i(e.layoutVertexArray,w.x,w.y,0,0,1,1,0),v.push(f.vertexLength++),x>=1){var S=_[x-1];if(!r(w,S)){var M=w.sub(S)._perp()._unit();i(e.layoutVertexArray,w.x,w.y,M.x,M.y,0,0,b),i(e.layoutVertexArray,w.x,w.y,M.x,M.y,0,1,b),b+=S.dist(w),i(e.layoutVertexArray,S.x,S.y,M.x,M.y,0,0,b),i(e.layoutVertexArray,S.x,S.y,M.x,M.y,0,1,b);var E=f.vertexLength;e.elementArray.emplaceBack(E,E+1,E+2),e.elementArray.emplaceBack(E+1,E+2,E+3),f.vertexLength+=4,f.primitiveLength+=2}}p.push(w.x),p.push(w.y)}}}for(var z=c(p,m),k=0;k<z.length;k+=3)e.elementArray.emplaceBack(v[z[k]],v[z[k+1]],v[z[k+2]]);f.primitiveLength+=z.length/3}e.populatePaintArrays(t.properties)},e}(o);p.programInterface=d,e.exports=p},{"../../util/classify_rings":195,"../bucket":45,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60,earcut:5}],49:[function(t,e,n){"use strict";function i(t,e,n,i,r,o,a){t.emplaceBack(e.x<<1|i,e.y<<1|r,Math.round(c*n.x)+128,Math.round(c*n.y)+128,1+(0===o?0:o<0?-1:1)|(a*d&63)<<2,a*d>>6)}var r=t("../bucket"),o=t("../vertex_array_type"),a=t("../element_array_type"),s=t("../load_geometry"),l=t("../extent"),u=t("vector-tile").VectorTileFeature,c=63,h=Math.cos(Math.PI/180*37.5),d=.5,f=Math.pow(2,14)/d,p={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:a()},m=function(t){function e(e){t.call(this,e,p)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.layers[0].layout,n=e["line-join"],i=e["line-cap"],r=e["line-miter-limit"],o=e["line-round-limit"],a=0,l=s(t,15);a<l.length;a+=1){var u=l[a];this.addLine(u,t,n,i,r,o)}},e.prototype.addLine=function(t,e,n,i,r,o){for(var a=this,s=e.properties,c="Polygon"===u.types[e.type],d=t.length;d>=2&&t[d-1].equals(t[d-2]);)d--;if(!(d<(c?3:2))){"bevel"===n&&(r=1.05);var f=l/(512*this.overscaling)*15,p=t[0],m=this.arrays,v=m.prepareSegment(10*d);this.distance=0;var g,y,_,b,x,w,S,M=i,E=c?"butt":i,z=!0;this.e1=this.e2=this.e3=-1,c&&(g=t[d-2],x=p.sub(g)._unit()._perp());for(var k=0;k<d;k++)if(!(_=c&&k===d-1?t[1]:t[k+1])||!t[k].equals(_)){x&&(b=x),g&&(y=g),g=t[k],x=_?_.sub(g)._unit()._perp():b;var T=(b=b||x).add(x);0===T.x&&0===T.y||T._unit();var O=T.x*x.x+T.y*x.y,P=0!==O?1/O:1/0,C=O<h&&y&&_;if(C&&k>0){var A=g.dist(y);if(A>2*f){var I=g.sub(g.sub(y)._mult(f/A)._round());a.distance+=I.dist(y),a.addCurrentVertex(I,a.distance,b.mult(1),0,0,!1,v),y=I}}var L=y&&_,j=L?n:_?M:E;if(L&&"round"===j&&(P<o?j="miter":P<=2&&(j="fakeround")),"miter"===j&&P>r&&(j="bevel"),"bevel"===j&&(P>2&&(j="flipbevel"),P<r&&(j="miter")),y&&(a.distance+=g.dist(y)),"miter"===j)T._mult(P),a.addCurrentVertex(g,a.distance,T,0,0,!1,v);else if("flipbevel"===j){if(P>100)T=x.clone().mult(-1);else{var D=b.x*x.y-b.y*x.x>0?-1:1,R=P*b.add(x).mag()/b.sub(x).mag();T._perp()._mult(R*D)}a.addCurrentVertex(g,a.distance,T,0,0,!1,v),a.addCurrentVertex(g,a.distance,T.mult(-1),0,0,!1,v)}else if("bevel"===j||"fakeround"===j){var F=b.x*x.y-b.y*x.x>0,B=-Math.sqrt(P*P-1);if(F?(S=0,w=B):(w=0,S=B),z||a.addCurrentVertex(g,a.distance,b,w,S,!1,v),"fakeround"===j){for(var N=Math.floor(8*(.5-(O-.5))),q=void 0,V=0;V<N;V++)q=x.mult((V+1)/(N+1))._add(b)._unit(),a.addPieSliceVertex(g,a.distance,q,F,v);a.addPieSliceVertex(g,a.distance,T,F,v);for(var U=N-1;U>=0;U--)q=b.mult((U+1)/(N+1))._add(x)._unit(),a.addPieSliceVertex(g,a.distance,q,F,v)}_&&a.addCurrentVertex(g,a.distance,x,-w,-S,!1,v)}else"butt"===j?(z||a.addCurrentVertex(g,a.distance,b,0,0,!1,v),_&&a.addCurrentVertex(g,a.distance,x,0,0,!1,v)):"square"===j?(z||(a.addCurrentVertex(g,a.distance,b,1,1,!1,v),a.e1=a.e2=-1),_&&a.addCurrentVertex(g,a.distance,x,-1,-1,!1,v)):"round"===j&&(z||(a.addCurrentVertex(g,a.distance,b,0,0,!1,v),a.addCurrentVertex(g,a.distance,b,1,1,!0,v),a.e1=a.e2=-1),_&&(a.addCurrentVertex(g,a.distance,x,-1,-1,!0,v),a.addCurrentVertex(g,a.distance,x,0,0,!1,v)));if(C&&k<d-1){var H=g.dist(_);if(H>2*f){var W=g.add(_.sub(g)._mult(f/H)._round());a.distance+=W.dist(g),a.addCurrentVertex(W,a.distance,x.mult(1),0,0,!1,v),g=W}}z=!1}m.populatePaintArrays(s)}},e.prototype.addCurrentVertex=function(t,e,n,r,o,a,s){var l,u=a?1:0,c=this.arrays,h=c.layoutVertexArray,d=c.elementArray;l=n.clone(),r&&l._sub(n.perp()._mult(r)),i(h,t,l,u,0,r,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,l=n.mult(-1),o&&l._sub(n.perp()._mult(o)),i(h,t,l,u,1,-o,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>f/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,n,r,o,a,s))},e.prototype.addPieSliceVertex=function(t,e,n,r,o){var a=r?1:0;n=n.mult(r?-1:1);var s=this.arrays,l=s.layoutVertexArray,u=s.elementArray;i(l,t,n,0,a,0,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3},e}(r);m.programInterface=p,e.exports=m},{"../bucket":45,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60,"vector-tile":34}],50:[function(t,e,n){"use strict";function i(t,e,n,i,r,o,a,s,l,u,c){t.emplaceBack(e,n,Math.round(64*i),Math.round(64*r),o/4,a/4,10*(u||0),c,10*(s||0),10*Math.min(l||25,25))}function r(t,e,n,i,r){return t.emplaceBack(e.x,e.y,Math.round(n.x),Math.round(n.y),10*i,10*r)}var o=t("point-geometry"),a=t("../array_group"),s=t("../buffer_group"),l=t("../vertex_array_type"),u=t("../element_array_type"),c=t("../extent"),h=t("../../symbol/anchor"),d=t("../../symbol/get_anchors"),f=t("../../util/token"),p=t("../../symbol/quads"),m=t("../../symbol/shaping"),v=t("../../symbol/resolve_text"),g=t("../../symbol/mergelines"),y=t("../../symbol/clip_line"),_=t("../../util/util"),b=t("../../util/script_detection"),x=t("../load_geometry"),w=t("../../symbol/collision_feature"),S=t("../../util/find_pole_of_inaccessibility"),M=t("../../util/classify_rings"),E=t("vector-tile").VectorTileFeature,z=t("../../source/rtl_text_plugin"),k=m.shapeText,T=m.shapeIcon,O=m.WritingMode,P=p.getGlyphQuads,C=p.getIconQuads,A=u(),I=l([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]),L={glyph:{layoutVertexArrayType:I,elementArrayType:A,paintAttributes:[{name:"a_fill_color",property:"text-color",type:"Uint8"},{name:"a_halo_color",property:"text-halo-color",type:"Uint8"},{name:"a_halo_width",property:"text-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"text-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"text-opacity",type:"Uint8",multiplier:255}]},icon:{layoutVertexArrayType:I,elementArrayType:A,paintAttributes:[{name:"a_fill_color",property:"icon-color",type:"Uint8"},{name:"a_halo_color",property:"icon-halo-color",type:"Uint8"},{name:"a_halo_width",property:"icon-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"icon-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"icon-opacity",type:"Uint8",multiplier:255}]},collisionBox:{layoutVertexArrayType:l([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:u(2)}},j=function(t){if(this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,this.sdfIcons=t.sdfIcons,this.iconsNeedLinear=t.iconsNeedLinear,this.adjustedTextSize=t.adjustedTextSize,this.adjustedIconSize=t.adjustedIconSize,this.fontstack=t.fontstack,t.arrays)for(var e in this.buffers={},t.arrays)t.arrays[e]&&(this.buffers[e]=new s(L[e],t.layers,t.zoom,t.arrays[e]))};j.prototype.populate=function(t,e){var n=this.layers[0],i=n.layout,r=i["text-font"],o=i["icon-image"],a=r&&(!n.isLayoutValueFeatureConstant("text-field")||i["text-field"]),s=o;if(this.features=[],a||s){for(var l=e.iconDependencies,u=e.glyphDependencies,c=u[r]=u[r]||{},h=0;h<t.length;h++){var d=t[h];if(n.filter(d)){var p=void 0;a&&(p=v(n,{zoom:this.zoom},d.properties),z.applyArabicShaping&&(p=z.applyArabicShaping(p)));var m=void 0;if(s&&(m=f(d.properties,o)),(p||m)&&(this.features.push({text:p,icon:m,index:h,sourceLayerIndex:d.sourceLayerIndex,geometry:x(d),properties:d.properties,type:E.types[d.type]}),m&&(l[m]=!0),p))for(var y=0;y<p.length;y++)c[p.charCodeAt(y)]=!0}}"line"===i["symbol-placement"]&&(this.features=g(this.features))}},j.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},j.prototype.getPaintPropertyStatistics=function(){for(var t=this,e={},n=0,i=t.layers;n<i.length;n+=1){var r=i[n];e[r.id]=_.extend({},t.arrays.icon.layerData[r.id].paintPropertyStatistics,t.arrays.glyph.layerData[r.id].paintPropertyStatistics)}return e},j.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:_.mapObject(this.arrays,function(e){return e.isEmpty()?null:e.serialize(t)})}},j.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},j.prototype.createArrays=function(){var t=this;this.arrays=_.mapObject(L,function(e){return new a(e,t.layers,t.zoom)})},j.prototype.prepare=function(t,e){var n=this;this.symbolInstances=[],this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18}),this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1}),this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18}),this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var i=512*this.overscaling;this.tilePixelRatio=c/i,this.compareText={},this.iconsNeedLinear=!1;var r=this.layers[0].layout,o=.5,a=.5;switch(r["text-anchor"]){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(r["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}for(var s="right"===r["text-justify"]?1:"left"===r["text-justify"]?0:.5,l=24,u=r["text-line-height"]*l,h="line"!==r["symbol-placement"]?r["text-max-width"]*l:0,d=r["text-letter-spacing"]*l,f=[r["text-offset"][0]*l,r["text-offset"][1]*l],p=this.fontstack=r["text-font"].join(","),m="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],v=0,g=n.features;v<g.length;v+=1){var y=g[v],x=void 0;if(y.text){var w=b.allowsVerticalWritingMode(y.text);(x={})[O.horizontal]=k(y.text,t[p],h,u,o,a,s,d,f,l,O.horizontal),x[O.vertical]=w&&m&&k(y.text,t[p],h,u,o,a,s,d,f,l,O.vertical)}else x={};var S=void 0;if(y.icon){var M=e[y.icon],E=n.layers[0].getLayoutValue("icon-offset",{zoom:n.zoom},y.properties);S=T(M,E),M&&(void 0===n.sdfIcons?n.sdfIcons=M.sdf:n.sdfIcons!==M.sdf&&_.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==M.pixelRatio?n.iconsNeedLinear=!0:0===r["icon-rotate"]&&n.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(n.iconsNeedLinear=!0))}(x[O.horizontal]||S)&&n.addFeature(y,x,S)}},j.prototype.addFeature=function(t,e,n){var i=this,r=this.layers[0].layout,o=this.adjustedTextSize/24,a=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,s=this.tilePixelRatio*o,l=this.tilePixelRatio*a/24,u=this.tilePixelRatio*this.adjustedIconSize,f=this.tilePixelRatio*r["symbol-spacing"],p=r["symbol-avoid-edges"],m=r["text-padding"]*this.tilePixelRatio,v=r["icon-padding"]*this.tilePixelRatio,g=r["text-max-angle"]/180*Math.PI,_="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],b="map"===r["icon-rotation-alignment"]&&"line"===r["symbol-placement"],x=r["text-allow-overlap"]||r["icon-allow-overlap"]||r["text-ignore-placement"]||r["icon-ignore-placement"],w=f/2,E=function(r,o){var a=!(o.x<0||o.x>c||o.y<0||o.y>c);if(!p||a){var l=a||x;i.addSymbolInstance(o,r,e,n,i.layers[0],l,i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,s,m,_,u,v,b,{zoom:i.zoom},t.properties)}};if("line"===r["symbol-placement"])for(var z=0,k=y(t.geometry,0,0,c,c);z<k.length;z+=1)for(var T=k[z],P=0,C=d(T,f,g,e[O.vertical]||e[O.horizontal],n,24,l,i.overscaling,c);P<C.length;P+=1){var A=C[P],I=e[O.horizontal];I&&i.anchorIsTooClose(I.text,w,A)||E(T,A)}else if("Polygon"===t.type)for(var L=0,j=M(t.geometry,0);L<j.length;L+=1){var D=j[L],R=S(D,16);E(D[0],new h(R.x,R.y,0))}else if("LineString"===t.type)for(var F=0,B=t.geometry;F<B.length;F+=1){var N=B[F];E(N,new h(N[0].x,N[0].y,0))}else if("Point"===t.type)for(var q=0,V=t.geometry;q<V.length;q+=1)for(var U=0,H=V[q];U<H.length;U+=1){var W=H[U];E([W],new h(W.x,W.y,0))}},j.prototype.anchorIsTooClose=function(t,e,n){var i=this.compareText;if(t in i){for(var r=i[t],o=r.length-1;o>=0;o--)if(n.dist(r[o])<e)return!0}else i[t]=[];return i[t].push(n),!1},j.prototype.place=function(t,e){var n=this;this.createArrays();var i=this.layers[0].layout,r=t.maxScale,o="map"===i["text-rotation-alignment"]&&"line"===i["symbol-placement"],a="map"===i["icon-rotation-alignment"]&&"line"===i["symbol-placement"];if(i["text-allow-overlap"]||i["icon-allow-overlap"]||i["text-ignore-placement"]||i["icon-ignore-placement"]){var s=t.angle,l=Math.sin(s),u=Math.cos(s);this.symbolInstances.sort(function(t,e){return(l*t.anchor.x+u*t.anchor.y|0)-(l*e.anchor.x+u*e.anchor.y|0)||e.featureIndex-t.featureIndex})}for(var c=0,h=n.symbolInstances;c<h.length;c+=1){var d=h[c],f={boxStartIndex:d.textBoxStartIndex,boxEndIndex:d.textBoxEndIndex},p={boxStartIndex:d.iconBoxStartIndex,boxEndIndex:d.iconBoxEndIndex},m=!(d.textBoxStartIndex===d.textBoxEndIndex),v=!(d.iconBoxStartIndex===d.iconBoxEndIndex),g=i["text-optional"]||!m,y=i["icon-optional"]||!v,_=m?t.placeCollisionFeature(f,i["text-allow-overlap"],i["symbol-avoid-edges"]):t.minScale,b=v?t.placeCollisionFeature(p,i["icon-allow-overlap"],i["symbol-avoid-edges"]):t.minScale;g||y?!y&&_?_=Math.max(b,_):!g&&b&&(b=Math.max(b,_)):b=_=Math.max(b,_),m&&(t.insertCollisionFeature(f,_,i["text-ignore-placement"]),_<=r&&n.addSymbols(n.arrays.glyph,d.glyphQuads,_,i["text-keep-upright"],o,t.angle,d.featureProperties,d.writingModes)),v&&(t.insertCollisionFeature(p,b,i["icon-ignore-placement"]),b<=r&&n.addSymbols(n.arrays.icon,d.iconQuads,b,i["icon-keep-upright"],a,t.angle,d.featureProperties))}e&&this.addToDebugBuffers(t)},j.prototype.addSymbols=function(t,e,n,r,o,a,s,l){for(var u=t.elementArray,c=t.layoutVertexArray,h=this.zoom,d=Math.max(Math.log(n)/Math.LN2+h,0),f=0,p=e;f<p.length;f+=1){var m=p[f],v=(m.anchorAngle+a+Math.PI)%(2*Math.PI);if(l&O.vertical){if(o&&m.writingMode===O.vertical){if(r&&o&&v<=5*Math.PI/4||v>7*Math.PI/4)continue}else if(r&&o&&v<=3*Math.PI/4||v>5*Math.PI/4)continue}else if(r&&o&&(v<=Math.PI/2||v>3*Math.PI/2))continue;var g=m.tl,y=m.tr,_=m.bl,b=m.br,x=m.tex,w=m.anchorPoint,S=Math.max(h+Math.log(m.minScale)/Math.LN2,d),M=Math.min(h+Math.log(m.maxScale)/Math.LN2,25);if(!(M<=S)){S===d&&(S=0);var E=Math.round(m.glyphAngle/(2*Math.PI)*256),z=t.prepareSegment(4),k=z.vertexLength;i(c,w.x,w.y,g.x,g.y,x.x,x.y,S,M,d,E),i(c,w.x,w.y,y.x,y.y,x.x+x.w,x.y,S,M,d,E),i(c,w.x,w.y,_.x,_.y,x.x,x.y+x.h,S,M,d,E),i(c,w.x,w.y,b.x,b.y,x.x+x.w,x.y+x.h,S,M,d,E),u.emplaceBack(k,k+1,k+2),u.emplaceBack(k+1,k+2,k+3),z.vertexLength+=4,z.primitiveLength+=2}}t.populatePaintArrays(s)},j.prototype.addToDebugBuffers=function(t){for(var e=this,n=this.arrays.collisionBox,i=n.layoutVertexArray,a=n.elementArray,s=-t.angle,l=t.yStretch,u=0,c=e.symbolInstances;u<c.length;u+=1){var h=c[u];h.textCollisionFeature={boxStartIndex:h.textBoxStartIndex,boxEndIndex:h.textBoxEndIndex},h.iconCollisionFeature={boxStartIndex:h.iconBoxStartIndex,boxEndIndex:h.iconBoxEndIndex};for(var d=0;d<2;d++){var f=h[0===d?"textCollisionFeature":"iconCollisionFeature"];if(f)for(var p=f.boxStartIndex;p<f.boxEndIndex;p++){var m=e.collisionBoxArray.get(p),v=m.anchorPoint,g=new o(m.x1,m.y1*l)._rotate(s),y=new o(m.x2,m.y1*l)._rotate(s),_=new o(m.x1,m.y2*l)._rotate(s),b=new o(m.x2,m.y2*l)._rotate(s),x=Math.max(0,Math.min(25,e.zoom+Math.log(m.maxScale)/Math.LN2)),w=Math.max(0,Math.min(25,e.zoom+Math.log(m.placementScale)/Math.LN2)),S=n.prepareSegment(4),M=S.vertexLength;r(i,v,g,x,w),r(i,v,y,x,w),r(i,v,b,x,w),r(i,v,_,x,w),a.emplaceBack(M,M+1),a.emplaceBack(M+1,M+2),a.emplaceBack(M+2,M+3),a.emplaceBack(M+3,M),S.vertexLength+=4,S.primitiveLength+=4}}}},j.prototype.addSymbolInstance=function(t,e,n,i,r,o,a,s,l,u,c,h,d,f,p,m,v,g){var y,b,x=[],S=[];for(var M in n){var E=parseInt(M,10);n[E]&&(S=S.concat(o?P(t,n[E],c,e,r,d):[]),y=new w(a,e,t,s,l,u,n[E],c,h,d,!1))}var z=y?y.boxStartIndex:this.collisionBoxArray.length,k=y?y.boxEndIndex:this.collisionBoxArray.length;i&&(x=o?C(t,i,f,e,r,m,n[O.horizontal],v,g):[],b=new w(a,e,t,s,l,u,i,f,p,m,!0));var T=b?b.boxStartIndex:this.collisionBoxArray.length,A=b?b.boxEndIndex:this.collisionBoxArray.length;k>j.MAX_INSTANCES&&_.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),A>j.MAX_INSTANCES&&_.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var I=(n[O.vertical]?O.vertical:0)|(n[O.horizontal]?O.horizontal:0);this.symbolInstances.push({textBoxStartIndex:z,textBoxEndIndex:k,iconBoxStartIndex:T,iconBoxEndIndex:A,glyphQuads:S,iconQuads:x,anchor:t,featureIndex:s,featureProperties:g,writingModes:I})},j.programInterfaces=L,j.MAX_INSTANCES=65535,e.exports=j},{"../../source/rtl_text_plugin":90,"../../symbol/anchor":157,"../../symbol/clip_line":159,"../../symbol/collision_feature":161,"../../symbol/get_anchors":163,"../../symbol/mergelines":166,"../../symbol/quads":167,"../../symbol/resolve_text":168,"../../symbol/shaping":169,"../../util/classify_rings":195,"../../util/find_pole_of_inaccessibility":201,"../../util/script_detection":209,"../../util/token":211,"../../util/util":212,"../array_group":44,"../buffer_group":52,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60,"point-geometry":26,"vector-tile":34}],51:[function(t,e,n){"use strict";var i={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"},r=function(t,e,n){this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.attributes=e.members,this.itemSize=e.bytesPerElement,this.type=n,this.arrayType=e};r.fromStructArray=function(t,e){return new r(t.serialize(),t.constructor.serialize(),e)},r.prototype.bind=function(t){var e=t[this.type];this.buffer?t.bindBuffer(e,this.buffer):(this.gl=t,this.buffer=t.createBuffer(),t.bindBuffer(e,this.buffer),t.bufferData(e,this.arrayBuffer,t.STATIC_DRAW),this.arrayBuffer=null)},r.prototype.setVertexAttribPointers=function(t,e,n){for(var r=this,o=0;o<this.attributes.length;o++){var a=r.attributes[o],s=e[a.name];void 0!==s&&t.vertexAttribPointer(s,a.components,t[i[a.type]],!1,r.arrayType.bytesPerElement,a.offset+(r.arrayType.bytesPerElement*n||0))}},r.prototype.destroy=function(){this.buffer&&this.gl.deleteBuffer(this.buffer)},r.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"},e.exports=r},{}],52:[function(t,e,n){"use strict";var i=t("../util/util"),r=t("./buffer"),o=t("./program_configuration"),a=t("../render/vertex_array_object"),s=function(t,e,n,s){var l=this;this.layoutVertexBuffer=new r(s.layoutVertexArray,t.layoutVertexArrayType.serialize(),r.BufferType.VERTEX),s.elementArray&&(this.elementBuffer=new r(s.elementArray,t.elementArrayType.serialize(),r.BufferType.ELEMENT)),s.elementArray2&&(this.elementBuffer2=new r(s.elementArray2,t.elementArrayType2.serialize(),r.BufferType.ELEMENT)),this.layerData={};for(var u=0,c=e;u<c.length;u+=1){var h=c[u],d=s.paintVertexArrays&&s.paintVertexArrays[h.id],f=o.createDynamic(t.paintAttributes||[],h,n),p=d?new r(d.array,d.type,r.BufferType.VERTEX):null;l.layerData[h.id]={programConfiguration:f,paintVertexBuffer:p}}this.segments=s.segments,this.segments2=s.segments2;for(var m=0,v=[l.segments,l.segments2];m<v.length;m+=1)for(var g=0,y=v[m]||[];g<y.length;g+=1){y[g].vaos=i.mapObject(l.layerData,function(){return new a})}};s.prototype.destroy=function(){var t=this;for(var e in this.layoutVertexBuffer.destroy(),this.elementBuffer&&this.elementBuffer.destroy(),this.elementBuffer2&&this.elementBuffer2.destroy(),t.layerData){var n=t.layerData[e].paintVertexBuffer;n&&n.destroy()}for(var i=0,r=[t.segments,t.segments2];i<r.length;i+=1)for(var o=0,a=r[i]||[];o<a.length;o+=1){var s=a[o];for(var l in s.vaos)s.vaos[l].destroy()}},e.exports=s},{"../render/vertex_array_object":80,"../util/util":212,"./buffer":51,"./program_configuration":58}],53:[function(t,e,n){"use strict";var i=t("../util/struct_array");e.exports=function(t){return i({members:[{type:"Uint16",name:"vertices",components:t||3}]})}},{"../util/struct_array":210}],54:[function(t,e,n){"use strict";e.exports=8192},{}],55:[function(t,e,n){"use strict";function i(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function r(t,e){return e-t}function o(t,e){return e>0?e+2*t:t}function a(t,e,n,i,r){if(!e[0]&&!e[1])return t;e=l.convert(e),"viewport"===n&&e._rotate(-i);for(var o=[],a=0;a<t.length;a++){for(var s=t[a],u=[],c=0;c<s.length;c++)u.push(s[c].sub(e._mult(r)));o.push(u)}return o}function s(t,e){for(var n=[],i=new l(0,0),r=0;r<t.length;r++){for(var o=t[r],a=[],s=0;s<o.length;s++){var u=o[s-1],c=o[s],h=o[s+1],d=0===s?i:c.sub(u)._unit()._perp(),f=s===o.length-1?i:h.sub(c)._unit()._perp(),p=d._add(f)._unit(),m=p.x*f.x+p.y*f.y;p._mult(1/m),a.push(p._mult(e)._add(c))}n.push(a)}return n}var l=t("point-geometry"),u=t("./load_geometry"),c=t("./extent"),h=t("../style-spec/feature_filter"),d=t("../util/struct_array"),f=t("grid-index"),p=t("../util/dictionary_coder"),m=t("vector-tile"),v=t("pbf"),g=t("../util/vectortile_to_geojson"),y=t("../util/util").arraysIntersect,_=t("../util/intersection_tests"),b=_.multiPolygonIntersectsBufferedMultiPoint,x=_.multiPolygonIntersectsMultiPolygon,w=_.multiPolygonIntersectsBufferedMultiLine,S=d({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]}),M=function(t,e,n){if(t.grid){var i=t,r=e;t=i.coord,e=i.overscaling,this.grid=new f(i.grid),this.featureIndexArray=new S(i.featureIndexArray),this.rawTileData=r,this.bucketLayerIDs=i.bucketLayerIDs,this.paintPropertyStatistics=i.paintPropertyStatistics}else this.grid=new f(c,16,0),this.featureIndexArray=new S;this.coord=t,this.overscaling=e,this.x=t.x,this.y=t.y,this.z=t.z-Math.log(e)/Math.LN2,this.setCollisionTile(n)};M.prototype.insert=function(t,e){var n=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(t.index,t.sourceLayerIndex,e);for(var i=u(t),r=0;r<i.length;r++){for(var o=i[r],a=[1/0,1/0,-1/0,-1/0],s=0;s<o.length;s++){var l=o[s];a[0]=Math.min(a[0],l.x),a[1]=Math.min(a[1],l.y),a[2]=Math.max(a[2],l.x),a[3]=Math.max(a[3],l.y)}this.grid.insert(n,a[0],a[1],a[2],a[3])}},M.prototype.setCollisionTile=function(t){this.collisionTile=t},M.prototype.serialize=function(t){var e=this.grid.toArrayBuffer();return t&&t.push(e),{coord:this.coord,overscaling:this.overscaling,grid:e,featureIndexArray:this.featureIndexArray.serialize(t),bucketLayerIDs:this.bucketLayerIDs,paintPropertyStatistics:this.paintPropertyStatistics}},M.prototype.query=function(t,e){var n=this;this.vtLayers||(this.vtLayers=new m.VectorTile(new v(this.rawTileData)).layers,this.sourceLayerCoder=new p(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var a={},s=t.params||{},u=c/t.tileSize/t.scale,d=h(s.filter),f=0;for(var g in e)if(n.hasLayer(g)){var y=e[g],_=0;if("line"===y.type){var b=o(n.getPaintValue("line-width",y),n.getPaintValue("line-gap-width",y)),x=n.getPaintValue("line-offset",y),w=n.getPaintValue("line-translate",y);_=b/2+Math.abs(x)+i(w)}else"fill"===y.type?_=i(n.getPaintValue("fill-translate",y)):"fill-extrusion"===y.type?_=i(n.getPaintValue("fill-extrusion-translate",y)):"circle"===y.type&&(_=n.getPaintValue("circle-radius",y)+i(n.getPaintValue("circle-translate",y)));f=Math.max(f,_*u)}for(var S=t.queryGeometry.map(function(t){return t.map(function(t){return new l(t.x,t.y)})}),M=1/0,E=1/0,z=-1/0,k=-1/0,T=0;T<S.length;T++)for(var O=S[T],P=0;P<O.length;P++){var C=O[P];M=Math.min(M,C.x),E=Math.min(E,C.y),z=Math.max(z,C.x),k=Math.max(k,C.y)}var A=this.grid.query(M-f,E-f,z+f,k+f);A.sort(r),this.filterMatching(a,A,this.featureIndexArray,S,d,s.layers,e,t.bearing,u);var I=this.collisionTile.queryRenderedSymbols(S,t.scale);return I.sort(),this.filterMatching(a,I,this.collisionTile.collisionBoxArray,S,d,s.layers,e,t.bearing,u),a},M.prototype.filterMatching=function(t,e,n,i,r,l,c,h,d){for(var f,p=this,m=0;m<e.length;m++){var v=e[m];if(v!==f){f=v;var _=n.get(v),S=p.bucketLayerIDs[_.bucketIndex];if(!l||y(l,S)){var M=p.sourceLayerCoder.decode(_.sourceLayerIndex),E=p.vtLayers[M].feature(_.featureIndex);if(r(E))for(var z=null,k=0;k<S.length;k++){var T=S[k];if(!(l&&l.indexOf(T)<0)){var O=c[T];if(O){var P=void 0;if("symbol"!==O.type)if(z||(z=u(E)),"line"===O.type){P=a(i,p.getPaintValue("line-translate",O,E),p.getPaintValue("line-translate-anchor",O,E),h,d);var C=d/2*o(p.getPaintValue("line-width",O,E),p.getPaintValue("line-gap-width",O,E)),A=p.getPaintValue("line-offset",O,E);if(A&&(z=s(z,A*d)),!w(P,z,C))continue}else if("fill"===O.type||"fill-extrusion"===O.type){var I=O.type;if(P=a(i,p.getPaintValue(I+"-translate",O,E),p.getPaintValue(I+"-translate-anchor",O,E),h,d),!x(P,z))continue}else if("circle"===O.type){P=a(i,p.getPaintValue("circle-translate",O,E),p.getPaintValue("circle-translate-anchor",O,E),h,d);var L=p.getPaintValue("circle-radius",O,E)*d;if(!b(P,z,L))continue}var j=new g(E,p.z,p.x,p.y);j.layer=O.serialize();var D=t[T];void 0===D&&(D=t[T]=[]),D.push(j)}}}}}}},M.prototype.hasLayer=function(t){for(var e in this.bucketLayerIDs)for(var n=0,i=this.bucketLayerIDs[e];n<i.length;n+=1){if(t===i[n])return!0}return!1},M.prototype.getPaintValue=function(t,e,n){if(e.isPaintValueFeatureConstant(t)||n){var i=n?n.properties:{};return e.getPaintValue(t,{zoom:this.z},i)}return this.paintPropertyStatistics[e.id][t].max},e.exports=M},{"../style-spec/feature_filter":103,"../util/dictionary_coder":197,"../util/intersection_tests":205,"../util/struct_array":210,"../util/util":212,"../util/vectortile_to_geojson":213,"./extent":54,"./load_geometry":56,"grid-index":16,pbf:25,"point-geometry":26,"vector-tile":34}],56:[function(t,e,n){"use strict";function i(t){return{min:-1*Math.pow(2,t-1),max:Math.pow(2,t-1)-1}}var r=t("../util/util"),o=t("./extent"),a={15:i(15),16:i(16)};e.exports=function(t,e){for(var n=a[e||16],i=o/t.extent,s=t.loadGeometry(),l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){var h=u[c];h.x=Math.round(h.x*i),h.y=Math.round(h.y*i),(h.x<n.min||h.x>n.max||h.y<n.min||h.y>n.max)&&r.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}},{"../util/util":212,"./extent":54}],57:[function(t,e,n){"use strict";var i=t("../util/struct_array")({members:[{name:"a_pos",type:"Int16",components:2}]});e.exports=i},{"../util/struct_array":210}],58:[function(t,e,n){"use strict";function i(t,e,n,i){if(!t.zoomStops)return e.getPaintValue(t.property,n,i);var r=t.zoomStops.map(function(r){return e.getPaintValue(t.property,a.extend({},n,{zoom:r}),i)});return 1===r.length?r[0]:r}function r(t,e){var n=t.name;n||(n=t.property.replace(e.type+"-","").replace(/-/g,"_"));var i="color"===e._paintSpecifications[t.property].type;return a.extend({name:"a_"+n,components:i?4:1,multiplier:i?255:1,dimensions:i?4:1},t)}var o=t("./vertex_array_type"),a=t("../util/util"),s=function(){this.attributes=[],this.uniforms=[],this.interpolationUniforms=[],this.pragmas={vertex:{},fragment:{}},this.cacheKey=""};s.createDynamic=function(t,e,n){for(var i=new s,a=0,l=t;a<l.length;a+=1){var u=r(l[a],e),c=u.name.slice(2);e.isPaintValueFeatureConstant(u.property)?i.addZoomAttribute(c,u):e.isPaintValueZoomConstant(u.property)?i.addPropertyAttribute(c,u):i.addZoomAndPropertyAttribute(c,u,e,n)}return i.PaintVertexArray=o(i.attributes),i},s.createStatic=function(t){for(var e=new s,n=0,i=t;n<i.length;n+=1){var r=i[n];e.addUniform(r,"u_"+r)}return e},s.prototype.addUniform=function(t,e){var n=this.getPragmas(t);n.define.push("uniform {precision} {type} "+e+";"),n.initialize.push("{precision} {type} "+t+" = "+e+";"),this.cacheKey+="/u_"+t},s.prototype.addZoomAttribute=function(t,e){this.uniforms.push(e),this.addUniform(t,e.name)},s.prototype.addPropertyAttribute=function(t,e){var n=this.getPragmas(t);this.attributes.push(e),n.define.push("varying {precision} {type} "+t+";"),n.vertex.define.push("attribute {precision} {type} "+e.name+";"),n.vertex.initialize.push(t+" = "+e.name+" / "+e.multiplier+".0;"),this.cacheKey+="/a_"+t},s.prototype.addZoomAndPropertyAttribute=function(t,e,n,i){var r=this.getPragmas(t);r.define.push("varying {precision} {type} "+t+";");for(var o=0,s=n.getPaintValueStopZoomLevels(e.property);o<s.length&&s[o]<i;)o++;var l=Math.max(0,Math.min(s.length-4,o-2)),u="u_"+t+"_t";r.vertex.define.push("uniform lowp float "+u+";"),this.interpolationUniforms.push({name:u,property:e.property,stopOffset:l});for(var c=[],h=0;h<4;h++)c.push(s[Math.min(l+h,s.length-1)]);var d=[];if(1===e.components)this.attributes.push(a.extend({},e,{components:4,zoomStops:c})),r.vertex.define.push("attribute {precision} vec4 "+e.name+";"),d.push(e.name);else for(var f=0;f<4;f++){var p=e.name+f;d.push(p),this.attributes.push(a.extend({},e,{name:p,zoomStops:[c[f]]})),r.vertex.define.push("attribute {precision} {type} "+p+";")}r.vertex.initialize.push(t+" = evaluate_zoom_function_"+e.components+"(            "+d.join(", ")+", "+u+") / "+e.multiplier+".0;"),this.cacheKey+="/z_"+t},s.prototype.getPragmas=function(t){return this.pragmas[t]||(this.pragmas[t]={define:[],initialize:[]},this.pragmas[t].fragment={define:[],initialize:[]},this.pragmas[t].vertex={define:[],initialize:[]}),this.pragmas[t]},s.prototype.applyPragmas=function(t,e){var n=this;return t.replace(/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(t,i,r,o,a){return n.pragmas[a][i].concat(n.pragmas[a][e][i]).join("\n").replace(/{type}/g,o).replace(/{precision}/g,r)})},s.prototype.createPaintPropertyStatistics=function(){for(var t={},e=0,n=this.attributes;e<n.length;e+=1){var i=n[e];1===i.dimensions&&(t[i.property]={max:-1/0})}return t},s.prototype.populatePaintArray=function(t,e,n,r,o,a){var s=e.length;e.resize(r);for(var l=0,u=this.attributes;l<u.length;l+=1)for(var c=u[l],h=i(c,t,o,a),d=s;d<r;d++){var f=e.get(d);if(4===c.components)for(var p=0;p<4;p++)f[c.name+p]=h[p]*c.multiplier;else f[c.name]=h*c.multiplier;if(1===c.dimensions){var m=n[c.property];m.max=Math.max(m.max,1===c.components?h:Math.max.apply(Math,h))}}},s.prototype.setUniforms=function(t,e,n,i){for(var r=0,o=this.uniforms;r<o.length;r+=1){var a=o[r],s=n.getPaintValue(a.property,i);4===a.components?t.uniform4fv(e[a.name],s):t.uniform1f(e[a.name],s)}for(var l=0,u=this.interpolationUniforms;l<u.length;l+=1){var c=u[l],h=n.getPaintInterpolationT(c.property,i);t.uniform1f(e[c.name],Math.max(0,Math.min(4,h-c.stopOffset)))}},e.exports=s},{"../util/util":212,"./vertex_array_type":60}],59:[function(t,e,n){"use strict";var i=t("../util/struct_array")({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});e.exports=i},{"../util/struct_array":210}],60:[function(t,e,n){"use strict";var i=t("../util/struct_array");e.exports=function(t){return i({members:t,alignment:4})}},{"../util/struct_array":210}],61:[function(t,e,n){"use strict";var i=function(t,e,n){this.column=t,this.row=e,this.zoom=n};i.prototype.clone=function(){return new i(this.column,this.row,this.zoom)},i.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},i.prototype.sub=function(t){return this.clone()._sub(t)},i.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},i.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this},e.exports=i},{}],62:[function(t,e,n){"use strict";var i=t("../util/util").wrap,r=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};r.prototype.wrap=function(){return new r(i(this.lng,-180,180),this.lat)},r.prototype.toArray=function(){return[this.lng,this.lat]},r.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},r.convert=function(t){if(t instanceof r)return t;if(t&&t.hasOwnProperty("lng")&&t.hasOwnProperty("lat"))return new r(t.lng,t.lat);if(Array.isArray(t)&&2===t.length)return new r(t[0],t[1]);throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},e.exports=r},{"../util/util":212}],63:[function(t,e,n){"use strict";var i=t("./lng_lat"),r=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};r.prototype.setNorthEast=function(t){return this._ne=i.convert(t),this},r.prototype.setSouthWest=function(t){return this._sw=i.convert(t),this},r.prototype.extend=function(t){var e,n,o=this._sw,a=this._ne;if(t instanceof i)e=t,n=t;else{if(!(t instanceof r))return Array.isArray(t)?t.every(Array.isArray)?this.extend(r.convert(t)):this.extend(i.convert(t)):this;if(e=t._sw,n=t._ne,!e||!n)return this}return o||a?(o.lng=Math.min(e.lng,o.lng),o.lat=Math.min(e.lat,o.lat),a.lng=Math.max(n.lng,a.lng),a.lat=Math.max(n.lat,a.lat)):(this._sw=new i(e.lng,e.lat),this._ne=new i(n.lng,n.lat)),this},r.prototype.getCenter=function(){return new i((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},r.prototype.getSouthWest=function(){return this._sw},r.prototype.getNorthEast=function(){return this._ne},r.prototype.getNorthWest=function(){return new i(this.getWest(),this.getNorth())},r.prototype.getSouthEast=function(){return new i(this.getEast(),this.getSouth())},r.prototype.getWest=function(){return this._sw.lng},r.prototype.getSouth=function(){return this._sw.lat},r.prototype.getEast=function(){return this._ne.lng},r.prototype.getNorth=function(){return this._ne.lat},r.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},r.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},r.convert=function(t){return!t||t instanceof r?t:new r(t)},e.exports=r},{"./lng_lat":62}],64:[function(t,e,n){"use strict";var i=t("./lng_lat"),r=t("point-geometry"),o=t("./coordinate"),a=t("../util/util"),s=t("../util/interpolate"),l=t("../source/tile_coord"),u=t("../data/extent"),c=t("@mapbox/gl-matrix"),h=c.vec4,d=c.mat4,f=c.mat2,p=function(t,e,n){this.tileSize=512,this._renderWorldCopies=void 0===n||n,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new i(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0},m={minZoom:{},maxZoom:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};m.minZoom.get=function(){return this._minZoom},m.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},m.maxZoom.get=function(){return this._maxZoom},m.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},m.worldSize.get=function(){return this.tileSize*this.scale},m.centerPoint.get=function(){return this.size._div(2)},m.size.get=function(){return new r(this.width,this.height)},m.bearing.get=function(){return-this.angle/Math.PI*180},m.bearing.set=function(t){var e=-a.wrap(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=f.create(),f.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},m.pitch.get=function(){return this._pitch/Math.PI*180},m.pitch.set=function(t){var e=a.clamp(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},m.fov.get=function(){return this._fov/Math.PI*180},m.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},m.zoom.get=function(){return this._zoom},m.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},m.center.get=function(){return this._center},m.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},p.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},p.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),n=e;if(e<t.minzoom)return[];e>t.maxzoom&&(e=t.maxzoom);var i=this.pointCoordinate(this.centerPoint,e),o=new r(i.column-.5,i.row-.5),a=[this.pointCoordinate(new r(0,0),e),this.pointCoordinate(new r(this.width,0),e),this.pointCoordinate(new r(this.width,this.height),e),this.pointCoordinate(new r(0,this.height),e)];return l.cover(e,a,t.reparseOverscaled?n:e,this._renderWorldCopies).sort(function(t,e){return o.dist(t)-o.dist(e)})},p.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},m.unmodified.get=function(){return this._unmodified},p.prototype.zoomScale=function(t){return Math.pow(2,t)},p.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},p.prototype.project=function(t){return new r(this.lngX(t.lng),this.latY(t.lat))},p.prototype.unproject=function(t){return new i(this.xLng(t.x),this.yLat(t.y))},m.x.get=function(){return this.lngX(this.center.lng)},m.y.get=function(){return this.latY(this.center.lat)},m.point.get=function(){return new r(this.x,this.y)},p.prototype.lngX=function(t){return(180+t)*this.worldSize/360},p.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},p.prototype.xLng=function(t){return 360*t/this.worldSize-180},p.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},p.prototype.setLocationAtPoint=function(t,e){var n=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(n))},p.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},p.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},p.prototype.locationCoordinate=function(t){return new o(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},p.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new i(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},p.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];h.transformMat4(n,n,this.pixelMatrixInverse),h.transformMat4(i,i,this.pixelMatrixInverse);var r=n[3],a=i[3],l=n[1]/r,u=i[1]/a,c=n[2]/r,d=i[2]/a,f=c===d?0:(0-c)/(d-c);return new o(s(n[0]/r,i[0]/a,f)/this.tileSize,s(l,u,f)/this.tileSize,this.zoom)._zoomTo(e)},p.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),n=[e.column*this.tileSize,e.row*this.tileSize,0,1];return h.transformMat4(n,n,this.pixelMatrix),new r(n[0]/n[3],n[1]/n[3])},p.prototype.calculatePosMatrix=function(t,e){var n=t.toCoordinate(e),i=this.worldSize/this.zoomScale(n.zoom),r=d.identity(new Float64Array(16));return d.translate(r,r,[n.column*i,n.row*i,0]),d.scale(r,r,[i/u,i/u,1]),d.multiply(r,this.projMatrix,r),new Float32Array(r)},p.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,n,i,o,a,s,l,u=this.size,c=this._unmodified;this.latRange&&(t=this.latY(this.latRange[1]),o=(e=this.latY(this.latRange[0]))-t<u.y?u.y/(e-t):0),this.lngRange&&(n=this.lngX(this.lngRange[0]),a=(i=this.lngX(this.lngRange[1]))-n<u.x?u.x/(i-n):0);var h=Math.max(a||0,o||0);if(h)return this.center=this.unproject(new r(a?(i+n)/2:this.x,o?(e+t)/2:this.y)),this.zoom+=this.scaleZoom(h),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var d=this.y,f=u.y/2;d-f<t&&(l=t+f),d+f>e&&(l=e-f)}if(this.lngRange){var p=this.x,m=u.x/2;p-m<n&&(s=n+m),p+m>i&&(s=i-m)}void 0===s&&void 0===l||(this.center=this.unproject(new r(void 0!==s?s:this.x,void 0!==l?l:this.y))),this._unmodified=c,this._constraining=!1}},p.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,n=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),i=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),r=new Float64Array(16);d.perspective(r,this._fov,this.width/this.height,1,i),d.scale(r,r,[1,-1,1]),d.translate(r,r,[0,0,-this.cameraToCenterDistance]),d.rotateX(r,r,this._pitch),d.rotateZ(r,r,this.angle),d.translate(r,r,[-this.x,-this.y,0]);var o=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));if(d.scale(r,r,[1,1,o,1]),this.projMatrix=r,r=d.create(),d.scale(r,r,[this.width/2,-this.height/2,1]),d.translate(r,r,[1,-1,0]),this.pixelMatrix=d.multiply(new Float64Array(16),r,this.projMatrix),!(r=d.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=r}},Object.defineProperties(p.prototype,m),e.exports=p},{"../data/extent":54,"../source/tile_coord":94,"../util/interpolate":204,"../util/util":212,"./coordinate":61,"./lng_lat":62,"@mapbox/gl-matrix":1,"point-geometry":26}],65:[function(t,e,n){"use strict";var i=t("./util/browser"),r=e.exports={};r.version=t("../package.json").version,r.workerCount=Math.max(Math.floor(i.hardwareConcurrency/2),1),r.Map=t("./ui/map"),r.NavigationControl=t("./ui/control/navigation_control"),r.GeolocateControl=t("./ui/control/geolocate_control"),r.AttributionControl=t("./ui/control/attribution_control"),r.ScaleControl=t("./ui/control/scale_control"),r.FullscreenControl=t("./ui/control/fullscreen_control"),r.Popup=t("./ui/popup"),r.Marker=t("./ui/marker"),r.Style=t("./style/style"),r.LngLat=t("./geo/lng_lat"),r.LngLatBounds=t("./geo/lng_lat_bounds"),r.Point=t("point-geometry"),r.Evented=t("./util/evented"),r.supported=t("./util/browser").supported;var o=t("./util/config");r.config=o;var a=t("./source/rtl_text_plugin");r.setRTLTextPlugin=a.setRTLTextPlugin,Object.defineProperty(r,"accessToken",{get:function(){return o.ACCESS_TOKEN},set:function(t){o.ACCESS_TOKEN=t}})},{"../package.json":43,"./geo/lng_lat":62,"./geo/lng_lat_bounds":63,"./source/rtl_text_plugin":90,"./style/style":146,"./ui/control/attribution_control":173,"./ui/control/fullscreen_control":174,"./ui/control/geolocate_control":175,"./ui/control/navigation_control":177,"./ui/control/scale_control":178,"./ui/map":187,"./ui/marker":188,"./ui/popup":189,"./util/browser":192,"./util/config":196,"./util/evented":200,"point-geometry":26}],66:[function(t,e,n){"use strict";var i=t("./pattern");e.exports=function(t,e,n){var r=t.gl,o=t.transform,a=o.tileSize,s=n.paint["background-color"],l=n.paint["background-pattern"],u=n.paint["background-opacity"],c=!l&&1===s[3]&&1===u;if(t.isOpaquePass===c){var h;r.disable(r.STENCIL_TEST),t.setDepthSublayer(0),l?(h=t.useProgram("fillPattern",t.basicFillProgramConfiguration),i.prepare(l,t,h),t.tileExtentPatternVAO.bind(r,h,t.tileExtentBuffer)):(h=t.useProgram("fill",t.basicFillProgramConfiguration),r.uniform4fv(h.u_color,s),t.tileExtentVAO.bind(r,h,t.tileExtentBuffer)),r.uniform1f(h.u_opacity,u);for(var d=0,f=o.coveringTiles({tileSize:a});d<f.length;d+=1){var p=f[d];l&&i.setTile({coord:p,tileSize:a},t,h),r.uniformMatrix4fv(h.u_matrix,!1,t.transform.calculatePosMatrix(p)),r.drawArrays(r.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}},{"./pattern":78}],67:[function(t,e,n){"use strict";var i=t("../util/browser");e.exports=function(t,e,n,r){if(!t.isOpaquePass){var o=t.gl;t.setDepthSublayer(0),t.depthMask(!1),o.disable(o.STENCIL_TEST);for(var a=0;a<r.length;a++){var s=r[a],l=e.getTile(s),u=l.getBucket(n);if(u){var c=u.buffers,h=c.layerData[n.id],d=h.programConfiguration,f=t.useProgram("circle",d);d.setUniforms(o,f,n,{zoom:t.transform.zoom}),"map"===n.paint["circle-pitch-scale"]?(o.uniform1i(f.u_scale_with_map,!0),o.uniform2f(f.u_extrude_scale,t.transform.pixelsToGLUnits[0]*t.transform.cameraToCenterDistance,t.transform.pixelsToGLUnits[1]*t.transform.cameraToCenterDistance)):(o.uniform1i(f.u_scale_with_map,!1),o.uniform2fv(f.u_extrude_scale,t.transform.pixelsToGLUnits)),o.uniform1f(f.u_devicepixelratio,i.devicePixelRatio),o.uniformMatrix4fv(f.u_matrix,!1,t.translatePosMatrix(s.posMatrix,l,n.paint["circle-translate"],n.paint["circle-translate-anchor"]));for(var p=0,m=c.segments;p<m.length;p+=1){var v=m[p];v.vaos[n.id].bind(o,f,c.layoutVertexBuffer,c.elementBuffer,h.paintVertexBuffer,v.vertexOffset),o.drawElements(o.TRIANGLES,3*v.primitiveLength,o.UNSIGNED_SHORT,3*v.primitiveOffset*2)}}}}}},{"../util/browser":192}],68:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){var r=t.gl;r.enable(r.STENCIL_TEST);for(var o=t.useProgram("collisionBox"),a=0;a<i.length;a++){var s=i[a],l=e.getTile(s),u=l.getBucket(n);if(u){var c=u.buffers.collisionBox;if(c){r.uniformMatrix4fv(o.u_matrix,!1,s.posMatrix),t.enableTileClippingMask(s),t.lineWidth(1),r.uniform1f(o.u_scale,Math.pow(2,t.transform.zoom-l.coord.z)),r.uniform1f(o.u_zoom,10*t.transform.zoom),r.uniform1f(o.u_maxzoom,10*(l.coord.z+1));for(var h=0,d=c.segments;h<d.length;h+=1){var f=d[h];f.vaos[n.id].bind(r,o,c.layoutVertexBuffer,c.elementBuffer,null,f.vertexOffset),r.drawElements(r.LINES,2*f.primitiveLength,r.UNSIGNED_SHORT,2*f.primitiveOffset*2)}}}}}},{}],69:[function(t,e,n){"use strict";function i(t,e,n){var i=t.gl;i.disable(i.STENCIL_TEST),t.lineWidth(1*r.devicePixelRatio);var h=n.posMatrix,d=t.useProgram("debug");i.uniformMatrix4fv(d.u_matrix,!1,h),i.uniform4f(d.u_color,1,0,0,1),t.debugVAO.bind(i,d,t.debugBuffer),i.drawArrays(i.LINE_STRIP,0,t.debugBuffer.length);for(var f=function(t,e,n,i){i=i||1;var r,o,a,s,l,u,h,d,f=[];for(r=0,o=t.length;r<o;r++)if(l=c[t[r]]){for(d=null,a=0,s=l[1].length;a<s;a+=2)-1===l[1][a]&&-1===l[1][a+1]?d=null:(u=e+l[1][a]*i,h=n-l[1][a+1]*i,d&&f.push(d.x,d.y,u,h),d={x:u,y:h});e+=l[0]*i}return f}(n.toString(),50,200,5),p=new u,m=0;m<f.length;m+=2)p.emplaceBack(f[m],f[m+1]);var v=s.fromStructArray(p,s.BufferType.VERTEX);(new l).bind(i,d,v),i.uniform4f(d.u_color,1,1,1,1);for(var g=e.getTile(n).tileSize,y=a/(Math.pow(2,t.transform.zoom-n.z)*g),_=[[-1,-1],[-1,1],[1,-1],[1,1]],b=0;b<_.length;b++){var x=_[b];i.uniformMatrix4fv(d.u_matrix,!1,o.translate([],h,[y*x[0],y*x[1],0])),i.drawArrays(i.LINES,0,v.length)}i.uniform4f(d.u_color,0,0,0,1),i.uniformMatrix4fv(d.u_matrix,!1,h),i.drawArrays(i.LINES,0,v.length)}var r=t("../util/browser"),o=t("@mapbox/gl-matrix").mat4,a=t("../data/extent"),s=t("../data/buffer"),l=t("./vertex_array_object"),u=t("../data/pos_array");e.exports=function(t,e,n){for(var r=0;r<n.length;r++)i(t,e,n[r])};var c={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]}},{"../data/buffer":51,"../data/extent":54,"../data/pos_array":57,"../util/browser":192,"./vertex_array_object":80,"@mapbox/gl-matrix":1}],70:[function(t,e,n){"use strict";function i(t,e,n,i,r){for(var o=!0,a=0,s=i;a<s.length;a+=1){var l=s[a],u=e.getTile(l),c=u.getBucket(n);c&&(t.enableTileClippingMask(l),r(t,e,n,u,l,c.buffers,o),o=!1)}}function r(t,e,n,i,r,o,s){for(var l=t.gl,u=o.layerData[n.id],c=a("fill",n.paint["fill-pattern"],t,u,n,i,r,s),h=0,d=o.segments;h<d.length;h+=1){var f=d[h];f.vaos[n.id].bind(l,c,o.layoutVertexBuffer,o.elementBuffer,u.paintVertexBuffer,f.vertexOffset),l.drawElements(l.TRIANGLES,3*f.primitiveLength,l.UNSIGNED_SHORT,3*f.primitiveOffset*2)}}function o(t,e,n,i,r,o,s){var l=t.gl,u=o.layerData[n.id],c=a("fillOutline",n.paint["fill-pattern"]&&!n.getPaintProperty("fill-outline-color"),t,u,n,i,r,s);l.uniform2f(c.u_world,l.drawingBufferWidth,l.drawingBufferHeight);for(var h=0,d=o.segments2;h<d.length;h+=1){var f=d[h];f.vaos[n.id].bind(l,c,o.layoutVertexBuffer,o.elementBuffer2,u.paintVertexBuffer,f.vertexOffset),l.drawElements(l.LINES,2*f.primitiveLength,l.UNSIGNED_SHORT,2*f.primitiveOffset*2)}}function a(t,e,n,i,r,o,a,l){var u,c=n.currentProgram;return e?(u=n.useProgram(t+"Pattern",i.programConfiguration),(l||u!==c)&&(i.programConfiguration.setUniforms(n.gl,u,r,{zoom:n.transform.zoom}),s.prepare(r.paint["fill-pattern"],n,u)),s.setTile(o,n,u)):(u=n.useProgram(t,i.programConfiguration),(l||u!==c)&&i.programConfiguration.setUniforms(n.gl,u,r,{zoom:n.transform.zoom})),n.gl.uniformMatrix4fv(u.u_matrix,!1,n.translatePosMatrix(a.posMatrix,o,r.paint["fill-translate"],r.paint["fill-translate-anchor"])),u}var s=t("./pattern");e.exports=function(t,e,n,a){var s=t.gl;s.enable(s.STENCIL_TEST);var l=!n.paint["fill-pattern"]&&n.isPaintValueFeatureConstant("fill-color")&&n.isPaintValueFeatureConstant("fill-opacity")&&1===n.paint["fill-color"][3]&&1===n.paint["fill-opacity"];t.isOpaquePass===l&&(t.setDepthSublayer(1),i(t,e,n,a,r)),!t.isOpaquePass&&n.paint["fill-antialias"]&&(t.lineWidth(2),t.depthMask(!1),t.setDepthSublayer(n.getPaintProperty("fill-outline-color")?2:0),i(t,e,n,a,o))}},{"./pattern":78}],71:[function(t,e,n){"use strict";function i(t,e,n){this.gl=t,this.width=e.width,this.height=e.height,this.painter=e,this.layer=n,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function r(t,e,n,i){if(!t.isOpaquePass){var r=e.getTile(i),o=r.getBucket(n);if(o){var a=o.buffers,s=t.gl,l=n.paint["fill-extrusion-pattern"],h=a.layerData[n.id],f=h.programConfiguration,p=t.useProgram(l?"fillExtrusionPattern":"fillExtrusion",f);f.setUniforms(s,p,n,{zoom:t.transform.zoom}),l&&(u.prepare(l,t,p),u.setTile(r,t,p),s.uniform1f(p.u_height_factor,-Math.pow(2,i.z)/r.tileSize/8)),t.gl.uniformMatrix4fv(p.u_matrix,!1,t.translatePosMatrix(i.posMatrix,r,n.paint["fill-extrusion-translate"],n.paint["fill-extrusion-translate-anchor"])),function(t,e){var n=e.gl,i=e.style.light,r=i.calculated.position,o=[r.x,r.y,r.z],a=c.create();"viewport"===i.calculated.anchor&&c.fromRotation(a,-e.transform.angle),d.transformMat3(o,o,a),n.uniform3fv(t.u_lightpos,o),n.uniform1f(t.u_lightintensity,i.calculated.intensity),n.uniform3fv(t.u_lightcolor,i.calculated.color.slice(0,3))}(p,t);for(var m=0,v=a.segments;m<v.length;m+=1){var g=v[m];g.vaos[n.id].bind(s,p,a.layoutVertexBuffer,a.elementBuffer,h.paintVertexBuffer,g.vertexOffset),s.drawElements(s.TRIANGLES,3*g.primitiveLength,s.UNSIGNED_SHORT,3*g.primitiveOffset*2)}}}}var o=t("@mapbox/gl-matrix"),a=t("../data/buffer"),s=t("./vertex_array_object"),l=t("../data/pos_array"),u=t("./pattern"),c=o.mat3,h=o.mat4,d=o.vec3;e.exports=function(t,e,n,o){if(0!==n.paint["fill-extrusion-opacity"]){var a=t.gl;a.disable(a.STENCIL_TEST),a.enable(a.DEPTH_TEST),t.depthMask(!0);var s=new i(a,t,n);s.bindFramebuffer(),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);for(var l=0;l<o.length;l++)r(t,e,n,o[l]);s.unbindFramebuffer(),s.renderToMap()}},i.prototype.bindFramebuffer=function(){var t=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),t.activeTexture(t.TEXTURE1),this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);else{this.fbo=t.createFramebuffer();var e=t.createRenderbuffer(),n=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,this.width,this.height),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},i.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},i.prototype.renderToMap=function(){var t=this.gl,e=this.painter,n=e.useProgram("extrusionTexture");t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1f(n.u_opacity,this.layer.paint["fill-extrusion-opacity"]),t.uniform1i(n.u_texture,1),t.uniformMatrix4fv(n.u_matrix,!1,h.ortho(h.create(),0,e.width,e.height,0,0,1)),t.disable(t.DEPTH_TEST),t.uniform1i(n.u_xdim,e.width),t.uniform1i(n.u_ydim,e.height);var i=new l;i.emplaceBack(0,0),i.emplaceBack(e.width,0),i.emplaceBack(0,e.height),i.emplaceBack(e.width,e.height);var r=a.fromStructArray(i,a.BufferType.VERTEX);(new s).bind(t,n,r),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.enable(t.DEPTH_TEST)}},{"../data/buffer":51,"../data/pos_array":57,"./pattern":78,"./vertex_array_object":80,"@mapbox/gl-matrix":1}],72:[function(t,e,n){"use strict";function i(t,e,n,i,a,s,l,u,c){var h,d,f,p,m=e.gl,v=a.paint["line-dasharray"],g=a.paint["line-pattern"];if(u||c){var y=1/o(n,1,e.transform.tileZoom);if(v){h=e.lineAtlas.getDash(v.from,"round"===a.layout["line-cap"]),d=e.lineAtlas.getDash(v.to,"round"===a.layout["line-cap"]);var _=h.width*v.fromScale,b=d.width*v.toScale;m.uniform2f(t.u_patternscale_a,y/_,-h.height/2),m.uniform2f(t.u_patternscale_b,y/b,-d.height/2),m.uniform1f(t.u_sdfgamma,e.lineAtlas.width/(256*Math.min(_,b)*r.devicePixelRatio)/2)}else if(g){if(f=e.spriteAtlas.getPosition(g.from,!0),p=e.spriteAtlas.getPosition(g.to,!0),!f||!p)return;m.uniform2f(t.u_pattern_size_a,f.size[0]*g.fromScale/y,p.size[1]),m.uniform2f(t.u_pattern_size_b,p.size[0]*g.toScale/y,p.size[1])}m.uniform2f(t.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}u&&(v?(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.lineAtlas.bind(m),m.uniform1f(t.u_tex_y_a,h.y),m.uniform1f(t.u_tex_y_b,d.y),m.uniform1f(t.u_mix,v.t)):g&&(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.spriteAtlas.bind(m,!0),m.uniform2fv(t.u_pattern_tl_a,f.tl),m.uniform2fv(t.u_pattern_br_a,f.br),m.uniform2fv(t.u_pattern_tl_b,p.tl),m.uniform2fv(t.u_pattern_br_b,p.br),m.uniform1f(t.u_fade,g.t)),m.uniform1f(t.u_width,a.paint["line-width"])),e.enableTileClippingMask(s);var x=e.translatePosMatrix(s.posMatrix,n,a.paint["line-translate"],a.paint["line-translate-anchor"]);m.uniformMatrix4fv(t.u_matrix,!1,x),m.uniform1f(t.u_ratio,1/o(n,1,e.transform.zoom));for(var w=0,S=i.segments;w<S.length;w+=1){var M=S[w];M.vaos[a.id].bind(m,t,i.layoutVertexBuffer,i.elementBuffer,l.paintVertexBuffer,M.vertexOffset),m.drawElements(m.TRIANGLES,3*M.primitiveLength,m.UNSIGNED_SHORT,3*M.primitiveOffset*2)}}var r=t("../util/browser"),o=t("../source/pixels_to_tile_units");e.exports=function(t,e,n,r){if(!t.isOpaquePass){t.setDepthSublayer(0),t.depthMask(!1);var o=t.gl;if(o.enable(o.STENCIL_TEST),!(n.paint["line-width"]<=0))for(var a,s=n.paint["line-dasharray"]?"lineSDF":n.paint["line-pattern"]?"linePattern":"line",l=!0,u=0,c=r;u<c.length;u+=1){var h=c[u],d=e.getTile(h),f=d.getBucket(n);if(f){var p=f.buffers.layerData[n.id],m=t.currentProgram,v=t.useProgram(s,p.programConfiguration),g=l||v!==m,y=a!==d.coord.z;g&&p.programConfiguration.setUniforms(t.gl,v,n,{zoom:t.transform.zoom}),i(v,t,d,f.buffers,n,h,p,g,y),a=d.coord.z,l=!1}}}}},{"../source/pixels_to_tile_units":87,"../util/browser":192}],73:[function(t,e,n){"use strict";function i(t,e,n,i){var o=t.gl;o.disable(o.STENCIL_TEST);var a=e.getTile(i),s=t.transform.calculatePosMatrix(i,e.getSource().maxzoom);a.registerFadeDuration(t.style.animationLoop,n.paint["raster-fade-duration"]);var l=t.useProgram("raster");o.uniformMatrix4fv(l.u_matrix,!1,s),o.uniform1f(l.u_brightness_low,n.paint["raster-brightness-min"]),o.uniform1f(l.u_brightness_high,n.paint["raster-brightness-max"]),o.uniform1f(l.u_saturation_factor,function(t){return t>0?1-1/(1.001-t):-t}(n.paint["raster-saturation"])),o.uniform1f(l.u_contrast_factor,function(t){return t>0?1/(1-t):1+t}(n.paint["raster-contrast"])),o.uniform3fv(l.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}(n.paint["raster-hue-rotate"]));var u,c,h=a.sourceCache&&a.sourceCache.findLoadedParent(i,0,{}),d=function(t,e,n,i){var o=n.paint["raster-fade-duration"];if(t.sourceCache&&o>0){var a=Date.now(),s=(a-t.timeAdded)/o,l=e?(a-e.timeAdded)/o:-1,u=t.sourceCache.getSource(),c=i.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),h=!e||Math.abs(e.coord.z-c)>Math.abs(t.coord.z-c),d=h&&t.refreshedUponExpiration?1:r.clamp(h?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}(a,h,n,t.transform);o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a.texture),o.activeTexture(o.TEXTURE1),h?(o.bindTexture(o.TEXTURE_2D,h.texture),u=Math.pow(2,h.coord.z-a.coord.z),c=[a.coord.x*u%1,a.coord.y*u%1]):o.bindTexture(o.TEXTURE_2D,a.texture),o.uniform2fv(l.u_tl_parent,c||[0,0]),o.uniform1f(l.u_scale_parent,u||1),o.uniform1f(l.u_buffer_scale,1),o.uniform1f(l.u_fade_t,d.mix),o.uniform1f(l.u_opacity,d.opacity*n.paint["raster-opacity"]),o.uniform1i(l.u_image0,0),o.uniform1i(l.u_image1,1);var f=a.boundsBuffer||t.rasterBoundsBuffer;(a.boundsVAO||t.rasterBoundsVAO).bind(o,l,f),o.drawArrays(o.TRIANGLE_STRIP,0,f.length)}var r=t("../util/util");e.exports=function(t,e,n,r){if(!t.isOpaquePass){var o=t.gl;o.enable(o.DEPTH_TEST),t.depthMask(!0),o.depthFunc(o.LESS);for(var a=r.length&&r[0].z,s=0;s<r.length;s++){var l=r[s];t.setDepthSublayer(l.z-a),i(t,e,n,l)}o.depthFunc(o.LEQUAL)}}},{"../util/util":212}],74:[function(t,e,n){"use strict";function i(t,e,n,i,a,s,l,u,c,h){if(a||!t.style.sprite||t.style.sprite.loaded()){var d=t.gl,f="map"===u,p="map"===c,m=p;m?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST);for(var v,g,y=0,_=i;y<_.length;y+=1){var b=_[y],x=e.getTile(b),w=x.getBucket(n);if(w){var S=a?w.buffers.glyph:w.buffers.icon;if(S&&S.segments.length){var M=S.layerData[n.id].programConfiguration,E=a||w.sdfIcons;v&&w.fontstack===g||(v=t.useProgram(E?"symbolSDF":"symbolIcon",M),M.setUniforms(d,v,n,{zoom:t.transform.zoom}),r(v,t,a,E,f,p,w.fontstack,h,w.iconsNeedLinear,a?w.adjustedTextSize:w.adjustedIconSize)),t.enableTileClippingMask(b),d.uniformMatrix4fv(v.u_matrix,!1,t.translatePosMatrix(b.posMatrix,x,s,l)),o(v,t,n,x,S,a,E,p,h),g=w.fontstack}}}m||d.enable(d.DEPTH_TEST)}}function r(t,e,n,i,r,o,a,l,u,c){var h=e.gl,d=e.transform;if(h.uniform1i(t.u_rotate_with_map,r),h.uniform1i(t.u_pitch_with_map,o),h.activeTexture(h.TEXTURE0),h.uniform1i(t.u_texture,0),n){var f=a&&e.glyphSource.getGlyphAtlas(a);if(!f)return;f.updateTexture(h),h.uniform2f(t.u_texsize,f.width/4,f.height/4)}else{var p=e.options.rotating||e.options.zooming,m=1!==l||s.devicePixelRatio!==e.spriteAtlas.pixelRatio||u,v=o||d.pitch;e.spriteAtlas.bind(h,i||p||m||v),h.uniform2f(t.u_texsize,e.spriteAtlas.width/4,e.spriteAtlas.height/4)}h.activeTexture(h.TEXTURE1),e.frameHistory.bind(h),h.uniform1i(t.u_fadetexture,1);var g=Math.log(l/c)/Math.LN2||0;h.uniform1f(t.u_zoom,10*(d.zoom-g)),h.uniform1f(t.u_pitch,d.pitch/360*2*Math.PI),h.uniform1f(t.u_bearing,d.bearing/360*2*Math.PI),h.uniform1f(t.u_aspect_ratio,d.width/d.height)}function o(t,e,n,i,r,o,s,l,c){var h=e.gl,d=e.transform,f=c/(o?24:1);if(l){var p=u(i,f,d.zoom);h.uniform2f(t.u_extrude_scale,p,p)}else{var m=d.cameraToCenterDistance*f;h.uniform2f(t.u_extrude_scale,d.pixelsToGLUnits[0]*m,d.pixelsToGLUnits[1]*m)}if(s){var v=(o?"text":"icon")+"-halo-width",g=!n.isPaintValueFeatureConstant(v)||n.paint[v],y=f*(l?Math.cos(d._pitch):1)*d.cameraToCenterDistance;h.uniform1f(t.u_font_scale,f),h.uniform1f(t.u_gamma_scale,y),g&&(h.uniform1f(t.u_is_halo,1),a(r,n,h,t)),h.uniform1f(t.u_is_halo,0)}a(r,n,h,t)}function a(t,e,n,i){for(var r=t.layerData[e.id],o=r&&r.paintVertexBuffer,a=0,s=t.segments;a<s.length;a+=1){var l=s[a];l.vaos[e.id].bind(n,i,t.layoutVertexBuffer,t.elementBuffer,o,l.vertexOffset),n.drawElements(n.TRIANGLES,3*l.primitiveLength,n.UNSIGNED_SHORT,3*l.primitiveOffset*2)}}var s=t("../util/browser"),l=t("./draw_collision_debug"),u=t("../source/pixels_to_tile_units");e.exports=function(t,e,n,r){if(!t.isOpaquePass){var o=!(n.layout["text-allow-overlap"]||n.layout["icon-allow-overlap"]||n.layout["text-ignore-placement"]||n.layout["icon-ignore-placement"]),a=t.gl;o?a.disable(a.STENCIL_TEST):a.enable(a.STENCIL_TEST),t.setDepthSublayer(0),t.depthMask(!1),i(t,e,n,r,!1,n.paint["icon-translate"],n.paint["icon-translate-anchor"],n.layout["icon-rotation-alignment"],n.layout["icon-rotation-alignment"],n.layout["icon-size"]),i(t,e,n,r,!0,n.paint["text-translate"],n.paint["text-translate-anchor"],n.layout["text-rotation-alignment"],n.layout["text-pitch-alignment"],n.layout["text-size"]),e.map.showCollisionBoxes&&l(t,e,n,r)}}},{"../source/pixels_to_tile_units":87,"../util/browser":192,"./draw_collision_debug":68}],75:[function(t,e,n){"use strict";var i=function(){this.changeTimes=new Float64Array(256),this.changeOpacities=new Uint8Array(256),this.opacities=new Uint8ClampedArray(256),this.array=new Uint8Array(this.opacities.buffer),this.previousZoom=0,this.firstFrame=!0};i.prototype.record=function(t,e,n){var i,r=this;if(this.firstFrame&&(t=0,this.firstFrame=!1),(e=Math.floor(10*e))<this.previousZoom)for(i=e+1;i<=this.previousZoom;i++)r.changeTimes[i]=t,r.changeOpacities[i]=r.opacities[i];else for(i=e;i>this.previousZoom;i--)r.changeTimes[i]=t,r.changeOpacities[i]=r.opacities[i];for(i=0;i<256;i++){var o=t-r.changeTimes[i],a=255*(n?o/n:1);r.opacities[i]=i<=e?r.changeOpacities[i]+a:r.changeOpacities[i]-a}this.changed=!0,this.previousZoom=e},i.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.changed&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,256,1,t.ALPHA,t.UNSIGNED_BYTE,this.array),this.changed=!1)):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,256,1,0,t.ALPHA,t.UNSIGNED_BYTE,this.array))},e.exports=i},{}],76:[function(t,e,n){"use strict";var i=t("../util/util"),r=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};r.prototype.setSprite=function(t){this.sprite=t},r.prototype.getDash=function(t,e){var n=t.join(",")+e;return this.positions[n]||(this.positions[n]=this.addDash(t,e)),this.positions[n]},r.prototype.addDash=function(t,e){var n=this,r=e?7:0,o=2*r+1;if(this.nextRow+o>this.height)return i.warnOnce("LineAtlas out of space"),null;for(var a=0,s=0;s<t.length;s++)a+=t[s];for(var l=this.width/a,u=l/2,c=t.length%2==1,h=-r;h<=r;h++)for(var d=n.nextRow+r+h,f=n.width*d,p=c?-t[t.length-1]:0,m=t[0],v=1,g=0;g<this.width;g++){for(;m<g/l;)p=m,m+=t[v],c&&v===t.length-1&&(m+=t[0]),v++;var y=Math.abs(g-p*l),_=Math.abs(g-m*l),b=Math.min(y,_),x=v%2==1,w=void 0;if(e){var S=r?h/r*(u+1):0;if(x){var M=u-Math.abs(S);w=Math.sqrt(b*b+M*M)}else w=u-Math.sqrt(b*b+S*S)}else w=(x?1:-1)*b;n.data[3+4*(f+g)]=Math.max(0,Math.min(255,w+128))}var E={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:a};return this.nextRow+=o,this.dirty=!0,E},r.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},e.exports=r},{"../util/util":212}],77:[function(t,e,n){"use strict";var i=t("../util/browser"),r=t("@mapbox/gl-matrix").mat4,o=t("./frame_history"),a=t("../source/source_cache"),s=t("../data/extent"),l=t("../source/pixels_to_tile_units"),u=t("../util/util"),c=t("../data/buffer"),h=t("./vertex_array_object"),d=t("../data/raster_bounds_array"),f=t("../data/pos_array"),p=t("../data/program_configuration"),m=t("./shaders"),v={symbol:t("./draw_symbol"),circle:t("./draw_circle"),line:t("./draw_line"),fill:t("./draw_fill"),"fill-extrusion":t("./draw_fill_extrusion"),raster:t("./draw_raster"),background:t("./draw_background"),debug:t("./draw_debug")},g=function(t,e){this.gl=t,this.transform=e,this.reusableTextures={tiles:{},viewport:null},this.preFbos={},this.frameHistory=new o,this.setup(),this.numSublayers=a.maxUnderzooming+a.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=p.createStatic(["color","opacity"]),this.emptyProgramConfiguration=new p};g.prototype.resize=function(t,e){var n=this.gl;this.width=t*i.devicePixelRatio,this.height=e*i.devicePixelRatio,n.viewport(0,0,this.width,this.height)},g.prototype.setup=function(){var t=this.gl;t.verbose=!0,t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.STENCIL_TEST),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),this._depthMask=!1,t.depthMask(!1);var e=new f;e.emplaceBack(0,0),e.emplaceBack(s,0),e.emplaceBack(0,s),e.emplaceBack(s,s),this.tileExtentBuffer=c.fromStructArray(e,c.BufferType.VERTEX),this.tileExtentVAO=new h,this.tileExtentPatternVAO=new h;var n=new f;n.emplaceBack(0,0),n.emplaceBack(s,0),n.emplaceBack(s,s),n.emplaceBack(0,s),n.emplaceBack(0,0),this.debugBuffer=c.fromStructArray(n,c.BufferType.VERTEX),this.debugVAO=new h;var i=new d;i.emplaceBack(0,0,0,0),i.emplaceBack(s,0,32767,0),i.emplaceBack(0,s,0,32767),i.emplaceBack(s,s,32767,32767),this.rasterBoundsBuffer=c.fromStructArray(i,c.BufferType.VERTEX),this.rasterBoundsVAO=new h},g.prototype.clearColor=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},g.prototype.clearStencil=function(){var t=this.gl;t.clearStencil(0),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT)},g.prototype.clearDepth=function(){var t=this.gl;t.clearDepth(1),this.depthMask(!0),t.clear(t.DEPTH_BUFFER_BIT)},g.prototype._renderTileClippingMasks=function(t){var e=this,n=this.gl;n.colorMask(!1,!1,!1,!1),this.depthMask(!1),n.disable(n.DEPTH_TEST),n.enable(n.STENCIL_TEST),n.stencilMask(248),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE);var i=1;this._tileClippingMaskIDs={};for(var r=0,o=t;r<o.length;r+=1){var a=o[r],s=e._tileClippingMaskIDs[a.id]=i++<<3;n.stencilFunc(n.ALWAYS,s,248);var l=e.useProgram("fill",e.basicFillProgramConfiguration);n.uniformMatrix4fv(l.u_matrix,!1,a.posMatrix),e.tileExtentVAO.bind(n,l,e.tileExtentBuffer),n.drawArrays(n.TRIANGLE_STRIP,0,e.tileExtentBuffer.length)}n.stencilMask(0),n.colorMask(!0,!0,!0,!0),this.depthMask(!0),n.enable(n.DEPTH_TEST)},g.prototype.enableTileClippingMask=function(t){var e=this.gl;e.stencilFunc(e.EQUAL,this._tileClippingMaskIDs[t.id],248)},g.prototype.prepareBuffers=function(){},g.prototype.bindDefaultFramebuffer=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},g.prototype.render=function(t,e){if(this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.spriteAtlas=t.spriteAtlas,this.spriteAtlas.setSprite(t.sprite),this.glyphSource=t.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,t.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(e.showOverdrawInspector),this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var n=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];n&&v.debug(this,n,n.getVisibleCoordinates())}},g.prototype.renderPass=function(){var t,e,n=this,i=this.style._order;this.currentLayer=this.isOpaquePass?i.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var r=0;r<i.length;r++){var o=n.style._layers[i[n.currentLayer]];o.source!==(t&&t.id)&&(e=[],(t=n.style.sourceCaches[o.source])&&(t.prepare&&t.prepare(),n.clearStencil(),e=t.getVisibleCoordinates(),t.getSource().isTileClipped&&n._renderTileClippingMasks(e)),n.isOpaquePass||e.reverse()),n.renderLayer(n,t,o,e),n.currentLayer+=n.isOpaquePass?-1:1}},g.prototype.depthMask=function(t){t!==this._depthMask&&(this._depthMask=t,this.gl.depthMask(t))},g.prototype.renderLayer=function(t,e,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||i.length)&&(this.id=n.id,v[n.type](t,e,n,i))},g.prototype.setDepthSublayer=function(t){var e=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,n=e-1+this.depthRange;this.gl.depthRange(n,e)},g.prototype.translatePosMatrix=function(t,e,n,i){if(!n[0]&&!n[1])return t;if("viewport"===i){var o=Math.sin(-this.transform.angle),a=Math.cos(-this.transform.angle);n=[n[0]*a-n[1]*o,n[0]*o+n[1]*a]}var s=[l(e,n[0],this.transform.zoom),l(e,n[1],this.transform.zoom),0],u=new Float32Array(16);return r.translate(u,t,s),u},g.prototype.saveTileTexture=function(t){var e=this.reusableTextures.tiles[t.size];e?e.push(t):this.reusableTextures.tiles[t.size]=[t]},g.prototype.saveViewportTexture=function(t){this.reusableTextures.viewport=t},g.prototype.getTileTexture=function(t){var e=this.reusableTextures.tiles[t];return e&&e.length>0?e.pop():null},g.prototype.getViewportTexture=function(t,e){var n=this.reusableTextures.viewport;if(n)return n.width===t&&n.height===e?n:(this.gl.deleteTexture(n),void(this.reusableTextures.viewport=null))},g.prototype.lineWidth=function(t){this.gl.lineWidth(u.clamp(t,this.lineWidthRange[0],this.lineWidthRange[1]))},g.prototype.showOverdrawInspector=function(t){if(t||this._showOverdrawInspector){this._showOverdrawInspector=t;var e=this.gl;if(t){e.blendFunc(e.CONSTANT_COLOR,e.ONE);e.blendColor(1/8,1/8,1/8,0),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}else e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}},g.prototype.createProgram=function(t,e){var n=this.gl,r=n.createProgram(),o=m[t],a="#define MAPBOX_GL_JS\n#define DEVICE_PIXEL_RATIO "+i.devicePixelRatio.toFixed(1)+"\n";this._showOverdrawInspector&&(a+="#define OVERDRAW_INSPECTOR;\n");var s=e.applyPragmas(a+m.prelude.fragmentSource+o.fragmentSource,"fragment"),l=e.applyPragmas(a+m.prelude.vertexSource+o.vertexSource,"vertex"),u=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(u,s),n.compileShader(u),n.attachShader(r,u);var c=n.createShader(n.VERTEX_SHADER);n.shaderSource(c,l),n.compileShader(c),n.attachShader(r,c),n.linkProgram(r);for(var h=n.getProgramParameter(r,n.ACTIVE_ATTRIBUTES),d={program:r,numAttributes:h},f=0;f<h;f++){var p=n.getActiveAttrib(r,f);d[p.name]=n.getAttribLocation(r,p.name)}for(var v=n.getProgramParameter(r,n.ACTIVE_UNIFORMS),g=0;g<v;g++){var y=n.getActiveUniform(r,g);d[y.name]=n.getUniformLocation(r,y.name)}return d},g.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var n=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=this.createProgram(t,e)),this.cache[n]},g.prototype.useProgram=function(t,e){var n=this.gl,i=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.currentProgram!==i&&(n.useProgram(i.program),this.currentProgram=i),i},e.exports=g},{"../data/buffer":51,"../data/extent":54,"../data/pos_array":57,"../data/program_configuration":58,"../data/raster_bounds_array":59,"../source/pixels_to_tile_units":87,"../source/source_cache":92,"../util/browser":192,"../util/util":212,"./draw_background":66,"./draw_circle":67,"./draw_debug":69,"./draw_fill":70,"./draw_fill_extrusion":71,"./draw_line":72,"./draw_raster":73,"./draw_symbol":74,"./frame_history":75,"./shaders":79,"./vertex_array_object":80,"@mapbox/gl-matrix":1}],78:[function(t,e,n){"use strict";var i=t("../source/pixels_to_tile_units");n.prepare=function(t,e,n){var i=e.gl,r=e.spriteAtlas.getPosition(t.from,!0),o=e.spriteAtlas.getPosition(t.to,!0);r&&o&&(i.uniform1i(n.u_image,0),i.uniform2fv(n.u_pattern_tl_a,r.tl),i.uniform2fv(n.u_pattern_br_a,r.br),i.uniform2fv(n.u_pattern_tl_b,o.tl),i.uniform2fv(n.u_pattern_br_b,o.br),i.uniform1f(n.u_mix,t.t),i.uniform2fv(n.u_pattern_size_a,r.size),i.uniform2fv(n.u_pattern_size_b,o.size),i.uniform1f(n.u_scale_a,t.fromScale),i.uniform1f(n.u_scale_b,t.toScale),i.activeTexture(i.TEXTURE0),e.spriteAtlas.bind(i,!0))},n.setTile=function(t,e,n){var r=e.gl;r.uniform1f(n.u_tile_units_to_pixels,1/i(t,1,e.transform.tileZoom));var o=Math.pow(2,t.coord.z),a=t.tileSize*Math.pow(2,e.transform.tileZoom)/o,s=a*(t.coord.x+t.coord.w*o),l=a*t.coord.y;r.uniform2f(n.u_pixel_coord_upper,s>>16,l>>16),r.uniform2f(n.u_pixel_coord_lower,65535&s,65535&l)}},{"../source/pixels_to_tile_units":87}],79:[function(t,e,n){"use strict";t("path");e.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n\n// To minimize the number of attributes needed in the mapbox-gl-native shaders,\n// we encode a 4-component color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    float r = floor(encodedColor[0]/256.0)/255.0;\n    float g = (encodedColor[0] - r*256.0*255.0)/255.0;\n    float b = floor(encodedColor[1]/256.0)/255.0;\n    float a = (encodedColor[1] - b*256.0*255.0)/255.0;\n    return vec4(r, g, b, a);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\nuniform float u_maxzoom;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    if (v_placement_zoom > u_zoom) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    if (u_zoom >= v_max_zoom) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n}\n"},debug:{fragmentSource:"uniform lowp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos.x = a_pos.x / float(u_xdim);\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},line:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\n\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n#pragma mapbox: define lowp float opacity\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma mapbox: define lowp vec4 fill_color\n#pragma mapbox: define lowp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_font_scale;\nuniform highp float u_gamma_scale;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 fill_color\n    #pragma mapbox: initialize lowp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / u_gamma_scale;\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / u_gamma_scale;\n        buff = (6.0 - halo_width / u_font_scale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    highp float gamma_scaled = gamma * v_gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist) * fade_alpha;\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n#pragma mapbox: define lowp vec4 fill_color\n#pragma mapbox: define lowp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 fill_color\n    #pragma mapbox: initialize lowp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"}}},{path:23}],80:[function(t,e,n){"use strict";var i=function(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.boundVertexOffset=null,this.vao=null};i.prototype.bind=function(t,e,n,i,r,o){void 0===t.extVertexArrayObject&&(t.extVertexArrayObject=t.getExtension("OES_vertex_array_object"));var a=!this.vao||this.boundProgram!==e||this.boundVertexBuffer!==n||this.boundVertexBuffer2!==r||this.boundElementBuffer!==i||this.boundVertexOffset!==o;!t.extVertexArrayObject||a?(this.freshBind(t,e,n,i,r,o),this.gl=t):t.extVertexArrayObject.bindVertexArrayOES(this.vao)},i.prototype.freshBind=function(t,e,n,i,r,o){var a,s=e.numAttributes;if(t.extVertexArrayObject)this.vao&&this.destroy(),this.vao=t.extVertexArrayObject.createVertexArrayOES(),t.extVertexArrayObject.bindVertexArrayOES(this.vao),a=0,this.boundProgram=e,this.boundVertexBuffer=n,this.boundVertexBuffer2=r,this.boundElementBuffer=i,this.boundVertexOffset=o;else{a=t.currentNumAttributes||0;for(var l=s;l<a;l++)t.disableVertexAttribArray(l)}for(var u=a;u<s;u++)t.enableVertexAttribArray(u);n.bind(t),n.setVertexAttribPointers(t,e,o),r&&(r.bind(t),r.setVertexAttribPointers(t,e,o)),i&&i.bind(t),t.currentNumAttributes=s},i.prototype.destroy=function(){this.vao&&(this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},e.exports=i},{}],81:[function(t,e,n){"use strict";var i=t("./image_source"),r=t("../util/window"),o=function(t){function e(e,n,i,r){t.call(this,e,n,i,r),this.options=n,this.animate=!n.hasOwnProperty("animate")||n.animate}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){if(this.canvas=this.canvas||r.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions())return this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero."));var t;this.play=function(){t=this.map.style.animationLoop.set(1/0),this.map._rerender()},this.pause=function(){this.map.style.animationLoop.cancel(t)},this._finishLoading()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.canvas&&this.animate&&this.play())},e.prototype.prepare=function(){var t=!1;this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||this.tile&&this._prepareImage(this.map.painter.gl,this.canvas,t)},e.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},e.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},e}(i);e.exports=o},{"../util/window":194,"./image_source":85}],82:[function(t,e,n){"use strict";var i=t("../util/evented"),r=t("../util/util"),o=t("../util/window"),a=t("../data/extent"),s=function(t){function e(e,n,i,o){t.call(this),n=n||{},this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=i,this.setEventedParent(o),this._data=n.data,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type);var s=a/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*s,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*s,extent:a,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(n.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:a,radius:(n.clusterRadius||50)*s,log:!1}},n.workerOptions)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(e){return e?void t.fire("error",{error:e}):void t.fire("data",{dataType:"source",sourceDataType:"metadata"})})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){return t?e.fire("error",{error:t}):void e.fire("data",{dataType:"source",sourceDataType:"content"})}),this},e.prototype._updateWorkerData=function(t){var e=this,n=r.extend({},this.workerOptions),i=this._data;"string"==typeof i?n.url=function(t){var e=o.document.createElement("a");return e.href=t,e.href}(i):n.data=JSON.stringify(i),this.workerID=this.dispatcher.send(this.type+".loadData",n,function(n){e._loaded=!0,t(n)})},e.prototype.loadTile=function(t,e){var n=this,i=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={type:this.type,uid:t.uid,coord:t.coord,zoom:t.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:i,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send("loadTile",r,function(i,r){if(t.unloadVectorData(),!t.aborted)return i?e(i):(t.loadVectorData(r,n.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(n)),e(null))},this.workerID)},e.prototype.abortTile=function(t){t.aborted=!0},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},function(){},t.workerID)},e.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})},e.prototype.serialize=function(){return{type:this.type,data:this._data}},e}(i);e.exports=s},{"../data/extent":54,"../util/evented":200,"../util/util":212,"../util/window":194}],83:[function(t,e,n){"use strict";var i=t("../util/ajax"),r=t("geojson-rewind"),o=t("./geojson_wrapper"),a=t("vt-pbf"),s=t("supercluster"),l=t("geojson-vt"),u=function(t){function e(e,n,i){t.call(this,e,n),i&&(this.loadGeoJSON=i),this._geoJSONIndexes={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.loadVectorData=function(t,e){var n=t.source,i=t.coord;if(!this._geoJSONIndexes[n])return e(null,null);var r=this._geoJSONIndexes[n].getTile(Math.min(i.z,t.maxZoom),i.x,i.y);if(!r)return e(null,null);var s=new o(r.features);s.name="_geojsonTileLayer";var l=a({layers:{_geojsonTileLayer:s}});0===l.byteOffset&&l.byteLength===l.buffer.byteLength||(l=new Uint8Array(l)),s.rawData=l.buffer,e(null,s)},e.prototype.loadData=function(t,e){var n=function(n,i){var o=this;return n?e(n):"object"!=typeof i?e(new Error("Input data is not a valid GeoJSON object.")):(r(i,!0),void this._indexData(i,t,function(n,i){return n?e(n):(o._geoJSONIndexes[t.source]=i,void e(null))}))}.bind(this);this.loadGeoJSON(t,n)},e.prototype.loadGeoJSON=function(t,e){if(t.url)i.getJSON(t.url,e);else{if("string"!=typeof t.data)return e(new Error("Input data is not a valid GeoJSON object."));try{return e(null,JSON.parse(t.data))}catch(t){return e(new Error("Input data is not a valid GeoJSON object."))}}},e.prototype.removeSource=function(t){this._geoJSONIndexes[t.source]&&delete this._geoJSONIndexes[t.source]},e.prototype._indexData=function(t,e,n){try{e.cluster?n(null,s(e.superclusterOptions).load(t.features)):n(null,l(t,e.geojsonVtOptions))}catch(t){return n(t)}},e}(t("./vector_tile_worker_source"));e.exports=u},{"../util/ajax":191,"./geojson_wrapper":84,"./vector_tile_worker_source":96,"geojson-rewind":7,"geojson-vt":11,supercluster:29,"vt-pbf":38}],84:[function(t,e,n){"use strict";var i=t("point-geometry"),r=t("vector-tile").VectorTileFeature,o=t("../data/extent"),a=function(t){if(this.type=t.type,1===t.type){this.rawGeometry=[];for(var e=0;e<t.geometry.length;e++)this.rawGeometry.push([t.geometry[e]])}else this.rawGeometry=t.geometry;this.properties=t.tags,"id"in t&&(this.id=t.id),this.extent=o};a.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var n=t[e],r=[],o=0;o<n.length;o++)r.push(new i(n[o][0],n[o][1]));this.geometry.push(r)}return this.geometry},a.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[e,i,n,r]},a.prototype.toGeoJSON=function(){r.prototype.toGeoJSON.call(this)};var s=function(t){this.features=t,this.length=t.length,this.extent=o};s.prototype.feature=function(t){return new a(this.features[t])},e.exports=s},{"../data/extent":54,"point-geometry":26,"vector-tile":34}],85:[function(t,e,n){"use strict";var i=t("../util/util"),r=t("../util/window"),o=t("./tile_coord"),a=t("../geo/lng_lat"),s=t("point-geometry"),l=t("../util/evented"),u=t("../util/ajax"),c=t("../data/extent"),h=t("../data/raster_bounds_array"),d=t("../data/buffer"),f=t("../render/vertex_array_object"),p=function(t){function e(e,n,i,r){t.call(this),this.id=e,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.setEventedParent(r),this.options=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,u.getImage(this.options.url,function(e,n){return e?t.fire("error",{error:e}):(t.image=n,void t._finishLoading())})},e.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire("data",{dataType:"source",sourceDataType:"metadata"}))},e.prototype.onAdd=function(t){this.load(),this.map=t,this.image&&this.setCoordinates(this.coordinates)},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,n=t.map(function(t){return e.transform.locationCoordinate(a.convert(t)).zoomTo(0)}),r=this.centerCoord=i.getCoordinatesCenter(n);return r.column=Math.round(r.column),r.row=Math.round(r.row),this.minzoom=this.maxzoom=r.zoom,this.coord=new o(r.zoom,r.column,r.row),this._tileCoords=n.map(function(t){var e=t.zoomTo(r.zoom);return new s(Math.round((e.column-r.column)*c),Math.round((e.row-r.row)*c))}),this.fire("data",{dataType:"source",sourceDataType:"content"}),this},e.prototype._setTile=function(t){this.tile=t;var e=32767,n=new h;n.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0),n.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,e,0),n.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,e),n.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,e,e),this.tile.buckets={},this.tile.boundsBuffer=d.fromStructArray(n,d.BufferType.VERTEX),this.tile.boundsVAO=new f},e.prototype.prepare=function(){this.tile&&this.image&&this._prepareImage(this.map.painter.gl,this.image)},e.prototype._prepareImage=function(t,e,n){"loaded"!==this.tile.state?(this.tile.state="loaded",this.tile.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)):n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):(e instanceof r.HTMLVideoElement||e instanceof r.ImageData||e instanceof r.HTMLCanvasElement)&&(t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e))},e.prototype.loadTile=function(t,e){this.coord&&this.coord.toString()===t.coord.toString()?(this._setTile(t),e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",urls:this.url,coordinates:this.coordinates}},e}(l);e.exports=p},{"../data/buffer":51,"../data/extent":54,"../data/raster_bounds_array":59,"../geo/lng_lat":62,"../render/vertex_array_object":80,"../util/ajax":191,"../util/evented":200,"../util/util":212,"../util/window":194,"./tile_coord":94,"point-geometry":26}],86:[function(t,e,n){"use strict";var i=t("../util/util"),r=t("../util/ajax"),o=t("../util/browser"),a=t("../util/mapbox").normalizeSourceURL;e.exports=function(t,e){var n=function(t,n){if(t)return e(t);var r=i.pick(n,["tiles","minzoom","maxzoom","attribution","mapbox_logo"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map(function(t){return t.id})),e(null,r)};t.url?r.getJSON(a(t.url),n):o.frame(n.bind(null,null,t))}},{"../util/ajax":191,"../util/browser":192,"../util/mapbox":208,"../util/util":212}],87:[function(t,e,n){"use strict";var i=t("../data/extent");e.exports=function(t,e,n){return e*(i/(t.tileSize*Math.pow(2,n-t.coord.z)))}},{"../data/extent":54}],88:[function(t,e,n){"use strict";function i(t,e){var n=t.coord,i=e.coord;return n.z-i.z||n.y-i.y||n.w-i.w||n.x-i.x}var r=t("./tile_coord");n.rendered=function(t,e,n,r,o,a){var s=t.tilesIn(n);s.sort(i);for(var l=[],u=0;u<s.length;u++){var c=s[u];c.tile.featureIndex&&l.push(c.tile.featureIndex.query({queryGeometry:c.queryGeometry,scale:c.scale,tileSize:c.tile.tileSize,bearing:a,params:r},e))}return function(t){for(var e=t[0]||{},n=1;n<t.length;n++){var i=t[n];for(var r in i){var o=i[r],a=e[r];if(void 0===a)a=e[r]=o;else for(var s=0;s<o.length;s++)a.push(o[s])}}return e}(l)},n.source=function(t,e){for(var n=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),i=[],o={},a=0;a<n.length;a++){var s=n[a],l=new r(Math.min(s.sourceMaxZoom,s.coord.z),s.coord.x,s.coord.y,0).id;o[l]||(o[l]=!0,s.querySourceFeatures(i,e))}return i}},{"./tile_coord":94}],89:[function(t,e,n){"use strict";var i=t("../util/util"),r=t("../util/ajax"),o=t("../util/evented"),a=t("./load_tilejson"),s=t("../util/mapbox").normalizeTileURL,l=function(t){function e(e,n,r,o){t.call(this),this.id=e,this.dispatcher=r,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.options=n,i.extend(this,i.pick(n,["url","scheme","tileSize"]))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),a(this.options,function(e,n){return e?t.fire("error",e):(i.extend(t,n),t.fire("data",{dataType:"source",sourceDataType:"metadata"}),void t.fire("data",{dataType:"source",sourceDataType:"content"}))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.serialize=function(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}},e.prototype.loadTile=function(t,e){var n=s(t.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);t.request=r.getImage(n,function(n,i){if(delete t.request,t.aborted)return this.state="unloaded",e(null);if(n)return this.state="errored",e(n);this.map._refreshExpiredTiles||t.setExpiryData(i),delete i.cacheControl,delete i.expires;var r=this.map.painter.gl;t.texture=this.map.painter.getTileTexture(i.width),t.texture?(r.bindTexture(r.TEXTURE_2D,t.texture),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,i)):(t.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,t.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),t.texture.size=i.width),r.generateMipmap(r.TEXTURE_2D),t.state="loaded",e(null)}.bind(this))},e.prototype.abortTile=function(t){t.request&&(t.request.abort(),delete t.request)},e.prototype.unloadTile=function(t){t.texture&&this.map.painter.saveTileTexture(t.texture)},e}(o);e.exports=l},{"../util/ajax":191,"../util/evented":200,"../util/mapbox":208,"../util/util":212,"./load_tilejson":86}],90:[function(t,e,n){"use strict";var i=t("../util/ajax"),r=t("../util/evented"),o=t("../util/window"),a=!1,s=null;e.exports.evented=new r,e.exports.registerForPluginAvailability=function(t){return s?t(s,e.exports.errorCallback):e.exports.evented.once("pluginAvailable",t),t},e.exports.setRTLTextPlugin=function(t,n){if(a)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=!0,e.exports.errorCallback=n,i.getArrayBuffer(t,function(t,i){t?n(t):(s=o.URL.createObjectURL(new o.Blob([i.data]),{type:"text/javascript"}),e.exports.evented.fire("pluginAvailable",{pluginBlobURL:s,errorCallback:n}))})}},{"../util/ajax":191,"../util/evented":200,"../util/window":194}],91:[function(t,e,n){"use strict";var i=t("../util/util"),r={vector:t("../source/vector_tile_source"),raster:t("../source/raster_tile_source"),geojson:t("../source/geojson_source"),video:t("../source/video_source"),image:t("../source/image_source"),canvas:t("../source/canvas_source")};n.create=function(t,e,n,o){if((e=new r[e.type](t,e,n,o)).id!==t)throw new Error("Expected Source id to be "+t+" instead of "+e.id);return i.bindAll(["load","abort","unload","serialize","prepare"],e),e},n.getType=function(t){return r[t]},n.setType=function(t,e){r[t]=e}},{"../source/canvas_source":81,"../source/geojson_source":82,"../source/image_source":85,"../source/raster_tile_source":89,"../source/vector_tile_source":95,"../source/video_source":97,"../util/util":212}],92:[function(t,e,n){"use strict";function i(t,e,n){var i=n.zoomTo(Math.min(t.z,e));return{x:(i.column-(t.x+t.w*Math.pow(2,t.z)))*d,y:(i.row-t.y)*d}}function r(t,e){return t%32-e%32}var o=t("./source"),a=t("./tile"),s=t("../util/evented"),l=t("./tile_coord"),u=t("../util/lru_cache"),c=t("../geo/coordinate"),h=t("../util/util"),d=t("../data/extent"),f=function(t){function e(e,n,i){t.call(this),this.id=e,this.dispatcher=i,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("error",function(){this._sourceErrored=!0}),this._source=o.create(e,n,i,this),this._tiles={},this._cache=new u(0,this.unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._isIdRenderable=this._isIdRenderable.bind(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){this.map=t,this._source&&this._source.onAdd&&this._source.onAdd(t)},e.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},e.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},e.prototype.getSource=function(){return this._source},e.prototype.loadTile=function(t,e){return this._source.loadTile(t,e)},e.prototype.unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t)},e.prototype.abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t)},e.prototype.serialize=function(){return this._source.serialize()},e.prototype.prepare=function(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()},e.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(r)},e.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},e.prototype._isIdRenderable=function(t){return this._tiles[t].hasData()&&!this._coveredTiles[t]},e.prototype.reload=function(){for(var t in this._cache.reset(),this._tiles)this.reloadTile(t,"reloading")},e.prototype.reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this.loadTile(n,this._tileLoaded.bind(this,n,t,e)))},e.prototype._tileLoaded=function(t,e,n,i){return i?(t.state="errored",void this._source.fire("error",{tile:t,error:i})):(t.sourceCache=this,t.timeAdded=(new Date).getTime(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),this._source.fire("data",{dataType:"source",tile:t,coord:t.coord}),void(this.map&&(this.map.painter.tileExtentVAO.vao=null)))},e.prototype.getTile=function(t){return this.getTileByID(t.id)},e.prototype.getTileByID=function(t){return this._tiles[t]},e.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},e.prototype.findLoadedChildren=function(t,e,n){var i=this,r=!1;for(var o in i._tiles){var a=i._tiles[o];if(!(n[o]||!a.hasData()||a.coord.z<=t.z||a.coord.z>e)){var s=Math.pow(2,Math.min(a.coord.z,i._source.maxzoom)-Math.min(t.z,i._source.maxzoom));if(Math.floor(a.coord.x/s)===t.x&&Math.floor(a.coord.y/s)===t.y)for(n[o]=!0,r=!0;a&&a.coord.z-1>t.z;){var l=a.coord.parent(i._source.maxzoom).id;(a=i._tiles[l])&&a.hasData()&&(delete n[o],n[l]=!0)}}}return r},e.prototype.findLoadedParent=function(t,e,n){for(var i=this,r=t.z-1;r>=e;r--){t=t.parent(i._source.maxzoom);var o=i._tiles[t.id];if(o&&o.hasData())return n[t.id]=!0,o;if(i._cache.has(t.id))return n[t.id]=!0,i._cache.getWithoutRemoving(t.id)}},e.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/t.tileSize)+1)*(Math.ceil(t.height/t.tileSize)+1);this._cache.setMaxSize(Math.floor(5*e))},e.prototype.update=function(t){var n=this;if(this.transform=t,this._sourceLoaded){var i,r,o,a;this.updateCacheSize(t);var s,u=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),c=Math.max(u-e.maxOverzooming,this._source.minzoom),d=Math.max(u+e.maxUnderzooming,this._source.minzoom),f={};for(this._coveredTiles={},s=this.used?this._source.coord?[this._source.coord]:t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}):[],i=0;i<s.length;i++)r=s[i],o=n.addTile(r),f[r.id]=!0,o.hasData()||n.findLoadedChildren(r,d,f)||(a=n.findLoadedParent(r,c,f))&&n.addTile(a.coord);var p,m={};if(function(t){return"raster"===t||"image"===t||"video"===t}(this._source.type))for(var v=Object.keys(f),g=0;g<v.length;g++){var y=v[g];r=l.fromID(y),(o=n._tiles[y])&&(void 0===o.fadeEndTime||o.fadeEndTime>=Date.now())&&(n.findLoadedChildren(r,d,f)&&(f[y]=!0),(a=n.findLoadedParent(r,c,m))&&n.addTile(a.coord))}for(p in m)f[p]||(n._coveredTiles[p]=!0);for(p in m)f[p]=!0;var _=h.keysDifference(this._tiles,f);for(i=0;i<_.length;i++)n.removeTile(+_[i])}},e.prototype.addTile=function(t){var e=this._tiles[t.id];if(e)return e;var n=t.wrapped();(e=this._tiles[n.id])||(e=this._cache.get(n.id))&&(e.redoPlacement(this._source),this._cacheTimers[n.id]&&(clearTimeout(this._cacheTimers[n.id]),this._cacheTimers[n.id]=void 0,this._setTileReloadTimer(n.id,e)));var i=Boolean(e);if(!i){var r=t.z,o=r>this._source.maxzoom?Math.pow(2,r-this._source.maxzoom):1;e=new a(n,this._source.tileSize*o,this._source.maxzoom),this.loadTile(e,this._tileLoaded.bind(this,e,t.id,e.state))}return e.uses++,this._tiles[t.id]=e,i||this._source.fire("dataloading",{tile:e,coord:e.coord,dataType:"source"}),e},e.prototype._setTileReloadTimer=function(t,e){var n=this,i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout(function(){n.reloadTile(t,"expired"),n._timers[t]=void 0},i))},e.prototype._setCacheInvalidationTimer=function(t,e){var n=this,i=e.getExpiryTimeout();i&&(this._cacheTimers[t]=setTimeout(function(){n._cache.remove(t),n._cacheTimers[t]=void 0},i))},e.prototype.removeTile=function(t){var e=this._tiles[t];if(e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),this._timers[t]=void 0),!(e.uses>0)))if(e.hasData()){var n=e.coord.wrapped().id;this._cache.add(n,e),this._setCacheInvalidationTimer(n,e)}else e.aborted=!0,this.abortTile(e),this.unloadTile(e)},e.prototype.clearTiles=function(){for(var t in this._tiles)this.removeTile(t);this._cache.reset()},e.prototype.tilesIn=function(t){for(var e={},n=this.getIds(),r=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0].zoom,h=0;h<t.length;h++){var f=t[h];r=Math.min(r,f.column),o=Math.min(o,f.row),a=Math.max(a,f.column),s=Math.max(s,f.row)}for(var p=0;p<n.length;p++){var m=this._tiles[n[p]],v=l.fromID(n[p]),g=[i(v,m.sourceMaxZoom,new c(r,o,u)),i(v,m.sourceMaxZoom,new c(a,s,u))];if(g[0].x<d&&g[0].y<d&&g[1].x>=0&&g[1].y>=0){for(var y=[],_=0;_<t.length;_++)y.push(i(v,m.sourceMaxZoom,t[_]));var b=e[m.coord.id];void 0===b&&(b=e[m.coord.id]={tile:m,coord:v,queryGeometry:[],scale:Math.pow(2,this.transform.zoom-m.coord.z)}),b.queryGeometry.push(y)}}var x=[];for(var w in e)x.push(e[w]);return x},e.prototype.redoPlacement=function(){for(var t=this.getIds(),e=0;e<t.length;e++){this.getTileByID(t[e]).redoPlacement(this._source)}},e.prototype.getVisibleCoordinates=function(){for(var t=this.getRenderableIds().map(l.fromID),e=0,n=t;e<n.length;e+=1){var i=n[e];i.posMatrix=this.transform.calculatePosMatrix(i,this._source.maxzoom)}return t},e}(s);f.maxOverzooming=10,f.maxUnderzooming=3,e.exports=f},{"../data/extent":54,"../geo/coordinate":61,"../util/evented":200,"../util/lru_cache":207,"../util/util":212,"./source":91,"./tile":93,"./tile_coord":94}],93:[function(t,e,n){"use strict";var i=t("../util/util"),r=t("../data/bucket"),o=t("../data/feature_index"),a=t("vector-tile"),s=t("pbf"),l=t("../util/vectortile_to_geojson"),u=t("../style-spec/feature_filter"),c=t("../symbol/collision_tile"),h=t("../symbol/collision_box"),d=function(t,e,n){this.coord=t,this.uid=i.uniqueId(),this.uses=0,this.tileSize=e,this.sourceMaxZoom=n,this.buckets={},this.expirationTime=null,this.expiredRequestCount=0,this.state="loading"};d.prototype.registerFadeDuration=function(t,e){var n=e+this.timeAdded;n<Date.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n,t.set(this.fadeEndTime-Date.now()))},d.prototype.loadVectorData=function(t,e){this.hasData()&&this.unloadVectorData(),this.state="loaded",t&&(t.rawTileData&&(this.rawTileData=t.rawTileData),this.collisionBoxArray=new h(t.collisionBoxArray),this.collisionTile=new c(t.collisionTile,this.collisionBoxArray),this.featureIndex=new o(t.featureIndex,this.rawTileData,this.collisionTile),this.buckets=r.deserialize(t.buckets,e.style))},d.prototype.reloadSymbolData=function(t,e){var n=this;if("unloaded"!==this.state){for(var o in this.collisionTile=new c(t.collisionTile,this.collisionBoxArray),this.featureIndex.setCollisionTile(this.collisionTile),n.buckets){var a=n.buckets[o];"symbol"===a.layers[0].type&&(a.destroy(),delete n.buckets[o])}i.extend(this.buckets,r.deserialize(t.buckets,e))}},d.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.collisionBoxArray=null,this.collisionTile=null,this.featureIndex=null,this.state="unloaded"},d.prototype.redoPlacement=function(t){var e=this;if("vector"===t.type||"geojson"===t.type)return"loaded"!==this.state?void(this.redoWhenDone=!0):void(this.collisionTile&&(this.state="reloading",t.dispatcher.send("redoPlacement",{type:t.type,uid:this.uid,source:t.id,angle:t.map.transform.angle,pitch:t.map.transform.pitch,showCollisionBoxes:t.map.showCollisionBoxes},function(n,i){e.reloadSymbolData(i,t.map.style),t.map&&(t.map.painter.tileExtentVAO.vao=null),e.state="loaded",e.redoWhenDone&&(e.redoWhenDone=!1,e.redoPlacement(t))},this.workerID)))},d.prototype.getBucket=function(t){return this.buckets[t.id]},d.prototype.querySourceFeatures=function(t,e){var n=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new a.VectorTile(new s(this.rawTileData)).layers);var i=this.vtLayers._geojsonTileLayer||this.vtLayers[e.sourceLayer];if(i)for(var r=u(e&&e.filter),o={z:this.coord.z,x:this.coord.x,y:this.coord.y},c=0;c<i.length;c++){var h=i.feature(c);if(r(h)){var d=new l(h,n.coord.z,n.coord.x,n.coord.y);d.tile=o,t.push(d)}}}},d.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},d.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=i.parseCacheControl(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),o=!1;if(this.expirationTime>r)o=!1;else if(e)if(this.expirationTime<e)o=!0;else{var a=this.expirationTime-e;a?this.expirationTime=r+Math.max(a,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},d.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},e.exports=d},{"../data/bucket":45,"../data/feature_index":55,"../style-spec/feature_filter":103,"../symbol/collision_box":160,"../symbol/collision_tile":162,"../util/util":212,"../util/vectortile_to_geojson":213,pbf:25,"vector-tile":34}],94:[function(t,e,n){"use strict";function i(t,e){if(t.row>e.row){var n=t;t=e,e=n}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function r(t,e,n,i,r){var o=Math.max(n,Math.floor(e.y0)),a=Math.min(i,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,c=t.dx>0,h=e.dx<0,d=o;d<a;d++){var f=l*Math.max(0,Math.min(t.dy,d+c-t.y0))+t.x0,p=u*Math.max(0,Math.min(e.dy,d+h-e.y0))+e.x0;r(Math.floor(p),Math.ceil(f),d)}}function o(t,e,n,o,a,s){var l,u=i(t,e),c=i(e,n),h=i(n,t);u.dy>c.dy&&(l=u,u=c,c=l),u.dy>h.dy&&(l=u,u=h,h=l),c.dy>h.dy&&(l=c,c=h,h=l),u.dy&&r(h,u,o,a,s),c.dy&&r(h,c,o,a,s)}var a=t("@mapbox/whoots-js"),s=t("../geo/coordinate"),l=function(t,e,n,i){isNaN(i)&&(i=0),this.z=+t,this.x=+e,this.y=+n,this.w=+i,(i*=2)<0&&(i=-1*i-1);var r=1<<this.z;this.id=32*(r*r*i+r*this.y+this.x)+this.z,this.posMatrix=null};l.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},l.prototype.toCoordinate=function(t){var e=Math.min(this.z,void 0===t?this.z:t),n=Math.pow(2,e),i=this.y,r=this.x+n*this.w;return new s(r,i,e)},l.prototype.url=function(t,e,n){var i=a.getTileBBox(this.x,this.y,this.z),r=function(t,e,n){for(var i,r="",o=t;o>0;o--)r+=(e&(i=1<<o-1)?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,e||this.z)).replace("{x}",this.x).replace("{y}","tms"===n?Math.pow(2,this.z)-this.y-1:this.y).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)},l.prototype.parent=function(t){return 0===this.z?null:this.z>t?new l(this.z-1,this.x,this.y,this.w):new l(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},l.prototype.wrapped=function(){return new l(this.z,this.x,this.y,0)},l.prototype.children=function(t){if(this.z>=t)return[new l(this.z+1,this.x,this.y,this.w)];var e=this.z+1,n=2*this.x,i=2*this.y;return[new l(e,n,i,this.w),new l(e,n+1,i,this.w),new l(e,n,i+1,this.w),new l(e,n+1,i+1,this.w)]},l.cover=function(t,e,n,i){function r(t,e,r){var o,u,c;if(r>=0&&r<=a)for(o=t;o<e;o++)0!==(u=Math.floor(o/a))&&!0!==i||(c=new l(n,(o%a+a)%a,r,u),s[c.id]=c)}void 0===i&&(i=!0);var a=1<<t,s={};return o(e[0],e[1],e[2],0,a,r),o(e[2],e[3],e[0],0,a,r),Object.keys(s).map(function(t){return s[t]})},l.fromID=function(t){var e=t%32,n=1<<e,i=(t-e)/32,r=i%n,o=(i-r)/n%n,a=Math.floor(i/(n*n));return a%2!=0&&(a=-1*a-1),new l(e,r,o,a/=2)},e.exports=l},{"../geo/coordinate":61,"@mapbox/whoots-js":4}],95:[function(t,e,n){"use strict";var i=t("../util/evented"),r=t("../util/util"),o=t("./load_tilejson"),a=t("../util/mapbox").normalizeTileURL,s=function(t){function e(e,n,i,o){if(t.call(this),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,r.extend(this,r.pick(n,["url","scheme","tileSize"])),this._options=r.extend({type:"vector"},n),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),o(this._options,function(e,n){return e?void t.fire("error",e):(r.extend(t,n),t.fire("data",{dataType:"source",sourceDataType:"metadata"}),void t.fire("data",{dataType:"source",sourceDataType:"content"}))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.serialize=function(){return r.extend({},this._options)},e.prototype.loadTile=function(t,e){function n(n,i){if(!t.aborted){if(n)return e(n);this.map._refreshExpiredTiles||t.setExpiryData(i),t.loadVectorData(i,this.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(this)),e(null),t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)}}var i=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={url:a(t.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:t.uid,coord:t.coord,zoom:t.coord.z,tileSize:this.tileSize*i,type:this.type,source:this.id,overscaling:i,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",r,n.bind(this),t.workerID):t.workerID=this.dispatcher.send("loadTile",r,n.bind(this))},e.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},e}(i);e.exports=s},{"../util/evented":200,"../util/mapbox":208,"../util/util":212,"./load_tilejson":86}],96:[function(t,e,n){"use strict";var i=t("../util/ajax"),r=t("vector-tile"),o=t("pbf"),a=t("./worker_tile"),s=t("../util/util"),l=function(t,e,n){this.actor=t,this.layerIndex=e,n&&(this.loadVectorData=n),this.loading={},this.loaded={}};l.prototype.loadTile=function(t,e){var n=t.source,i=t.uid;this.loading[n]||(this.loading[n]={});var r=this.loading[n][i]=new a(t);r.abort=this.loadVectorData(t,function(t,o){return delete this.loading[n][i],t?e(t):o?(r.vectorTile=o,r.parse(o,this.layerIndex,this.actor,function(t,n,i){if(t)return e(t);var r={};o.expires&&(r.expires=o.expires),o.cacheControl&&(r.cacheControl=o.cacheControl),e(null,s.extend({rawTileData:o.rawData},n,r),i)}),this.loaded[n]=this.loaded[n]||{},void(this.loaded[n][i]=r)):e(null,null)}.bind(this))},l.prototype.reloadTile=function(t,e){var n=this.loaded[t.source],i=t.uid,r=this;if(n&&n[i]){var o=n[i];"parsing"===o.status?o.reloadCallback=e:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,function(t,n){if(this.reloadCallback){var i=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,r.layerIndex,r.actor,i)}e(t,n)}.bind(o))}},l.prototype.abortTile=function(t){var e=this.loading[t.source],n=t.uid;e&&e[n]&&e[n].abort&&(e[n].abort(),delete e[n])},l.prototype.removeTile=function(t){var e=this.loaded[t.source],n=t.uid;e&&e[n]&&delete e[n]},l.prototype.loadVectorData=function(t,e){var n=i.getArrayBuffer(t.url,function(t,n){if(t)return e(t);var i=new r.VectorTile(new o(n.data));i.rawData=n.data,i.cacheControl=n.cacheControl,i.expires=n.expires,e(t,i)}.bind(this));return function(){n.abort()}},l.prototype.redoPlacement=function(t,e){var n=this.loaded[t.source],i=this.loading[t.source],r=t.uid;if(n&&n[r]){var o=n[r].redoPlacement(t.angle,t.pitch,t.showCollisionBoxes);o.result&&e(null,o.result,o.transferables)}else i&&i[r]&&(i[r].angle=t.angle)},e.exports=l},{"../util/ajax":191,"../util/util":212,"./worker_tile":99,pbf:25,"vector-tile":34}],97:[function(t,e,n){"use strict";var i=t("../util/ajax"),r=function(t){function e(e,n,i,r){t.call(this,e,n,i,r),this.roundZoom=!0,this.type="video",this.options=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this,e=this.options;this.urls=e.urls,i.getVideo(e.urls,function(e,n){if(e)return t.fire("error",{error:e});var i;t.video=n,t.video.loop=!0,t.video.addEventListener("playing",function(){i=t.map.style.animationLoop.set(1/0),t.map._rerender()}),t.video.addEventListener("pause",function(){t.map.style.animationLoop.cancel(i)}),t.map&&t.video.play(),t._finishLoading()})},e.prototype.getVideo=function(){return this.video},e.prototype.onAdd=function(t){this.map||(this.load(),this.map=t,this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},e.prototype.prepare=function(){!this.tile||this.video.readyState<2||this._prepareImage(this.map.painter.gl,this.video)},e.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},e}(t("./image_source"));e.exports=r},{"../util/ajax":191,"./image_source":85}],98:[function(t,e,n){"use strict";var i=t("../util/actor"),r=t("../style/style_layer_index"),o=t("./vector_tile_worker_source"),a=t("./geojson_worker_source"),s=t("./rtl_text_plugin"),l=function(t){var e=this;this.self=t,this.actor=new i(t,this),this.layerIndexes={},this.workerSourceTypes={vector:o,geojson:a},this.workerSources={},this.self.registerWorkerSource=function(t,n){if(e.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');e.workerSourceTypes[t]=n},this.self.registerRTLTextPlugin=function(t){if(s.applyArabicShaping||s.processBidirectionalText)throw new Error("RTL text plugin already registered.");s.applyArabicShaping=t.applyArabicShaping,s.processBidirectionalText=t.processBidirectionalText}};l.prototype.setLayers=function(t,e){this.getLayerIndex(t).replace(e)},l.prototype.updateLayers=function(t,e){this.getLayerIndex(t).update(e.layers,e.removedIds,e.symbolOrder)},l.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type).loadTile(e,n)},l.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type).reloadTile(e,n)},l.prototype.abortTile=function(t,e){this.getWorkerSource(t,e.type).abortTile(e)},l.prototype.removeTile=function(t,e){this.getWorkerSource(t,e.type).removeTile(e)},l.prototype.removeSource=function(t,e){var n=this.getWorkerSource(t,e.type);void 0!==n.removeSource&&n.removeSource(e)},l.prototype.redoPlacement=function(t,e,n){this.getWorkerSource(t,e.type).redoPlacement(e,n)},l.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t)}},l.prototype.loadRTLTextPlugin=function(t,e,n){try{s.applyArabicShaping||s.processBidirectionalText||this.self.importScripts(e)}catch(t){n(t)}},l.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},l.prototype.getWorkerSource=function(t,e){var n=this;if(this.workerSources[t]||(this.workerSources[t]={}),!this.workerSources[t][e]){var i={send:function(e,i,r,o){n.actor.send(e,i,r,o,t)}};this.workerSources[t][e]=new this.workerSourceTypes[e](i,this.getLayerIndex(t))}return this.workerSources[t][e]},e.exports=function(t){return new l(t)}},{"../style/style_layer_index":154,"../util/actor":190,"./geojson_worker_source":83,"./rtl_text_plugin":90,"./vector_tile_worker_source":96}],99:[function(t,e,n){"use strict";function i(t,e){for(var n=0,i=t.layers;n<i.length;n+=1){i[n].recalculate(e)}}function r(t,e){return t.filter(function(t){return!t.isEmpty()}).map(function(t){return t.serialize(e)})}var o=t("../data/feature_index"),a=t("../symbol/collision_tile"),s=t("../symbol/collision_box"),l=t("../util/dictionary_coder"),u=t("../util/util"),c=function(t){this.coord=t.coord,this.uid=t.uid,this.zoom=t.zoom,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=t.overscaling,this.angle=t.angle,this.pitch=t.pitch,this.showCollisionBoxes=t.showCollisionBoxes};c.prototype.parse=function(t,e,n,c){var h=this;t.layers||(t={layers:{_geojsonTileLayer:t}}),this.status="parsing",this.data=t,this.collisionBoxArray=new s;var d=new l(Object.keys(t.layers).sort()),f=new o(this.coord,this.overscaling);f.bucketLayerIDs={};var p={},m=0,v={featureIndex:f,iconDependencies:{},glyphDependencies:{}},g=e.familiesBySource[this.source];for(var y in g){var _=t.layers[y];if(_){1===_.version&&u.warnOnce('Vector tile source "'+h.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var b=d.encode(y),x=[],w=0;w<_.length;w++){var S=_.feature(w);S.index=w,S.sourceLayerIndex=b,x.push(S)}for(var M=0,E=g[y];M<E.length;M+=1){var z=E[M],k=z[0];if(!(k.minzoom&&h.zoom<k.minzoom||k.maxzoom&&h.zoom>=k.maxzoom||k.layout&&"none"===k.layout.visibility)){for(var T=0,O=z;T<O.length;T+=1){O[T].recalculate(h.zoom)}(p[k.id]=k.createBucket({index:m,layers:z,zoom:h.zoom,overscaling:h.overscaling,collisionBoxArray:h.collisionBoxArray})).populate(x,v),f.bucketLayerIDs[m]=z.map(function(t){return t.id}),m++}}}}var P=function(t){for(var e in h.status="done",f.paintPropertyStatistics={},p)u.extend(f.paintPropertyStatistics,p[e].getPaintPropertyStatistics());var n=[];c(null,{buckets:r(u.values(p),n),featureIndex:f.serialize(n),collisionTile:t.serialize(n),collisionBoxArray:h.collisionBoxArray.serialize()},n)};this.symbolBuckets=[];for(var C=e.symbolOrder.length-1;C>=0;C--){var A=p[e.symbolOrder[C]];A&&h.symbolBuckets.push(A)}if(0===this.symbolBuckets.length)return P(new a(this.angle,this.pitch,this.collisionBoxArray));var I=0,L=Object.keys(v.iconDependencies),j=u.mapObject(v.glyphDependencies,function(t){return Object.keys(t).map(Number)}),D=function(t){if(t)return c(t);if(2===++I){for(var e=new a(h.angle,h.pitch,h.collisionBoxArray),n=0,r=h.symbolBuckets;n<r.length;n+=1){var o=r[n];i(o,h.zoom),o.prepare(j,L),o.place(e,h.showCollisionBoxes)}P(e)}};Object.keys(j).length?n.send("getGlyphs",{uid:this.uid,stacks:j},function(t,e){j=e,D(t)}):D(),L.length?n.send("getIcons",{icons:L},function(t,e){L=e,D(t)}):D()},c.prototype.redoPlacement=function(t,e,n){if(this.angle=t,this.pitch=e,"done"!==this.status)return{};for(var o=new a(this.angle,this.pitch,this.collisionBoxArray),s=0,l=this.symbolBuckets;s<l.length;s+=1){var u=l[s];i(u,this.zoom),u.place(o,n)}var c=[];return{result:{buckets:r(this.symbolBuckets,c),collisionTile:o.serialize(c)},transferables:c}},e.exports=c},{"../data/feature_index":55,"../symbol/collision_box":160,"../symbol/collision_tile":162,"../util/dictionary_coder":197,"../util/util":212}],100:[function(t,e,n){"use strict";function i(t,e){var n={};for(var i in t)"ref"!==i&&(n[i]=t[i]);return r.forEach(function(t){t in e&&(n[t]=e[t])}),n}var r=t("./util/ref_properties");e.exports=function(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=i(t[r],e[t[r].ref]));return t}},{"./util/ref_properties":122}],101:[function(t,e,n){"use strict";function i(t,e,n,i,r,o){var s;for(s in t=t||{},e=e||{},t)t.hasOwnProperty(s)&&(a(t[s],e[s])||n.push({command:o,args:[i,s,e[s],r]}));for(s in e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(a(t[s],e[s])||n.push({command:o,args:[i,s,e[s],r]}))}function r(t){return t.id}function o(t,e){return t[e.id]=e,t}var a=t("lodash.isequal"),s={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};e.exports=function(t,e){if(!t)return[{command:s.setStyle,args:[e]}];var n=[];try{if(!a(t.version,e.version))return[{command:s.setStyle,args:[e]}];a(t.center,e.center)||n.push({command:s.setCenter,args:[e.center]}),a(t.zoom,e.zoom)||n.push({command:s.setZoom,args:[e.zoom]}),a(t.bearing,e.bearing)||n.push({command:s.setBearing,args:[e.bearing]}),a(t.pitch,e.pitch)||n.push({command:s.setPitch,args:[e.pitch]}),a(t.sprite,e.sprite)||n.push({command:s.setSprite,args:[e.sprite]}),a(t.glyphs,e.glyphs)||n.push({command:s.setGlyphs,args:[e.glyphs]}),a(t.transition,e.transition)||n.push({command:s.setTransition,args:[e.transition]}),a(t.light,e.light)||n.push({command:s.setLight,args:[e.light]});var l={},u=[];!function(t,e,n,i){var r;for(r in t=t||{},e=e||{},t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||(n.push({command:s.removeSource,args:[r]}),i[r]=!0));for(r in e)e.hasOwnProperty(r)&&(t.hasOwnProperty(r)?a(t[r],e[r])||(n.push({command:s.removeSource,args:[r]}),n.push({command:s.addSource,args:[r,e[r]]}),i[r]=!0):n.push({command:s.addSource,args:[r,e[r]]}))}(t.sources,e.sources,u,l);var c=[];t.layers&&t.layers.forEach(function(t){l[t.source]?n.push({command:s.removeLayer,args:[t.id]}):c.push(t)}),n=n.concat(u),function(t,e,n){t=t||[],e=e||[];var l,u,c,h,d,f,p,m=t.map(r),v=e.map(r),g=t.reduce(o,{}),y=e.reduce(o,{}),_=m.slice(),b=Object.create(null);for(l=0,u=0;l<m.length;l++)c=m[l],y.hasOwnProperty(c)?u++:(n.push({command:s.removeLayer,args:[c]}),_.splice(_.indexOf(c,u),1));for(l=0,u=0;l<v.length;l++)c=v[v.length-1-l],_[_.length-1-l]!==c&&(g.hasOwnProperty(c)?(n.push({command:s.removeLayer,args:[c]}),_.splice(_.lastIndexOf(c,_.length-u),1)):u++,f=_[_.length-l],n.push({command:s.addLayer,args:[y[c],f]}),_.splice(_.length-l,0,c),b[c]=!0);for(l=0;l<v.length;l++)if(h=g[c=v[l]],d=y[c],!b[c]&&!a(h,d))if(a(h.source,d.source)&&a(h["source-layer"],d["source-layer"])&&a(h.type,d.type)){for(p in i(h.layout,d.layout,n,c,null,s.setLayoutProperty),i(h.paint,d.paint,n,c,null,s.setPaintProperty),a(h.filter,d.filter)||n.push({command:s.setFilter,args:[c,d.filter]}),a(h.minzoom,d.minzoom)&&a(h.maxzoom,d.maxzoom)||n.push({command:s.setLayerZoomRange,args:[c,d.minzoom,d.maxzoom]}),h)h.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?i(h[p],d[p],n,c,p.slice(6),s.setPaintProperty):a(h[p],d[p])||n.push({command:s.setLayerProperty,args:[c,p,d[p]]}));for(p in d)d.hasOwnProperty(p)&&!h.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?i(h[p],d[p],n,c,p.slice(6),s.setPaintProperty):a(h[p],d[p])||n.push({command:s.setLayerProperty,args:[c,p,d[p]]}))}else n.push({command:s.removeLayer,args:[c]}),f=_[_.lastIndexOf(c)+1],n.push({command:s.addLayer,args:[d,f]})}(c,e.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:s.setStyle,args:[e]}]}return n},e.exports.operations=s},{"lodash.isequal":114}],102:[function(t,e,n){"use strict";var i=t("util").format;e.exports=function(t,e){this.message=(t?t+": ":"")+i.apply(i,Array.prototype.slice.call(arguments,2)),null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__)}},{util:33}],103:[function(t,e,n){"use strict";function i(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?o(t[1],t[2],"===",!1):"!="===e?o(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?o(t[1],t[2],e,!0):"any"===e?a(t.slice(1),"||"):"all"===e?a(t.slice(1),"&&"):"none"===e?u(a(t.slice(1),"||")):"in"===e?s(t[1],t.slice(2)):"!in"===e?u(s(t[1],t.slice(2))):"has"===e?l(t[1]):"!has"===e?u(l(t[1])):"true")+")"}function r(t){return"$type"===t?"f.type":"$id"===t?"f.id":"p["+JSON.stringify(t)+"]"}function o(t,e,n,i){var o=r(t),a="$type"===t?h.indexOf(e):JSON.stringify(e);return(i?"typeof "+o+"=== typeof "+a+"&&":"")+o+n+a}function a(t,e){return t.map(i).join(e)}function s(t,e){"$type"===t&&(e=e.map(function(t){return h.indexOf(t)}));var n=JSON.stringify(e.sort(c)),i=r(t);return e.length<=200?n+".indexOf("+i+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+i+", "+n+",0,"+(e.length-1)+")"}function l(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function u(t){return"!("+t+")"}function c(t,e){return t<e?-1:t>e?1:0}e.exports=function(t){return new Function("f","var p = (f && f.properties || {}); return "+i(t))};var h=["Unknown","Point","LineString","Polygon"]},{}],104:[function(t,e,n){"use strict";function i(t){return t>m?Math.pow(t,1/3):t/p+d}function r(t){return t>f?t*t*t:p*(t-d)}function o(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function a(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function s(t){var e=a(t[0]),n=a(t[1]),r=a(t[2]),o=i((.4124564*e+.3575761*n+.1804375*r)/u),s=i((.2126729*e+.7151522*n+.072175*r)/c);return[116*s-16,500*(o-s),200*(s-i((.0193339*e+.119192*n+.9503041*r)/h)),t[3]]}function l(t){var e=(t[0]+16)/116,n=isNaN(t[1])?e:e+t[1]/500,i=isNaN(t[2])?e:e-t[2]/200;return e=c*r(e),[o(3.2404542*(n=u*r(n))-1.5371385*e-.4985314*(i=h*r(i))),o(-.969266*n+1.8760108*e+.041556*i),o(.0556434*n-.2040259*e+1.0572252*i),t[3]]}var u=.95047,c=1,h=1.08883,d=4/29,f=6/29,p=3*f*f,m=f*f*f,v=Math.PI/180,g=180/Math.PI;e.exports={lab:{forward:s,reverse:l},hcl:{forward:function(t){var e=s(t),n=e[0],i=e[1],r=e[2],o=Math.atan2(r,i)*g;return[o<0?o+360:o,Math.sqrt(i*i+r*r),n,t[3]]},reverse:function(t){var e=t[0]*v,n=t[1];return l([t[2],Math.cos(e)*n,Math.sin(e)*n,t[3]])}}}},{}],105:[function(t,e,n){"use strict";function i(t){return t}function r(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function o(t,e,n,i,o){return r(typeof n===o?i[n]:void 0,t.default,e.default)}function a(t,e,n){if("number"!==m(n))return r(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var o=u(t.stops,n);return t.stops[o][1]}function s(t,e,n){var i=void 0!==t.base?t.base:1;if("number"!==m(n))return r(t.default,e.default);var o=t.stops.length;if(1===o)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];var a=u(t.stops,n);return function t(e,n,i,r,o,a){return"function"==typeof o?function(){var s=o.apply(void 0,arguments),l=a.apply(void 0,arguments);if(void 0!==s&&void 0!==l)return t(e,n,i,r,s,l)}:o.length?function(t,e,n,i,r,o){for(var a=[],s=0;s<r.length;s++)a[s]=c(t,e,n,i,r[s],o[s]);return a}(e,n,i,r,o,a):c(e,n,i,r,o,a)}(n,i,t.stops[a][0],t.stops[a+1][0],t.stops[a][1],t.stops[a+1][1])}function l(t,e,n){return"color"===e.type?n=f(n):m(n)!==e.type&&(n=void 0),r(n,t.default,e.default)}function u(t,e){for(var n,i,r=0,o=t.length-1,a=0;r<=o;){if(n=t[a=Math.floor((r+o)/2)][0],i=t[a+1][0],e>=n&&e<i)return a;n<e?r=a+1:n>e&&(o=a-1)}return Math.max(a-1,0)}function c(t,e,n,i,r,o){var a,s=i-n,l=t-n;return r*(1-(a=1===e?l/s:(Math.pow(e,l)-1)/(Math.pow(e,s)-1)))+o*a}function h(t){return"object"==typeof t&&(t.stops||"identity"===t.type)}var d=t("./color_spaces"),f=t("../util/parse_color"),p=t("../util/extend"),m=t("../util/get_type");e.exports=function t(e,n){var u,c="color"===n.type;if(h(e)){var m,v,g,y,_=e.stops&&"object"==typeof e.stops[0][0],b=_||void 0!==e.property,x=_||!b,w=e.type||("interpolated"===n.function?"exponential":"interval");if(c&&((e=p({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],f(t[1])]})),e.default?e.default=f(e.default):e.default=f(n.default)),"exponential"===w)m=s;else if("interval"===w)m=a;else if("categorical"===w){m=o,v=Object.create(null);for(var S=0,M=e.stops;S<M.length;S+=1){var E=M[S];v[E[0]]=E[1]}g=typeof e.stops[0][0]}else{if("identity"!==w)throw new Error('Unknown function type "'+w+'"');m=l}if(e.colorSpace&&"rgb"!==e.colorSpace){if(!d[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);var z=d[e.colorSpace];e=JSON.parse(JSON.stringify(e));for(var k=0;k<e.stops.length;k++)e.stops[k]=[e.stops[k][0],z.forward(e.stops[k][1])];y=z.reverse}else y=i;if(_){for(var T={},O=[],P=0;P<e.stops.length;P++){var C=e.stops[P];void 0===T[C[0].zoom]&&(T[C[0].zoom]={zoom:C[0].zoom,type:e.type,property:e.property,stops:[]}),T[C[0].zoom].stops.push([C[0].value,C[1]])}for(var A in T)O.push([T[A].zoom,t(T[A],n)]);(u=function(t,i){return y(s({stops:O,base:e.base},n,t)(t,i))}).isFeatureConstant=!1,u.isZoomConstant=!1}else x?((u=function(t){return y(m(e,n,t,v,g))}).isFeatureConstant=!0,u.isZoomConstant=!1):((u=function(t,i){var o=i[e.property];return void 0===o?r(e.default,n.default):y(m(e,n,o,v,g))}).isFeatureConstant=!1,u.isZoomConstant=!0)}else c&&e&&(e=f(e)),(u=function(){return e}).isFeatureConstant=!0,u.isZoomConstant=!0;return u},e.exports.isFunctionDefinition=h},{"../util/extend":119,"../util/get_type":120,"../util/parse_color":121,"./color_spaces":104}],106:[function(t,e,n){"use strict";function i(t){return o(r.map(function(e){return t[e]}))}var r=t("./util/ref_properties"),o=t("fast-stable-stringify");e.exports=function(t){for(var e={},n=0;n<t.length;n++){var r=i(t[n]),o=e[r];o||(o=e[r]=[]),o.push(t[n])}var a=[];for(var s in e)a.push(e[s]);return a}},{"./util/ref_properties":122,"fast-stable-stringify":108}],107:[function(t,e,n){function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return i("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return function(t){return t<0?0:t>1?1:t}("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{n.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in s)return s[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=n.indexOf("("),u=n.indexOf(")");if(-1!==l&&u+1===n.length){var c=n.substr(0,l),h=n.substr(l+1,u-(l+1)).split(","),d=1;switch(c){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=o(h[1]),m=o(h[2]),v=m<=.5?m*(p+1):m+p-m*p,g=2*m-v;return[i(255*a(g,v,f+1/3)),i(255*a(g,v,f)),i(255*a(g,v,f-1/3)),d];default:return null}}return null}}catch(t){}},{}],108:[function(t,e,n){var i={}.toString,r=Array.isArray||function(t){return"[object Array]"===i.call(t)},o=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},a=/[\u0000-\u001f"\\]/g,s=function(t){var e=t.charCodeAt(0);switch(e){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:return e>15?"\\u00"+e.toString(16):"\\u000"+e.toString(16)}};e.exports=function(t){if(void 0!==t)return""+function t(e){var n,i,l,u,c,h;switch(typeof e){case"object":if(null===e)return null;if(r(e)){for(l="[",i=e.length-1,n=0;n<i;n++)l+=t(e[n])+",";return i>-1&&(l+=t(e[n])),l+"]"}for(i=(u=o(e).sort()).length,l="{",c=u[n=0],h=i>0&&void 0!==e[c];n<i;)h?(l+='"'+c.replace(a,s)+'":'+t(e[c]),c=u[++n],(h=n<i&&void 0!==e[c])&&(l+=",")):(c=u[++n],h=n<i&&void 0!==e[c]);return l+"}";case"undefined":return null;case"string":return'"'+e.replace(a,s)+'"';default:return e}}(t)},e.exports.stringSearch=a,e.exports.stringReplace=s},{}],109:[function(t,e,n){function i(t,e){for(var n=-1,i=t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}var r=t("lodash.isarray"),o=t("lodash.istypedarray"),a=t("lodash.keys"),s="[object Arguments]",l="[object Array]",u="[object Boolean]",c="[object Date]",h="[object Error]",d="[object Number]",f="[object Object]",p="[object RegExp]",m="[object String]",v=Object.prototype,g=v.hasOwnProperty,y=v.toString;e.exports=function t(e,n,v,_,b,x){return e===n||(null==e||null==n||!function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(e)&&!function(t){return!!t&&"object"==typeof t}(n)?e!=e&&n!=n:function(t,e,n,v,_,b,x){var w=r(t),S=r(e),M=l,E=l;w||((M=y.call(t))==s?M=f:M!=f&&(w=o(t))),S||((E=y.call(e))==s?E=f:E!=f&&(S=o(e)));var z=M==f,k=E==f,T=M==E;if(T&&!w&&!z)return function(t,e,n){switch(n){case u:case c:return+t==+e;case h:return t.name==e.name&&t.message==e.message;case d:return t!=+t?e!=+e:t==+e;case p:case m:return t==e+""}return!1}(t,e,M);if(!_){var O=z&&g.call(t,"__wrapped__"),P=k&&g.call(e,"__wrapped__");if(O||P)return n(O?t.value():t,P?e.value():e,v,_,b,x)}if(!T)return!1;b||(b=[]),x||(x=[]);for(var C=b.length;C--;)if(b[C]==t)return x[C]==e;b.push(t),x.push(e);var A=(w?function(t,e,n,r,o,a,s){var l=-1,u=t.length,c=e.length;if(u!=c&&!(o&&c>u))return!1;for(;++l<u;){var h=t[l],d=e[l],f=r?r(o?d:h,o?h:d,l):void 0;if(void 0!==f){if(f)continue;return!1}if(o){if(!i(e,function(t){return h===t||n(h,t,r,o,a,s)}))return!1}else if(h!==d&&!n(h,d,r,o,a,s))return!1}return!0}:function(t,e,n,i,r,o,s){var l=a(t),u=l.length,c=a(e).length;if(u!=c&&!r)return!1;for(var h=u;h--;){var d=l[h];if(!(r?d in e:g.call(e,d)))return!1}for(var f=r;++h<u;){d=l[h];var p=t[d],m=e[d],v=i?i(r?m:p,r?p:m,d):void 0;if(!(void 0===v?n(p,m,i,r,o,s):v))return!1;f||(f="constructor"==d)}if(!f){var y=t.constructor,_=e.constructor;if(y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _))return!1}return!0})(t,e,n,v,_,b,x);return b.pop(),x.pop(),A}(e,n,t,v,_,b,x))}},{"lodash.isarray":113,"lodash.istypedarray":115,"lodash.keys":116}],110:[function(t,e,n){function i(t){return t}e.exports=function(t,e,n){if("function"!=typeof t)return i;if(void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)};case 5:return function(n,i,r,o,a){return t.call(e,n,i,r,o,a)}}return function(){return t.apply(e,arguments)}}},{}],111:[function(t,e,n){var i="[object Function]",r=/^\[object .+?Constructor\]$/,o=Object.prototype,a=Function.prototype.toString,s=o.hasOwnProperty,l=o.toString,u=RegExp("^"+a.call(s).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(t,e){var n=null==t?void 0:t[e];return function(t){return null!=t&&(function(t){return function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)&&l.call(t)==i}(t)?u.test(a.call(t)):function(t){return!!t&&"object"==typeof t}(t)&&r.test(t))}(n)?n:void 0}},{}],112:[function(t,e,n){var i=9007199254740991,r="[object Arguments]",o="[object Function]",a="[object GeneratorFunction]",s=Object.prototype,l=s.hasOwnProperty,u=s.toString,c=s.propertyIsEnumerable;e.exports=function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?u.call(t):"";return e==o||e==a}(t)}(t)}(t)&&l.call(t,"callee")&&(!c.call(t,"callee")||u.call(t)==r)}},{}],113:[function(t,e,n){function i(t){return!!t&&"object"==typeof t}var r,o,a="[object Function]",s=/^\[object .+?Constructor\]$/,l=Object.prototype,u=Function.prototype.toString,c=l.hasOwnProperty,h=l.toString,d=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),f=9007199254740991,p=(r=Array,function(t){return null!=t&&(function(t){return function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)&&h.call(t)==a}(t)?d.test(u.call(t)):i(t)&&s.test(t))}(o=null==r?void 0:r["isArray"])?o:void 0)||function(t){return i(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=f}(t.length)&&"[object Array]"==h.call(t)};e.exports=p},{}],114:[function(t,e,n){var i=t("lodash._baseisequal"),r=t("lodash._bindcallback");e.exports=function(t,e,n,o){var a=(n="function"==typeof n?r(n,o,3):void 0)?n(t,e):void 0;return void 0===a?i(t,e,n):!!a}},{"lodash._baseisequal":109,"lodash._bindcallback":110}],115:[function(t,e,n){var i=9007199254740991,r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1;var o=Object.prototype.toString;e.exports=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}(t.length)&&!!r[o.call(t)]}},{}],116:[function(t,e,n){function i(t,e){return t="number"==typeof t||h.test(t)?+t:-1,e=null==e?p:e,t>-1&&t%1==0&&t<e}function r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}function o(t){for(var e=function(t){if(null==t)return[];a(t)||(t=Object(t));var e=t.length;e=e&&r(e)&&(c(t)||u(t))&&e||0;for(var n=t.constructor,o=-1,s="function"==typeof n&&n.prototype===t,l=Array(e),h=e>0;++o<e;)l[o]=o+"";for(var f in t)h&&i(f,e)||"constructor"==f&&(s||!d.call(t,f))||l.push(f);return l}(t),n=e.length,o=n&&t.length,s=!!o&&r(o)&&(c(t)||u(t)),l=-1,h=[];++l<n;){var f=e[l];(s&&i(f,o)||d.call(t,f))&&h.push(f)}return h}function a(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var s,l=t("lodash._getnative"),u=t("lodash.isarguments"),c=t("lodash.isarray"),h=/^\d+$/,d=Object.prototype.hasOwnProperty,f=l(Object,"keys"),p=9007199254740991,m=(s="length",function(t){return null==t?void 0:t[s]}),v=f?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&function(t){return null!=t&&r(m(t))}(t)?o(t):a(t)?f(t):[]}:o;e.exports=v},{"lodash._getnative":111,"lodash.isarguments":112,"lodash.isarray":113}],117:[function(t,e,n){"use strict";e.exports=t("./v8.json")},{"./v8.json":118}],118:[function(t,e,n){e.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image","source_canvas"],source_tile:{type:{required:!0,type:"enum",values:{vector:{},raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_canvas:{type:{required:!0,type:"enum",values:{canvas:{}}},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},animate:{type:"boolean",default:"true"},canvas:{type:"string",required:!0}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},"fill-extrusion":{},raster:{},background:{}}},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_fill-extrusion","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":!0,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:!1},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_fill-extrusion","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"]}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"milliseconds"}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}}}},{}],119:[function(t,e,n){"use strict";e.exports=function(t){for(var e=arguments,n=1;n<arguments.length;n++){var i=e[n];for(var r in i)t[r]=i[r]}return t}},{}],120:[function(t,e,n){"use strict";e.exports=function(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}},{}],121:[function(t,e,n){"use strict";var i=t("csscolorparser").parseCSSColor;e.exports=function(t){if("string"==typeof t){var e=i(t);if(!e)return;return[e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]]}return Array.isArray(t)?t:void 0}},{csscolorparser:107}],122:[function(t,e,n){"use strict";e.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],123:[function(t,e,n){"use strict";e.exports=function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}},{}],124:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/get_type"),o=t("../util/extend");e.exports=function(e){var n=t("./validate_function"),a=t("./validate_object"),s={"*":function(){return[]},array:t("./validate_array"),boolean:t("./validate_boolean"),number:t("./validate_number"),color:t("./validate_color"),constants:t("./validate_constants"),enum:t("./validate_enum"),filter:t("./validate_filter"),function:t("./validate_function"),layer:t("./validate_layer"),object:t("./validate_object"),source:t("./validate_source"),light:t("./validate_light"),string:t("./validate_string")},l=e.value,u=e.valueSpec,c=e.key,h=e.styleSpec,d=e.style;if("string"===r(l)&&"@"===l[0]){if(h.$version>7)return[new i(c,l,"constants have been deprecated as of v8")];if(!(l in d.constants))return[new i(c,l,'constant "%s" not found',l)];e=o({},e,{value:d.constants[l]})}return u.function&&"object"===r(l)?n(e):u.type&&s[u.type]?s[u.type](e):a(o({},e,{valueSpec:u.type?h[u.type]:u}))}},{"../error/validation_error":102,"../util/extend":119,"../util/get_type":120,"./validate_array":125,"./validate_boolean":126,"./validate_color":127,"./validate_constants":128,"./validate_enum":129,"./validate_filter":130,"./validate_function":131,"./validate_layer":133,"./validate_light":135,"./validate_number":136,"./validate_object":137,"./validate_source":140,"./validate_string":141}],125:[function(t,e,n){"use strict";var i=t("../util/get_type"),r=t("./validate"),o=t("../error/validation_error");e.exports=function(t){var e=t.value,n=t.valueSpec,a=t.style,s=t.styleSpec,l=t.key,u=t.arrayElementValidator||r;if("array"!==i(e))return[new o(l,e,"array expected, %s found",i(e))];if(n.length&&e.length!==n.length)return[new o(l,e,"array length %d expected, length %d found",n.length,e.length)];if(n["min-length"]&&e.length<n["min-length"])return[new o(l,e,"array length at least %d expected, length %d found",n["min-length"],e.length)];var c={type:n.value};s.$version<7&&(c.function=n.function),"object"===i(n.value)&&(c=n.value);for(var h=[],d=0;d<e.length;d++)h=h.concat(u({array:e,arrayIndex:d,value:e[d],valueSpec:c,style:a,styleSpec:s,key:l+"["+d+"]"}));return h}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],126:[function(t,e,n){"use strict";var i=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.value,n=t.key,o=i(e);return"boolean"!==o?[new r(n,e,"boolean expected, %s found",o)]:[]}},{"../error/validation_error":102,"../util/get_type":120}],127:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/get_type"),o=t("csscolorparser").parseCSSColor;e.exports=function(t){var e=t.key,n=t.value,a=r(n);return"string"!==a?[new i(e,n,"color expected, %s found",a)]:null===o(n)?[new i(e,n,'color expected, "%s" found',n)]:[]}},{"../error/validation_error":102,"../util/get_type":120,csscolorparser:107}],128:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/get_type");e.exports=function(t){var e=t.key,n=t.value;if(t.styleSpec.$version>7)return n?[new i(e,n,"constants have been deprecated as of v8")]:[];var o=r(n);if("object"!==o)return[new i(e,n,"object expected, %s found",o)];var a=[];for(var s in n)"@"!==s[0]&&a.push(new i(e+"."+s,n[s],'constants must start with "@"'));return a}},{"../error/validation_error":102,"../util/get_type":120}],129:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/unbundle_jsonlint");e.exports=function(t){var e=t.key,n=t.value,o=t.valueSpec,a=[];return Array.isArray(o.values)?-1===o.values.indexOf(r(n))&&a.push(new i(e,n,"expected one of [%s], %s found",o.values.join(", "),n)):-1===Object.keys(o.values).indexOf(r(n))&&a.push(new i(e,n,"expected one of [%s], %s found",Object.keys(o.values).join(", "),n)),a}},{"../error/validation_error":102,"../util/unbundle_jsonlint":123}],130:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("./validate_enum"),o=t("../util/get_type"),a=t("../util/unbundle_jsonlint");e.exports=function t(e){var n,s=e.value,l=e.key,u=e.styleSpec,c=[];if("array"!==o(s))return[new i(l,s,"array expected, %s found",o(s))];if(s.length<1)return[new i(l,s,"filter array must have at least 1 element")];switch(c=c.concat(r({key:l+"[0]",value:s[0],valueSpec:u.filter_operator,style:e.style,styleSpec:e.styleSpec})),a(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"===a(s[1])&&c.push(new i(l,s,'"$type" cannot be use with operator "%s"',s[0]));case"==":case"!=":3!==s.length&&c.push(new i(l,s,'filter array for operator "%s" must have 3 elements',s[0]));case"in":case"!in":s.length>=2&&("string"!==(n=o(s[1]))&&c.push(new i(l+"[1]",s[1],"string expected, %s found",n)));for(var h=2;h<s.length;h++)n=o(s[h]),"$type"===a(s[1])?c=c.concat(r({key:l+"["+h+"]",value:s[h],valueSpec:u.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&c.push(new i(l+"["+h+"]",s[h],"string, number, or boolean expected, %s found",n));break;case"any":case"all":case"none":for(var d=1;d<s.length;d++)c=c.concat(t({key:l+"["+d+"]",value:s[d],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=o(s[1]),2!==s.length?c.push(new i(l,s,'filter array for "%s" operator must have 2 elements',s[0])):"string"!==n&&c.push(new i(l+"[1]",s[1],"string expected, %s found",n))}return c}},{"../error/validation_error":102,"../util/get_type":120,"../util/unbundle_jsonlint":123,"./validate_enum":129}],131:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/get_type"),o=t("./validate"),a=t("./validate_object"),s=t("./validate_array"),l=t("./validate_number"),u=t("../util/unbundle_jsonlint");e.exports=function(t){function e(t){var e=[],s=t.value,c=t.key;if("array"!==r(s))return[new i(c,s,"array expected, %s found",r(s))];if(2!==s.length)return[new i(c,s,"array length %d expected, length %d found",2,s.length)];if(y){if("object"!==r(s[0]))return[new i(c,s,"object expected, %s found",r(s[0]))];if(void 0===s[0].zoom)return[new i(c,s,"object stop key must have zoom")];if(void 0===s[0].value)return[new i(c,s,"object stop key must have value")];if(d&&d>u(s[0].zoom))return[new i(c,s[0].zoom,"stop zoom values must appear in ascending order")];u(s[0].zoom)!==d&&(d=u(s[0].zoom),h=void 0,m={}),e=e.concat(a({key:c+"[0]",value:s[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:l,value:n}}))}else e=e.concat(n({key:c+"[0]",value:s[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec}));return e.concat(o({key:c+"[1]",value:s[1],valueSpec:f,style:t.style,styleSpec:t.styleSpec}))}function n(t){var e=r(t.value),n=u(t.value);if(c){if(e!==c)return[new i(t.key,t.value,"%s stop domain type must match previous stop domain type %s",e,c)]}else c=e;if("number"!==e&&"string"!==e&&"boolean"!==e)return[new i(t.key,t.value,"stop domain value must be a number, string, or boolean")];if("number"!==e&&"categorical"!==p){var o="number expected, %s found";return f["property-function"]&&void 0===p&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i(t.key,t.value,o,e)]}return"categorical"!==p||"number"!==e||isFinite(n)&&Math.floor(n)===n?"number"===e&&void 0!==h&&n<h?[new i(t.key,t.value,"stop domain values must appear in ascending order")]:(h=n,"categorical"===p&&n in m?[new i(t.key,t.value,"stop domain values must be unique")]:(m[n]=!0,[])):[new i(t.key,t.value,"integer expected, found %s",n)]}var c,h,d,f=t.valueSpec,p=u(t.value.type),m={},v="categorical"!==p&&void 0===t.value.property,g=!v,y="array"===r(t.value.stops)&&"array"===r(t.value.stops[0])&&"object"===r(t.value.stops[0][0]),_=a({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===p)return[new i(t.key,t.value,'identity function may not have a "stops" property')];var n=[],o=t.value;return n=n.concat(s({key:t.key,value:o,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:e})),"array"===r(o)&&0===o.length&&n.push(new i(t.key,o,"array must have at least one stop")),n},default:function(t){return o({key:t.key,value:t.value,valueSpec:f,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===p&&v&&_.push(new i(t.key,t.value,'missing required property "property"')),"identity"===p||t.value.stops||_.push(new i(t.key,t.value,'missing required property "stops"')),"exponential"===p&&"piecewise-constant"===t.valueSpec.function&&_.push(new i(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(g&&!t.valueSpec["property-function"]?_.push(new i(t.key,t.value,"property functions not supported")):v&&!t.valueSpec["zoom-function"]&&_.push(new i(t.key,t.value,"zoom functions not supported"))),"categorical"!==p&&!y||void 0!==t.value.property||_.push(new i(t.key,t.value,'"property" property is required')),_}},{"../error/validation_error":102,"../util/get_type":120,"../util/unbundle_jsonlint":123,"./validate":124,"./validate_array":125,"./validate_number":136,"./validate_object":137}],132:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("./validate_string");e.exports=function(t){var e=t.value,n=t.key,o=r(t);return o.length?o:(-1===e.indexOf("{fontstack}")&&o.push(new i(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&o.push(new i(n,e,'"glyphs" url must include a "{range}" token')),o)}},{"../error/validation_error":102,"./validate_string":141}],133:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/unbundle_jsonlint"),o=t("./validate_object"),a=t("./validate_filter"),s=t("./validate_paint_property"),l=t("./validate_layout_property"),u=t("../util/extend");e.exports=function(t){var e=[],n=t.value,c=t.key,h=t.style,d=t.styleSpec;n.type||n.ref||e.push(new i(c,n,'either "type" or "ref" is required'));var f,p=r(n.type),m=r(n.ref);if(n.id)for(var v=r(n.id),g=0;g<t.arrayIndex;g++){var y=h.layers[g];r(y.id)===v&&e.push(new i(c,n.id,'duplicate layer id "%s", previously used at line %d',n.id,y.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach(function(t){t in n&&e.push(new i(c,n[t],'"%s" is prohibited for ref layers',t))}),h.layers.forEach(function(t){r(t.id)===m&&(f=t)}),f?f.ref?e.push(new i(c,n.ref,"ref cannot reference another ref layer")):p=r(f.type):e.push(new i(c,n.ref,'ref layer "%s" not found',m));else if("background"!==p)if(n.source){var _=h.sources&&h.sources[n.source],b=_&&r(_.type);_?"vector"===b&&"raster"===p?e.push(new i(c,n.source,'layer "%s" requires a raster source',n.id)):"raster"===b&&"raster"!==p?e.push(new i(c,n.source,'layer "%s" requires a vector source',n.id)):"vector"!==b||n["source-layer"]||e.push(new i(c,n,'layer "%s" must specify a "source-layer"',n.id)):e.push(new i(c,n.source,'source "%s" not found',n.source))}else e.push(new i(c,n,'missing required property "source"'));return e=e.concat(o({key:c,value:n,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},filter:a,layout:function(t){return o({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return l(u({layerType:p},t))}}})},paint:function(t){return o({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return s(u({layerType:p},t))}}})}}}))}},{"../error/validation_error":102,"../util/extend":119,"../util/unbundle_jsonlint":123,"./validate_filter":130,"./validate_layout_property":134,"./validate_object":137,"./validate_paint_property":138}],134:[function(t,e,n){"use strict";var i=t("./validate_property");e.exports=function(t){return i(t,"layout")}},{"./validate_property":139}],135:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/get_type"),o=t("./validate");e.exports=function(t){var e=t.value,n=t.styleSpec,a=n.light,s=t.style,l=[],u=r(e);if(void 0===e)return l;if("object"!==u)return l.concat([new i("light",e,"object expected, %s found",u)]);for(var c in e){var h=c.match(/^(.*)-transition$/);l=h&&a[h[1]]&&a[h[1]].transition?l.concat(o({key:c,value:e[c],valueSpec:n.transition,style:s,styleSpec:n})):a[c]?l.concat(o({key:c,value:e[c],valueSpec:a[c],style:s,styleSpec:n})):l.concat([new i(c,e[c],'unknown property "%s"',c)])}return l}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],136:[function(t,e,n){"use strict";var i=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.key,n=t.value,o=t.valueSpec,a=i(n);return"number"!==a?[new r(e,n,"number expected, %s found",a)]:"minimum"in o&&n<o.minimum?[new r(e,n,"%s is less than the minimum value %s",n,o.minimum)]:"maximum"in o&&n>o.maximum?[new r(e,n,"%s is greater than the maximum value %s",n,o.maximum)]:[]}},{"../error/validation_error":102,"../util/get_type":120}],137:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/get_type"),o=t("./validate");e.exports=function(t){var e=t.key,n=t.value,a=t.valueSpec||{},s=t.objectElementValidators||{},l=t.style,u=t.styleSpec,c=[],h=r(n);if("object"!==h)return[new i(e,n,"object expected, %s found",h)];for(var d in n){var f=d.split(".")[0],p=a[f]||a["*"],m=void 0;if(s[f])m=s[f];else if(a[f])m=o;else if(s["*"])m=s["*"];else{if(!a["*"]){c.push(new i(e,n[d],'unknown property "%s"',d));continue}m=o}c=c.concat(m({key:(e?e+".":e)+d,value:n[d],valueSpec:p,style:l,styleSpec:u,object:n,objectKey:d}))}for(var v in a)a[v].required&&void 0===a[v].default&&void 0===n[v]&&c.push(new i(e,n,'missing required property "%s"',v));return c}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],138:[function(t,e,n){"use strict";var i=t("./validate_property");e.exports=function(t){return i(t,"paint")}},{"./validate_property":139}],139:[function(t,e,n){"use strict";var i=t("./validate"),r=t("../error/validation_error"),o=t("../util/get_type");e.exports=function(t,e){var n=t.key,a=t.style,s=t.styleSpec,l=t.value,u=t.objectKey,c=s[e+"_"+t.layerType];if(!c)return[];var h=u.match(/^(.*)-transition$/);if("paint"===e&&h&&c[h[1]]&&c[h[1]].transition)return i({key:n,value:l,valueSpec:s.transition,style:a,styleSpec:s});var d,f=t.valueSpec||c[u];if(!f)return[new r(n,l,'unknown property "%s"',u)];if("string"===o(l)&&f["property-function"]&&!f.tokens&&(d=/^{([^}]+)}$/.exec(l)))return[new r(n,l,'"%s" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": %s` }`.',u,JSON.stringify(d[1]))];var p=[];return"symbol"===t.layerType&&"text-field"===u&&a&&!a.glyphs&&p.push(new r(n,l,'use of "text-field" requires a style "glyphs" property')),p.concat(i({key:t.key,value:l,valueSpec:f,style:a,styleSpec:s}))}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],140:[function(t,e,n){"use strict";var i=t("../error/validation_error"),r=t("../util/unbundle_jsonlint"),o=t("./validate_object"),a=t("./validate_enum");e.exports=function(t){var e=t.value,n=t.key,s=t.styleSpec,l=t.style;if(!e.type)return[new i(n,e,'"type" is required')];var u=[];switch(r(e.type)){case"vector":case"raster":if(u=u.concat(o({key:n,value:e,valueSpec:s.source_tile,style:t.style,styleSpec:s})),"url"in e)for(var c in e)["type","url","tileSize"].indexOf(c)<0&&u.push(new i(n+"."+c,e[c],'a source with a "url" property may not include a "%s" property',c));return u;case"geojson":return o({key:n,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s});case"video":return o({key:n,value:e,valueSpec:s.source_video,style:l,styleSpec:s});case"image":return o({key:n,value:e,valueSpec:s.source_image,style:l,styleSpec:s});case"canvas":return o({key:n,value:e,valueSpec:s.source_canvas,style:l,styleSpec:s});default:return a({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","geojson","video","image","canvas"]},style:l,styleSpec:s})}}},{"../error/validation_error":102,"../util/unbundle_jsonlint":123,"./validate_enum":129,"./validate_object":137}],141:[function(t,e,n){"use strict";var i=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.value,n=t.key,o=i(e);return"string"!==o?[new r(n,e,"string expected, %s found",o)]:[]}},{"../error/validation_error":102,"../util/get_type":120}],142:[function(t,e,n){"use strict";function i(t,e){e=e||l;var n=[];return n=n.concat(s({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:u,"*":function(){return[]}}})),e.$version>7&&t.constants&&(n=n.concat(a({key:"constants",value:t.constants,style:t,styleSpec:e}))),r(n)}function r(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function o(t){return function(){return r(t.apply(this,arguments))}}var a=t("./validate/validate_constants"),s=t("./validate/validate"),l=t("./reference/latest"),u=t("./validate/validate_glyphs_url");i.source=o(t("./validate/validate_source")),i.light=o(t("./validate/validate_light")),i.layer=o(t("./validate/validate_layer")),i.filter=o(t("./validate/validate_filter")),i.paintProperty=o(t("./validate/validate_paint_property")),i.layoutProperty=o(t("./validate/validate_layout_property")),e.exports=i},{"./reference/latest":117,"./validate/validate":124,"./validate/validate_constants":128,"./validate/validate_filter":130,"./validate/validate_glyphs_url":132,"./validate/validate_layer":133,"./validate/validate_layout_property":134,"./validate/validate_light":135,"./validate/validate_paint_property":138,"./validate/validate_source":140}],143:[function(t,e,n){"use strict";var i=function(){this.n=0,this.times=[]};i.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},i.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},i.prototype.cancel=function(t){this.times=this.times.filter(function(e){return e.id!==t})},e.exports=i},{}],144:[function(t,e,n){"use strict";var i=t("../util/evented"),r=t("../util/ajax"),o=t("../util/browser"),a=t("../util/mapbox").normalizeSpriteURL,s=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.pixelRatio=1,this.sdf=!1},l=function(t){function e(e,n){var i=this;t.call(this),this.base=e,this.retina=o.devicePixelRatio>1,this.setEventedParent(n);var s=this.retina?"@2x":"";r.getJSON(a(e,s,".json"),function(t,e){return t?void i.fire("error",{error:t}):(i.data=e,void(i.imgData&&i.fire("data",{dataType:"style"})))}),r.getImage(a(e,s,".png"),function(t,e){if(t)i.fire("error",{error:t});else{i.imgData=o.getImageData(e);for(var n=0;n<i.imgData.length;n+=4){var r=i.imgData[n+3]/255;i.imgData[n+0]*=r,i.imgData[n+1]*=r,i.imgData[n+2]*=r}i.width=e.width,i.data&&i.fire("data",{dataType:"style"})}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return this.base},e.prototype.loaded=function(){return!(!this.data||!this.imgData)},e.prototype.resize=function(){var t=this;if(o.devicePixelRatio>1!==this.retina){var n=new e(this.base);n.on("data",function(){t.data=n.data,t.imgData=n.imgData,t.width=n.width,t.retina=n.retina})}},e.prototype.getSpritePosition=function(t){if(!this.loaded())return new s;var e=this.data&&this.data[t];return e&&this.imgData?e:new s},e}(i);e.exports=l},{"../util/ajax":191,"../util/browser":192,"../util/evented":200,"../util/mapbox":208}],145:[function(t,e,n){"use strict";var i=t("../style-spec/reference/latest"),r=t("../util/util"),o=t("../util/evented"),a=t("./validate_style"),s=t("./style_declaration"),l=t("./style_transition"),u=function(t){function e(e){t.call(this),this.properties=["anchor","color","position","intensity"],this._specifications=i.light,this.set(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){var e=this;if(!this._validate(a.light,t)){this._declarations={},this._transitions={},this._transitionOptions={},this.calculated={},t=r.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},t);for(var n=0,i=e.properties;n<i.length;n+=1){var o=i[n];e._declarations[o]=new s(e._specifications[o],t[o])}return this}},e.prototype.getLight=function(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}},e.prototype.getLightProperty=function(t){return r.endsWith(t,"-transition")?this._transitionOptions[t]:this._declarations[t]&&this._declarations[t].value},e.prototype.getLightValue=function(t,e){if("position"===t){var n=this._transitions[t].calculate(e),i=r.sphericalToCartesian(n);return{x:i[0],y:i[1],z:i[2]}}return this._transitions[t].calculate(e)},e.prototype.setLight=function(t){var e=this;if(!this._validate(a.light,t))for(var n in t){var i=t[n];r.endsWith(n,"-transition")?e._transitionOptions[n]=i:null===i||void 0===i?delete e._declarations[n]:e._declarations[n]=new s(e._specifications[n],i)}},e.prototype.recalculate=function(t){var e=this;for(var n in e._declarations)e.calculated[n]=e.getLightValue(n,{zoom:t})},e.prototype._applyLightDeclaration=function(t,e,n,i,o){var a=n.transition?this._transitions[t]:void 0,u=this._specifications[t];if(null!==e&&void 0!==e||(e=new s(u,u.default)),!a||a.declaration.json!==e.json){var c=r.extend({duration:300,delay:0},i,this.getLightProperty(t+"-transition")),h=this._transitions[t]=new l(u,e,a,c);h.instant()||(h.loopID=o.set(h.endTime-Date.now())),a&&o.cancel(a.loopID)}},e.prototype.updateLightTransitions=function(t,e,n){var i,r=this;for(i in r._declarations)r._applyLightDeclaration(i,r._declarations[i],t,e,n)},e.prototype._validate=function(t,e){return a.emitErrors(this,t.call(a,r.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:i})))},e}(o);e.exports=u},{"../style-spec/reference/latest":117,"../util/evented":200,"../util/util":212,"./style_declaration":147,"./style_transition":155,"./validate_style":156}],146:[function(t,e,n){"use strict";var i=t("../util/evented"),r=t("./style_layer"),o=t("./image_sprite"),a=t("./light"),s=t("../symbol/glyph_source"),l=t("../symbol/sprite_atlas"),u=t("../render/line_atlas"),c=t("../util/util"),h=t("../util/ajax"),d=t("../util/mapbox"),f=t("../util/browser"),p=t("../util/dispatcher"),m=t("./animation_loop"),v=t("./validate_style"),g=t("../source/source"),y=t("../source/query_features"),_=t("../source/source_cache"),b=t("../style-spec/reference/latest"),x=t("../style-spec/function"),w=t("../util/global_worker_pool"),S=t("../style-spec/deref"),M=t("../style-spec/diff"),E=t("../source/rtl_text_plugin"),z=c.pick(M.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]),k=c.pick(M.operations,["setCenter","setZoom","setBearing","setPitch"]),T=function(t){function e(e,n,i){var r=this;t.call(this),this.map=n,this.animationLoop=n&&n.animationLoop||new m,this.dispatcher=new p(w(),this),this.spriteAtlas=new l(1024,1024),this.spriteAtlas.setEventedParent(this),this.lineAtlas=new u(256,512),this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory={},this._loaded=!1,c.bindAll(["_redoPlacement"],this),this._resetUpdates(),i=c.extend({validate:"string"!=typeof e||!d.isMapboxURL(e)},i),this.setEventedParent(n),this.fire("dataloading",{dataType:"style"});var a=this;this._rtlTextPluginCallback=E.registerForPluginAvailability(function(t){for(var e in a.dispatcher.broadcast("loadRTLTextPlugin",t.pluginBlobURL,t.errorCallback),a.sourceCaches)a.sourceCaches[e].reload()});var g=function(t,e){if(t)r.fire("error",{error:t});else if(!i.validate||!v.emitErrors(r,v(e))){for(var n in r._loaded=!0,r.stylesheet=e,r.updateClasses(),e.sources)r.addSource(n,e.sources[n],i);e.sprite&&(r.sprite=new o(e.sprite,r)),r.glyphSource=new s(e.glyphs),r._resolve(),r.fire("data",{dataType:"style"}),r.fire("style.load")}};"string"==typeof e?h.getJSON(d.normalizeStyleURL(e),g):f.frame(g.bind(this,null,e)),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=r.sourceCaches[t.sourceId].getSource();if(e&&e.vectorLayerIds)for(var n in r._layers){var i=r._layers[n];i.source===e.id&&r._validateLayer(i)}}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(t.sourceLayer&&e){var n=e.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(t.sourceLayer))&&this.fire("error",{error:new Error('Source layer "'+t.sourceLayer+'" does not exist on source "'+n.id+'" as specified by style layer "'+t.id+'"')})}},e.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},e.prototype._resolve=function(){var t=S(this.stylesheet.layers);this._order=t.map(function(t){return t.id}),this._layers={};for(var e=0,n=t;e<n.length;e+=1){var i=n[e];(i=r.create(i)).setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new a(this.stylesheet.light)},e.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},e.prototype._applyClasses=function(t,e){var n=this;if(this._loaded){t=t||[],e=e||{transition:!0};var i=this.stylesheet.transition||{},r=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var o in r){var a=n._layers[o],s=n._updatedPaintProps[o];if(n._updatedAllPaintProps||s.all)a.updatePaintTransitions(t,e,i,n.animationLoop,n.zoomHistory);else for(var l in s)n._layers[o].updatePaintTransition(l,t,e,i,n.animationLoop,n.zoomHistory)}this.light.updateLightTransitions(e,i,this.animationLoop)}},e.prototype._recalculate=function(t){var e=this;if(this._loaded){for(var n in e.sourceCaches)e.sourceCaches[n].used=!1;this._updateZoomHistory(t);for(var i=0,r=e._order;i<r.length;i+=1){var o=r[i],a=e._layers[o];a.recalculate(t),!a.isHidden(t)&&a.source&&(e.sourceCaches[a.source].used=!0)}this.light.recalculate(t);Math.floor(this.z)!==Math.floor(t)&&this.animationLoop.set(300),this.z=t}},e.prototype._updateZoomHistory=function(t){var e=this.zoomHistory;void 0===e.lastIntegerZoom&&(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=0,e.lastZoom=t),Math.floor(e.lastZoom)<Math.floor(t)?(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=Date.now()):Math.floor(e.lastZoom)>Math.floor(t)&&(e.lastIntegerZoom=Math.floor(t+1),e.lastIntegerZoomTime=Date.now()),e.lastZoom=t},e.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},e.prototype.update=function(t,e){var n=this;if(this._changed){var i=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var o in(i.length||r.length||this._updatedSymbolOrder)&&this._updateWorkerLayers(i,r),n._updatedSources){var a=n._updatedSources[o];"reload"===a?n._reloadSource(o):"clear"===a&&n._clearSource(o)}this._applyClasses(t,e),this._resetUpdates(),this.fire("data",{dataType:"style"})}},e.prototype._updateWorkerLayers=function(t,e){var n=this,i=this._updatedSymbolOrder?this._order.filter(function(t){return"symbol"===n._layers[t].type}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e,symbolOrder:i})},e.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSymbolOrder=!1,this._updatedSources={},this._updatedPaintProps={},this._updatedAllPaintProps=!1},e.prototype.setState=function(t){var e=this;if(this._checkLoaded(),v.emitErrors(this,v(t)))return!1;(t=c.extend({},t)).layers=S(t.layers);var n=M(this.serialize(),t).filter(function(t){return!(t.command in k)});if(0===n.length)return!1;var i=n.filter(function(t){return!(t.command in z)});if(i.length>0)throw new Error("Unimplemented: "+i.map(function(t){return t.command}).join(", ")+".");return n.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},e.prototype.addSource=function(t,e,n){var i=this;if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e)+".");if(!(["vector","raster","geojson","video","image","canvas"].indexOf(e.type)>=0)||!this._validate(v.source,"sources."+t,e,null,n)){var r=this.sourceCaches[t]=new _(t,e,this.dispatcher);r.style=this,r.setEventedParent(this,function(){return{isSourceLoaded:i.loaded(),source:r.serialize(),sourceId:t}}),r.onAdd(this.map),this._changed=!0}},e.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");var e=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],e.setEventedParent(null),e.clearTiles(),e.onRemove&&e.onRemove(this.map),this._changed=!0},e.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},e.prototype.addLayer=function(t,e,n){this._checkLoaded();var i=t.id;if("object"==typeof t.source&&(this.addSource(i,t.source),t=c.extend(t,{source:i})),!this._validate(v.layer,"layers."+i,t,{arrayIndex:-1},n)){var o=r.create(t);this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}});var a=e?this._order.indexOf(e):this._order.length;if(this._order.splice(a,0,i),this._layers[i]=o,this._removedLayers[i]&&o.source){var s=this._removedLayers[i];delete this._removedLayers[i],this._updatedSources[o.source]=s.type!==o.type?"clear":"reload"}this._updateLayer(o),"symbol"===o.type&&(this._updatedSymbolOrder=!0),this.updateClasses(i)}},e.prototype.moveLayer=function(t,e){this._checkLoaded(),this._changed=!0;var n=this._layers[t];if(n){var i=this._order.indexOf(t);this._order.splice(i,1);var r=e?this._order.indexOf(e):this._order.length;this._order.splice(r,0,t),"symbol"===n.type&&(this._updatedSymbolOrder=!0,n.source&&!this._updatedSources[n.source]&&(this._updatedSources[n.source]="reload"))}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")})},e.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(e){e.setEventedParent(null);var n=this._order.indexOf(t);this._order.splice(n,1),"symbol"===e.type&&(this._updatedSymbolOrder=!0),this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t]}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")})},e.prototype.getLayer=function(t){return this._layers[t]},e.prototype.setLayerZoomRange=function(t,e,n){this._checkLoaded();var i=this.getLayer(t);return i?void(i.minzoom===e&&i.maxzoom===n||(null!=e&&(i.minzoom=e),null!=n&&(i.maxzoom=n),this._updateLayer(i))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")})},e.prototype.setFilter=function(t,e){this._checkLoaded();var n=this.getLayer(t);return n?void(null!==e&&void 0!==e&&this._validate(v.filter,"layers."+n.id+".filter",e)||c.deepEqual(n.filter,e)||(n.filter=c.clone(e),this._updateLayer(n))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")})},e.prototype.getFilter=function(t){return c.clone(this.getLayer(t).filter)},e.prototype.setLayoutProperty=function(t,e,n){this._checkLoaded();var i=this.getLayer(t);return i?void(c.deepEqual(i.getLayoutProperty(e),n)||(i.setLayoutProperty(e,n),this._updateLayer(i))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},e.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},e.prototype.setPaintProperty=function(t,e,n,i){this._checkLoaded();var r=this.getLayer(t);if(r){if(!c.deepEqual(r.getPaintProperty(e,i),n)){var o=r.isPaintValueFeatureConstant(e);r.setPaintProperty(e,n,i),!(n&&x.isFunctionDefinition(n)&&"$zoom"!==n.property&&void 0!==n.property)&&o||this._updateLayer(r),this.updateClasses(t,e)}}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},e.prototype.getPaintProperty=function(t,e,n){return this.getLayer(t).getPaintProperty(e,n)},e.prototype.getTransition=function(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},e.prototype.updateClasses=function(t,e){if(this._changed=!0,t){var n=this._updatedPaintProps;n[t]||(n[t]={}),n[t][e||"all"]=!0}else this._updatedAllPaintProps=!0},e.prototype.serialize=function(){var t=this;return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:c.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(e){return t._layers[e].serialize()})},function(t){return void 0!==t})},e.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload"),this._changed=!0},e.prototype._flattenRenderedFeatures=function(t){for(var e=[],n=this._order.length-1;n>=0;n--)for(var i=this._order[n],r=0,o=t;r<o.length;r+=1){var a=o[r][i];if(a)for(var s=0,l=a;s<l.length;s+=1){var u=l[s];e.push(u)}}return e},e.prototype.queryRenderedFeatures=function(t,e,n,i){var r=this;e&&e.filter&&this._validate(v.filter,"queryRenderedFeatures.filter",e.filter);var o={};if(e&&e.layers){if(!Array.isArray(e.layers))return void this.fire("error",{error:"parameters.layers must be an Array."});for(var a=0,s=e.layers;a<s.length;a+=1){var l=s[a],u=r._layers[l];if(!u)return void r.fire("error",{error:"The layer '"+l+"' does not exist in the map's style and cannot be queried for features."});o[u.source]=!0}}var c=[];for(var h in r.sourceCaches)if(!e.layers||o[h]){var d=y.rendered(r.sourceCaches[h],r._layers,t,e,n,i);c.push(d)}return this._flattenRenderedFeatures(c)},e.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(v.filter,"querySourceFeatures.filter",e.filter);var n=this.sourceCaches[t];return n?y.source(n,e):[]},e.prototype.addSourceType=function(t,e,n){return g.getType(t)?n(new Error('A source type called "'+t+'" already exists.')):(g.setType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},e.prototype.getLight=function(){return this.light.getLight()},e.prototype.setLight=function(t,e){this._checkLoaded();var n=this.light.getLight(),i=!1;for(var r in t)if(!c.deepEqual(t[r],n[r])){i=!0;break}if(i){var o=this.stylesheet.transition||{};this.light.setLight(t),this.light.updateLightTransitions(e||{transition:!0},o,this.animationLoop)}},e.prototype._validate=function(t,e,n,i,r){return(!r||!1!==r.validate)&&v.emitErrors(this,t.call(v,c.extend({key:e,style:this.serialize(),value:n,styleSpec:b},i)))},e.prototype._remove=function(){for(var t in E.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[t].clearTiles();this.dispatcher.remove()},e.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},e.prototype._reloadSource=function(t){this.sourceCaches[t].reload()},e.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},e.prototype._redoPlacement=function(){for(var t in this.sourceCaches)this.sourceCaches[t].redoPlacement()},e.prototype.getIcons=function(t,e,n){var i=this,r=function(){i.spriteAtlas.setSprite(i.sprite),i.spriteAtlas.addIcons(e.icons,n)};!this.sprite||this.sprite.loaded()?r():this.sprite.on("data",r)},e.prototype.getGlyphs=function(t,e,n){function i(t,e,i){t&&console.error(t),a[i]=e,0===--o&&n(null,a)}var r=e.stacks,o=Object.keys(r).length,a={};for(var s in r)this.glyphSource.getSimpleGlyphs(s,r[s],e.uid,i)},e}(i);e.exports=T},{"../render/line_atlas":76,"../source/query_features":88,"../source/rtl_text_plugin":90,"../source/source":91,"../source/source_cache":92,"../style-spec/deref":100,"../style-spec/diff":101,"../style-spec/function":105,"../style-spec/reference/latest":117,"../symbol/glyph_source":165,"../symbol/sprite_atlas":170,"../util/ajax":191,"../util/browser":192,"../util/dispatcher":198,"../util/evented":200,"../util/global_worker_pool":202,"../util/mapbox":208,"../util/util":212,"./animation_loop":143,"./image_sprite":144,"./light":145,"./style_layer":148,"./validate_style":156}],147:[function(t,e,n){"use strict";var i=t("../style-spec/function"),r=t("../util/util"),o=function(t,e){var n=this;if(this.value=r.clone(e),this.isFunction=i.isFunctionDefinition(e),this.json=JSON.stringify(this.value),this.minimum=t.minimum,this.function=i(this.value,t),this.isFeatureConstant=this.function.isFeatureConstant,this.isZoomConstant=this.function.isZoomConstant,!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];for(var o=[],a=0,s=n.value.stops;a<s.length;a+=1){var l=s[a][0].zoom;n.stopZoomLevels.indexOf(l)<0&&(n.stopZoomLevels.push(l),o.push([l,o.length]))}this.functionInterpolationT=i({type:"exponential",stops:o,base:e.base},{type:"number"})}};o.prototype.calculate=function(t,e){var n=this.function(t&&t.zoom,e||{});return void 0!==this.minimum&&n<this.minimum?this.minimum:n},o.prototype.calculateInterpolationT=function(t,e){return this.functionInterpolationT(t&&t.zoom,e||{})},e.exports=o},{"../style-spec/function":105,"../util/util":212}],148:[function(t,e,n){"use strict";function i(t){return t.value}var r=t("../util/util"),o=t("./style_transition"),a=t("./style_declaration"),s=t("../style-spec/reference/latest"),l=t("./validate_style"),u=t("./../style-spec/util/parse_color"),c=function(t){function e(e){var n=this;t.call(this),this.id=e.id,this.metadata=e.metadata,this.type=e.type,this.source=e.source,this.sourceLayer=e["source-layer"],this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.filter=e.filter,this.paint={},this.layout={},this._paintSpecifications=s["paint_"+this.type],this._layoutSpecifications=s["layout_"+this.type],this._paintTransitions={},this._paintTransitionOptions={},this._paintDeclarations={},this._layoutDeclarations={},this._layoutFunctions={};var i,r,o={validate:!1};for(var a in e){var l=a.match(/^paint(?:\.(.*))?$/);if(l){var u=l[1]||"";for(i in e[a])n.setPaintProperty(i,e[a][i],u,o)}}for(r in e.layout)n.setLayoutProperty(r,e.layout[r],o);for(i in n._paintSpecifications)n.paint[i]=n.getPaintValue(i);for(r in n._layoutSpecifications)n._updateLayoutValue(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setLayoutProperty=function(t,e,n){if(null==e)delete this._layoutDeclarations[t];else{var i="layers."+this.id+".layout."+t;if(this._validate(l.layoutProperty,i,t,e,n))return;this._layoutDeclarations[t]=new a(this._layoutSpecifications[t],e)}this._updateLayoutValue(t)},e.prototype.getLayoutProperty=function(t){return this._layoutDeclarations[t]&&this._layoutDeclarations[t].value},e.prototype.getLayoutValue=function(t,e,n){var i=this._layoutSpecifications[t],r=this._layoutDeclarations[t];return r?r.calculate(e,n):i.default},e.prototype.setPaintProperty=function(t,e,n,i){var o="layers."+this.id+(n?'["paint.'+n+'"].':".paint.")+t;if(r.endsWith(t,"-transition"))if(this._paintTransitionOptions[n||""]||(this._paintTransitionOptions[n||""]={}),null===e||void 0===e)delete this._paintTransitionOptions[n||""][t];else{if(this._validate(l.paintProperty,o,t,e,i))return;this._paintTransitionOptions[n||""][t]=e}else if(this._paintDeclarations[n||""]||(this._paintDeclarations[n||""]={}),null===e||void 0===e)delete this._paintDeclarations[n||""][t];else{if(this._validate(l.paintProperty,o,t,e,i))return;this._paintDeclarations[n||""][t]=new a(this._paintSpecifications[t],e)}},e.prototype.getPaintProperty=function(t,e){return e=e||"",r.endsWith(t,"-transition")?this._paintTransitionOptions[e]&&this._paintTransitionOptions[e][t]:this._paintDeclarations[e]&&this._paintDeclarations[e][t]&&this._paintDeclarations[e][t].value},e.prototype.getPaintValue=function(t,e,n){var i=this._paintSpecifications[t],r=this._paintTransitions[t];return r?r.calculate(e,n):"color"===i.type&&i.default?u(i.default):i.default},e.prototype.getPaintValueStopZoomLevels=function(t){var e=this._paintTransitions[t];return e?e.declaration.stopZoomLevels:[]},e.prototype.getPaintInterpolationT=function(t,e){return this._paintTransitions[t].declaration.calculateInterpolationT(e)},e.prototype.isPaintValueFeatureConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isFeatureConstant},e.prototype.isLayoutValueFeatureConstant=function(t){var e=this._layoutDeclarations[t];return!e||e.isFeatureConstant},e.prototype.isPaintValueZoomConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isZoomConstant},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.layout.visibility},e.prototype.updatePaintTransitions=function(t,e,n,i,o){for(var a=this,s=r.extend({},this._paintDeclarations[""]),l=0;l<t.length;l++)r.extend(s,a._paintDeclarations[t[l]]);var u;for(u in s)a._applyPaintDeclaration(u,s[u],e,n,i,o);for(u in a._paintTransitions)u in s||a._applyPaintDeclaration(u,null,e,n,i,o)},e.prototype.updatePaintTransition=function(t,e,n,i,r,o){for(var a=this._paintDeclarations[""][t],s=0;s<e.length;s++){var l=this._paintDeclarations[e[s]];l&&l[t]&&(a=l[t])}this._applyPaintDeclaration(t,a,n,i,r,o)},e.prototype.recalculate=function(t){var e=this;for(var n in e._paintTransitions)e.paint[n]=e.getPaintValue(n,{zoom:t});for(var i in e._layoutFunctions)e.layout[i]=e.getLayoutValue(i,{zoom:t})},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:r.mapObject(this._layoutDeclarations,i)};for(var e in this._paintDeclarations){t[""===e?"paint":"paint."+e]=r.mapObject(this._paintDeclarations[e],i)}return r.filterObject(t,function(t,e){return void 0!==t&&!("layout"===e&&!Object.keys(t).length)})},e.prototype._applyPaintDeclaration=function(t,e,n,i,s,l){var u=n.transition?this._paintTransitions[t]:void 0,c=this._paintSpecifications[t];if(null!==e&&void 0!==e||(e=new a(c,c.default)),!u||u.declaration.json!==e.json){var h=r.extend({duration:300,delay:0},i,this.getPaintProperty(t+"-transition")),d=this._paintTransitions[t]=new o(c,e,u,h,l);d.instant()||(d.loopID=s.set(d.endTime-Date.now())),u&&s.cancel(u.loopID)}},e.prototype._updateLayoutValue=function(t){var e=this._layoutDeclarations[t];e&&e.isFunction?this._layoutFunctions[t]=!0:(delete this._layoutFunctions[t],this.layout[t]=this.getLayoutValue(t))},e.prototype._validate=function(t,e,n,i,r){return(!r||!1!==r.validate)&&l.emitErrors(this,t.call(l,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:s,style:{glyphs:!0,sprite:!0}}))},e}(t("../util/evented"));e.exports=c;var h={circle:t("./style_layer/circle_style_layer"),fill:t("./style_layer/fill_style_layer"),"fill-extrusion":t("./style_layer/fill_extrusion_style_layer"),line:t("./style_layer/line_style_layer"),symbol:t("./style_layer/symbol_style_layer")};c.create=function(t){return new(h[t.type]||c)(t)}},{"../style-spec/reference/latest":117,"../util/evented":200,"../util/util":212,"./../style-spec/util/parse_color":121,"./style_declaration":147,"./style_layer/circle_style_layer":149,"./style_layer/fill_extrusion_style_layer":150,"./style_layer/fill_style_layer":151,"./style_layer/line_style_layer":152,"./style_layer/symbol_style_layer":153,"./style_transition":155,"./validate_style":156}],149:[function(t,e,n){"use strict";var i=t("../style_layer"),r=t("../../data/bucket/circle_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new r(t)},e}(i);e.exports=o},{"../../data/bucket/circle_bucket":46,"../style_layer":148}],150:[function(t,e,n){"use strict";var i=t("../style_layer"),r=t("../../data/bucket/fill_extrusion_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,n,i){var r=t.prototype.getPaintValue.call(this,e,n,i);return"fill-extrusion-color"===e&&r&&(r[3]=1),r},e.prototype.createBucket=function(t){return new r(t)},e}(i);e.exports=o},{"../../data/bucket/fill_extrusion_bucket":48,"../style_layer":148}],151:[function(t,e,n){"use strict";var i=t("../style_layer"),r=t("../../data/bucket/fill_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,n,i){if("fill-outline-color"===e){if(void 0===this.getPaintProperty("fill-outline-color"))return t.prototype.getPaintValue.call(this,"fill-color",n,i);for(var r=this._paintTransitions["fill-outline-color"];r;){if(!(r&&r.declaration&&r.declaration.value))return t.prototype.getPaintValue.call(this,"fill-color",n,i);r=r.oldTransition}}return t.prototype.getPaintValue.call(this,e,n,i)},e.prototype.getPaintValueStopZoomLevels=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintValueStopZoomLevels.call(this,"fill-color"):t.prototype.getPaintValueStopZoomLevels.call(this,e)},e.prototype.getPaintInterpolationT=function(e,n){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintInterpolationT.call(this,"fill-color",n):t.prototype.getPaintInterpolationT.call(this,e,n)},e.prototype.isPaintValueFeatureConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueFeatureConstant.call(this,"fill-color"):t.prototype.isPaintValueFeatureConstant.call(this,e)},e.prototype.isPaintValueZoomConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueZoomConstant.call(this,"fill-color"):t.prototype.isPaintValueZoomConstant.call(this,e)},e.prototype.createBucket=function(t){return new r(t)},e}(i);e.exports=o},{"../../data/bucket/fill_bucket":47,"../style_layer":148}],152:[function(t,e,n){"use strict";var i=t("../style_layer"),r=t("../../data/bucket/line_bucket"),o=t("../../util/util"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,n,i){var r=t.prototype.getPaintValue.call(this,e,n,i);if(r&&"line-dasharray"===e){var a=this.getPaintValue("line-width",o.extend({},n,{zoom:Math.floor(n.zoom)}),i);r.fromScale*=a,r.toScale*=a}return r},e.prototype.createBucket=function(t){return new r(t)},e}(i);e.exports=a},{"../../data/bucket/line_bucket":49,"../../util/util":212,"../style_layer":148}],153:[function(t,e,n){"use strict";var i=t("../style_layer"),r=t("../../data/bucket/symbol_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,n,i){var r=t.prototype.getLayoutValue.call(this,e,n,i);if("auto"!==r)return r;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",n,i)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",n,i);default:return r}},e.prototype.createBucket=function(t){return new r(t)},e}(i);e.exports=o},{"../../data/bucket/symbol_bucket":50,"../style_layer":148}],154:[function(t,e,n){"use strict";var i=t("./style_layer"),r=t("../util/util"),o=t("../style-spec/feature_filter"),a=t("../style-spec/group_by_layout"),s=function(t){t&&this.replace(t)};s.prototype.replace=function(t){this.symbolOrder=[];for(var e=0,n=t;e<n.length;e+=1){var i=n[e];"symbol"===i.type&&this.symbolOrder.push(i.id)}this._layerConfigs={},this._layers={},this.update(t,[])},s.prototype.update=function(t,e,n){for(var s=this,l=0,u=t;l<u.length;l+=1){var c=u[l];s._layerConfigs[c.id]=c;var h=s._layers[c.id]=i.create(c);h.updatePaintTransitions({},{transition:!1}),h.filter=o(h.filter)}for(var d=0,f=e;d<f.length;d+=1){var p=f[d];delete s._layerConfigs[p],delete s._layers[p]}n&&(this.symbolOrder=n),this.familiesBySource={};for(var m=0,v=a(r.values(this._layerConfigs));m<v.length;m+=1){var g=v[m].map(function(t){return s._layers[t.id]}),y=g[0];if(!y.layout||"none"!==y.layout.visibility){var _=y.source||"",b=s.familiesBySource[_];b||(b=s.familiesBySource[_]={});var x=y.sourceLayer||"_geojsonTileLayer",w=b[x];w||(w=b[x]=[]),w.push(g)}}},e.exports=s},{"../style-spec/feature_filter":103,"../style-spec/group_by_layout":106,"../util/util":212,"./style_layer":148}],155:[function(t,e,n){"use strict";function i(t,e,n){if(void 0!==t&&void 0!==e)return{from:t.to,fromScale:t.toScale,to:e.to,toScale:e.toScale,t:n}}var r=t("../util/util"),o=t("../util/interpolate"),a={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0},s=function(t,e,n,r,s){this.declaration=e,this.startTime=this.endTime=(new Date).getTime(),this.oldTransition=n,this.duration=r.duration||0,this.delay=r.delay||0,this.zoomTransitioned="piecewise-constant"===t.function&&t.transition,this.interp=this.zoomTransitioned?i:o[t.type],this.zoomHistory=s||a,this.instant()||(this.endTime=this.startTime+this.duration+this.delay),n&&n.endTime<=this.startTime&&delete n.oldTransition};s.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},s.prototype.calculate=function(t,e,n){var i=this._calculateTargetValue(t,e);if(this.instant())return i;if((n=n||Date.now())>=this.endTime)return i;var o=this.oldTransition.calculate(t,e,this.startTime),a=r.easeCubicInOut((n-this.startTime-this.delay)/this.duration);return this.interp(o,i,a)},s.prototype._calculateTargetValue=function(t,e){if(!this.zoomTransitioned)return this.declaration.calculate(t,e);var n=t.zoom,i=this.zoomHistory.lastIntegerZoom,r=n>i?2:.5,a=this.declaration.calculate({zoom:n>i?n-1:n+1},e),s=this.declaration.calculate({zoom:n},e),l=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1),u=Math.abs(n-i),c=o(l,1,u);return void 0!==a&&void 0!==s?{from:a,fromScale:r,to:s,toScale:1,t:c}:void 0},e.exports=s},{"../util/interpolate":204,"../util/util":212}],156:[function(t,e,n){"use strict";e.exports=t("../style-spec/validate_style.min"),e.exports.emitErrors=function(t,e){if(e&&e.length){for(var n=0;n<e.length;n++)t.fire("error",{error:new Error(e[n].message)});return!0}return!1}},{"../style-spec/validate_style.min":142}],157:[function(t,e,n){"use strict";var i=function(t){function e(e,n,i,r){t.call(this,e,n),this.angle=i,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(t("point-geometry"));e.exports=i},{"point-geometry":26}],158:[function(t,e,n){"use strict";e.exports=function(t,e,n,i,r){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<n/2;){var c=t[a-1],h=t[a],d=t[a+1];if(!d)return!1;var f=c.angleTo(h)-h.angleTo(d);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:f}),u+=f;s-l[0].distance>i;)u-=l.shift().angleDelta;if(u>r)return!1;a++,s+=h.dist(d)}return!0}},{}],159:[function(t,e,n){"use strict";var i=t("point-geometry");e.exports=function(t,e,n,r,o){for(var a=[],s=0;s<t.length;s++)for(var l=t[s],u=void 0,c=0;c<l.length-1;c++){var h=l[c],d=l[c+1];h.x<e&&d.x<e||(h.x<e?h=new i(e,h.y+(d.y-h.y)*((e-h.x)/(d.x-h.x)))._round():d.x<e&&(d=new i(e,h.y+(d.y-h.y)*((e-h.x)/(d.x-h.x)))._round()),h.y<n&&d.y<n||(h.y<n?h=new i(h.x+(d.x-h.x)*((n-h.y)/(d.y-h.y)),n)._round():d.y<n&&(d=new i(h.x+(d.x-h.x)*((n-h.y)/(d.y-h.y)),n)._round()),h.x>=r&&d.x>=r||(h.x>=r?h=new i(r,h.y+(d.y-h.y)*((r-h.x)/(d.x-h.x)))._round():d.x>=r&&(d=new i(r,h.y+(d.y-h.y)*((r-h.x)/(d.x-h.x)))._round()),h.y>=o&&d.y>=o||(h.y>=o?h=new i(h.x+(d.x-h.x)*((o-h.y)/(d.y-h.y)),o)._round():d.y>=o&&(d=new i(h.x+(d.x-h.x)*((o-h.y)/(d.y-h.y)),o)._round()),u&&h.equals(u[u.length-1])||(u=[h],a.push(u)),u.push(d)))))}return a}},{"point-geometry":26}],160:[function(t,e,n){"use strict";var i=t("../util/struct_array"),r=t("point-geometry"),o=i({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(o.prototype.StructType.prototype,"anchorPoint",{get:function(){return new r(this.anchorPointX,this.anchorPointY)}}),e.exports=o},{"../util/struct_array":210,"point-geometry":26}],161:[function(t,e,n){"use strict";var i=function(t,e,n,i,r,o,a,s,l,u,c){var h=a.top*s-l,d=a.bottom*s+l,f=a.left*s-l,p=a.right*s+l;if(this.boxStartIndex=t.length,u){var m=d-h,v=p-f;if(m>0)if(m=Math.max(10*s,m),c){var g=e[n.segment+1].sub(e[n.segment])._unit()._mult(v),y=[n.sub(g),n.add(g)];this._addLineCollisionBoxes(t,y,n,0,v,m,i,r,o)}else this._addLineCollisionBoxes(t,e,n,n.segment,v,m,i,r,o)}else t.emplaceBack(n.x,n.y,f,h,p,d,1/0,i,r,o,0,0,0,0,0);this.boxEndIndex=t.length};i.prototype._addLineCollisionBoxes=function(t,e,n,i,r,o,a,s,l){var u=o/2,c=Math.floor(r/u),h=-o/2,d=this.boxes,f=n,p=i+1,m=h;do{if(--p<0)return d;m-=e[p].dist(f),f=e[p]}while(m>-r/2);for(var v=e[p].dist(e[p+1]),g=0;g<c;g++){for(var y=-r/2+g*u;m+v<y;){if(m+=v,++p+1>=e.length)return d;v=e[p].dist(e[p+1])}var _=y-m,b=e[p],x=e[p+1].sub(b)._unit()._mult(_)._add(b)._round(),w=r/2/Math.max(Math.abs(y-h)-u/2,0);t.emplaceBack(x.x,x.y,-o/2,-o/2,o/2,o/2,w,a,s,l,0,0,0,0,0)}return d},e.exports=i},{}],162:[function(t,e,n){"use strict";var i=t("point-geometry"),r=t("../data/extent"),o=t("grid-index"),a=t("../util/intersection_tests"),s=function(t,e,n){if("object"==typeof t){var i=t;n=e,t=i.angle,e=i.pitch,this.grid=new o(i.grid),this.ignoredGrid=new o(i.ignoredGrid)}else this.grid=new o(r,12,6),this.ignoredGrid=new o(r,12,0);this.minScale=.5,this.maxScale=2,this.angle=t,this.pitch=e;var a=Math.sin(t),s=Math.cos(t);if(this.rotationMatrix=[s,-a,a,s],this.reverseRotationMatrix=[s,a,-a,s],this.yStretch=1/Math.cos(e/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3),this.collisionBoxArray=n,0===n.length){n.emplaceBack();var l=32767;n.emplaceBack(0,0,0,-l,0,l,l,0,0,0,0,0,0,0,0,0),n.emplaceBack(r,0,0,-l,0,l,l,0,0,0,0,0,0,0,0,0),n.emplaceBack(0,0,-l,0,l,0,l,0,0,0,0,0,0,0,0,0),n.emplaceBack(0,r,-l,0,l,0,l,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=n.get(0),this.edges=[n.get(1),n.get(2),n.get(3),n.get(4)]};s.prototype.serialize=function(t){var e=this.grid.toArrayBuffer(),n=this.ignoredGrid.toArrayBuffer();return t&&(t.push(e),t.push(n)),{angle:this.angle,pitch:this.pitch,grid:e,ignoredGrid:n}},s.prototype.placeCollisionFeature=function(t,e,n){for(var r=this,o=this.collisionBoxArray,a=this.minScale,s=this.rotationMatrix,l=this.yStretch,u=t.boxStartIndex;u<t.boxEndIndex;u++){var c=o.get(u),h=c.anchorPoint._matMult(s),d=h.x,f=h.y,p=d+c.x1,m=f+c.y1*l,v=d+c.x2,g=f+c.y2*l;if(c.bbox0=p,c.bbox1=m,c.bbox2=v,c.bbox3=g,!e)for(var y=r.grid.query(p,m,v,g),_=0;_<y.length;_++){var b=o.get(y[_]),x=b.anchorPoint._matMult(s);if((a=r.getPlacementScale(a,h,c,x,b))>=r.maxScale)return a}if(n){var w=void 0;if(r.angle){var S=r.reverseRotationMatrix,M=new i(c.x1,c.y1).matMult(S),E=new i(c.x2,c.y1).matMult(S),z=new i(c.x1,c.y2).matMult(S),k=new i(c.x2,c.y2).matMult(S);(w=r.tempCollisionBox).anchorPointX=c.anchorPoint.x,w.anchorPointY=c.anchorPoint.y,w.x1=Math.min(M.x,E.x,z.x,k.x),w.y1=Math.min(M.y,E.x,z.x,k.x),w.x2=Math.max(M.x,E.x,z.x,k.x),w.y2=Math.max(M.y,E.x,z.x,k.x),w.maxScale=c.maxScale}else w=c;for(var T=0;T<this.edges.length;T++){var O=r.edges[T];if((a=r.getPlacementScale(a,c.anchorPoint,w,O.anchorPoint,O))>=r.maxScale)return a}}}return a},s.prototype.queryRenderedSymbols=function(t,e){var n={},r=[];if(0===t.length||0===this.grid.length&&0===this.ignoredGrid.length)return r;for(var o=this.collisionBoxArray,s=this.rotationMatrix,l=this.yStretch,u=[],c=1/0,h=1/0,d=-1/0,f=-1/0,p=0;p<t.length;p++)for(var m=t[p],v=0;v<m.length;v++){var g=m[v].matMult(s);c=Math.min(c,g.x),h=Math.min(h,g.y),d=Math.max(d,g.x),f=Math.max(f,g.y),u.push(g)}for(var y=this.grid.query(c,h,d,f),_=this.ignoredGrid.query(c,h,d,f),b=0;b<_.length;b++)y.push(_[b]);for(var x=Math.pow(2,Math.ceil(Math.log(e)/Math.LN2*10)/10),w=0;w<y.length;w++){var S=o.get(y[w]),M=S.sourceLayerIndex,E=S.featureIndex;if(void 0===n[M]&&(n[M]={}),!n[M][E]&&!(x<S.placementScale||x>S.maxScale)){var z=S.anchorPoint.matMult(s),k=z.x+S.x1/e,T=z.y+S.y1/e*l,O=z.x+S.x2/e,P=z.y+S.y2/e*l,C=[new i(k,T),new i(O,T),new i(O,P),new i(k,P)];a.polygonIntersectsPolygon(u,C)&&(n[M][E]=!0,r.push(y[w]))}}return r},s.prototype.getPlacementScale=function(t,e,n,i,r){var o=e.x-i.x,a=e.y-i.y,s=(r.x1-n.x2)/o,l=(r.x2-n.x1)/o,u=(r.y1-n.y2)*this.yStretch/a,c=(r.y2-n.y1)*this.yStretch/a;(isNaN(s)||isNaN(l))&&(s=l=1),(isNaN(u)||isNaN(c))&&(u=c=1);var h=Math.min(Math.max(s,l),Math.max(u,c)),d=r.maxScale,f=n.maxScale;return h>d&&(h=d),h>f&&(h=f),h>t&&h>=r.placementScale&&(t=h),t},s.prototype.insertCollisionFeature=function(t,e,n){for(var i=n?this.ignoredGrid:this.grid,r=this.collisionBoxArray,o=t.boxStartIndex;o<t.boxEndIndex;o++){var a=r.get(o);a.placementScale=e,e<this.maxScale&&i.insert(o,a.bbox0,a.bbox1,a.bbox2,a.bbox3)}},e.exports=s},{"../data/extent":54,"../util/intersection_tests":205,"grid-index":16,"point-geometry":26}],163:[function(t,e,n){"use strict";var i=t("../util/interpolate"),r=t("../symbol/anchor"),o=t("./check_max_angle");e.exports=function(t,e,n,a,s,l,u,c,h){var d=a?.6*l*u:0,f=Math.max(a?a.right-a.left:0,s?s.right-s.left:0),p=0===t[0].x||t[0].x===h||0===t[0].y||t[0].y===h;return e-f*u<e/4&&(e=f*u+e/4),function t(e,n,a,s,l,u,c,h,d){for(var f=u/2,p=0,m=0;m<e.length-1;m++)p+=e[m].dist(e[m+1]);for(var v=0,g=n-a,y=[],_=0;_<e.length-1;_++){for(var b=e[_],x=e[_+1],w=b.dist(x),S=x.angleTo(b);g+a<v+w;){var M=((g+=a)-v)/w,E=i(b.x,x.x,M),z=i(b.y,x.y,M);if(E>=0&&E<d&&z>=0&&z<d&&g-f>=0&&g+f<=p){var k=new r(E,z,S,_)._round();s&&!o(e,k,u,s,l)||y.push(k)}}v+=w}return h||y.length||c||(y=t(e,v/2,a,s,l,u,c,!0,d)),y}(t,p?e/2*c%e:(f/2+2*l)*u*c%e,e,d,n,f*u,p,!1,h)}},{"../symbol/anchor":157,"../util/interpolate":204,"./check_max_angle":158}],164:[function(t,e,n){"use strict";var i=t("@mapbox/shelf-pack"),r=t("../util/util"),o=function(){this.width=128,this.height=128,this.atlas=new i(this.width,this.height),this.index={},this.ids={},this.data=new Uint8Array(this.width*this.height)};o.prototype.getGlyphs=function(){var t,e,n,i={};for(var r in this.ids)e=(t=r.split("#"))[0],n=t[1],i[e]||(i[e]=[]),i[e].push(n);return i},o.prototype.getRects=function(){var t,e,n,i={};for(var r in this.ids)e=(t=r.split("#"))[0],n=t[1],i[e]||(i[e]={}),i[e][n]=this.index[r];return i},o.prototype.addGlyph=function(t,e,n,i){if(!n)return null;var o=e+"#"+n.id;if(this.index[o])return this.ids[o].indexOf(t)<0&&this.ids[o].push(t),this.index[o];if(!n.bitmap)return null;var a=n.width+2*i,s=n.height+2*i,l=a+2,u=s+2;l+=4-l%4,u+=4-u%4;var c=this.atlas.packOne(l,u);if(c||(this.resize(),c=this.atlas.packOne(l,u)),!c)return r.warnOnce("glyph bitmap overflow"),null;this.index[o]=c,this.ids[o]=[t];for(var h=this.data,d=n.bitmap,f=0;f<s;f++)for(var p=this.width*(c.y+f+1)+c.x+1,m=a*f,v=0;v<a;v++)h[p+v]=d[m+v];return this.dirty=!0,c},o.prototype.resize=function(){var t=this.width,e=this.height;if(!(t>=2048||e>=2048)){this.texture&&(this.gl&&this.gl.deleteTexture(this.texture),this.texture=null),this.width*=4,this.height*=4,this.atlas.resize(this.width,this.height);for(var n=new ArrayBuffer(this.width*this.height),i=0;i<e;i++){var r=new Uint8Array(this.data.buffer,e*i,t);new Uint8Array(n,e*i*4,t).set(r)}this.data=new Uint8Array(n)}},o.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},o.prototype.updateTexture=function(t){this.bind(t),this.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.dirty=!1)},e.exports=o},{"../util/util":212,"@mapbox/shelf-pack":2}],165:[function(t,e,n){"use strict";var i=t("../util/mapbox").normalizeGlyphsURL,r=t("../util/ajax"),o=t("../util/verticalize_punctuation"),a=t("../util/glyphs"),s=t("../symbol/glyph_atlas"),l=t("pbf"),u=function(t,e,n){this.advance=t.advance,this.left=t.left-n-1,this.top=t.top+n+1,this.rect=e},c=function(t){this.url=t&&i(t),this.atlases={},this.stacks={},this.loading={}};c.prototype.getSimpleGlyphs=function(t,e,n,i){var r=this;void 0===this.stacks[t]&&(this.stacks[t]={}),void 0===this.atlases[t]&&(this.atlases[t]=new s);for(var a={},l=this.stacks[t],c=this.atlases[t],h={},d=0,f=function(e){var i=Math.floor(e/256);if(l[i]){var r=l[i].glyphs[e],o=c.addGlyph(n,t,r,3);r&&(a[e]=new u(r,o,3))}else void 0===h[i]&&(h[i]=[],d++),h[i].push(e)},p=0;p<e.length;p++){var m=e[p],v=String.fromCharCode(m);f(m),o.lookup[v]&&f(o.lookup[v].charCodeAt(0))}d||i(void 0,a,t);var g=function(e,o,s){if(!e)for(var l=r.stacks[t][o]=s.stacks[0],f=0;f<h[o].length;f++){var p=h[o][f],m=l.glyphs[p],v=c.addGlyph(n,t,m,3);m&&(a[p]=new u(m,v,3))}--d||i(void 0,a,t)};for(var y in h)r.loadRange(t,y,g)},c.prototype.loadRange=function(t,e,n){if(256*e>65535)return n("glyphs > 65535 not supported");void 0===this.loading[t]&&(this.loading[t]={});var i=this.loading[t];if(i[e])i[e].push(n);else{i[e]=[n];var o=function(t,e,n,i){return i=i||"abc",n.replace("{s}",i[t.length%i.length]).replace("{fontstack}",t).replace("{range}",e)}(t,256*e+"-"+(256*e+255),this.url);r.getArrayBuffer(o,function(t,n){for(var r=!t&&new a(new l(n.data)),o=0;o<i[e].length;o++)i[e][o](t,e,r);delete i[e]})}},c.prototype.getGlyphAtlas=function(t){return this.atlases[t]},e.exports=c},{"../symbol/glyph_atlas":164,"../util/ajax":191,"../util/glyphs":203,"../util/mapbox":208,"../util/verticalize_punctuation":214,pbf:25}],166:[function(t,e,n){"use strict";e.exports=function(t){function e(e){s.push(t[e]),l++}function n(t,e,n){var i=a[t];return delete a[t],a[e]=i,s[i].geometry[0].pop(),s[i].geometry[0]=s[i].geometry[0].concat(n[0]),i}function i(t,e,n){var i=o[e];return delete o[e],o[t]=i,s[i].geometry[0].shift(),s[i].geometry[0]=n[0].concat(s[i].geometry[0]),i}function r(t,e,n){var i=n?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var o={},a={},s=[],l=0,u=0;u<t.length;u++){var c=t[u],h=c.geometry,d=c.text;if(d){var f=r(d,h),p=r(d,h,!0);if(f in a&&p in o&&a[f]!==o[p]){var m=i(f,p,h),v=n(f,p,s[m].geometry);delete o[f],delete a[p],a[r(d,s[v].geometry,!0)]=v,s[m].geometry=null}else f in a?n(f,p,h):p in o?i(f,p,h):(e(u),o[f]=l-1,a[p]=l-1)}else e(u)}return s.filter(function(t){return t.geometry})}},{}],167:[function(t,e,n){"use strict";function i(t,e,n,i,r,o,a,s,l,u,c){this.anchorPoint=t,this.tl=e,this.tr=n,this.bl=i,this.br=r,this.tex=o,this.anchorAngle=a,this.glyphAngle=s,this.minScale=l,this.maxScale=u,this.writingMode=c}function r(t,e,n,i,r,s){var l=!s;n<0&&(s=!s),s&&r++;var u=new o(e.x,e.y),c=i[r],h=1/0;n=Math.abs(n);for(var d=a;;){var f=u.dist(c),p=n/f,m=Math.atan2(c.y-u.y,c.x-u.x);if(s||(m+=Math.PI),t.push({anchorPoint:u,offset:l?Math.PI:0,minScale:p,maxScale:h,angle:(m+2*Math.PI)%(2*Math.PI)}),p<=d)break;for(u=c;u.equals(c);)if(!(c=i[r+=s?1:-1]))return p;var v=c.sub(u)._unit();u=u.sub(v._mult(f)),h=p}return d}var o=t("point-geometry");e.exports={getIconQuads:function(t,e,n,r,s,l,u,c,h){var d,f,p,m,v=e.image.rect,g=s.layout,y=e.left-1,_=y+v.w/e.image.pixelRatio,b=e.top-1,x=b+v.h/e.image.pixelRatio;if("none"!==g["icon-text-fit"]&&u){var w=_-y,S=x-b,M=g["text-size"]/24,E=u.left*M,z=u.right*M,k=u.top*M,T=z-E,O=u.bottom*M-k,P=g["icon-text-fit-padding"][0],C=g["icon-text-fit-padding"][1],A=g["icon-text-fit-padding"][2],I=g["icon-text-fit-padding"][3],L="width"===g["icon-text-fit"]?.5*(O-S):0,j="height"===g["icon-text-fit"]?.5*(T-w):0,D="width"===g["icon-text-fit"]||"both"===g["icon-text-fit"]?T:w,R="height"===g["icon-text-fit"]||"both"===g["icon-text-fit"]?O:S;d=new o(E+j-I,k+L-P),f=new o(E+j+C+D,k+L-P),p=new o(E+j+C+D,k+L+A+R),m=new o(E+j-I,k+L+A+R)}else d=new o(y,b),f=new o(_,b),p=new o(_,x),m=new o(y,x);var F=s.getLayoutValue("icon-rotate",c,h)*Math.PI/180;if(l){var B=r[t.segment];if(t.y===B.y&&t.x===B.x&&t.segment+1<r.length){var N=r[t.segment+1];F+=Math.atan2(t.y-N.y,t.x-N.x)+Math.PI}else F+=Math.atan2(t.y-B.y,t.x-B.x)}if(F){var q=Math.sin(F),V=Math.cos(F),U=[V,-q,q,V];d=d.matMult(U),f=f.matMult(U),m=m.matMult(U),p=p.matMult(U)}return[new i(new o(t.x,t.y),d,f,m,p,e.image.rect,0,0,a,1/0)]},getGlyphQuads:function(t,e,n,s,l,u){for(var c=l.layout["text-rotate"]*Math.PI/180,h=l.layout["text-keep-upright"],d=e.positionedGlyphs,f=[],p=0;p<d.length;p++){var m=d[p],v=m.glyph;if(v){var g=v.rect;if(g){var y=(m.x+v.advance/2)*n,_=void 0,b=a;u?(b=r(_=[],t,y,s,t.segment,!0),h&&(b=Math.min(b,r(_,t,y,s,t.segment,!1)))):_=[{anchorPoint:new o(t.x,t.y),offset:0,angle:0,maxScale:1/0,minScale:a}];var x=m.x+v.left,w=m.y-v.top,S=x+g.w,M=w+g.h,E=new o(m.x,v.advance/2),z=new o(x,w),k=new o(S,w),T=new o(x,M),O=new o(S,M);0!==m.angle&&(z._sub(E)._rotate(m.angle)._add(E),k._sub(E)._rotate(m.angle)._add(E),T._sub(E)._rotate(m.angle)._add(E),O._sub(E)._rotate(m.angle)._add(E));for(var P=0;P<_.length;P++){var C=_[P],A=z,I=k,L=T,j=O;if(c){var D=Math.sin(c),R=Math.cos(c),F=[R,-D,D,R];A=A.matMult(F),I=I.matMult(F),L=L.matMult(F),j=j.matMult(F)}var B=Math.max(C.minScale,b),N=(t.angle+C.offset+2*Math.PI)%(2*Math.PI),q=(C.angle+C.offset+2*Math.PI)%(2*Math.PI);f.push(new i(C.anchorPoint,A,I,L,j,g,N,q,B,C.maxScale,e.writingMode))}}}}return f},SymbolQuad:i};var a=.5},{"point-geometry":26}],168:[function(t,e,n){"use strict";var i=t("../util/token");e.exports=function(t,e,n){var r=t.getLayoutValue("text-field",e,n);if(t.isLayoutValueFeatureConstant("text-field")&&(r=i(n,r)),r){r=r.toString();var o=t.getLayoutValue("text-transform",e,n);return"uppercase"===o?r=r.toLocaleUpperCase():"lowercase"===o&&(r=r.toLocaleLowerCase()),r}}},{"../util/token":211}],169:[function(t,e,n){"use strict";function i(t,e,n,i,r){this.codePoint=t,this.x=e,this.y=n,this.glyph=i||null,this.angle=r}function r(t,e,n,i){var r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function o(t,e){var n=0;return 10===t&&(n-=1e4),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function a(t,e,n,i,o,a){for(var s=null,l=r(e,n,o,a),u=0,c=i;u<c.length;u+=1){var h=c[u],d=r(e-h.x,n,o,a)+h.badness;d<=l&&(s=h,l=d)}return{index:t,x:e,priorBreak:s,badness:l}}function s(t,e,n,i){if(!n)return[];if(!t)return[];for(var r=[],s=function(t,e,n,i){var r=0;for(var o in t){var a=i[t.charCodeAt(o)];a&&(r+=a.advance+e)}return r/Math.max(1,Math.ceil(r/n))}(t,e,n,i),l=0,c=0;c<t.length;c++){var h=t.charCodeAt(c),d=i[h];d&&!f[h]&&(l+=d.advance+e),c<t.length-1&&(p[h]||u.charAllowsIdeographicBreaking(h))&&r.push(a(c+1,l,s,r,o(h,t.charCodeAt(c+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(a(t.length,l,s,r,0,!0))}function l(t,e,n,i,r){if(r)for(var o=e[t[i].codePoint].advance,a=(t[i].x+o)*r,s=n;s<=i;s++)t[s].x-=a}var u=t("../util/script_detection"),c=t("../util/verticalize_punctuation"),h=t("../source/rtl_text_plugin"),d={horizontal:1,vertical:2};e.exports={shapeText:function(t,e,n,r,o,a,f,p,m,v,g){var y=t.trim();g===d.vertical&&(y=c(y));var _=[],b=new function(t,e,n,i,r,o,a){this.positionedGlyphs=t,this.text=e,this.top=n,this.bottom=i,this.left=r,this.right=o,this.writingMode=a}(_,y,m[1],m[1],m[0],m[0],g);return function(t,e,n,r,o,a,s,c,h,f,p){var m=0,v=-17,g=0,y=t.positionedGlyphs;for(var _ in n){var b=n[_].trim();if(b.length){for(var x=y.length,w=0;w<b.length;w++){var S=b.charCodeAt(w),M=e[S];M&&(u.charHasUprightVerticalOrientation(S)&&h!==d.horizontal?(y.push(new i(S,m,0,M,-Math.PI/2)),m+=p+f):(y.push(new i(S,m,v,M,0)),m+=M.advance+f))}if(y.length!==x){var E=m-f;g=Math.max(E,g),l(y,e,x,y.length-1,s)}m=0,v+=r}else v+=r}!function(t,e,n,i,r,o,a,s){for(var l=(e-n)*r+s[0],u=(-i*a+.5)*o+s[1],c=0;c<t.length;c++)t[c].x+=l,t[c].y+=u}(y,s,o,a,g,r,n.length,c);var z=n.length*r;t.top+=-a*z,t.bottom=t.top+z,t.left+=-o*g,t.right=t.left+g}(b,e,h.processBidirectionalText?h.processBidirectionalText(y,s(y,p,n,e)):function(t,e){for(var n=[],i=0,r=0,o=e;r<o.length;r+=1){var a=o[r];n.push(t.substring(i,a)),i=a}return i<t.length&&n.push(t.substring(i,t.length)),n}(y,s(y,p,n,e)),r,o,a,f,m,g,p,v),!!_.length&&b},shapeIcon:function(t,e){if(!t||!t.rect)return null;var n=e[0],i=e[1],r=n-t.width/2,o=r+t.width,a=i-t.height/2;return new function(t,e,n,i,r){this.image=t,this.top=e,this.bottom=n,this.left=i,this.right=r}(t,a,a+t.height,r,o)},WritingMode:d};var f={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},p={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0}},{"../source/rtl_text_plugin":90,"../util/script_detection":209,"../util/verticalize_punctuation":214}],170:[function(t,e,n){"use strict";var i=t("@mapbox/shelf-pack"),r=t("../util/browser"),o=t("../util/util"),a=t("../util/window"),s=function(t){function e(e,n){t.call(this),this.width=e,this.height=n,this.shelfPack=new i(e,n),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.allocateImage=function(t,e){var n=(t/=this.pixelRatio)+2+(4-(t+2)%4),i=(e/=this.pixelRatio)+2+(4-(e+2)%4),r=this.shelfPack.packOne(n,i);return r||(o.warnOnce("SpriteAtlas out of space."),null)},e.prototype.addImage=function(t,e,n){var i,o,s;if(e instanceof a.HTMLImageElement?(i=e.width,o=e.height,e=r.getImageData(e),s=this.pixelRatio):(i=n.width,o=n.height,s=n.pixelRatio||this.pixelRatio),ArrayBuffer.isView(e)&&(e=new Uint32Array(e.buffer)),!(e instanceof Uint32Array))return this.fire("error",{error:new Error("Image provided in an invalid format. Supported formats are HTMLImageElement, ImageData, and ArrayBufferView.")});if(this.images[t])return this.fire("error",{error:new Error("An image with this name already exists.")});var l=this.allocateImage(i,o);if(!l)return this.fire("error",{error:new Error("There is not enough space to add this image.")});var u={rect:l,width:i/s,height:o/s,sdf:!1,pixelRatio:1};this.images[t]=u,this.copy(e,i,l,{pixelRatio:s,x:0,y:0,width:i,height:o},!1),this.fire("data",{dataType:"style"})},e.prototype.removeImage=function(t){var e=this.images[t];return delete this.images[t],e?(this.shelfPack.unref(e.rect),void this.fire("data",{dataType:"style"})):this.fire("error",{error:new Error("No image with this name exists.")})},e.prototype.getImage=function(t,e){if(this.images[t])return this.images[t];if(!this.sprite)return null;var n=this.sprite.getSpritePosition(t);if(!n.width||!n.height)return null;var i=this.allocateImage(n.width,n.height);if(!i)return null;var r={rect:i,width:n.width/n.pixelRatio,height:n.height/n.pixelRatio,sdf:n.sdf,pixelRatio:n.pixelRatio/this.pixelRatio};if(this.images[t]=r,!this.sprite.imgData)return null;var o=new Uint32Array(this.sprite.imgData.buffer);return this.copy(o,this.sprite.width,i,n,e),r},e.prototype.getPosition=function(t,e){var n=this.getImage(t,e),i=n&&n.rect;if(!i)return null;var r=n.width*n.pixelRatio,o=n.height*n.pixelRatio;return{size:[n.width,n.height],tl:[(i.x+1)/this.width,(i.y+1)/this.height],br:[(i.x+1+r)/this.width,(i.y+1+o)/this.height]}},e.prototype.allocate=function(){if(!this.data){var t=Math.floor(this.width*this.pixelRatio),e=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(t*e);for(var n=0;n<this.data.length;n++)this.data[n]=0}},e.prototype.copy=function(t,e,n,i,r){this.allocate();var o=this.data;(function(t,e,n,i,r,o,a,s,l,u,c){var h,d,f=i*e+n,p=s*o+a;if(c)for(p-=o,d=-1;d<=u;d++,p+=o)for(f=((d+u)%u+i)*e+n,h=-1;h<=l;h++)r[p+h]=t[f+(h+l)%l];else for(d=0;d<u;d++,f+=e,p+=o)for(h=0;h<l;h++)r[p+h]=t[f+h]})(t,e,i.x,i.y,o,this.width*this.pixelRatio,(n.x+1)*this.pixelRatio,(n.y+1)*this.pixelRatio,i.width,i.height,r),this.dirty=!0},e.prototype.setSprite=function(t){t&&(this.pixelRatio=r.devicePixelRatio>1?2:1,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio)),this.sprite=t},e.prototype.addIcons=function(t,e){for(var n=0;n<t.length;n++)this.getImage(t[n]);e(null,this.images)},e.prototype.bind=function(t,e){var n=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n=!0);var i=e?t.LINEAR:t.NEAREST;i!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),this.filter=i),this.dirty&&(this.allocate(),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1)},e}(t("../util/evented"));e.exports=s},{"../util/browser":192,"../util/evented":200,"../util/util":212,"../util/window":194,"@mapbox/shelf-pack":2}],171:[function(t,e,n){"use strict";var i=t("../util/dom"),r=t("point-geometry"),o={scrollZoom:t("./handler/scroll_zoom"),boxZoom:t("./handler/box_zoom"),dragRotate:t("./handler/drag_rotate"),dragPan:t("./handler/drag_pan"),keyboard:t("./handler/keyboard"),doubleClickZoom:t("./handler/dblclick_zoom"),touchZoomRotate:t("./handler/touch_zoom_rotate")};e.exports=function(t,e){function n(){d=null}function a(e,n){var r=i.mousePos(l,n);return t.fire(e,{lngLat:t.unproject(r),point:r,originalEvent:n})}function s(e,n){var o=i.touchPos(l,n),a=o.reduce(function(t,e,n,i){return t.add(e.div(i.length))},new r(0,0));return t.fire(e,{lngLat:t.unproject(a),point:a,lngLats:o.map(function(e){return t.unproject(e)},this),points:o,originalEvent:n})}var l=t.getCanvasContainer(),u=null,c=!1,h=null,d=null;for(var f in o)t[f]=new o[f](t,e),e.interactive&&e[f]&&t[f].enable(e[f]);l.addEventListener("mouseout",function(t){a("mouseout",t)},!1),l.addEventListener("mousedown",function(e){t.stop(),h=i.mousePos(l,e),a("mousedown",e),c=!0},!1),l.addEventListener("mouseup",function(e){var n=t.dragRotate&&t.dragRotate.isActive();u&&!n&&a("contextmenu",u),u=null,c=!1,a("mouseup",e)},!1),l.addEventListener("mousemove",function(e){if(!(t.dragPan&&t.dragPan.isActive()||t.dragRotate&&t.dragRotate.isActive())){for(var n=e.toElement||e.target;n&&n!==l;)n=n.parentNode;n===l&&a("mousemove",e)}},!1),l.addEventListener("touchstart",function(e){t.stop(),s("touchstart",e),!e.touches||e.touches.length>1||(d?(clearTimeout(d),d=null,a("dblclick",e)):d=setTimeout(n,300))},!1),l.addEventListener("touchend",function(t){s("touchend",t)},!1),l.addEventListener("touchmove",function(t){s("touchmove",t)},!1),l.addEventListener("touchcancel",function(t){s("touchcancel",t)},!1),l.addEventListener("click",function(t){i.mousePos(l,t).equals(h)&&a("click",t)},!1),l.addEventListener("dblclick",function(t){a("dblclick",t),t.preventDefault()},!1),l.addEventListener("contextmenu",function(e){var n=t.dragRotate&&t.dragRotate.isActive();c||n?c&&(u=e):a("contextmenu",e),e.preventDefault()},!1)}},{"../util/dom":199,"./handler/box_zoom":179,"./handler/dblclick_zoom":180,"./handler/drag_pan":181,"./handler/drag_rotate":182,"./handler/keyboard":183,"./handler/scroll_zoom":184,"./handler/touch_zoom_rotate":185,"point-geometry":26}],172:[function(t,e,n){"use strict";var i=t("../util/util"),r=t("../util/interpolate"),o=t("../util/browser"),a=t("../geo/lng_lat"),s=t("../geo/lng_lat_bounds"),l=t("point-geometry"),u=function(t){function e(e,n){t.call(this),this.moving=!1,this.transform=e,this._bearingSnap=n.bearingSnap}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCenter=function(){return this.transform.center},e.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e),this},e.prototype.panBy=function(t,e,n){return this.panTo(this.transform.center,i.extend({offset:l.convert(t).mult(-1)},e),n),this},e.prototype.panTo=function(t,e,n){return this.easeTo(i.extend({center:t},e),n)},e.prototype.getZoom=function(){return this.transform.zoom},e.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},e.prototype.zoomTo=function(t,e,n){return this.easeTo(i.extend({zoom:t},e),n)},e.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},e.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},e.prototype.getBearing=function(){return this.transform.bearing},e.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},e.prototype.rotateTo=function(t,e,n){return this.easeTo(i.extend({bearing:t},e),n)},e.prototype.resetNorth=function(t,e){return this.rotateTo(0,i.extend({duration:1e3},t),e),this},e.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},e.prototype.getPitch=function(){return this.transform.pitch},e.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},e.prototype.fitBounds=function(t,e,n){if("number"==typeof(e=i.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){var r=e.padding;e.padding={top:r,bottom:r,right:r,left:r}}if(i.deepEqual(Object.keys(e.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"])){t=s.convert(t);var o=[e.padding.left-e.padding.right,e.padding.top-e.padding.bottom],a=Math.min(e.padding.right,e.padding.left),u=Math.min(e.padding.top,e.padding.bottom);e.offset=[e.offset[0]+o[0],e.offset[1]+o[1]];var c=l.convert(e.offset),h=this.transform,d=h.project(t.getNorthWest()),f=h.project(t.getSouthEast()),p=f.sub(d),m=(h.width-2*a-2*Math.abs(c.x))/p.x,v=(h.height-2*u-2*Math.abs(c.y))/p.y;return v<0||m<0?void i.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset."):(e.center=h.unproject(d.add(f).div(2)),e.zoom=Math.min(h.scaleZoom(h.scale*Math.min(m,v)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,n):this.flyTo(e,n))}i.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},e.prototype.jumpTo=function(t,e){this.stop();var n=this.transform,i=!1,r=!1,o=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(i=!0,n.zoom=+t.zoom),"center"in t&&(n.center=a.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(r=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),this.fire("movestart",e).fire("move",e),i&&this.fire("zoomstart",e).fire("zoom",e).fire("zoomend",e),r&&this.fire("rotate",e),o&&this.fire("pitch",e),this.fire("moveend",e)},e.prototype.easeTo=function(t,e){var n=this;this.stop(),t=i.extend({offset:[0,0],duration:500,easing:i.ease},t);var o,s,u=this.transform,c=l.convert(t.offset),h=this.getZoom(),d=this.getBearing(),f=this.getPitch(),p="zoom"in t?+t.zoom:h,m="bearing"in t?this._normalizeBearing(t.bearing,d):d,v="pitch"in t?+t.pitch:f;"center"in t?(o=a.convert(t.center),s=u.centerPoint.add(c)):"around"in t?(o=a.convert(t.around),s=u.locationPoint(o)):(s=u.centerPoint.add(c),o=u.pointLocation(s));var g=u.locationPoint(o);return!1===t.animate&&(t.duration=0),this.zooming=p!==h,this.rotating=d!==m,this.pitching=v!==f,t.smoothEasing&&0!==t.duration&&(t.easing=this._smoothOutEasing(t.duration)),t.noMoveStart||(this.moving=!0,this.fire("movestart",e)),this.zooming&&this.fire("zoomstart",e),clearTimeout(this._onEaseEnd),this._ease(function(t){this.zooming&&(u.zoom=r(h,p,t)),this.rotating&&(u.bearing=r(d,m,t)),this.pitching&&(u.pitch=r(f,v,t)),u.setLocationAtPoint(o,g.add(s.sub(g)._mult(t))),this.fire("move",e),this.zooming&&this.fire("zoom",e),this.rotating&&this.fire("rotate",e),this.pitching&&this.fire("pitch",e)},function(){t.delayEndEvents?n._onEaseEnd=setTimeout(n._easeToEnd.bind(n,e),t.delayEndEvents):n._easeToEnd(e)},t),this},e.prototype._easeToEnd=function(t){var e=this.zooming;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,e&&this.fire("zoomend",t),this.fire("moveend",t)},e.prototype.flyTo=function(t,e){function n(t){var e=(S*S-w*w+(t?-1:1)*k*k*M*M)/(2*(t?S:w)*k*M);return Math.log(Math.sqrt(e*e+1)-e)}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}this.stop(),t=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},t);var u=this.transform,c=l.convert(t.offset),h=this.getZoom(),d=this.getBearing(),f=this.getPitch(),p="center"in t?a.convert(t.center):this.getCenter(),m="zoom"in t?+t.zoom:h,v="bearing"in t?this._normalizeBearing(t.bearing,d):d,g="pitch"in t?+t.pitch:f;Math.abs(u.center.lng)+Math.abs(p.lng)>180&&(u.center.lng>0&&p.lng<0?p.lng+=360:u.center.lng<0&&p.lng>0&&(p.lng-=360));var y=u.zoomScale(m-h),_=u.point,b="center"in t?u.project(p).sub(c.div(y)):_,x=t.curve,w=Math.max(u.width,u.height),S=w/y,M=b.sub(_).mag();if("minZoom"in t){var E=i.clamp(Math.min(t.minZoom,h,m),u.minZoom,u.maxZoom),z=w/u.zoomScale(E-h);x=Math.sqrt(z/M*2)}var k=x*x,T=n(0),O=function(t){return s(T)/s(T+x*t)},P=function(t){return w*((s(T)*function(t){return o(t)/s(t)}(T+x*t)-o(T))/k)/M},C=(n(1)-T)/x;if(Math.abs(M)<1e-6){if(Math.abs(w-S)<1e-6)return this.easeTo(t,e);var A=S<w?-1:1;C=Math.abs(Math.log(S/w))/x,P=function(){return 0},O=function(t){return Math.exp(A*x*t)}}if("duration"in t)t.duration=+t.duration;else{var I="screenSpeed"in t?+t.screenSpeed/x:+t.speed;t.duration=1e3*C/I}return this.moving=!0,this.zooming=!0,d!==v&&(this.rotating=!0),f!==g&&(this.pitching=!0),this.fire("movestart",e),this.fire("zoomstart",e),this._ease(function(t){var n=t*C,i=P(n),o=1/O(n);u.zoom=h+u.scaleZoom(o),u.center=u.unproject(_.add(b.sub(_).mult(i)).mult(o)),this.rotating&&(u.bearing=r(d,v,t)),this.pitching&&(u.pitch=r(f,g,t)),this.fire("move",e),this.fire("zoom",e),this.rotating&&this.fire("rotate",e),this.pitching&&this.fire("pitch",e)},function(){this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.fire("zoomend",e),this.fire("moveend",e)},t),this},e.prototype.isEasing=function(){return!!this._abortFn},e.prototype.isMoving=function(){return this.moving},e.prototype.stop=function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},e.prototype._ease=function(t,e,n){this._finishFn=e,this._abortFn=o.timed(function(e){t.call(this,n.easing(e)),1===e&&this._finishEase()},!1===n.animate?0:n.duration,this)},e.prototype._finishEase=function(){delete this._abortFn;var t=this._finishFn;delete this._finishFn,t.call(this)},e.prototype._normalizeBearing=function(t,e){t=i.wrap(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t},e.prototype._smoothOutEasing=function(t){var e=i.ease;if(this._prevEase){var n=this._prevEase,r=(Date.now()-n.start)/n.duration,o=n.easing(r+.01)-n.easing(r),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);e=i.bezier(a,s,.25,1)}return this._prevEase={start:(new Date).getTime(),duration:t,easing:e},e},e}(t("../util/evented"));e.exports=u},{"../geo/lng_lat":62,"../geo/lng_lat_bounds":63,"../util/browser":192,"../util/evented":200,"../util/interpolate":204,"../util/util":212,"point-geometry":26}],173:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../util/util"),o=function(t){this.options=t,r.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};o.prototype.getDefaultPosition=function(){return"bottom-right"},o.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),e&&this._container.classList.add("compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},o.prototype._updateEditLink=function(){if(this._editLink||(this._editLink=this._container.querySelector(".mapbox-improve-map")),this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}},o.prototype._updateData=function(t){this._updateAttributions(t),this._updateEditLink()},o.prototype._updateAttributions=function(t){if(this._map.style&&(!t||"metadata"===t.sourceDataType)){var e=[],n=this._map.style.sourceCaches;for(var i in n){var r=n[i].getSource();r.attribution&&e.indexOf(r.attribution)<0&&e.push(r.attribution)}e.sort(function(t,e){return t.length-e.length}),e=e.filter(function(t,n){for(var i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}),this._container.innerHTML=e.join(" | "),this._editLink=null}},o.prototype._updateCompact=function(){var t=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[t?"add":"remove"]("compact")},e.exports=o},{"../../util/dom":199,"../../util/util":212}],174:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=function(){this._fullscreen=!1,r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.document&&(this._fullscreenchange="MSFullscreenChange")};a.prototype.onAdd=function(t){var e="mapboxgl-ctrl",n=this._container=i.create("div",e+" mapboxgl-ctrl-group"),r=this._fullscreenButton=i.create("button",e+"-icon "+e+"-fullscreen",this._container);return r.setAttribute("aria-label","Toggle fullscreen"),r.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),this._mapContainer=t.getContainer(),o.document.addEventListener(this._fullscreenchange,this._changeIcon),n},a.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=null,o.document.removeEventListener(this._fullscreenchange,this._changeIcon)},a.prototype._isFullscreen=function(){return this._fullscreen},a.prototype._changeIcon=function(t){if(t.target===this._mapContainer){this._fullscreen=!this._fullscreen;var e="mapboxgl-ctrl";this._fullscreenButton.classList.toggle(e+"-shrink"),this._fullscreenButton.classList.toggle(e+"-fullscreen")}},a.prototype._onClickFullscreen=function(){this._isFullscreen()?o.document.exitFullscreen?o.document.exitFullscreen():o.document.mozCancelFullScreen?o.document.mozCancelFullScreen():o.document.msExitFullscreen?o.document.msExitFullscreen():o.document.webkitCancelFullScreen&&o.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()},e.exports=a},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],175:[function(t,e,n){"use strict";var i,r=t("../../util/evented"),o=t("../../util/dom"),a=t("../../util/window"),s=t("../../util/util"),l={enableHighAccuracy:!1,timeout:6e3},u=function(t){function e(e){t.call(this),this.options=e||{},s.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){return this._map=t,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),function(t){void 0!==i?t(i):void 0!==a.navigator.permissions?a.navigator.permissions.query({name:"geolocation"}).then(function(e){i="denied"!==e.state,t(i)}):(i=!!a.navigator.geolocation,t(i))}(this._setupUI),this._container},e.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=void 0},e.prototype._onSuccess=function(t){this._map.jumpTo({center:[t.coords.longitude,t.coords.latitude],zoom:17,bearing:0,pitch:0}),this.fire("geolocate",t),this._finish()},e.prototype._onError=function(t){this.fire("error",t),this._finish()},e.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},e.prototype._setupUI=function(t){!1!==t&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=o.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.watchPosition&&this._geolocateButton.setAttribute("aria-pressed",!1),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)))},e.prototype._onClickGeolocate=function(){var t=s.extend(l,this.options&&this.options.positionOptions||{});this.options.watchPosition?void 0!==this._geolocationWatchID?(this._geolocateButton.classList.remove("watching"),this._geolocateButton.setAttribute("aria-pressed",!1),a.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0):(this._geolocateButton.classList.add("watching"),this._geolocateButton.setAttribute("aria-pressed",!0),this._geolocationWatchID=a.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)):(a.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,t),this._timeoutId=setTimeout(this._finish,1e4))},e}(r);e.exports=u},{"../../util/dom":199,"../../util/evented":200,"../../util/util":212,"../../util/window":194}],176:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../util/util"),o=function(){r.bindAll(["_updateLogo"],this)};o.prototype.onAdd=function(t){return this._map=t,this._container=i.create("div","mapboxgl-ctrl"),this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateLogo)},o.prototype.getDefaultPosition=function(){return"bottom-left"},o.prototype._updateLogo=function(t){if(t&&"metadata"===t.sourceDataType)if(!this._container.childNodes.length&&this._logoRequired()){var e=i.create("a","mapboxgl-ctrl-logo");e.target="_blank",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),this._container.appendChild(e),this._map.off("data",this._updateLogo)}else this._container.childNodes.length&&!this._logoRequired()&&this.onRemove()},o.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t){if(t[e].getSource().mapbox_logo)return!0}return!1}},e.exports=o},{"../../util/dom":199,"../../util/util":212}],177:[function(t,e,n){"use strict";function i(t){return new o.MouseEvent(t.type,{button:2,buttons:2,bubbles:!0,cancelable:!0,detail:t.detail,view:t.view,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,movementX:t.movementX,movementY:t.movementY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey})}var r=t("../../util/dom"),o=t("../../util/window"),a=t("../../util/util"),s="mapboxgl-ctrl",l=function(){a.bindAll(["_rotateCompassArrow"],this)};l.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},l.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div",s+" "+s+"-group",t.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton(s+"-icon "+s+"-zoom-in","Zoom In",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(s+"-icon "+s+"-zoom-out","Zoom Out",t.zoomOut.bind(t)),this._compass=this._createButton(s+"-icon "+s+"-compass","Reset North",t.resetNorth.bind(t)),this._compassArrow=r.create("span",s+"-compass-arrow",this._compass),this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container},l.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("rotate",this._rotateCompassArrow),this._map=void 0},l.prototype._onContextMenu=function(t){t.preventDefault()},l.prototype._onCompassDown=function(t){0===t.button&&(r.disableDrag(),o.document.addEventListener("mousemove",this._onCompassMove),o.document.addEventListener("mouseup",this._onCompassUp),this._map.getCanvasContainer().dispatchEvent(i(t)),t.stopPropagation())},l.prototype._onCompassMove=function(t){0===t.button&&(this._map.getCanvasContainer().dispatchEvent(i(t)),t.stopPropagation())},l.prototype._onCompassUp=function(t){0===t.button&&(o.document.removeEventListener("mousemove",this._onCompassMove),o.document.removeEventListener("mouseup",this._onCompassUp),r.enableDrag(),this._map.getCanvasContainer().dispatchEvent(i(t)),t.stopPropagation())},l.prototype._createButton=function(t,e,n){var i=r.create("button",t,this._container);return i.type="button",i.setAttribute("aria-label",e),i.addEventListener("click",function(){n()}),i},e.exports=l},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],178:[function(t,e,n){"use strict";function i(t,e,n){var i=n&&n.maxWidth||100,o=t._container.clientHeight/2,a=function(t,e){var n=Math.PI/180,i=t.lat*n,r=e.lat*n,o=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-t.lng)*n);return 6371e3*Math.acos(Math.min(o,1))}(t.unproject([0,o]),t.unproject([i,o]));if(n&&"imperial"===n.unit){var s=3.2808*a;if(s>5280)r(e,i,s/5280,"mi");else r(e,i,s,"ft")}else r(e,i,a,"m")}function r(t,e,n,i){var r=function(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),n=t/e;return e*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}(n),o=r/n;"m"===i&&r>=1e3&&(r/=1e3,i="km"),t.style.width=e*o+"px",t.innerHTML=r+i}var o=t("../../util/dom"),a=t("../../util/util"),s=function(t){this.options=t,a.bindAll(["_onMove"],this)};s.prototype.getDefaultPosition=function(){return"bottom-left"},s.prototype._onMove=function(){i(this._map,this._container,this.options)},s.prototype.onAdd=function(t){return this._map=t,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},s.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},e.exports=s},{"../../util/dom":199,"../../util/util":212}],179:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../geo/lng_lat_bounds"),o=t("../../util/util"),a=t("../../util/window"),s=function(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),o.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onMouseDown,!1),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},s.prototype._onMouseDown=function(t){t.shiftKey&&0===t.button&&(a.document.addEventListener("mousemove",this._onMouseMove,!1),a.document.addEventListener("keydown",this._onKeyDown,!1),a.document.addEventListener("mouseup",this._onMouseUp,!1),i.disableDrag(),this._startPos=i.mousePos(this._el,t),this._active=!0)},s.prototype._onMouseMove=function(t){var e=this._startPos,n=i.mousePos(this._el,t);this._box||(this._box=i.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var r=Math.min(e.x,n.x),o=Math.max(e.x,n.x),a=Math.min(e.y,n.y),s=Math.max(e.y,n.y);i.setTransform(this._box,"translate("+r+"px,"+a+"px)"),this._box.style.width=o-r+"px",this._box.style.height=s-a+"px"},s.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,n=i.mousePos(this._el,t),o=(new r).extend(this._map.unproject(e)).extend(this._map.unproject(n));this._finish(),e.x===n.x&&e.y===n.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(o,{linear:!0}).fire("boxzoomend",{originalEvent:t,boxZoomBounds:o})}},s.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},s.prototype._finish=function(){this._active=!1,a.document.removeEventListener("mousemove",this._onMouseMove,!1),a.document.removeEventListener("keydown",this._onKeyDown,!1),a.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.parentNode.removeChild(this._box),this._box=null),i.enableDrag()},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},e.exports=s},{"../../geo/lng_lat_bounds":63,"../../util/dom":199,"../../util/util":212,"../../util/window":194}],180:[function(t,e,n){"use strict";var i=function(t){this._map=t,this._onDblClick=this._onDblClick.bind(this)};i.prototype.isEnabled=function(){return!!this._enabled},i.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},i.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},i.prototype._onDblClick=function(t){this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},e.exports=i},{}],181:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=r.bezier(0,0,.3,1),s=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},s.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(o.document.addEventListener("touchmove",this._onMove),o.document.addEventListener("touchend",this._onTouchEnd)):(o.document.addEventListener("mousemove",this._onMove),o.document.addEventListener("mouseup",this._onMouseUp)),o.addEventListener("blur",this._onMouseUp),this._active=!1,this._startPos=this._pos=i.mousePos(this._el,t),this._inertia=[[Date.now(),this._pos]])},s.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t));var e=i.mousePos(this._el,t),n=this._map;n.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),e]),n.transform.setLocationAtPoint(n.transform.pointLocation(this._pos),e),this._fireEvent("drag",t),this._fireEvent("move",t),this._pos=e,t.preventDefault()}},s.prototype._onUp=function(t){var e=this;if(this.isActive()){this._active=!1,this._fireEvent("dragend",t),this._drainInertiaBuffer();var n=function(){e._map.moving=!1,e._fireEvent("moveend",t)},i=this._inertia;if(i.length<2)return void n();var r=i[i.length-1],o=i[0],s=r[1].sub(o[1]),l=(r[0]-o[0])/1e3;if(0===l||r[1].equals(o[1]))return void n();var u=s.mult(.3/l),c=u.mag();c>1400&&(c=1400,u._unit()._mult(c));var h=c/750,d=u.mult(-h/2);this._map.panBy(d,{duration:1e3*h,easing:a,noMoveStart:!0},{originalEvent:t})}},s.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("mousemove",this._onMove),o.document.removeEventListener("mouseup",this._onMouseUp),o.removeEventListener("blur",this._onMouseUp))},s.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("touchmove",this._onMove),o.document.removeEventListener("touchend",this._onTouchEnd))},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},s.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragRotate&&e.dragRotate.isActive())return!0;if(t.touches)return t.touches.length>1;if(t.ctrlKey)return!0;return"mousemove"===t.type?!1&t.buttons:t.button&&0!==t.button},s.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},e.exports=s},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],182:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=r.bezier(0,0,.25,1),s=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._bearingSnap=e.bearingSnap,this._pitchWithRotate=!1!==e.pitchWithRotate,r.bindAll(["_onDown","_onMove","_onUp"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},s.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(o.document.addEventListener("mousemove",this._onMove),o.document.addEventListener("mouseup",this._onUp),o.addEventListener("blur",this._onUp),this._active=!1,this._inertia=[[Date.now(),this._map.getBearing()]],this._startPos=this._pos=i.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault())},s.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t));var e=this._map;e.stop();var n=this._pos,r=i.mousePos(this._el,t),o=.8*(n.x-r.x),a=-.5*(n.y-r.y),s=e.getBearing()-o,l=e.getPitch()-a,u=this._inertia,c=u[u.length-1];this._drainInertiaBuffer(),u.push([Date.now(),e._normalizeBearing(s,c[1])]),e.transform.bearing=s,this._pitchWithRotate&&(e.transform.pitch=l),this._fireEvent("rotate",t),this._fireEvent("move",t),this._pos=r}},s.prototype._onUp=function(t){var e=this;if(!this._ignoreEvent(t)&&(o.document.removeEventListener("mousemove",this._onMove),o.document.removeEventListener("mouseup",this._onUp),o.removeEventListener("blur",this._onUp),this.isActive())){this._active=!1,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var n=this._map,i=n.getBearing(),r=this._inertia,s=function(){Math.abs(i)<e._bearingSnap?n.resetNorth({noMoveStart:!0},{originalEvent:t}):(e._map.moving=!1,e._fireEvent("moveend",t))};if(r.length<2)return void s();var l=r[0],u=r[r.length-1],c=r[r.length-2],h=n._normalizeBearing(i,c[1]),d=u[1]-l[1],f=d<0?-1:1,p=(u[0]-l[0])/1e3;if(0===d||0===p)return void s();var m=Math.abs(d*(.25/p));m>180&&(m=180);var v=m/180;h+=f*m*(v/2),Math.abs(n._normalizeBearing(h,0))<this._bearingSnap&&(h=n._normalizeBearing(0,h)),n.rotateTo(h,{duration:1e3*v,easing:a,noMoveStart:!0},{originalEvent:t})}},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},s.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragPan&&e.dragPan.isActive())return!0;if(t.touches)return t.touches.length>1;var n=t.ctrlKey?1:2,i=t.ctrlKey?0:2,r=t.button;return"undefined"!=typeof InstallTrigger&&2===t.button&&t.ctrlKey&&o.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(r=0),"mousemove"===t.type?t.buttons&0===n:!this.isActive()&&r!==i},s.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},e.exports=s},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],183:[function(t,e,n){"use strict";function i(t){return t*(2-t)}var r=function(t){this._map=t,this._el=t.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)};r.prototype.isEnabled=function(){return!!this._enabled},r.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},r.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},r.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,n=0,r=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?r=-1:(a=1,t.preventDefault())}var s=this._map,l=s.getZoom(),u={duration:300,delayEndEvents:500,easing:i,zoom:e?Math.round(l)+e*(t.shiftKey?2:1):l,bearing:s.getBearing()+15*n,pitch:s.getPitch()+10*r,offset:[100*-o,100*-a],center:s.getCenter()};s.easeTo(u,{originalEvent:t})}},e.exports=r},{}],184:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/browser"),a=t("../../util/window"),s=a.navigator.userAgent.toLowerCase(),l=-1!==s.indexOf("firefox"),u=-1!==s.indexOf("safari")&&-1===s.indexOf("chrom"),c=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onWheel","_onTimeout"],this)};c.prototype.isEnabled=function(){return!!this._enabled},c.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},c.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},c.prototype._onWheel=function(t){var e;"wheel"===t.type?(e=t.deltaY,l&&t.deltaMode===a.WheelEvent.DOM_DELTA_PIXEL&&(e/=o.devicePixelRatio),t.deltaMode===a.WheelEvent.DOM_DELTA_LINE&&(e*=40)):"mousewheel"===t.type&&(e=-t.wheelDeltaY,u&&(e/=3));var n=o.now(),r=n-(this._time||0);this._pos=i.mousePos(this._el,t),this._time=n,0!==e&&e%4.000244140625==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(r*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&this._zoom(-e,t),t.preventDefault()},c.prototype._onTimeout=function(){this._type="wheel",this._zoom(-this._lastValue)},c.prototype._zoom=function(t,e){if(0!==t){var n=this._map,i=2/(1+Math.exp(-Math.abs(t/100)));t<0&&0!==i&&(i=1/i);var r=n.ease?n.ease.to:n.transform.scale,o=n.transform.scaleZoom(r*i);n.zoomTo(o,{duration:"wheel"===this._type?200:0,around:this._aroundCenter?n.getCenter():n.unproject(this._pos),delayEndEvents:200,smoothEasing:!0},{originalEvent:e})}},e.exports=c},{"../../util/browser":192,"../../util/dom":199,"../../util/util":212,"../../util/window":194}],185:[function(t,e,n){"use strict";var i=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=r.bezier(0,0,.15,1),s=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onStart","_onMove","_onEnd"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},s.prototype.disableRotation=function(){this._rotationDisabled=!0},s.prototype.enableRotation=function(){this._rotationDisabled=!1},s.prototype._onStart=function(t){if(2===t.touches.length){var e=i.mousePos(this._el,t.touches[0]),n=i.mousePos(this._el,t.touches[1]);this._startVec=e.sub(n),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],o.document.addEventListener("touchmove",this._onMove,!1),o.document.addEventListener("touchend",this._onEnd,!1)}},s.prototype._onMove=function(t){if(2===t.touches.length){var e=i.mousePos(this._el,t.touches[0]),n=i.mousePos(this._el,t.touches[1]),r=e.add(n).div(2),o=e.sub(n),a=o.mag()/this._startVec.mag(),s=this._rotationDisabled?0:180*o.angleWith(this._startVec)/Math.PI,l=this._map;if(this._gestureIntent){var u={duration:0,around:l.unproject(r)};"rotate"===this._gestureIntent&&(u.bearing=this._startBearing+s),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(u.zoom=l.transform.scaleZoom(this._startScale*a)),l.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),a,r]),l.easeTo(u,{originalEvent:t})}else{var c=Math.abs(1-a)>.15;Math.abs(s)>4?this._gestureIntent="rotate":c&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=o,this._startScale=l.transform.scale,this._startBearing=l.transform.bearing)}t.preventDefault()}},s.prototype._onEnd=function(t){o.document.removeEventListener("touchmove",this._onMove),o.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,n=this._map;if(e.length<2)n.snapToNorth({},{originalEvent:t});else{var i=e[e.length-1],r=e[0],s=n.transform.scaleZoom(this._startScale*i[1]),l=n.transform.scaleZoom(this._startScale*r[1]),u=s-l,c=(i[0]-r[0])/1e3,h=i[2];if(0!==c&&s!==l){var d=.15*u/c;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var f=1e3*Math.abs(d/(12*.15)),p=s+d*f/2e3;p<0&&(p=0),n.easeTo({zoom:p,duration:f,easing:a,around:this._aroundCenter?n.getCenter():n.unproject(h)},{originalEvent:t})}else n.snapToNorth({},{originalEvent:t})}},s.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>2&&e-t[0][0]>160;)t.shift()},e.exports=s},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],186:[function(t,e,n){"use strict";var i=t("../util/util"),r=t("../util/window"),o=function(){i.bindAll(["_onHashChange","_updateHash"],this)};o.prototype.addTo=function(t){return this._map=t,r.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},o.prototype.remove=function(){return r.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},o.prototype._onHashChange=function(){var t=r.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},o.prototype._updateHash=function(){var t=this._map.getCenter(),e=this._map.getZoom(),n=this._map.getBearing(),i=this._map.getPitch(),o=Math.max(0,Math.ceil(Math.log(e)/Math.LN2)),a="#"+Math.round(100*e)/100+"/"+t.lat.toFixed(o)+"/"+t.lng.toFixed(o);(n||i)&&(a+="/"+Math.round(10*n)/10),i&&(a+="/"+Math.round(i)),r.history.replaceState("","",a)},e.exports=o},{"../util/util":212,"../util/window":194}],187:[function(t,e,n){"use strict";function i(t){t.parentNode&&t.parentNode.removeChild(t)}var r=t("../util/util"),o=t("../util/browser"),a=t("../util/window"),s=t("../util/dom"),l=t("../style/style"),u=t("../style/animation_loop"),c=t("../render/painter"),h=t("../geo/transform"),d=t("./hash"),f=t("./bind_handlers"),p=t("./camera"),m=t("../geo/lng_lat"),v=t("../geo/lng_lat_bounds"),g=t("point-geometry"),y=t("./control/attribution_control"),_=t("./control/logo_control"),b=t("mapbox-gl-supported"),x={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0},w=function(t){function e(e){var n=this;if(null!=(e=r.extend({},x,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var i=new h(e.minZoom,e.maxZoom,e.renderWorldCopies);if(t.call(this,i,e),this._interactive=e.interactive,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,"string"==typeof e.container){if(this._container=a.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else this._container=e.container;this.animationLoop=new u,e.maxBounds&&this.setMaxBounds(e.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),this.on("moveend",function(){n.animationLoop.set(300),n._rerender()}),void 0!==a&&(a.addEventListener("online",this._onWindowOnline,!1),a.addEventListener("resize",this._onWindowResize,!1)),f(this,e),this._hash=e.hash&&(new d).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this._classes=[],this.resize(),e.classes&&this.setClasses(e.classes),e.style&&this.setStyle(e.style),e.attributionControl&&this.addControl(new y),this.addControl(new _,e.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this.style.update(this._classes,{transition:!1})}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return e.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var n=t.onAdd(this),i=this._controlPositions[e];return-1!==e.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this},e.prototype.removeControl=function(t){return t.onRemove(this),this},e.prototype.addClass=function(t,e){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0||""===t?this:(this._classes.push(t),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.removeClass=function(t,e){r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");var n=this._classes.indexOf(t);return n<0||""===t?this:(this._classes.splice(n,1),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.setClasses=function(t,e){r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");for(var n={},i=0;i<t.length;i++)""!==t[i]&&(n[t[i]]=!0);return this._classes=Object.keys(n),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0)},e.prototype.hasClass=function(t){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0},e.prototype.getClasses=function(){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes},e.prototype.resize=function(){var t=this._containerDimensions(),e=t[0],n=t[1];return this._resizeCanvas(e,n),this.transform.resize(e,n),this.painter.resize(e,n),this.fire("movestart").fire("move").fire("resize").fire("moveend")},e.prototype.getBounds=function(){var t=new v(this.transform.pointLocation(new g(0,this.transform.height)),this.transform.pointLocation(new g(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new g(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new g(0,this.transform.size.y)))),t},e.prototype.setMaxBounds=function(t){if(t){var e=v.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null!==t&&void 0!==t||(this.transform.lngRange=[],this.transform.latRange=[],this._update());return this},e.prototype.setMinZoom=function(t){if((t=null===t||void 0===t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},e.prototype.getMinZoom=function(){return this.transform.minZoom},e.prototype.setMaxZoom=function(t){if((t=null===t||void 0===t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},e.prototype.getMaxZoom=function(){return this.transform.maxZoom},e.prototype.project=function(t){return this.transform.locationPoint(m.convert(t))},e.prototype.unproject=function(t){return this.transform.pointLocation(g.convert(t))},e.prototype.queryRenderedFeatures=function(){var t,e={};return 2===arguments.length?(t=arguments[0],e=arguments[1]):1===arguments.length&&function(t){return t instanceof g||Array.isArray(t)}(arguments[0])?t=arguments[0]:1===arguments.length&&(e=arguments[0]),this.style.queryRenderedFeatures(this._makeQueryGeometry(t),e,this.transform.zoom,this.transform.angle)},e.prototype._makeQueryGeometry=function(t){var e,n=this;if(void 0===t&&(t=[g.convert([0,0]),g.convert([this.transform.width,this.transform.height])]),t instanceof g||"number"==typeof t[0]){e=[g.convert(t)]}else{var i=[g.convert(t[0]),g.convert(t[1])];e=[i[0],new g(i[1].x,i[0].y),i[1],new g(i[0].x,i[1].y),i[0]]}return e.map(function(t){return n.transform.pointCoordinate(t)})},e.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},e.prototype.setStyle=function(t,e){if((!e||!1!==e.diff)&&this.style&&t&&!(t instanceof l)&&"string"!=typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){r.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),t?(this.style=t instanceof l?t:new l(t,this),this.style.setEventedParent(this,{style:this.style}),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this):(this.style=null,this)},e.prototype.getStyle=function(){if(this.style)return this.style.serialize()},e.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},e.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];return void 0===e?void this.fire("error",{error:new Error("There is no source with ID '"+t+"'")}):e.loaded()},e.prototype.addSourceType=function(t,e,n){return this.style.addSourceType(t,e,n)},e.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},e.prototype.getSource=function(t){return this.style.getSource(t)},e.prototype.addImage=function(t,e,n){this.style.spriteAtlas.addImage(t,e,n)},e.prototype.removeImage=function(t){this.style.spriteAtlas.removeImage(t)},e.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},e.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},e.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},e.prototype.getLayer=function(t){return this.style.getLayer(t)},e.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},e.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0),this},e.prototype.getFilter=function(t){return this.style.getFilter(t)},e.prototype.setPaintProperty=function(t,e,n,i){return this.style.setPaintProperty(t,e,n,i),this._update(!0),this},e.prototype.getPaintProperty=function(t,e,n){return this.style.getPaintProperty(t,e,n)},e.prototype.setLayoutProperty=function(t,e,n){return this.style.setLayoutProperty(t,e,n),this._update(!0),this},e.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},e.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},e.prototype.getLight=function(){return this.style.getLight()},e.prototype.getContainer=function(){return this._container},e.prototype.getCanvasContainer=function(){return this._canvasContainer},e.prototype.getCanvas=function(){return this._canvas},e.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},e.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map");var e=this._canvasContainer=s.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=s.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",0),this._canvas.setAttribute("aria-label","Map");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var i=this._controlContainer=s.create("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){r[t]=s.create("div","mapboxgl-ctrl-"+t,i)})},e.prototype._resizeCanvas=function(t,e){var n=a.devicePixelRatio||1;this._canvas.width=n*t,this._canvas.height=n*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},e.prototype._setupPainter=function(){var t=r.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},b.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);return e?void(this.painter=new c(e,this.transform)):void this.fire("error",{error:new Error("Failed to initialize WebGL")})},e.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&o.cancelFrame(this._frameId),this.fire("webglcontextlost",{originalEvent:t})},e.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:t})},e.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},e.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender(),this):this},e.prototype._render=function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.update(this._classes,this._classOptions),this._classOptions=null,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty)&&this._rerender(),this},e.prototype.remove=function(){this._hash&&this._hash.remove(),o.cancelFrame(this._frameId),this.setStyle(null),void 0!==a&&(a.removeEventListener("resize",this._onWindowResize,!1),a.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),i(this._canvasContainer),i(this._controlContainer),this._container.classList.remove("mapboxgl-map"),this.fire("remove")},e.prototype._rerender=function(){this.style&&!this._frameId&&(this._frameId=o.frame(this._render))},e.prototype._onWindowOnline=function(){this._update()},e.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},n.showTileBoundaries.get=function(){return!!this._showTileBoundaries},n.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},n.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},n.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this.style._redoPlacement())},n.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},n.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},n.repaint.get=function(){return!!this._repaint},n.repaint.set=function(t){this._repaint=t,this._update()},n.vertices.get=function(){return!!this._vertices},n.vertices.set=function(t){this._vertices=t,this._update()},e.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(t.dataType+"data",t)},e.prototype._onDataLoading=function(t){this.fire(t.dataType+"dataloading",t)},Object.defineProperties(e.prototype,n),e}(p);e.exports=w},{"../geo/lng_lat":62,"../geo/lng_lat_bounds":63,"../geo/transform":64,"../render/painter":77,"../style/animation_loop":143,"../style/style":146,"../util/browser":192,"../util/dom":199,"../util/util":212,"../util/window":194,"./bind_handlers":171,"./camera":172,"./control/attribution_control":173,"./control/logo_control":176,"./hash":186,"mapbox-gl-supported":22,"point-geometry":26}],188:[function(t,e,n){"use strict";var i=t("../util/dom"),r=t("../geo/lng_lat"),o=t("point-geometry"),a=function(t,e){this._offset=o.convert(e&&e.offset||[0,0]),this._update=this._update.bind(this),this._onMapClick=this._onMapClick.bind(this),t||(t=i.create("div")),t.classList.add("mapboxgl-marker"),this._element=t,this._popup=null};a.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},a.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map=null),i.remove(this._element),this._popup&&this._popup.remove(),this},a.prototype.getLngLat=function(){return this._lngLat},a.prototype.setLngLat=function(t){return this._lngLat=r.convert(t),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},a.prototype.getElement=function(){return this._element},a.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&(this._popup=t,this._popup.setLngLat(this._lngLat)),this},a.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},a.prototype.getPopup=function(){return this._popup},a.prototype.togglePopup=function(){var t=this._popup;t&&(t.isOpen()?t.remove():t.addTo(this._map))},a.prototype._update=function(t){if(this._map){var e=this._map.project(this._lngLat)._add(this._offset);t&&"moveend"!==t.type||(e=e.round()),i.setTransform(this._element,"translate("+e.x+"px, "+e.y+"px)")}},e.exports=a},{"../geo/lng_lat":62,"../util/dom":199,"point-geometry":26}],189:[function(t,e,n){"use strict";function i(t){if(t){if("number"==typeof t){var e=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{top:new l(0,t),"top-left":new l(e,e),"top-right":new l(-e,e),bottom:new l(0,-t),"bottom-left":new l(e,-e),"bottom-right":new l(-e,-e),left:new l(t,0),right:new l(-t,0)}}if(function(t){return t instanceof l||Array.isArray(t)}(t)){var n=l.convert(t);return{top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{top:l.convert(t.top||[0,0]),"top-left":l.convert(t["top-left"]||[0,0]),"top-right":l.convert(t["top-right"]||[0,0]),bottom:l.convert(t.bottom||[0,0]),"bottom-left":l.convert(t["bottom-left"]||[0,0]),"bottom-right":l.convert(t["bottom-right"]||[0,0]),left:l.convert(t.left||[0,0]),right:l.convert(t.right||[0,0])}}return i(new l(0,0))}var r=t("../util/util"),o=t("../util/evented"),a=t("../util/dom"),s=t("../geo/lng_lat"),l=t("point-geometry"),u=t("../util/window"),c={closeButton:!0,closeOnClick:!0},h=function(t){function e(e){t.call(this),this.options=r.extend(Object.create(c),e),r.bindAll(["_update","_onClickClose"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},e.prototype.isOpen=function(){return!!this._map},e.prototype.remove=function(){return this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},e.prototype.getLngLat=function(){return this._lngLat},e.prototype.setLngLat=function(t){return this._lngLat=s.convert(t),this._update(),this},e.prototype.setText=function(t){return this.setDOMContent(u.document.createTextNode(t))},e.prototype.setHTML=function(t){var e,n=u.document.createDocumentFragment(),i=u.document.createElement("body");for(i.innerHTML=t;e=i.firstChild;)n.appendChild(e);return this.setDOMContent(n)},e.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},e.prototype._createContent=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._content=a.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=a.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},e.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=a.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=a.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content));var t=this.options.anchor,e=i(this.options.offset),n=this._map.project(this._lngLat).round();if(!t){var r=this._container.offsetWidth,o=this._container.offsetHeight;t=n.y+e.bottom.y<o?["top"]:n.y>this._map.transform.height-o?["bottom"]:[],n.x<r/2?t.push("left"):n.x>this._map.transform.width-r/2&&t.push("right"),t=0===t.length?"bottom":t.join("-")}var s=n.add(e[t]),l={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},u=this._container.classList;for(var c in l)u.remove("mapboxgl-popup-anchor-"+c);u.add("mapboxgl-popup-anchor-"+t),a.setTransform(this._container,l[t]+" translate("+s.x+"px,"+s.y+"px)")}},e.prototype._onClickClose=function(){this.remove()},e}(o);e.exports=h},{"../geo/lng_lat":62,"../util/dom":199,"../util/evented":200,"../util/util":212,"../util/window":194,"point-geometry":26}],190:[function(t,e,n){"use strict";var i=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)};i.prototype.send=function(t,e,n,i,r){var o=n?this.mapId+":"+this.callbackID++:null;n&&(this.callbacks[o]=n),this.target.postMessage({targetMapId:r,sourceMapId:this.mapId,type:t,id:String(o),data:e},i)},i.prototype.receive=function(t){var e,n=this,i=t.data,r=i.id;if(!i.targetMapId||this.mapId===i.targetMapId){var o=function(t,e,i){n.target.postMessage({sourceMapId:n.mapId,type:"<response>",id:String(r),error:t?String(t):null,data:e},i)};if("<response>"===i.type)e=this.callbacks[i.id],delete this.callbacks[i.id],e&&e(i.error||null,i.data);else if(void 0!==i.id&&this.parent[i.type])this.parent[i.type](i.sourceMapId,i.data,o);else if(void 0!==i.id&&this.parent.getWorkerSource){var a=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,a[0])[a[1]](i.data,o)}else this.parent[i.type](i.data)}},i.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},e.exports=i},{}],191:[function(t,e,n){"use strict";function i(t){var e=r.document.createElement("a");return e.href=t,e.protocol===r.document.location.protocol&&e.host===r.document.location.host}var r=t("./window");n.getJSON=function(t,e){var n=new r.XMLHttpRequest;return n.open("GET",t,!0),n.setRequestHeader("Accept","application/json"),n.onerror=function(t){e(t)},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var t;try{t=JSON.parse(n.response)}catch(t){return e(t)}e(null,t)}else e(new Error(n.statusText))},n.send(),n},n.getArrayBuffer=function(t,e){var n=new r.XMLHttpRequest;return n.open("GET",t,!0),n.responseType="arraybuffer",n.onerror=function(t){e(t)},n.onload=function(){return 0===n.response.byteLength&&200===n.status?e(new Error("http status 200 returned without content.")):void(n.status>=200&&n.status<300&&n.response?e(null,{data:n.response,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):e(new Error(n.statusText)))},n.send(),n};n.getImage=function(t,e){return n.getArrayBuffer(t,function(t,n){if(t)return e(t);var i=new r.Image,o=r.URL||r.webkitURL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src)};var a=new r.Blob([new Uint8Array(n.data)],{type:"image/png"});i.cacheControl=n.cacheControl,i.expires=n.expires,i.src=n.data.byteLength?o.createObjectURL(a):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="})},n.getVideo=function(t,e){var n=r.document.createElement("video");n.onloadstart=function(){e(null,n)};for(var o=0;o<t.length;o++){var a=r.document.createElement("source");i(t[o])||(n.crossOrigin="Anonymous"),a.src=t[o],n.appendChild(a)}return n}},{"./window":194}],192:[function(t,e,n){"use strict";var i=t("./window");e.exports.now=i.performance&&i.performance.now?i.performance.now.bind(i.performance):Date.now.bind(Date);var r=i.requestAnimationFrame||i.mozRequestAnimationFrame||i.webkitRequestAnimationFrame||i.msRequestAnimationFrame;n.frame=function(t){return r(t)};var o=i.cancelAnimationFrame||i.mozCancelAnimationFrame||i.webkitCancelAnimationFrame||i.msCancelAnimationFrame;n.cancelFrame=function(t){o(t)},n.timed=function(t,i,r){if(!i)return t.call(r,1),null;var o=!1,a=e.exports.now();return n.frame(function s(l){o||((l=e.exports.now())>=a+i?t.call(r,1):(t.call(r,(l-a)/i),n.frame(s)))}),function(){o=!0}},n.getImageData=function(t){var e=i.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height).data},n.supported=t("mapbox-gl-supported"),n.hardwareConcurrency=i.navigator.hardwareConcurrency||4,Object.defineProperty(n,"devicePixelRatio",{get:function(){return i.devicePixelRatio}}),n.supportsWebp=!1;var a=i.document.createElement("img");a.onload=function(){n.supportsWebp=!0},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":194,"mapbox-gl-supported":22}],193:[function(t,e,n){"use strict";var i=t("webworkify"),r=t("../window"),o=r.URL.createObjectURL(new i(t("../../source/worker"),{bare:!0}));e.exports=function(){return new r.Worker(o)}},{"../../source/worker":98,"../window":194,webworkify:41}],194:[function(t,e,n){"use strict";e.exports=self},{}],195:[function(t,e,n){"use strict";function i(t,e){return e.area-t.area}var r=t("quickselect"),o=t("./util").calculateSignedArea;e.exports=function(t,e){var n=t.length;if(n<=1)return[t];for(var a,s,l=[],u=0;u<n;u++){var c=o(t[u]);0!==c&&(t[u].area=Math.abs(c),void 0===s&&(s=c<0),s===c<0?(a&&l.push(a),a=[t[u]]):a.push(t[u]))}if(a&&l.push(a),e>1)for(var h=0;h<l.length;h++)l[h].length<=e||(r(l[h],e,1,l[h].length-1,i),l[h]=l[h].slice(0,e));return l}},{"./util":212,quickselect:28}],196:[function(t,e,n){"use strict";e.exports={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null}},{}],197:[function(t,e,n){"use strict";var i=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};i.prototype.encode=function(t){return this._stringToNumber[t]},i.prototype.decode=function(t){return this._numberToString[t]},e.exports=i},{}],198:[function(t,e,n){"use strict";var i=t("./util"),r=t("./actor"),o=function(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=i.uniqueId();for(var n=this.workerPool.acquire(this.id),o=0;o<n.length;o++){var a=n[o],s=new r(a,e,this.id);s.name="Worker "+o,this.actors.push(s)}};o.prototype.broadcast=function(t,e,n){n=n||function(){},i.asyncAll(this.actors,function(n,i){n.send(t,e,i)},n)},o.prototype.send=function(t,e,n,i,r){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,e,n,r),i},o.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},e.exports=o},{"./actor":190,"./util":212}],199:[function(t,e,n){"use strict";function i(t){for(var e=0;e<t.length;e++)if(t[e]in l)return t[e];return t[0]}function r(t){t.preventDefault(),t.stopPropagation(),a.removeEventListener("click",r,!0)}var o=t("point-geometry"),a=t("./window");n.create=function(t,e,n){var i=a.document.createElement(t);return e&&(i.className=e),n&&n.appendChild(i),i};var s,l=a.document.documentElement.style,u=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){u&&(s=l[u],l[u]="none")},n.enableDrag=function(){u&&(l[u]=s)};var c=i(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[c]=e},n.suppressClick=function(){a.addEventListener("click",r,!0),a.setTimeout(function(){a.removeEventListener("click",r,!0)},0)},n.mousePos=function(t,e){var n=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new o(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},n.touchPos=function(t,e){for(var n=t.getBoundingClientRect(),i=[],r="touchend"===e.type?e.changedTouches:e.touches,a=0;a<r.length;a++)i.push(new o(r[a].clientX-n.left-t.clientLeft,r[a].clientY-n.top-t.clientTop));return i},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)}},{"./window":194,"point-geometry":26}],200:[function(t,e,n){"use strict";function i(t,e,n){n[t]=n[t]||[],n[t].push(e)}function r(t,e,n){if(n&&n[t]){var i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}var o=t("./util"),a=function(){};a.prototype.on=function(t,e){return this._listeners=this._listeners||{},i(t,e,this._listeners),this},a.prototype.off=function(t,e){return r(t,e,this._listeners),r(t,e,this._oneTimeListeners),this},a.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},i(t,e,this._oneTimeListeners),this},a.prototype.fire=function(t,e){var n=this;if(this.listens(t)){e=o.extend({},e,{type:t,target:this});for(var i=this._listeners&&this._listeners[t]?this._listeners[t].slice():[],a=0;a<i.length;a++)i[a].call(n,e);for(var s=this._oneTimeListeners&&this._oneTimeListeners[t]?this._oneTimeListeners[t].slice():[],l=0;l<s.length;l++)s[l].call(n,e),r(t,s[l],n._oneTimeListeners);this._eventedParent&&this._eventedParent.fire(t,o.extend({},e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData))}else o.endsWith(t,"error")&&console.error(e&&e.error||e||"Empty error event");return this},a.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},a.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this},e.exports=a},{"./util":212}],201:[function(t,e,n){"use strict";function i(t,e){return e.max-t.max}function r(t,e,n,i){this.p=new a(t,e),this.h=n,this.d=function(t,e){for(var n=!1,i=1/0,r=0;r<e.length;r++)for(var o=e[r],a=0,l=o.length,u=l-1;a<l;u=a++){var c=o[a],h=o[u];c.y>t.y!=h.y>t.y&&t.x<(h.x-c.x)*(t.y-c.y)/(h.y-c.y)+c.x&&(n=!n),i=Math.min(i,s(t,c,h))}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}var o=t("tinyqueue"),a=t("point-geometry"),s=t("./intersection_tests").distToSegmentSquared;e.exports=function(t,e,n){e=e||1;for(var a,s,l,u,c=t[0],h=0;h<c.length;h++){var d=c[h];(!h||d.x<a)&&(a=d.x),(!h||d.y<s)&&(s=d.y),(!h||d.x>l)&&(l=d.x),(!h||d.y>u)&&(u=d.y)}var f=l-a,p=u-s,m=Math.min(f,p),v=m/2,g=new o(null,i);if(0===m)return[a,s];for(var y=a;y<l;y+=m)for(var _=s;_<u;_+=m)g.push(new r(y+v,_+v,v,t));for(var b=function(t){for(var e=0,n=0,i=0,o=t[0],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l],h=u.x*c.y-c.x*u.y;n+=(u.x+c.x)*h,i+=(u.y+c.y)*h,e+=3*h}return new r(n/e,i/e,0,t)}(t),x=g.length;g.length;){var w=g.pop();(w.d>b.d||!b.d)&&(b=w,n&&console.log("found best %d after %d probes",Math.round(1e4*w.d)/1e4,x)),w.max-b.d<=e||(v=w.h/2,g.push(new r(w.p.x-v,w.p.y-v,v,t)),g.push(new r(w.p.x+v,w.p.y-v,v,t)),g.push(new r(w.p.x-v,w.p.y+v,v,t)),g.push(new r(w.p.x+v,w.p.y+v,v,t)),x+=4)}return n&&(console.log("num probes: "+x),console.log("best distance: "+b.d)),b.p}},{"./intersection_tests":205,"point-geometry":26,tinyqueue:30}],202:[function(t,e,n){"use strict";var i,r=t("./worker_pool");e.exports=function(){return i||(i=new r),i}},{"./worker_pool":215}],203:[function(t,e,n){"use strict";function i(t,e,n){if(1===t){var i=n.readMessage(r,{glyphs:{}});e.push(i)}}function r(t,e,n){if(1===t)e.name=n.readString();else if(2===t)e.range=n.readString();else if(3===t){var i=n.readMessage(o,{});e.glyphs[i.id]=i}}function o(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}e.exports=function(t,e){this.stacks=t.readFields(i,[],e)}},{}],204:[function(t,e,n){"use strict";function i(t,e,n){return t*(1-n)+e*n}e.exports=i,i.number=i,i.vec2=function(t,e,n){return[i(t[0],e[0],n),i(t[1],e[1],n)]},i.color=function(t,e,n){return[i(t[0],e[0],n),i(t[1],e[1],n),i(t[2],e[2],n),i(t[3],e[3],n)]},i.array=function(t,e,n){return t.map(function(t,r){return i(t,e[r],n)})}},{}],205:[function(t,e,n){"use strict";function i(t,e,n){if(t.length>1){if(r(t,e))return!0;for(var i=0;i<e.length;i++)if(a(e[i],t,n))return!0}for(var o=0;o<t.length;o++)if(a(t[o],e,n))return!0;return!1}function r(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var i=t[n],r=t[n+1],a=0;a<e.length-1;a++){if(o(i,r,e[a],e[a+1]))return!0}return!1}function o(t,e,n,i){return c(t,n,i)!==c(e,n,i)&&c(t,e,n)!==c(t,e,i)}function a(t,e,n){var i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(var r=1;r<e.length;r++){if(s(t,e[r-1],e[r])<i)return!0}return!1}function s(t,e,n){var i=e.distSqr(n);if(0===i)return t.distSqr(e);var r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return r<0?t.distSqr(e):r>1?t.distSqr(n):t.distSqr(n.sub(e)._mult(r)._add(e))}function l(t,e){for(var n,i,r,o=!1,a=0;a<t.length;a++)for(var s=0,l=(n=t[a]).length-1;s<n.length;l=s++)i=n[s],r=n[l],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(o=!o);return o}function u(t,e){for(var n=!1,i=0,r=t.length-1;i<t.length;r=i++){var o=t[i],a=t[r];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}var c=t("./util").isCounterClockwise;e.exports={multiPolygonIntersectsBufferedMultiPoint:function(t,e,n){for(var i=0;i<t.length;i++)for(var r=t[i],o=0;o<e.length;o++)for(var s=e[o],l=0;l<s.length;l++){var c=s[l];if(u(r,c))return!0;if(a(c,r,n))return!0}return!1},multiPolygonIntersectsMultiPolygon:function(t,e){if(1===t.length&&1===t[0].length)return l(e,t[0][0]);for(var n=0;n<e.length;n++)for(var i=e[n],o=0;o<i.length;o++)if(l(t,i[o]))return!0;for(var a=0;a<t.length;a++){for(var s=t[a],u=0;u<s.length;u++)if(l(e,s[u]))return!0;for(var c=0;c<e.length;c++)if(r(s,e[c]))return!0}return!1},multiPolygonIntersectsBufferedMultiLine:function(t,e,n){for(var r=0;r<e.length;r++)for(var o=e[r],a=0;a<t.length;a++){var s=t[a];if(s.length>=3)for(var l=0;l<o.length;l++)if(u(s,o[l]))return!0;if(i(s,o,n))return!0}return!1},polygonIntersectsPolygon:function(t,e){for(var n=0;n<t.length;n++)if(u(e,t[n]))return!0;for(var i=0;i<e.length;i++)if(u(t,e[i]))return!0;return!!r(t,e)},distToSegmentSquared:s}},{"./util":212}],206:[function(t,e,n){"use strict";e.exports={"Latin-1 Supplement":function(t){return t>=128&&t<=255},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}}},{}],207:[function(t,e,n){"use strict";var i=function(t,e){this.max=t,this.onRemove=e,this.reset()};i.prototype.reset=function(){var t=this;for(var e in t.data)t.onRemove(t.data[e]);return this.data={},this.order=[],this},i.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var n=this.get(this.order[0]);n&&this.onRemove(n)}return this},i.prototype.has=function(t){return t in this.data},i.prototype.keys=function(){return this.order},i.prototype.get=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},i.prototype.getWithoutRemoving=function(t){return this.has(t)?this.data[t]:null},i.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},i.prototype.setMaxSize=function(t){var e=this;for(this.max=t;this.order.length>this.max;){var n=e.get(e.order[0]);n&&e.onRemove(n)}return this},e.exports=i},{}],208:[function(t,e,n){"use strict";function i(t,e){var n=o(s.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,!s.REQUIRE_ACCESS_TOKEN)return a(t);if(!(e=e||s.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params.push("access_token="+e),a(t)}function r(t){return 0===t.indexOf("mapbox:")}function o(t){var e=t.match(h);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function a(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var s=t("./config"),l=t("./browser"),u="See https://www.mapbox.com/api-documentation/#access-tokens";n.isMapboxURL=r,n.normalizeStyleURL=function(t,e){if(!r(t))return t;var n=o(t);return n.path="/styles/v1"+n.path,i(n,e)},n.normalizeGlyphsURL=function(t,e){if(!r(t))return t;var n=o(t);return n.path="/fonts/v1"+n.path,i(n,e)},n.normalizeSourceURL=function(t,e){if(!r(t))return t;var n=o(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),i(n,e)},n.normalizeSpriteURL=function(t,e,n,s){var l=o(t);return r(t)?(l.path="/styles/v1"+l.path+"/sprite"+e+n,i(l,s)):(l.path+=""+e+n,a(l))};var c=/(\.(png|jpg)\d*)(?=$)/;n.normalizeTileURL=function(t,e,n){if(!e||!r(e))return t;var i=o(t),u=l.devicePixelRatio>=2||512===n?"@2x":"",h=l.supportsWebp?".webp":"$1";return i.path=i.path.replace(c,""+u+h),function(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(s.ACCESS_TOKEN||""))}(i.params),a(i)};var h=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/},{"./browser":192,"./config":196}],209:[function(t,e,n){"use strict";var i=t("./is_char_in_unicode_block");e.exports.allowsIdeographicBreaking=function(t){for(var e=0,i=t;e<i.length;e+=1){var r=i[e];if(!n.charAllowsIdeographicBreaking(r.charCodeAt(0)))return!1}return!0},e.exports.allowsVerticalWritingMode=function(t){for(var e=0,i=t;e<i.length;e+=1){var r=i[e];if(n.charHasUprightVerticalOrientation(r.charCodeAt(0)))return!0}return!1},e.exports.charAllowsIdeographicBreaking=function(t){return!!(!(t<11904)&&(i["Bopomofo Extended"](t)||i.Bopomofo(t)||i["CJK Compatibility Forms"](t)||i["CJK Compatibility Ideographs"](t)||i["CJK Compatibility"](t)||i["CJK Radicals Supplement"](t)||i["CJK Strokes"](t)||i["CJK Symbols and Punctuation"](t)||i["CJK Unified Ideographs Extension A"](t)||i["CJK Unified Ideographs"](t)||i["Enclosed CJK Letters and Months"](t)||i["Halfwidth and Fullwidth Forms"](t)||i.Hiragana(t)||i["Ideographic Description Characters"](t)||i["Kangxi Radicals"](t)||i["Katakana Phonetic Extensions"](t)||i.Katakana(t)||i["Vertical Forms"](t)||i["Yi Radicals"](t)||i["Yi Syllables"](t)))},n.charHasUprightVerticalOrientation=function(t){return!!(746===t||747===t||!(t<4352)&&(i["Bopomofo Extended"](t)||i.Bopomofo(t)||i["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||i["CJK Compatibility Ideographs"](t)||i["CJK Compatibility"](t)||i["CJK Radicals Supplement"](t)||i["CJK Strokes"](t)||!(!i["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||i["CJK Unified Ideographs Extension A"](t)||i["CJK Unified Ideographs"](t)||i["Enclosed CJK Letters and Months"](t)||i["Hangul Compatibility Jamo"](t)||i["Hangul Jamo Extended-A"](t)||i["Hangul Jamo Extended-B"](t)||i["Hangul Jamo"](t)||i["Hangul Syllables"](t)||i.Hiragana(t)||i["Ideographic Description Characters"](t)||i.Kanbun(t)||i["Kangxi Radicals"](t)||i["Katakana Phonetic Extensions"](t)||i.Katakana(t)&&12540!==t||!(!i["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!i["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||i["Unified Canadian Aboriginal Syllabics"](t)||i["Unified Canadian Aboriginal Syllabics Extended"](t)||i["Vertical Forms"](t)||i["Yijing Hexagram Symbols"](t)||i["Yi Syllables"](t)||i["Yi Radicals"](t)))},n.charHasNeutralVerticalOrientation=function(t){return!!(i["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||i["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||i["Letterlike Symbols"](t)||i["Number Forms"](t)||i["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||i["Control Pictures"](t)&&9251!==t||i["Optical Character Recognition"](t)||i["Enclosed Alphanumerics"](t)||i["Geometric Shapes"](t)||i["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||i["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||i["CJK Symbols and Punctuation"](t)||i.Katakana(t)||i["Private Use Area"](t)||i["CJK Compatibility Forms"](t)||i["Small Form Variants"](t)||i["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)},n.charHasRotatedVerticalOrientation=function(t){return!(n.charHasUprightVerticalOrientation(t)||n.charHasNeutralVerticalOrientation(t))}},{"./is_char_in_unicode_block":206}],210:[function(t,e,n){"use strict";function i(t,e){return Math.ceil(t/e)*e}function r(t){return u[t].BYTES_PER_ELEMENT}function o(t){return t.toLowerCase()}function a(t,e){var n="this._pos"+r(t.type).toFixed(0)+" + "+(t.offset/r(t.type)+e).toFixed(0);return"this._structArray."+o(t.type)+"["+n+"]"}function s(t,e){return new Function("return "+a(t,e)+";")}function l(t,e){return new Function("x",a(t,e)+" = x;")}e.exports=function(t){var e=JSON.stringify(t);if(d[e])return d[e];var n=void 0===t.alignment?1:t.alignment,a=0,u=0,f=["Uint8"],p=t.members.map(function(t){f.indexOf(t.type)<0&&f.push(t.type);var e=r(t.type),o=a=i(a,Math.max(n,e)),s=t.components||1;return u=Math.max(u,e),a+=e*s,{name:t.name,type:t.type,components:s,offset:o}}),m=i(a,Math.max(u,n)),v=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(c);v.prototype.alignment=n,v.prototype.size=m;for(var g=0,y=p;g<y.length;g+=1)for(var _=y[g],b=0;b<_.components;b++){var x=_.name+(1===_.components?"":b);Object.defineProperty(v.prototype,x,{get:s(_,b),set:l(_,b)})}var w=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(h);return w.prototype.members=p,w.prototype.StructType=v,w.prototype.bytesPerElement=m,w.prototype.emplaceBack=function(t,e){for(var n=[],i=[],a="var i = this.length;\nthis.resize(this.length + 1);\n",s=0,l=t;s<l.length;s+=1){var u=l[s],c=r(u.type);n.indexOf(c)<0&&(n.push(c),a+="var o"+c.toFixed(0)+" = i * "+(e/c).toFixed(0)+";\n");for(var h=0;h<u.components;h++){var d="v"+i.length,f="o"+c.toFixed(0)+" + "+(u.offset/c+h).toFixed(0);a+="this."+o(u.type)+"["+f+"] = "+d+";\n",i.push(d)}}return a+="return i;",new Function(i.toString(),a)}(p,m),w.prototype._usedTypes=f,d[e]=w,w};var u={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array},c=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},h=function(t){this.isTransferred=!1,void 0!==t?(this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))};h.serialize=function(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}},h.prototype.serialize=function(t){return this._trim(),t&&(this.isTransferred=!0,t.push(this.arrayBuffer)),{length:this.length,arrayBuffer:this.arrayBuffer}},h.prototype.get=function(t){return new this.StructType(this,t)},h.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},h.prototype.resize=function(t){if(this.length=t,t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},h.prototype._refreshViews=function(){for(var t=this,e=0,n=t._usedTypes;e<n.length;e+=1){var i=n[e];t[o(i)]=new u[i](t.arrayBuffer)}},h.prototype.toArray=function(t,e){for(var n=[],i=t;i<e;i++){var r=this.get(i);n.push(r)}return n};var d={}},{}],211:[function(t,e,n){"use strict";e.exports=function(t,e){return e.replace(/{([^{}]+)}/g,function(e,n){return n in t?t[n]:""})}},{}],212:[function(t,e,n){"use strict";var i=t("@mapbox/unitbezier"),r=t("../geo/coordinate");t("point-geometry");n.easeCubicInOut=function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)},n.bezier=function(t,e,n,r){var o=new i(t,e,n,r);return function(t){return o.solve(t)}},n.ease=n.bezier(.25,.1,.25,1),n.clamp=function(t,e,n){return Math.min(n,Math.max(e,t))},n.wrap=function(t,e,n){var i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r},n.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var i=t.length,r=new Array(t.length),o=null;t.forEach(function(t,a){e(t,function(t,e){t&&(o=t),r[a]=e,0==--i&&n(o,r)})})},n.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},n.keysDifference=function(t,e){var n=[];for(var i in t)i in e||n.push(i);return n},n.extend=function(t,e,n,i){for(var r=arguments,o=1;o<arguments.length;o++){var a=r[o];for(var s in a)t[s]=a[s]}return t},n.pick=function(t,e){for(var n={},i=0;i<e.length;i++){var r=e[i];r in t&&(n[r]=t[r])}return n};var o=1;n.uniqueId=function(){return o++},n.bindAll=function(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})},n.getCoordinatesCenter=function(t){for(var e=1/0,n=1/0,i=-1/0,o=-1/0,a=0;a<t.length;a++)e=Math.min(e,t[a].column),n=Math.min(n,t[a].row),i=Math.max(i,t[a].column),o=Math.max(o,t[a].row);var s=i-e,l=o-n,u=Math.max(s,l);return new r((e+i)/2,(n+o)/2,0).zoomTo(Math.floor(-Math.log(u)/Math.LN2))},n.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},n.mapObject=function(t,e,n){var i={};for(var r in t)i[r]=e.call(n||this,t[r],r,t);return i},n.filterObject=function(t,e,n){var i={};for(var r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i},n.deepEqual=function(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!n.deepEqual(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(!n.deepEqual(t[r],e[r]))return!1;return!0}return t===e},n.clone=function(t){return Array.isArray(t)?t.map(n.clone):"object"==typeof t&&t?n.mapObject(t,n.clone):t},n.arraysIntersect=function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1};var a={};n.warnOnce=function(t){a[t]||("undefined"!=typeof console&&console.warn(t),a[t]=!0)},n.isCounterClockwise=function(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)},n.calculateSignedArea=function(t){for(var e=0,n=0,i=t.length,r=i-1,o=void 0,a=void 0;n<i;r=n++)o=t[n],e+=((a=t[r]).x-o.x)*(o.y+a.y);return e},n.isClosedPolygon=function(t){if(t.length<4)return!1;var e=t[0],i=t[t.length-1];return!(Math.abs(e.x-i.x)>0||Math.abs(e.y-i.y)>0)&&Math.abs(n.calculateSignedArea(t))>.01},n.sphericalToCartesian=function(t){var e=t[0],n=t[1],i=t[2];return n+=90,n*=Math.PI/180,i*=Math.PI/180,[e*Math.cos(n)*Math.sin(i),e*Math.sin(n)*Math.sin(i),e*Math.cos(i)]},n.parseCacheControl=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,n,i,r){var o=i||r;return e[n]=!o||o.toLowerCase(),""}),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}},{"../geo/coordinate":61,"@mapbox/unitbezier":3,"point-geometry":26}],213:[function(t,e,n){"use strict";var i=function(t,e,n,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,null!=t.id&&(this.id=t.id)},r={geometry:{}};r.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},r.geometry.set=function(t){this._geometry=t},i.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(i.prototype,r),e.exports=i},{}],214:[function(t,e,n){"use strict";var i=t("./script_detection");e.exports=function(t){for(var n="",r=0;r<t.length;r++){var o=t.charCodeAt(r+1)||null,a=t.charCodeAt(r-1)||null;n+=(!o||!i.charHasRotatedVerticalOrientation(o)||e.exports.lookup[t[r+1]])&&(!a||!i.charHasRotatedVerticalOrientation(a)||e.exports.lookup[t[r-1]])&&e.exports.lookup[t[r]]?e.exports.lookup[t[r]]:t[r]}return n},e.exports.lookup={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"}},{"./script_detection":209}],215:[function(t,e,n){"use strict";var i=t("./web_worker"),r=function(){this.active={}};r.prototype.acquire=function(e){if(!this.workers){var n=t("../").workerCount;for(this.workers=[];this.workers.length<n;)this.workers.push(new i)}return this.active[e]=!0,this.workers.slice()},r.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},e.exports=r},{"../":65,"./web_worker":193}]},{},[65])(65)},t.exports=i()}).call(e,n(12))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){t.exports=n(0)}])},46:function(t,e){t.exports="./assets/bubblechart.css"},47:function(t,e){!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(5);var i,r=n(1),o=(i=r)&&i.__esModule?i:{default:i};e.default=Vizabi.Tool.extend("BubbleChart",{init:function(t,e){this.name="bubblechart",this.components=[{component:o.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.time","locale","ui"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),t.ui.chart.lockNonSelected&&(!t.ui.splash||!1===t.state.time.splash)){var e=t.state.time.parse(""+t.ui.chart.lockNonSelected);e<t.state.time.start&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.start)),e>t.state.time.end&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.end))}},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},marker:{limit:5e3,space:["entities","time"],axis_x:{use:"indicator",autoconfig:{index:0,type:"measure"}},axis_y:{use:"indicator",autoconfig:{index:1,type:"measure"}},label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},size:{autoconfig:{index:2,type:"measure"}},color:{syncModels:["marker_colorlegend"],autoconfig:{}},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33],allow:{names:["_default"]}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{decorations:{enabled:!0,xAxisGroups:null},superhighlightOnMinimapHover:!0,whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},margin:{left:0,top:0},trails:!0,lockNonSelected:0},datawarning:{doubtDomain:[],doubtRange:[]},show_ticks:!0,presentation:!1,panWithArrow:!1,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!1,buttons:["colors","find","zoom","trails","lock","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","zoom","moreoptions"],sidebar:["colors","find","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","presentation","about"]}}},versionInfo:{version:"2.1.3",build:1531651491103}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(3)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var a=Vizabi.utils,s=Vizabi.helpers,l=s.svgexport,u=s.labels,c=s["d3.axisWithLabelPicker"],h=s["d3.dynamicBackground"],d=Vizabi.iconset,f=d.warn,p=d.question,m=Vizabi.Component.extend("bubblechart",{init:function(t,e){var o=this,s=this;this.name="bubblechart",this.template=n(6),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.playing":function(t,e){a.isTouchDevice()&&s.model.time.playing&&s.someHighlighted&&s.model.marker.clearHighlighted()},"change:time.start":function(t,e){s._readyOnce&&!s.model.time.splash&&(["color","axis_x","axis_y"].filter(function(t){return s.model.marker[t].which==s.model.time.dim}).length?s.ready():s._trails.create().then(function(){s._trails.run(["findVisible","reveal","opacityHandler"])}))},"change:time.end":function(t,e){s._readyOnce&&!s.model.time.splash&&(["color","axis_x","axis_y"].filter(function(t){return s.model.marker[t].which==s.model.time.dim}).length?s.ready():s._trails.create().then(function(){s._trails.run(["findVisible","reveal","opacityHandler"])}))},"change:time.record":function(){s.model.time.record?s._export.open(this.element,this.name):s._export.reset()},"change:ui.chart.trails":function(t){s._readyOnce&&(s._trails.toggle(s.model.ui.chart.trails),s.redrawDataPoints())},"change:ui.chart.lockNonSelected":function(t){s._readyOnce&&s.redrawDataPoints(500)},"change:ui.chart.decorations":function(t){s._readyOnce&&s._updateDecorations(500)},"change:marker":function(t,e){if(s._readyOnce)if(e.indexOf("scaleType")>-1)s.ready();else if(-1===e.indexOf("marker.color")&&-1===e.indexOf("marker.size")&&-1===e.indexOf("marker.size_label"))if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1){if(!s.yScale||!s.xScale)return;s.updateSize(),s.updateMarkerSizeLimits(),s._trails.run("findVisible"),s.redrawDataPoints(),s._trails.run("resize",null,500)}else if(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(s.draggingNow)return;if(a.approxEqual(s._zoomedXYMinMax.axis_x.zoomedMin,s.model.marker.axis_x.zoomedMin,.01)&&a.approxEqual(s._zoomedXYMinMax.axis_x.zoomedMax,s.model.marker.axis_x.zoomedMax,.01)&&a.approxEqual(s._zoomedXYMinMax.axis_y.zoomedMin,s.model.marker.axis_y.zoomedMin,.01)&&a.approxEqual(s._zoomedXYMinMax.axis_y.zoomedMax,s.model.marker.axis_y.zoomedMax,.01))return;var n=!1;s.model.time.playing&&(n=!0,s.model.time.pause(!0)),s._trails.run("abortAnimation"),s._panZoom.zoomToMaxMin(s.model.marker.axis_x.getZoomedMin(),s.model.marker.axis_x.getZoomedMax(),s.model.marker.axis_y.getZoomedMin(),s.model.marker.axis_y.getZoomedMax(),500,"don't feed these zoom values back to state"),n&&(s.model.time.postponePause=!1)}},"change:marker.select":function(t,e){s._readyOnce&&s.entityBubbles&&((t.source._val||[]).length-(t.source._previousVal||[]).length>50&&(s.model.ui.chart.trails=!1),s.selectDataPoints(),s.redrawDataPoints(),s._trails.create().then(function(){s._trails.run(["findVisible","reveal","opacityHandler"])}),s.updateBubbleOpacity(),s._updateDoubtOpacity())},"change:marker.superHighlight":function(t,e){o._readyOnce&&o._blinkSuperHighlighted()},"change:marker.highlight":function(t,e){if(s._readyOnce)if("highlight"==e)s.highlightDataPoints();else if(null!==e){var n=s._formatSTitleValues(e.size,e.color);s._updateSTitle(n[0],n[1])}else s._updateSTitle()},"change:time.value":function(){var t;!s.model.time.splash&&s._readyOnce&&s.entityBubbles&&(s.calculationQueue?s.calculationQueue.push(s.model.time.value.toString()):s.calculationQueue=[s.model.time.value.toString()],t=s.model.time.value,s.model.marker.getFrame(t,function(t,e){if(!s._frameIsValid(t))return a.warn("change:time.value: empty data received from marker.getFrame(). doing nothing");var n=s.calculationQueue.indexOf(e.toString());-1!=n&&(s.calculationQueue.splice(0,n+1),s.frameChanged(t,e))}))},"change:ui.adaptMinMaxZoom":function(){s.model.ui.adaptMinMaxZoom?s._panZoom.expandCanvas(500):s._panZoom.reset()},"change:marker.size.extent":function(t,e){s._readyOnce&&(s.updateMarkerSizeLimits(),s.redrawDataPointsOnlySize(),s._trails.run("resize"))},"change:marker.color":function(t,e){s._readyOnce&&(s.redrawDataPointsOnlyColors(),s._trails.run("recolor"))},"change:marker.opacitySelectDim":function(){s.updateBubbleOpacity()},"change:marker.opacityRegular":function(){s.updateBubbleOpacity(),s._trails.run("opacityHandler")},"change:ui.cursorMode":function(){var t=s.chartSvg;"plus"===s.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1)):"minus"===s.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0),t.classed("vzb-panhand",!1)):"hand"===s.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1))},"change:marker.space":function(){s.someHighlighted&&s.model.marker.clearHighlighted(),s.someSelected&&s.model.marker.clearSelected()},ready:function(){}},this._super(t,e),this.xScale=null,this.yScale=null,this.sScale=null,this.cScale=null,this.xAxis=c("bottom"),this.yAxis=c("left"),s.COLOR_BLACKISH="#333",s.COLOR_WHITEISH="#fdfdfd",this.isCanvasPreviouslyExpanded=!1,this.draggingNow=null,this._trails=new i.default(this),this._panZoom=new r.default(this),this._export=new l(this),this._export.prefix("vzb-bc-").deleteClasses(["vzb-bc-bubbles-crop","vzb-hidden","vzb-bc-year","vzb-bc-zoom-rect","vzb-bc-projection-x","vzb-bc-projection-y","vzb-bc-axis-c-title"]),this._labels=new u(this),this._labels.config({CSS_PREFIX:"vzb-bc",LABELS_CONTAINER_CLASS:"vzb-bc-labels",LINES_CONTAINER_CLASS:"vzb-bc-bubbles",LINES_CONTAINER_SELECTOR_PREFIX:"bubble-"})},_rangeBump:function(t,e){var n=this.activeProfile.maxRadiusPx/2;if(e=e?-1:1,a.isArray(t)&&t.length>1){var i=t[0],r=t[t.length-1];return i<r?(i+=n*e)>(r-=n*e)&&(i=r=(i+r)/2):i>r&&(i-=n*e)<(r+=n*e)&&(i=r=(i+r)/2),[i,r]}a.warn("rangeBump error: input is not an array or empty")},readyOnce:function(){var t=this;this._readyOnce=!1,this.scrollableAncestor=a.findScrollableAncestor(this.element),this.element=d3.select(this.element),this.chartSvg=this.element.select("svg"),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisElContainer=this.graph.select(".vzb-bc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-bc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.ySubTitleEl=this.graph.select(".vzb-bc-axis-y-subtitle"),this.xSubTitleEl=this.graph.select(".vzb-bc-axis-x-subtitle"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.sTitleEl=this.graph.select(".vzb-bc-axis-s-title"),this.cTitleEl=this.graph.select(".vzb-bc-axis-c-title"),this.yearEl=this.graph.select(".vzb-bc-year"),this.year=new h(this.yearEl),this.yInfoEl=this.graph.select(".vzb-bc-axis-y-info"),this.xInfoEl=this.graph.select(".vzb-bc-axis-x-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.projectionX=this.graph.select(".vzb-bc-projection-x"),this.projectionY=this.graph.select(".vzb-bc-projection-y"),this.decorationsEl=this.graph.select(".vzb-bc-decorations"),this.lineEqualXY=this.decorationsEl.select(".vzb-bc-line-equal-xy"),this.xAxisGroupsEl=this.decorationsEl.select(".vzb-bc-x-axis-groups"),this.trailsContainer=this.graph.select(".vzb-bc-trails"),this.bubbleContainerCrop=this.graph.select(".vzb-bc-bubbles-crop"),this.zoomSelection=this.graph.select(".vzb-zoom-selection"),this.labelsContainerCrop=this.graph.select(".vzb-bc-labels-crop"),this.bubbleContainer=this.graph.select(".vzb-bc-bubbles"),this.labelsContainer=this.graph.select(".vzb-bc-labels"),this.linesContainer=this.graph.select(".vzb-bc-lines"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.eventArea=this.element.select(".vzb-bc-eventarea"),this.entityBubbles=null,this.bubbleCrown=this.element.select(".vzb-bc-bubble-crown"),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltipMobile=this.element.select(".vzb-tooltip-mobile"),this.on("resize",function(){var e,n,i,r;(t._trails.run("abortAnimation"),t.updateSize())||(t.updateMarkerSizeLimits(),t._labels.updateSize(),e=t._zoomedXYMinMax.axis_x.zoomedMin,n=t._zoomedXYMinMax.axis_x.zoomedMax,i=t._zoomedXYMinMax.axis_y.zoomedMin,r=t._zoomedXYMinMax.axis_y.zoomedMax,t._panZoom.zoomer.dontFeedToState=!0,t._panZoom.rerun(),t._panZoom.zoomToMaxMin(e,n,i,r,0,!0))}),d3.select("body").on("keydown",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||(d3.event.metaKey||d3.event.ctrlKey)&&t.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}).on("mouseenter",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}),this.root.on("resetZoom",function(){t._panZoom.reset(null,500)}),this._panZoom.zoomSelection(this.bubbleContainerCrop),this.bubbleContainerCrop.call(this._panZoom.dragRectangle).call(this._panZoom.zoomer).on("dblclick.zoom",null).on("mouseup",function(){t.draggingNow=!1}).on("click",function(){var e=t.model.ui.cursorMode;d3.event.defaultPrevented||"arrow"===e||"hand"===e||t._panZoom.zoomByIncrement(e,500)}),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=a.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce(),t._readyOnce=!0},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.size).length)},ready:function(){var t=this;this.KEYS=a.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings();this.model.time.end;this.updateIndicators(),this.updateTime(),t.model.time.splash||t._trails.create(),this.model.marker.getFrame(this.model.time.value,function(e,n){if(n.toString()==t.model.time.value.toString()){if(!t._frameIsValid(e))return a.warn("ready: empty data received from marker.getFrame(). doing nothing");t.frame=e,t.updateSize(),t.updateMarkerSizeLimits(),t.updateEntities(),t._labels.ready(),t.redrawDataPoints(),t.selectDataPoints(),t.updateBubbleOpacity(),t._updateDoubtOpacity(),t.zoomToMarkerMaxMin(),t.model.time.splash||t._trails.run(["findVisible","reveal","opacityHandler"]),t.model.ui.adaptMinMaxZoom&&t._panZoom.expandCanvas()}else a.defer(function(){t.ready()})})},zoomToMarkerMaxMin:function(){this._panZoom.resetZoomState();var t=this.model.marker.axis_x,e=this.model.marker.axis_y,n=(t.getScale().domain(),e.getScale().domain(),t.getZoomedMin()),i=t.getZoomedMax(),r=e.getZoomedMin(),o=e.getZoomedMax();this._panZoom.zoomToMaxMin(n,i,r,o,0,"don't feed these zoom values back to state")},updateIndicators:function(){this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this._labels.setScales(this.xScale,this.yScale),this.yAxis.tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter())},frameChanged:function(t,e){this.frame=t,this.updateTime(),this._updateDoubtOpacity(),this._trails.run("findVisible"),this.model.ui.adaptMinMaxZoom?this._panZoom.expandCanvas():this.redrawDataPoints(),this._trails.run("reveal",null,this.duration),this.tooltipMobile.classed("vzb-hidden",!0),this._reorderEntities()},_getSubtitle:function(t,e){var n=t.replace(e,"");","===n[0]&&(n=n.slice(1));var i=/^\((.*)\)$|.*/.exec(n.trim());return i[1]||i[0]||""},updateUIStrings:function(){var t=this,e=(this.getLayoutProfile(),t.model.marker.axis_y.getConceptprops()),n=t.model.marker.axis_x.getConceptprops(),i=t.model.marker.size.getConceptprops(),r=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),this.strings={title:{Y:e.name,X:n.name,S:i.name,C:r.name},title_short:{Y:e.name_short,X:n.name_short,S:i.name_short,C:r.name_short},subtitle:{Y:this._getSubtitle(e.name,e.name_short),X:this._getSubtitle(n.name,n.name_short),S:i.name_short,C:r.name_short},unit:{Y:e.unit||"",X:n.unit||"",S:i.unit||"",C:r.unit||""}},this.ySubTitleEl.selectAll("text").data([0]).enter().append("text"),this.xSubTitleEl.selectAll("text").data([0]).enter().append("text");var o=this.yTitleEl.selectAll("text").data([0]);o.enter().append("text"),o.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()});var s=this.xTitleEl.selectAll("text").data([0]);s.enter().append("text"),s.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("bottom").updateView().toggle()});var l=this.sTitleEl.selectAll("text").data([0]);l.enter().append("text"),l.attr("text-anchor","end"),a.setIcon(this.dataWarningEl,f).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),a.setIcon(this.yInfoEl,p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),a.setIcon(this.xInfoEl,p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(n.description||n.sourceLink))),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),n=a.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),i=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(n.x+r.left-i.left,n.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),n=a.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),i=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(n.x+r.left-i.left,n.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t._updateDoubtOpacity(1)}).on("mouseout",function(){t._updateDoubtOpacity()})},_updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.model.time.formatDate(this.time))),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateEntities:function(){var t=this,e=this.dataKeys=this.model.marker.getDataKeysPerHook(),n=this.KEYS,i=this.KEY,r=this.TIMEDIM,o=this.model.time.end,s=function(s){return s=s||"",t.model.marker.getKeys().map(function(l){var u=Object.assign({},l);return u[r]=o,u.sortValue=t.frame.size[a.getKey(l,e.size)]||0,u[i]=s+a.getKey(l,n),u}).sort(function(t,e){return e.sortValue-t.sortValue})}.call(this);this.model.marker.setVisible(s),this.model.time.splash||this.unselectBubblesWithNoData(s),this.entityBubbles=this.bubbleContainer.selectAll("circle.vzb-bc-entity").data(this.model.marker.getVisible(),function(t){return t[i]}),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class",function(t){return"vzb-bc-entity bubble-"+t[i]}).on("mouseover",function(e,n){a.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseover(e,n)}).on("mouseout",function(e,n){a.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseout(e,n)}).on("click",function(e,n){a.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().click(e,n)}).onTap(function(e,n){d3.event.stopPropagation(),t._bubblesInteract().click(e,n)}).onLongTap(function(t,e){}).merge(this.entityBubbles),this._reorderEntities()},unselectBubblesWithNoData:function(t){var e=this.KEYS,n=this.KEY;if(this.model.marker.select.length){var i=[],r=t.map(function(t){return t[n]});this.model.marker.select.forEach(function(t){-1!==r.indexOf(a.getKey(t,e))&&i.push(t)}),i.length!==this.model.marker.select.length&&(this.model.marker.select=i)}},_reorderEntities:function(){var t=this,e=this.dataKeys,n=this.KEY;this.bubbleContainer.selectAll(".vzb-bc-entity").sort(function(i,r){var o=t.frame.size[a.getKey(i,e.size)],s=t.frame.size[a.getKey(r,e.size)];return void 0===o&&void 0!==s?-1:void 0!==o&&void 0===s?1:o!=s?d3.descending(o,s):i[n]!=r[n]?d3.ascending(i[n],r[n]):void 0!==i.trailStartTime||void 0!==r.trailStartTime?void 0!==i.trailStartTime?-1:1:void 0!==i.status||void 0!==r.status?void 0!==i.status?-1:1:d3.descending(o,s)})},_bubblesInteract:function(){var t=this;this.KEY,this.TIMEDIM;return{mouseover:function(e,n){t.model.marker.highlightMarker(e),t._labels.showCloseCross(e,!0)},mouseout:function(e,n){t.model.marker.clearHighlighted(),t._labels.showCloseCross(e,!1)},click:function(e,n){if(!t.draggingNow){var i=t.model.marker.isSelected(e);t.model.marker.selectMarker(e),a.isTouchDevice()||(i&&t.model.marker.highlightMarker(e),t.highlightDataPoints())}}}},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time,"ui"),this.duration)},updateSize:function(){var t=this.chartSvg,e=a.px2num(t.style("width")),n=a.px2num(t.style("height")),i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+n*e},r=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+e*n},o={small:{margin:{top:30,bottom:35,left:30,right:10},leftMarginRatio:1,padding:2,minRadiusPx:.5,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:16,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:4},medium:{margin:{top:15,bottom:40,left:40,right:15},leftMarginRatio:1.6,padding:2,minRadiusPx:1,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:20,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4},large:{margin:{top:15,bottom:i(30,.03),left:r(31,.015),right:20},leftMarginRatio:1.8,padding:2,minRadiusPx:1,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:22,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:i(0,.01),hideSTitle:!0}},s={medium:{margin:{top:20,bottom:55,left:50,right:20},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4,infoElHeight:26},large:{margin:{top:30,bottom:i(45,.03),left:r(35,.025),right:30},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:i(-10,.01),infoElHeight:32,hideSTitle:!0}};this.activeProfile=this.getActiveProfile(o,s);var l=this.getLayoutProfile(),u=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*a.hypotenuse(u.width,u.height));var c=this.activeProfile.margin,h=this.activeProfile.infoElHeight;if(this._labels.setCloseCrossHeight(1.2*this.activeProfile.infoElHeight),this._labels.setTooltipFontSize(this.activeProfile.infoElHeight+"px"),this.height=parseInt(this.element.style("height"),10)-c.top-c.bottom||0,this.width=parseInt(this.element.style("width"),10)-c.left*this.activeProfile.leftMarginRatio-c.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,a.warn("Bubble chart updateSize(): vizabi container is too little or has display:none")),this.graph.attr("transform","translate("+c.left*this.activeProfile.leftMarginRatio+","+c.top+")"),this.year.resize(this.width,this.height),this.eventArea.attr("width",this.width).attr("height",Math.max(0,this.height)),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range(this._rangeBump([this.height,0])):this.yScale.rangePoints([this.height,0],this.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range(this._rangeBump([0,this.width])):this.xScale.rangePoints([0,this.width],this.activeProfile.padding).range(),this.yAxis.scale(this.yScale).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:c,limitMaxTickNumber:6,bump:this.activeProfile.maxRadiusPx/2,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:c,bump:this.activeProfile.maxRadiusPx/2,viewportLength:this.width,formatter:this.model.marker.axis_x.getTickFormatter()}),this.bubbleContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.xAxisElContainer.attr("width",this.width+1).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-1),this.xAxisEl.attr("transform","translate(1,"+(1+this.height)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.projectionX.attr("y1",this.yScale.range()[0]+this.activeProfile.maxRadiusPx/2),this.projectionY.attr("x2",this.xScale.range()[0]-this.activeProfile.maxRadiusPx/2),this._updateSTitle(),this.sTitleEl.attr("transform","translate("+this.width+",20) rotate(-90)"),"small"!==l)this.ySubTitleEl.select("text").attr("dy",.6*h).text(this.strings.subtitle.Y),this.xSubTitleEl.select("text").attr("dy",.3*-h).text(this.strings.subtitle.X),this.yTitleEl.select("text").text(this.strings.title_short.Y+" ").append("tspan").style("font-size",.7*h+"px").text("▼"),this.xTitleEl.select("text").text(this.strings.title_short.X+" ").append("tspan").style("font-size",.7*h+"px").text("▼");else{this.ySubTitleEl.select("text").text(""),this.xSubTitleEl.select("text").text("");var d=this.yTitleEl.select("text").text(this.strings.title.Y);d.node().getBBox().width>this.width&&d.text(this.strings.title_short.Y);var f=this.xTitleEl.select("text").text(this.strings.title.X);f.node().getBBox().width>this.width-100&&f.text(this.strings.title_short.X)}var p=this.model.locale.isRTL();if(this.ySubTitleEl.style("font-size",.8*h+"px").attr("transform","translate(0,0) rotate(-90)"),this.xSubTitleEl.style("font-size",.8*h+"px").attr("transform","translate("+this.width+","+this.height+")"),this.yTitleEl.style("font-size",h+"px").attr("transform","small"!==l?"translate("+(-c.left-this.activeProfile.yAxisTitleBottomMargin)+","+.5*this.height+") rotate(-90)":"translate("+(p?this.width:10-this.activeProfile.margin.left)+", -"+this.activeProfile.yAxisTitleBottomMargin+")"),this.xTitleEl.style("font-size",h+"px").attr("transform","small"!==l?"translate("+.5*this.width+","+(this.height+c.bottom-this.activeProfile.xAxisTitleBottomMargin)+")":"translate("+(p?this.width:0)+","+(this.height+c.bottom-this.activeProfile.xAxisTitleBottomMargin)+")"),this.xAxisGroupsEl.style("font-size",.8*h+"px"),this.yInfoEl.select("svg").node()){var m=this.yTitleEl.node().getBBox(),v=a.transform(this.yTitleEl.node()),g=p?m.x+v.translateX-1.4*h:m.x+v.translateX+m.width+.4*h,y=p?v.translateY+1.4*h+.5*m.width:v.translateY-.4*h-.5*m.width;this.yInfoEl.select("svg").attr("width",h+"px").attr("height",h+"px"),this.yInfoEl.attr("transform","small"!==l?"translate("+(v.translateX-.8*h)+","+y+") rotate(-90)":"translate("+g+","+(v.translateY-.8*h)+")")}if(this.xInfoEl.select("svg").node()){var _=this.xTitleEl.node().getBBox(),b=a.transform(this.xTitleEl.node()),x=p?_.x+b.translateX-1.4*h:_.x+b.translateX+_.width+.4*h;this.xInfoEl.select("svg").attr("width",h+"px").attr("height",h+"px"),this.xInfoEl.attr("transform","translate("+x+","+(b.translateY-.8*h)+")")}this._resizeDataWarning(),this.model.ui.chart.margin.set("left",c.left*this.activeProfile.leftMarginRatio,!1,!1)},_updateDecorations:function(t){var e=this,n=this.model.ui.chart.decorations.xAxisGroups&&this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which]&&this.model.ui.chart.decorations.enabled&&"small"!==this.getLayoutProfile();if(this.xAxisGroupsEl.classed("vzb-invisible",!n),n){var i=this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which],r=this.xAxisGroupsEl.selectAll(".vzb-bc-x-axis-group").data(i);r.exit().remove();var o=[],a=!1;(r=r.enter().append("g").attr("class","vzb-bc-x-axis-group").each(function(){var t=d3.select(this);t.append("text").attr("class","vzb-bc-x-axis-group-line").text("◆").style("text-anchor","middle"),t.append("text").attr("class","vzb-bc-x-axis-group-text")}).merge(r)).each(function(t,n){var i=d3.select(this).select("text.vzb-bc-x-axis-group-text").text(e.translator(t.label)),r={min:t.min,max:t.max};r.textHeight=i.node().getBBox().height,r.textWidth=i.node().getBBox().width,r.boundaryMinX_px=e.xScale(t.min||0===t.min?t.min:d3.min(e.xScale.domain())),r.boundaryMaxX_px=e.xScale(t.max||0===t.max?t.max:d3.max(e.xScale.domain())),r.centerX_px=(r.boundaryMinX_px+r.boundaryMaxX_px)/2,r.marginX_px=(Math.abs(r.boundaryMinX_px-r.boundaryMaxX_px)-r.textWidth)/2,r.marginX_px-r.textHeight<0&&(a=!0),o[n]=r}),a&&r.each(function(t,n){var i=d3.select(this).select("text.vzb-bc-x-axis-group-text").text(e.translator(t.label_short)),r=o[n];r.textWidth=i.node().getBBox().width,r.marginX_px=(Math.abs(r.boundaryMinX_px-r.boundaryMaxX_px)-r.textWidth)/2,o[n]=r}),r.each(function(e,n){var i=d3.select(this),r=0==n,a=n==o.length-1,s=o[n],l=s.textHeight/4,u=s.centerX_px;r&&(u=o[n+1].boundaryMinX_px-Math.max(o[n+1].marginX_px,l)),a&&(u=o[n-1].boundaryMaxX_px+Math.max(o[n-1].marginX_px,l));i.select("text.vzb-bc-x-axis-group-text").transition().duration(t||0).style("text-anchor",r?"end":a?"start":"middle").attr("dy","-0.2em").attr("y",s.textHeight).attr("x",u);i.select("text.vzb-bc-x-axis-group-line").classed("vzb-invisible",a).transition().duration(t||0).attr("dy","-0.2em").attr("y",.9*s.textHeight).attr("x",s.boundaryMaxX_px)})}var s=this.model.marker.axis_x.which==this.model.marker.axis_y.which&&this.model.ui.chart.decorations.enabled&&"small"!==this.getLayoutProfile();if(this.lineEqualXY.classed("vzb-invisible",!s),s){var l=d3.min(this.yScale.domain().concat(this.xScale.domain())),u=d3.max(this.yScale.domain().concat(this.xScale.domain()));this.lineEqualXY.transition().duration(t||0).attr("y1",this.yScale(l)).attr("y2",this.yScale(u)).attr("x1",this.xScale(l)).attr("x2",this.xScale(u))}},_resizeDataWarning:function(){var t=this.dataWarningEl.select("text").style("font-size",null),e=t.node().getBBox().width+3*t.node().getBBox().height,n=this.width-this.xTitleEl.node().getBBox().width-this.activeProfile.infoElHeight,i=parseInt(t.style("font-size"))*n/e;t.style("font-size",e>n?i+"px":null);var r=t.node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+(this.model.locale.isRTL()?r.width+r.height:this.width)+","+(this.height+this.activeProfile.margin.bottom-this.activeProfile.xAxisTitleBottomMargin)+")")},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return a.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var e=this.activeProfile.minRadiusPx,n=this.activeProfile.maxRadiusPx,i=a.radiusToArea(Math.max(n*t[0],e)),r=a.radiusToArea(Math.max(n*t[1],e)),o=i===r?[i,r]:d3.range(i,r,(r-i)/this.sScale.domain().length).concat(r);this.sScale.range(o)},redrawDataPointsOnlyColors:function(){var t=this;if(!this.entityBubbles)return a.warn("redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!");var e=void 0,n=this.dataKeys=this.model.marker.getDataKeysPerHook(),i=this.KEYS,r=this.KEY,o=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(o=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(o,function(o){if(!t._frameIsValid(o))return a.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing");e=t.frame,t.entityBubbles.each(function(s,l){var u=t.model.marker.isSelected(s),c=u?e.color[a.getKey(s,n.color)]:o.color[a.getKey(s,n.color)],h=null!=c?t.cScale(c):t.COLOR_WHITEISH;if(d3.select(this).style("fill",h),u){var d=a.find(t.model.marker.select,function(t){return a.getKey(t,i)==s[r]}),f=t.model.time.parse(""+d.trailStartTime);t.model.marker.getFrame(f,function(e){if(!e)return a.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing");var i={};if(t.model.ui.chart.trails&&f-t.time!=0){var r=e.color[a.getKey(s,n.color)];i.scaledC0=null!=r?t.cScale(r):t.COLOR_WHITEISH}else i.scaledC0=h;t._labels.updateLabelOnlyColor(s,l,i)})}})})},redrawDataPointsOnlySize:function(){var t=this,e=void 0,n=this.dataKeys=this.model.marker.getDataKeysPerHook(),i=this.KEYS,r=this.KEY,o=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(o=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(o,function(o){if(!t._frameIsValid(o))return a.warn("redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing");e=t.frame,t.entityBubbles.each(function(s,l){var u=t.model.marker.isSelected(s),c=u?e.size[a.getKey(s,n.size)]:o.size[a.getKey(s,n.size)];if(null!=c){var h=a.areaToRadius(t.sScale(c));if(d3.select(this).attr("r",h),u){var d=a.find(t.model.marker.select,function(t){return a.getKey(t,i)==s[r]}),f=t.model.time.parse(""+d.trailStartTime);t.model.marker.getFrame(f,function(e){if(!e)return a.warn("redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing");var i={};t.model.ui.chart.trails&&f-t.time!=0?i.scaledS0=a.areaToRadius(t.sScale(e.size[a.getKey(s,n.size)])):i.scaledS0=h,t._labels.updateLabelOnlyPosition(s,l,i)})}}})})},redrawDataPoints:function(t){var e=this;this.KEY;if(null==t&&(t=e.duration),this.model.ui.chart.lockNonSelected&&this.someSelected){var n=this.model.time.parse(""+this.model.ui.chart.lockNonSelected);this.model.marker.getFrame(n,function(n){if(!n)return a.warn("redrawDataPoints: empty data received from marker.getFrames(). doing nothing");e.entityBubbles.each(function(i,r){var o=e.model.marker.isSelected(i)?e.frame:n;e._updateBubble(i,o,r,d3.select(this),t)})})}else e.entityBubbles.each(function(n,i){e._updateBubble(n,e.frame,i,d3.select(this),t)});this._updateDecorations(t)},_updateBubble:function(t,e,n,i,r){var o=this.dataKeys,s=!1,l=e.axis_y[a.getKey(t,o.axis_y)],u=e.axis_x[a.getKey(t,o.axis_x)],c=e.size[a.getKey(t,o.size)],h=e.label[a.getKey(t,o.label)],d=e.color[a.getKey(t,o.color)],f=e.size_label[a.getKey(t,o.size_label)];if(!l&&0!==l||!u&&0!==u||!c&&0!==c){if(t.hidden||(t.hidden=!0,s=!0),s)if(r){var p=i.style("opacity");i.transition().duration(r).ease(d3.easeExp).style("opacity",0).on("end",function(){i.classed("vzb-invisible",t.hidden),i.style("opacity",p)})}else i.classed("vzb-invisible",t.hidden)}else{(t.hidden||i.classed("vzb-invisible"))&&(t.hidden=!1,s=!0);var m=a.areaToRadius(this.sScale(c));if(i.style("fill",null!=d?this.cScale(d):this.COLOR_WHITEISH),r)if(s){var v=i.style("opacity");i.classed("vzb-invisible",t.hidden),i.style("opacity",0).attr("cy",this.yScale(l)).attr("cx",this.xScale(u)).attr("r",m).transition().duration(r).ease(d3.easeExp).style("opacity",v)}else i.transition().duration(r).ease(d3.easeLinear).attr("cy",this.yScale(l)).attr("cx",this.xScale(u)).attr("r",m);else i.interrupt().attr("cy",this.yScale(l)).attr("cx",this.xScale(u)).attr("r",m).transition(),s&&i.classed("vzb-invisible",t.hidden);this.model.time.record&&this._export.write({type:"circle",id:t[KEY],time:this.model.time.value.getUTCFullYear(),fill:null!=d?this.cScale(d):this.COLOR_WHITEISH,cx:this.xScale(u),cy:this.yScale(l),r:m})}this._updateLabel(t,n,e,u,l,c,d,h,f,r,s)},_updateLabel:function(t,e,n,i,r,o,s,l,u,c,h){var d=this.KEYS,f=this.KEY;if(this.model.marker.isSelected(t)){var p={},m=a.find(this.model.marker.select,function(e){return a.getKey(e,d)==t[f]}),v=this.model.time.formatDate(this.time);this.model.ui.chart.trails&&m.trailStartTime!=v&&null!=m.trailStartTime||(this.model.ui.chart.trails&&null==m.trailStartTime&&(m.trailStartTime=v),p.labelX0=i,p.labelY0=r,p.scaledC0=null!=s?this.cScale(s):this.COLOR_WHITEISH,p.scaledS0=o||0===o?a.areaToRadius(this.sScale(o)):null);var g=this.model.time.parse(""+m.trailStartTime),y=this._getLabelText(n,t,m.trailStartTime);h&&t.hidden&&this.model.ui.chart.trails&&g&&g<this.time&&(h=!1),t.hidden&&!this.model.ui.chart.trails&&(h=!0),this._labels.updateLabel(t,e,p,i,r,o,s,y,u,c,h)}},_getLabelText:function(t,e,n){return this.model.marker.getCompoundLabelText(e,t)+(n&&this.model.time.start-this.model.time.end!=0?" "+n:"")},_setTooltip:function(t,e,n,i,r,o){if(t){var s={};if(o){var l=this.dataKeys,u=this.frame;s.valueY=u.axis_y[a.getKey(o,l.axis_y)],s.valueX=u.axis_x[a.getKey(o,l.axis_x)],s.valueS=u.size[a.getKey(o,l.size)],s.valueC=u.color[a.getKey(o,l.color)],s.valueLST=u.size_label[a.getKey(o,l.size_label)],s.labelText=this._getLabelText(u,o,this.model.time.formatDate(this.time))}var c={};c.labelX0=this.xScale.invert(e),c.labelY0=this.yScale.invert(n),c.scaledS0=i,c.scaledC0=null,this._labels.setTooltip(o,t,c,s)}else this._labels.setTooltip()},_formatSTitleValues:function(t,e){var n=this.strings.unit.S,i=this.strings.unit.C,r=this.model.marker.size.getTickFormatter(),o=this.model.marker.color.getTickFormatter();return this.model.marker.color.isDiscrete()&&"constant"!==this.model.marker.color.use&&e&&this.model.marker.color.getColorlegendMarker()&&(e=this.model.marker.color.getColorlegendMarker().label.getItems()[e]||""),[r(t)+" "+n,e||0===e?o(e)+" "+i:this.translator("hints/nodata")]},_updateSTitle:function(t,e){if(this.activeProfile.hideSTitle&&this.model.ui.dialogs.sidebar.indexOf("colors")>-1&&this.model.ui.dialogs.sidebar.indexOf("size")>-1)this.sTitleEl.classed("vzb-invisible",!0);else{this.sTitleEl.classed("vzb-invisible")&&this.sTitleEl.classed("vzb-invisible",!1);var n="constant"!==this.model.marker.size.use,i="constant"!==this.model.marker.color.use,r=this.sTitleEl.select("text").style("font-size",null).text((n?this.translator("buttons/size")+": "+(t||this.strings.title.S):"")+(n&&i?", ":"")+(i?this.translator("buttons/colors")+": "+(e||this.strings.title.C):"")),o=r.node().getBBox().width,a=this.height-30,s=parseInt(r.style("font-size"))*a/o;r.style("font-size",o>a?s+"px":null)}},selectDataPoints:function(){this.KEY;a.isTouchDevice()?(this.model.marker.clearHighlighted(),this._labels.showCloseCross(null,!1)):(this._setTooltip(),this._setBubbleCrown()),this.someSelected=this.model.marker.select.length>0,this.nonSelectedOpacityZero=!1},_setBubbleCrown:function(t,e,n,i,r){null!=t?(this.bubbleCrown.classed("vzb-hidden",!1),this.bubbleCrown.select(".vzb-crown").attr("cx",t).attr("cy",e).attr("r",n).attr("fill",r?"none":i),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("cx",t).attr("cy",e).attr("r",n+10).attr("stroke",i)):this.bubbleCrown.classed("vzb-hidden",!0)},_axisProjections:function(t){var e=this,n=this.TIMEDIM,i=this.dataKeys;null!=t?this.model.marker.getFrame(t[n],function(n){var r=n.axis_y[a.getKey(t,i.axis_y)],o=n.axis_x[a.getKey(t,i.axis_x)],s=n.size[a.getKey(t,i.size)],l=a.areaToRadius(e.sScale(s));!r&&0!==r||!o&&0!==o||!s&&0!==s||(e.model.ui.chart.whenHovering.showProjectionLineX&&e.xScale(o)>0&&e.xScale(o)<e.width&&e.yScale(r)+l<e.height&&e.projectionX.style("opacity",1).attr("y2",e.yScale(r)+l).attr("x1",e.xScale(o)).attr("x2",e.xScale(o)),e.model.ui.chart.whenHovering.showProjectionLineY&&e.yScale(r)>0&&e.yScale(r)<e.height&&e.xScale(o)-l>0&&e.projectionY.style("opacity",1).attr("y1",e.yScale(r)).attr("y2",e.yScale(r)).attr("x1",e.xScale(o)-l),e.model.ui.chart.whenHovering.higlightValueX&&e.xAxisEl.call(e.xAxis.highlightValue(o)),e.model.ui.chart.whenHovering.higlightValueY&&e.yAxisEl.call(e.yAxis.highlightValue(r)))}):(this.projectionX.style("opacity",0),this.projectionY.style("opacity",0),this.xAxisEl.call(this.xAxis.highlightValue("none")),this.yAxisEl.call(this.yAxis.highlightValue("none")))},highlightDataPoints:function(){var t=this,e=this.TIMEDIM,n=this.dataKeys,i=this.KEYS,r=this.KEY;if(this.someHighlighted=this.model.marker.highlight.length>0,this.updateBubbleOpacity(),1===this.model.marker.highlight.length){var o=a.clone(this.model.marker.highlight[0]);o[r]=a.getKey(o,i),t.model.ui.chart.lockNonSelected&&t.someSelected&&!t.model.marker.isSelected(o)?o[e]=t.model.time.parse(""+t.model.ui.chart.lockNonSelected):o[e]=t.model.time.parse(""+o.trailStartTime)||t.time,t.model.marker.getFrame(o[e],function(s){if(s){var l=t.xScale(s.axis_x[a.getKey(o,n.axis_x)]),u=t.yScale(s.axis_y[a.getKey(o,n.axis_y)]),c=a.areaToRadius(t.sScale(s.size[a.getKey(o,n.size)])),h=null!=s.color[a.getKey(o,n.color)]?t.cScale(s.color[a.getKey(o,n.color)]):t.COLOR_WHITEISH,d=!1,f=t._formatSTitleValues(s.size[a.getKey(o,n.size)],s.color[a.getKey(o,n.color)]);t._updateSTitle(f[0],f[1]),(l+c<0||l-c>t.width||u+c<0||u-c>t.height)&&(d=!0);var p="",m=!1;if(t.model.marker.isSelected(o)&&t.model.ui.chart.trails){p=t.model.time.formatDate(t.time);var v=a.find(t.model.marker.select,function(t){return a.getKey(t,i)==o[r]});m=p!==v.trailStartTime&&!d3.select(d3.event.target).classed("bubble-"+o[r]),p=p!==v.trailStartTime&&t.time===o[e]?p:""}else p=t.model.marker.isSelected(o)?"":t._getLabelText(s,o);if(t._labels.highlight(null,!1),t._labels.highlight(o,!0),t.model.marker.isSelected(o)){var g=!o.trailStartTime||o.trailStartTime==t.model.time.formatDate(t.time);t._setBubbleCrown(l,u,c,h,g)}d||m||t._axisProjections(o),!p||d||m||t._setTooltip(p,l,u,c+3,h,o);var y=a.find(t.model.marker.select,function(t){return a.getKey(t,i)==o[r]});if(y){var _=a.clone(y);_.opacity=1,t._trails.run(["opacityHandler"],_)}}})}else this._axisProjections(),this._trails.run(["opacityHandler"]),t._updateSTitle(),this._setTooltip(),this._setBubbleCrown(),this._labels.highlight(null,!1)},_blinkSuperHighlighted:function(){var t=this;this.entityBubbles.classed("vzb-super-highlighted",function(e){return t.model.marker.isSuperHighlighted(e)})},updateBubbleOpacity:function(t){var e=this,n=this.model.marker.opacityHighlightDim,i=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?1:e.someSelected?e.model.marker.isSelected(t)?1:r:e.someHighlighted?n:i});var o=e.model.marker.opacitySelectDim<.01;o!=this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(t){return e.someSelected&&o&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=m},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Vizabi.utils,r=Vizabi.Class.extend({init:function(t){this.context=t,this.dragRectangle=d3.drag(),this.zoomer=d3.zoom(),this.dragRectangle.subject(this.dragSubject()).on("start",this.drag().start).on("drag",this.drag().go).on("end",this.drag().stop),this.zoomer.filter(this.zoomFilter()).scaleExtent([.0625,1/0]).on("start",this.zoom().start).on("zoom",this.zoom().go).on("end",this.zoom().stop),this.zoomer.ratioX=1,this.zoomer.ratioY=1,t._zoomedXYMinMax={axis_x:{zoomedMin:null,zoomedMax:null},axis_y:{zoomedMin:null,zoomedMax:null}}},dragSubject:function(){var t=this.context;return function(e){return!d3.event.sourceEvent.ctrlKey&&!d3.event.sourceEvent.metaKey&&"plus"!==t.ui.cursorMode||"minus"===t.ui.cursorMode||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1)?null:{x:d3.mouse(this)[0],y:d3.mouse(this)[1]}}},drag:function(){var t=this.context,e=this;return{start:function(e,n){this.origin={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},t.zoomRect.classed("vzb-invisible",!1)},go:function(e,n){var i=this.origin,r={x:d3.event.x,y:d3.event.y};t.zoomRect.attr("x",Math.min(r.x,i.x)).attr("y",Math.min(r.y,i.y)).attr("width",Math.abs(r.x-i.x)).attr("height",Math.abs(r.y-i.y))},stop:function(n){if(t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),this.target={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},!(Math.abs(this.origin.x-this.target.x)<10||Math.abs(this.origin.y-this.target.y)<10)){var i=d3.event.sourceEvent.ctrlKey||d3.event.sourceEvent.metaKey||"plus"===t.ui.cursorMode;e._zoomOnRectangle(d3.select(this),this.origin.x,this.origin.y,this.target.x,this.target.y,i,500)}}}},zoomFilter:function(){var t=this.context;return function(e){var n=d3.event;return!n.ctrlKey&&!n.metaKey&&(("touchmove"===n.type||"touchstart"===n.type)&&(n.touches.length>1||n.targetTouches.length>1)||(!("wheel"!==n.type&&"mousewheel"!==n.type||!t.ui.zoomOnScrolling)||!("mousedown"!==n.type&&"touchstart"!==n.type||"plus"===t.ui.cursorMode||"minus"===t.ui.cursorMode||!t.ui.panWithArrow&&"hand"!==t.ui.cursorMode)))}},zoom:function(){var t=this.context,e=this.zoomer,n=this;return{start:function(){"plus"!==t.ui.cursorMode&&"minus"!==t.ui.cursorMode&&t.chartSvg.classed("vzb-zooming",!0),t.model._data.marker.clearHighlighted(),t._setTooltip()},go:function(){var r=d3.event.sourceEvent,o=d3.event.transform.k,a=[d3.event.transform.x,d3.event.transform.y],s=e.ratioY,l=e.ratioX;t.draggingNow=!0,(isNaN(o)||null==o)&&(o=e.scale),(isNaN(o)||null==o)&&(o=1),1===o&&null!==r&&(("wheel"===r.type||"mousewheel"===r.type)&&(r.deltaY||-r.wheelDelta)>0||"touchmove"===r.type&&r.touches.length>1)&&(e.ratioX=1,l=1,e.ratioY=1,s=1),(isNaN(a[0])||isNaN(a[1])||null==a[0]||null==a[1])&&(a=[0,0]);var u=e.scaleExtent()[0];o*s<u&&(s=u/o,e.ratioY=s),o*l<u&&(l=u/o,e.ratioX=l);var c=o*l<1,h=o*s<1;c?(a[0]<0&&(a[0]=0),a[0]>(1-o*l)*t.width&&(a[0]=(1-o*l)*t.width)):(a[0]>0&&(a[0]=0),a[0]<(1-o*l)*t.width&&(a[0]=(1-o*l)*t.width)),h?(a[1]<0&&(a[1]=0),a[1]>(1-o*s)*t.height&&(a[1]=(1-o*s)*t.height)):(a[1]>0&&(a[1]=0),a[1]<(1-o*s)*t.height&&(a[1]=(1-o*s)*t.height)),n.zoomSelection.property("__zoom",d3.zoomIdentity.translate(a[0],a[1]).scale(o));var d=t.width*o*l,f=t.height*o*s,p=[0*o*l+a[0],d+a[0]],m=[f+a[1],0*o*s+a[1]],v=t._rangeBump(p),g=t._rangeBump(m),y=(v[0]-p[0])*o*l,_=(v[1]-p[1])*o*l,b=(g[0]-m[0])*o*s,x=(g[1]-m[1])*o*s;p[0]+=y,p[1]+=_,m[0]+=b,m[1]+=x;var w=[0,t.width],S=[t.height,0],M=t._rangeBump(w),E=t._rangeBump(S);c?(p[0]<M[0]&&(a[0]=M[0]-y),p[1]>M[1]&&(a[0]=M[1]-_-d)):(p[0]>M[0]&&(a[0]=M[0]-y),p[1]<M[1]&&(a[0]=M[1]-_-d)),h?(m[0]>E[0]&&(a[1]=E[0]-b-f),m[1]<E[1]&&(a[1]=E[1]-x)):(m[0]<E[0]&&(a[1]=E[0]-b-f),m[1]>E[1]&&(a[1]=E[1]-x)),c?(p[0]<M[0]&&(p[1]+=Math.abs(p[0]-M[0]),p[0]=M[0]),p[1]>M[1]&&(p[0]-=Math.abs(p[1]-M[1]),p[1]=M[1])):(p[0]>M[0]&&(p[1]-=Math.abs(p[0]-M[0]),p[0]=M[0]),p[1]<M[1]&&(p[0]+=Math.abs(p[1]-M[1]),p[1]=M[1])),h?(m[0]>E[0]&&(m[1]-=Math.abs(m[0]-E[0]),m[0]=E[0]),m[1]<E[1]&&(m[0]+=Math.abs(m[1]-E[1]),m[1]=E[1])):(m[0]<E[0]&&(m[1]+=Math.abs(m[0]-E[0]),m[0]=E[0]),m[1]>E[1]&&(m[0]-=Math.abs(m[1]-E[1]),m[1]=E[1])),"ordinal"===t.model.marker.axis_x.scaleType?t.xScale.rangeBands(p):t.xScale.range(p),"ordinal"===t.model.marker.axis_y.scaleType?t.yScale.rangeBands(m):t.yScale.range(m);var z=function(t){return i.isDate(t)?t:+t.toFixed(2)},k=M,T=E;t._zoomedXYMinMax={axis_x:{zoomedMin:z(t.xScale.invert(k[0])),zoomedMax:z(t.xScale.invert(k[1]))},axis_y:{zoomedMin:z(t.yScale.invert(T[0])),zoomedMax:z(t.yScale.invert(T[1]))}},e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,null,!1);var O=t.yAxis.labelerOptions(),P=t.xAxis.labelerOptions();O.limitMaxTickNumber=o*s<1.5?8:o*s*8,P.limitMaxTickNumber=o*l<1.5?8:o*l*8,O.transitionDuration=e.duration,P.transitionDuration=e.duration,t.xAxisEl.call(t.xAxis.labelerOptions(P)),t.yAxisEl.call(t.yAxis.labelerOptions(O)),t.redrawDataPoints(e.duration),t._trails.run("resize",null,e.duration),e.duration=0},stop:function(){t.chartSvg.classed("vzb-zooming",!1),t.draggingNow=!1,e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,!0,!0),e.dontFeedToState=null}}},expandCanvas:function(t){var e=this.context;t||(t=e.duration);var n=d3.extent(i.values(e.frame.axis_x)),r=d3.extent(i.values(e.frame.axis_y));if(!n[0]&&0!==n[0]||!n[1]&&0!==n[1]||!r[0]&&0!==r[0]||!r[1]&&0!==r[1])return i.warn("panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action");var o={x1:e.xScale(n[0]),y1:e.yScale(r[0]),x2:e.xScale(n[1]),y2:e.yScale(r[1])},a=[0,e.width],s=[e.height,0],l=a[0],u=a[1],c=s[0],h=s[1];if(!e.isCanvasPreviouslyExpanded||o.x1<1*l||o.x2>1*u||o.y2<1*h||o.y1>1*c){if(e.isCanvasPreviouslyExpanded){var d=e._rangeBump(a),f=e._rangeBump(s);o.x1>d[0]&&(o.x1=d[0]),o.x2<d[1]&&(o.x2=d[1]),o.y1<f[0]&&(o.y1=f[0]),o.y2>f[0]&&(o.y2=f[1])}e.isCanvasPreviouslyExpanded=!0,this._zoomOnRectangle(e.element,o.x1,o.y1,o.x2,o.y2,!1,t)}else e.redrawDataPoints(t)},zoomToMaxMin:function(t,e,n,i,r,o){var a=this.context,s=t,l=e,u=n,c=i,h=a.xScale.domain(),d=a.yScale.domain();s<h[0]&&l<h[1]&&(s=h[0]),s>h[0]&&l>h[1]&&(l=h[1]),u<d[0]&&c<d[1]&&(u=d[0]),u>d[0]&&c>d[1]&&(c=d[1]);var f=[a.xScale(s),a.xScale(l)],p=[a.yScale(u),a.yScale(c)];this._zoomOnRectangle(a.element,f[0],p[0],f[1],p[1],!1,r,o)},_zoomOnRectangle:function(t,e,n,r,o,a,s,l){var u=this.context,c=this.zoomer,h=d3.zoomTransform(this.zoomSelection.node()),d=e,f=n,p=r,m=o;a&&h.translate(d-p,f-m);var v=[0,u.width],g=[u.height,0],y=u._rangeBump(v),_=u._rangeBump(g),b=c.scaleExtent()[0],x=c.scaleExtent()[1],w=void 0,S=void 0,M=void 0;if(d==p||f==m||y[0]==y[1]||_[0]==_[1])return i.warn("_zoomOnRectangle(): can not proceed because this may result in infinity zooms");Math.abs(d-p)>Math.abs(f-m)?((w=Math.abs(_[0]-_[1])/Math.abs(f-m)*h.k)<b&&(c.ratioY*=w/h.k,w=b),w>x&&(w=x),S=Math.abs(y[0]-y[1])/Math.abs(d-p)*h.k/w*c.ratioX,M=c.ratioY):((w=Math.abs(y[0]-y[1])/Math.abs(d-p)*h.k)<b&&(c.ratioX*=w/h.k,w=b),w>x&&(w=x),M=Math.abs(_[0]-_[1])/Math.abs(f-m)*h.k/w*c.ratioY,S=c.ratioX);var E=[(h.x-Math.min(d,p))/h.k/c.ratioX*w*S+(y[0]-v[0]),(h.y-Math.min(f,m))/h.k/c.ratioY*w*M+(_[1]-g[1])];c.dontFeedToState=l,c.ratioY=M||1,c.ratioX=S||1,c.duration=s||0,this.zoomSelection.call(c.transform,d3.zoomIdentity.translate(E[0],E[1]).scale(w))},zoomByIncrement:function(t,e){this.context;var n=d3.zoomTransform(this.zoomSelection.node()),i=n.k,r=[n.x,n.y],o=d3.mouse(this.zoomSelection.node()),a=Math.log(i)/Math.LN2;"plus"!=t&&t||(a=Math.floor(a)+1),"minus"==t&&(a=Math.ceil(a)-1);var s=[(o[0]-r[0])/i,(o[1]-r[1])/i],l=this.zoomer.scaleExtent();i==l[0]&&(this.zoomer.ratioY=1,this.zoomer.ratioX=1),i=Math.max(l[0],Math.min(l[1],Math.pow(2,a))),s=[s[0]*i+r[0],s[1]*i+r[1]],r[0]+=o[0]-s[0],r[1]+=o[1]-s[1],this.zoomer.duration=e||0,this.zoomSelection.call(this.zoomer.transform,d3.zoomIdentity.translate(r[0],r[1]).scale(i))},resetZoomState:function(t){this.zoomer.ratioY=1,this.zoomer.ratioX=1,(t||this.zoomSelection).property("__zoom",d3.zoomIdentity)},reset:function(t,e){this.context.isCanvasPreviouslyExpanded=!1,this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.duration=e||0,(t||this.zoomSelection).call(this.zoomer.transform,d3.zoomIdentity)},rerun:function(t){this.context;(t||this.zoomSelection).call(this.zoomer.scaleBy,1)},zoomSelection:function(t){this.zoomSelection=t}});e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(4),o=(i=r)&&i.__esModule?i:{default:i};var a=Vizabi.utils,s=Vizabi.Class.extend({init:function(t){this.context=t,this._isCreated=null,this.actionsQueue={},this.entityTrails={},this.trailsData=[],this.trailsInProgress={},this.activePromises={},this.trailTransitions={},this.delayedIterations={},this.drawingQueue={}},toggle:function(t){var e=this.context;t?e._trails.create().then(function(){e._trails.run(["findVisible","reveal","opacityHandler"])}):(e._trails.run("remove"),e.model.marker.select.forEach(function(t){delete t.trailStartTime}))},create:function(t){var e=this.context,n=this,i=e.KEYS,r=e.KEY,s=e.dataKeys,l=e.TIMEDIM;return this._isCreated=new Promise(function(u,c){if(e.model.ui.chart.trails){var h=e.model.time.getAllSteps(),d=[];t=null==t?e.model.marker.select:[t],n._clearActions(t),n.trailsData=e.model.marker.select.map(function(t){var e={status:"created",selectedEntityData:t};return i.forEach(function(n){return e[n]=t[n]}),e[r]=a.getKey(t,i),e}),n.trailTransitions={};var f=e.bubbleContainer.selectAll("g.vzb-bc-entity.entity-trail").data(n.trailsData,function(t){return t[r]});f.exit().remove(),f.enter().insert("g",function(t){return this.querySelector(".bubble-"+(0,o.default)(t[r]))}).attr("class",function(t){return"vzb-bc-entity entity-trail trail-"+t[r]}).merge(f).each(function(t,o){var u=this;d.push(new Promise(function(o,c){var d=h.map(function(e){return{t:e,key:t[r]}}),f=d3.select(u).selectAll("g").data(d).classed("vzb-invisible",!0);f.exit().remove(),n.entityTrails[t[r]]=f.enter().append("g").attr("class","vzb-bc-trailsegment vzb-invisible").on("mouseover",function(n,o){if(!a.isTouchDevice()){var u={};u[r]=n.key,u[l]=n.t,e._axisProjections(u),e._labels.highlight(t,!0);var c=e.model.time.formatDate(n.t),h=a.find(e.model.marker.select,function(e){return a.getKey(e,i)==t[r]});e.model.marker.getFrame(u[l],function(n){var i=e.xScale(n.axis_x[a.getKey(t,s.axis_x)]),r=e.yScale(n.axis_y[a.getKey(t,s.axis_y)]),o=a.areaToRadius(e.sScale(n.size[a.getKey(t,s.size)])),l=null!=n.color[a.getKey(t,s.color)]?e.cScale(n.color[a.getKey(t,s.color)]):e.COLOR_WHITEISH;c!==h.trailStartTime&&e._setTooltip(c,i,r,o+3,l),e._setBubbleCrown(i,r,o,l),e.model.marker.getModelObject("highlight").trigger("change",{size:n.size[a.getKey(t,s.size)],color:n.color[a.getKey(t,s.color)]})}),d3.select(this).style("opacity",1)}}).on("mouseout",function(t,n){a.isTouchDevice()||(e._axisProjections(),e._setTooltip(),e._setBubbleCrown(),e._labels.highlight(null,!1),e.model.marker.getModelObject("highlight").trigger("change",null),d3.select(this).style("opacity",e.model.marker.opacityRegular))}).each(function(t,e){var n=d3.select(this);n.append("circle"),n.append("line")}).merge(f),o()}))}),d.length>0?Promise.all(d).then(function(t){u(!0)}):u(!0)}}),this._isCreated},_addActions:function(t,e){var n=this,i=this.context.KEYS;t.forEach(function(t){var r=a.getKey(t,i);n.actionsQueue[r]||(n.actionsQueue[r]=[]),n.actionsQueue[r]=[].concat(n.actionsQueue[r].filter(function(t){return-1==e.indexOf(t)}),e)})},_clearActions:function(t){var e=this,n=this.context.KEYS;t.forEach(function(t){var i=a.getKey(t,n);e.actionsQueue[i]||(e.actionsQueue[i]=[]),e.actionsQueue[i]=[],e.drawingQueue[i]={},e.delayedIterations[i]={},e.activePromises[i]||(e.activePromises[i]=[]),a.forEach(e.activePromises[i],function(t,e){"pending"===t.status&&t.reject()}),e.trailsInProgress[i]=null,e.activePromises[i]=[]})},_getNextAction:function(t){return this.actionsQueue[t].shift()},run:function(t,e,n){var i=this.context,r=this,o=i.KEY;this._isCreated&&!i.model.time.splash&&("string"==typeof t&&(t=[t]),this._isCreated.then(function(){if(i.model.ui.chart.trails&&i.model.marker.select.length||"remove"==t){n||(n=0),e=null==e?i.model.marker.select:[e];for(var a=0;a<t.length;a++)-1!=["resize","recolor","remove"].indexOf(t[a])&&function(){var e=t.splice(a,1).pop();--a,r.trailsData.forEach(function(t){var a=r.entityTrails[t[o]];i._trails["_"+e](a,n,t)})}();0!=t.length&&(r._addActions(e,t),r.trailsData.forEach(function(e){-1!=t.indexOf("findVisible")&&(r.drawingQueue[e[o]]={},r.delayedIterations[e[o]]={});var a=r.entityTrails[e[o]];r.trailsInProgress[e[o]]||function t(s){var l=r._getNextAction(e[o]);if(l){r.trailsInProgress[e[o]]=l;var u=i._trails["_"+l](a,n,e);u&&u instanceof Promise?u.then(function(){r.trailsInProgress[e[o]]=null,t(s+1)},function(){r.trailsInProgress[e[o]]=null}):(r.trailsInProgress[e[o]]=null,t(s+1))}}(0)}))}}))},_remove:function(t,e,n){this.actionsQueue[n[this.context.KEY]]=[],t&&(d3.select(this.entityTrails[n[this.context.KEY]].node().parentNode).remove(),this.entityTrails[n[this.context.KEY]]=null)},_resize:function(t,e,n){var i=this.context;if(!i.model.time.splash){var r=!1;t.each(function(t,o){if(null!=t.valueY&&null!=t.valueX&&null!=t.valueS){var s=d3.select(this);if(e?s.select("circle").transition().duration(e).ease(d3.easeLinear).attr("cy",i.yScale(t.valueY)).attr("cx",i.xScale(t.valueX)).attr("r",a.areaToRadius(i.sScale(t.valueS))):s.select("circle").interrupt().attr("cy",i.yScale(t.valueY)).attr("cx",i.xScale(t.valueX)).attr("r",a.areaToRadius(i.sScale(t.valueS))).transition(),r||t.transparent||(r=!0,i._labels.updateLabelOnlyPosition(n,null,{scaledS0:a.areaToRadius(i.sScale(t.valueS))})),t.next){var l=t.next;if(null!=l&&null!=l.valueY&&null!=l.valueX){var u=Math.sqrt(Math.pow(i.xScale(t.valueX)-i.xScale(l.valueX),2)+Math.pow(i.yScale(t.valueY)-i.yScale(l.valueY),2));e?s.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",i.xScale(l.valueX)).attr("y1",i.yScale(l.valueY)).attr("x2",i.xScale(t.valueX)).attr("y2",i.yScale(t.valueY)).attr("stroke-dasharray",u).attr("stroke-dashoffset",a.areaToRadius(i.sScale(t.valueS))):s.select("line").interrupt().attr("x1",i.xScale(l.valueX)).attr("y1",i.yScale(l.valueY)).attr("x2",i.xScale(t.valueX)).attr("y2",i.yScale(t.valueY)).attr("stroke-dasharray",u).attr("stroke-dashoffset",a.areaToRadius(i.sScale(t.valueS))).transition()}}}})}},_recolor:function(t,e,n){var i=this.context;t.each(function(t,e){var n=d3.select(this),r="geo.world_4region"==i.model.marker.color.which?i.model.marker.color.getColorShade({colorID:t.valueC,shadeID:"shade"}):null!=t.valueC?i.cScale(t.valueC):i.COLOR_BLACKISH;n.select("circle").style("fill",null!=t.valueC?i.cScale(t.valueC):i.COLOR_WHITEISH),n.select("line").style("stroke",r)})},_opacityHandler:function(t,e,n){var i=this.context;t.each(function(t,e){d3.select(this).style("opacity",n.opacity||i.model.marker.opacityRegular)})},_findVisible:function(t,e,n){var i=this.context,r=this,o=i.KEY,s=i.dataKeys;return new Promise(function(e,l){new Promise(function(t,e){n.limits?t():i.model.marker.getEntityLimits(n[o]).then(function(e){n.limits=e,t()})}).then(function(){n.selectedEntityData.trailStartTime||(n.selectedEntityData.trailStartTime=i.model.time.formatDate(i.time));var l=i.model.time.parse(""+n.selectedEntityData.trailStartTime);if(i.time-l<0||n.limits.min-l>0){i.time-l<0?(n.selectedEntityData.trailStartTime=i.model.time.formatDate(d3.max([i.time,n.limits.min])),l=i.model.time.parse(""+n.selectedEntityData.trailStartTime)):(n.selectedEntityData.trailStartTime=i.model.time.formatDate(n.limits.min),l=i.model.time.parse(""+n.selectedEntityData.trailStartTime));var u=i._labels.cached[n[o]],c=i.frame.size[a.getKey(n,s.size)],h=i.frame.color[a.getKey(n,s.color)];u.labelX0=i.frame.axis_x[a.getKey(n,s.axis_x)],u.labelY0=i.frame.axis_y[a.getKey(n,s.axis_y)],u.scaledS0=c||0===c?a.areaToRadius(i.sScale(c)):null,u.scaledC0=null!=h?i.cScale(h):i.COLOR_WHITEISH,i._updateLabel(n,0,i.frame,u.labelX0,u.labelY0,c,h,i.frame.label[a.getKey(n,s.label)],i.frame.size_label[a.getKey(n,s.size_label)],0,!0)}t.each(function(e,r){var o=e.transparent;e.transparent=null==n.selectedEntityData.trailStartTime||e.t-i.time>0||l-e.t>0||n.selectedEntityData.trailStartTime-i.model.time.formatDate(i.time)>=0,(o!=e.transparent||Math.abs(i.model.time.formatDate(e.t)-i.model.time.formatDate(i.time))<2)&&(e.visibilityChanged=!0),e.transparent&&d3.select(t._groups[0][r]).classed("vzb-invisible",e.transparent)}),r.drawingQueue[n[o]]={},r.delayedIterations[n[o]]={},e()})})},_abortAnimation:function(){var t=this,e=this.context.KEY;t.trailsData.forEach(function(n){t.trailTransitions[n[e]]&&t.trailTransitions[n[e]].select("line").interrupt().transition()})},_reveal:function(t,e,n){var i=this.context;i.model.time.playing&&(e=i.model.time.delay);var r=this,o=(i.KEYS,i.KEY),s=i.dataKeys;n.status="reveal";var l=i.model.time.parse(""+n.selectedEntityData.trailStartTime),u=function(t,u,h,d){return new Promise(function(d,f){var p=d3.select(t._groups[0][u]),m=p.datum();if(h-u==1){if(m.transparent)return p.classed("vzb-invisible",m.transparent),d();if(!m.visibilityChanged)return d()}i.model.marker.getFrame(m.t,function(f){if("reveal"!=n.status)return d();if(!f)return d();if(m.valueY=f.axis_y[a.getKey(n,s.axis_y)],m.valueX=f.axis_x[a.getKey(n,s.axis_x)],m.valueS=f.size[a.getKey(n,s.size)],m.valueC=f.color[a.getKey(n,s.color)],null==m.valueY||null==m.valueX||null==m.valueS)return d();if(l&&l.toString()==m.t.toString()){var v=i._labels.cached[n[o]];v.labelX0=m.valueX,v.labelY0=m.valueY;var g=m.valueS;v.scaledS0=g||0===g?a.areaToRadius(i.sScale(g)):null,v.scaledC0=null!=m.valueC?i.cScale(m.valueC):i.COLOR_WHITEISH,i._updateLabel(n,u,f,m.valueX,m.valueY,m.valueS,m.valueC,f.label[a.getKey(n,s.label)],f.size_label[a.getKey(n,s.size_label)],0,!0)}if(p.select("circle").attr("cy",i.yScale(m.valueY)).attr("cx",i.xScale(m.valueX)).attr("r",a.areaToRadius(i.sScale(m.valueS))).style("fill",null!=m.valueC?i.cScale(m.valueC):i.COLOR_WHITEISH),p.select("line").attr("x2",i.xScale(m.valueX)).attr("y2",i.yScale(m.valueY)).attr("x1",i.xScale(m.valueX)).attr("y1",i.yScale(m.valueY)),i.time-m.t>0?(m.visibilityChanged=!1,p.classed("vzb-invisible",m.transparent)):p.classed("vzb-invisible",!0),!t._groups[0][h]||i.time.toString()==m.t.toString())return d();var y=d3.select(t._groups[0][h]).datum();y.previous=m,m.next=y;var _=y.t;i.time-y.t<0&&(m.visibilityChanged=!0,_=i.time),i.model.marker.getFrame(_,function(t){if("reveal"!=n.status)return d();if(!t||null==m.valueY||null==m.valueX||null==m.valueS)return d();if(null==t.axis_x[a.getKey(n,s.axis_x)]||null==t.axis_y[a.getKey(n,s.axis_y)])return d();y.valueY=t.axis_y[a.getKey(n,s.axis_y)],y.valueX=t.axis_x[a.getKey(n,s.axis_x)],y.valueS=t.size[a.getKey(n,s.size)],y.valueC=t.color[a.getKey(n,s.color)],r.trailTransitions[n[o]]=p;var l="geo.world_4region"==i.model.marker.color.which?i.model.marker.color.getColorShade({colorID:m.valueC,shadeID:"shade"}):null!=m.valueC?i.cScale(m.valueC):i.COLOR_BLACKISH,f=Math.sqrt(Math.pow(i.xScale(m.valueX)-i.xScale(y.valueX),2)+Math.pow(i.yScale(m.valueY)-i.yScale(y.valueY),2));return p.select("line").attr("stroke-dasharray",f).attr("stroke-dashoffset",a.areaToRadius(i.sScale(m.valueS))).style("stroke",l).transition().duration(e).ease(d3.easeLinear).attr("x1",i.xScale(y.valueX)).attr("y1",i.yScale(y.valueY)).attr("x2",i.xScale(m.valueX)).attr("y2",i.yScale(m.valueY)),h-u>1?(c(u,h),d()):d()})})})},c=function(t,e,i){var a=void 0;e-t>1&&(a=h(t,e),r.delayedIterations[n[o]][t]={first:t,next:e,medium:a}),i&&i-e>1&&(a=h(e,i),r.delayedIterations[n[o]][e]={first:e,next:i,medium:a})},h=function(t,e){return Math.round(t+(e-t)/2)},d=function(){return new Promise(function(l,u){Object.keys(r.drawingQueue[n[o]]).length>0?function u(){var h,d,f,p=Object.keys(r.drawingQueue[n[o]])[Math.floor(Math.random()*Object.keys(r.drawingQueue[n[o]]).length)],m=JSON.parse(JSON.stringify(r.drawingQueue[n[o]][p]));delete r.drawingQueue[n[o]][p],(h=m.first,d=m.next,f=m.medium,new Promise(function(r,o){var l=d3.select(t._groups[0][h]),u=d3.select(t._groups[0][d]),p=d3.select(t._groups[0][f]),m=l.datum(),v=u.datum(),g=p.datum();if(!m.previous&&!m.next||!v.previous&&!v.next)return r();i.model.marker.getFrame(g.t,function(t){if("reveal"!=n.status)return r();if(!t||void 0===t.axis_x||null==t.axis_x[a.getKey(n,s.axis_x)]||void 0===t.axis_y||null==t.axis_y[a.getKey(n,s.axis_y)])return a.warn("Frame for trail missed: "+g.t),r();if(g.valueY=t.axis_y[a.getKey(n,s.axis_y)],g.valueX=t.axis_x[a.getKey(n,s.axis_x)],g.valueS=t.size[a.getKey(n,s.size)],g.valueC=t.color[a.getKey(n,s.color)],g.previous=m,g.next=v,m.next=g,v.previous=g,null==g.valueY||null==g.valueX||null==g.valueS)return a.warn("Data for trail point missed: "+g.t),r();var o="geo.world_4region"==i.model.marker.color.which?i.model.marker.color.getColorShade({colorID:g.valueC,shadeID:"shade"}):null!=g.valueC?i.cScale(g.valueC):i.COLOR_BLACKISH,u=Math.sqrt(Math.pow(i.xScale(m.valueX)-i.xScale(g.valueX),2)+Math.pow(i.yScale(m.valueY)-i.yScale(g.valueX),2));if(l.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",i.xScale(g.valueX)).attr("y1",i.yScale(g.valueY)).attr("x2",i.xScale(m.valueX)).attr("y2",i.yScale(m.valueY)).attr("stroke-dasharray",u).attr("stroke-dashoffset",a.areaToRadius(i.sScale(m.valueS))).style("stroke",o),p.classed("vzb-invisible",g.transparent),!g.transparent){p.select("circle").attr("cy",i.yScale(g.valueY)).attr("cx",i.xScale(g.valueX)).attr("r",a.areaToRadius(i.sScale(g.valueS))).style("fill",null!=g.valueC?i.cScale(g.valueC):i.COLOR_WHITEISH);var y=Math.sqrt(Math.pow(i.xScale(g.valueX)-i.xScale(v.valueX),2)+Math.pow(i.yScale(g.valueY)-i.yScale(v.valueY),2));p.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",i.xScale(v.valueX)).attr("y1",i.yScale(v.valueY)).attr("x2",i.xScale(g.valueX)).attr("y2",i.yScale(g.valueY)).attr("stroke-dasharray",y).attr("stroke-dashoffset",a.areaToRadius(i.sScale(g.valueS))).style("stroke",o)}c(h,f,d),r()})})).then(function(){Object.keys(r.drawingQueue[n[o]]).length>0?u():l()})}(r.drawingQueue[n[o]]):l()})};return new Promise(function(e,s){if(i.model.marker.framesAreReady())!function t(n,i){if(i<0||i>=n._groups[0].length)return e();u(n,i,i+1).then(function(){t(n,i+1)},function(){return e()})}(t,0);else{r.delayedIterations[n[o]]={},r.drawingQueue[n[o]]={};var l=function(t,e,n){var r=[],o=0,s=0,l=d3.min([t.limits.max,i.time]),u=d3.max([t.limits.min,i.model.time.parse(""+t.selectedEntityData.trailStartTime)]);return a.forEach(e._groups[0],function(t,e){var a=t.__data__;a.t-u==0?o=e:a.t-l==0?s=e:a.t>u&&a.t<l&&(i.model.time.formatDate(a.t)%n==0||a.next&&a.previous)&&r.push(e)}),r.unshift(o),s>0&&r.push(s),r}(n,t,50),c=[];if(l.length<=1)return e();r.delayedIterations[n[o]]={};for(var h=0;h<l.length-1;h++)c.push(u(t,l[h],l[h+1]));Promise.all(c).then(function(){0==Object.keys(r.delayedIterations[n[o]]).length?e():(r.drawingQueue[n[o]]=r.delayedIterations[n[o]],r.delayedIterations[n[o]]={},function t(){d().then(function(){if(0==Object.keys(r.delayedIterations[n[o]]).length)return e();r.drawingQueue[n[o]]=r.delayedIterations[n[o]],r.delayedIterations[n[o]]={},t()},function(){return e()})}())},function(){e()})}})}});e.default=s},function(t,e,n){(function(e){var n,i;n=void 0!==e?e:this,i=function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,n=String(t),i=n.length,r=-1,o="",a=n.charCodeAt(0);++r<i;)0!=(e=n.charCodeAt(r))?o+=e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==a?"\\"+e.toString(16)+" ":(0!=r||1!=i||45!=e)&&(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?n.charAt(r):"\\"+n.charAt(r):o+="�";return o};return t.CSS||(t.CSS={}),t.CSS.escape=e,e},t.exports=i(n)}).call(e,n(7))},function(t,e){},function(t,e){t.exports='\x3c!-- Bubble Chart Component --\x3e\n<div class="vzb-bubblechart">\n    <svg class="vzb-bubblechart-svg vzb-export">\n        <g class="vzb-bc-graph">\n            <g class="vzb-bc-year"></g>\n\n            <svg class="vzb-bc-axis-x"><g></g></svg>\n            <svg class="vzb-bc-axis-y"><g></g></svg>\n            <line class="vzb-bc-projection-x"></line>\n            <line class="vzb-bc-projection-y"></line>\n\n            <svg class="vzb-bc-bubbles-crop">\n                <g class="vzb-zoom-selection"></g>\n                <g class="vzb-bc-decorations">\n                    <line class="vzb-bc-line-equal-xy vzb-invisible"></line>\n                    <g class="vzb-bc-x-axis-groups"></g>\n                </g>\n                <rect class="vzb-bc-eventarea"></rect>\n                <g class="vzb-bc-trails"></g>\n                <g class="vzb-bc-bubbles"></g>\n                <g class="vzb-bc-lines"></g>\n                <g class="vzb-bc-bubble-crown vzb-hidden">\n                    <circle class="vzb-crown-glow"></circle>\n                    <circle class="vzb-crown"></circle>\n                </g>\n            </svg>\n\n            <g class="vzb-bc-axis-y-subtitle"></g>\n            <g class="vzb-bc-axis-x-subtitle"></g>\n            <g class="vzb-bc-axis-y-title"></g>\n            <g class="vzb-bc-axis-x-title"></g>\n            <g class="vzb-bc-axis-s-title"></g>\n            <g class="vzb-bc-axis-c-title"></g>\n\n            <g class="vzb-bc-axis-y-info vzb-noexport"></g>\n            <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n\n            <svg class="vzb-bc-labels-crop">\n                <g class="vzb-bc-labels"></g>\n            </svg>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n            <rect class="vzb-bc-zoom-rect"></rect>\n        </g>\n    </svg>\n    <svg>\n        <defs>\n            <filter id="vzb-glow-filter" x="-50%" y="-50%" width="200%" height="200%">\n                <feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur>\n            </filter>\n        </defs>\n    </svg>\n    \x3c!-- This could possibly be another component --\x3e\n    <div class="vzb-tooltip vzb-hidden vzb-tooltip-mobile"></div>\n</div>\n'},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){t.exports=n(0)}])},51:function(t,e){t.exports="./config/toolconfigs/BubbleChart.js"},53:function(t,e){t.exports="./assets/vizabi.css"},54:function(t,e){var n=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e){(function(){var e,n,i;i=[],e={},t.exports=n=function(t,n,r){var o,a,s,l,u,c,h,d;if(null==r&&(r=!0),"string"==typeof n){if(2!==n.length)throw{name:"ArgumentException",message:"The format for string options is '<thousands><decimal>' (exactly two characters)"};d=n[0],o=n[1]}else if(Array.isArray(n)){if(2!==n.length)throw{name:"ArgumentException",message:"The format for array options is ['<thousands>','[<decimal>'] (exactly two elements)"};d=n[0],o=n[1]}else d=(null!=n?n.thousands:void 0)||(null!=n?n.group:void 0)||e.thousands,o=(null!=n?n.decimal:void 0)||e.decimal;return null==(u=i[c=""+d+o+r])&&(s=r?3:1,u=i[c]=new RegExp("^\\s*([+-]?(?:(?:\\d{1,3}(?:\\"+d+"\\d{"+s+",3})+)|\\d*))(?:\\"+o+"(\\d*))?\\s*$")),null==(h=t.match(u))||3!==h.length?NaN:(l=h[1].replace(new RegExp("\\"+d,"g"),""),a=h[2],parseFloat(l+"."+a))},t.exports.setOptions=function(t){var n,i;for(n in t)i=t[n],e[n]=i},t.exports.factoryReset=function(){e={thousands:",",decimal:"."}},t.exports.withOptions=function(t,e){return null==e&&(e=!0),function(i){return n(i,t,e)}},t.exports.factoryReset()}).call(this)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),r={},o="https://docs.google.com/spreadsheets/";e.getReaderObject=(()=>({MISSED_INDICATOR_NAME:"indicator",_name:"csv",init(t){if(this._lastModified=t.lastModified||"",this._basepath=t.path,this.delimiter=t.delimiter,this.keySize=t.keySize||1,this.hasNameColumn=t.hasNameColumn||!1,this.nameColumnIndex=t.nameColumnIndex||0,this.assetsPath=t.assetsPath||"",this.additionalTextReader=t.additionalTextReader,this.additionalJsonReader=t.additionalJsonReader,this.isTimeInColumns=t.timeInColumns||!1,this.timeKey="time",this._basepath.includes(o)&&!this._basepath.includes("tqx=out:csv")){const t=this._basepath.split(o)[1].split("/"),e=t[t.indexOf("d")+1];this._basepath=o+"d/"+e+"/gviz/tq?tqx=out:csv"}this._parseStrategies=[...[",.",".,"].map(t=>this._createParseStrategy(t)),t=>t],Object.assign(this.ERRORS||{},{WRONG_TIME_COLUMN_OR_UNITS:"reader/error/wrongTimeUnitsOrColumn",NOT_ENOUGH_ROWS_IN_FILE:"reader/error/notEnoughRows",UNDEFINED_DELIMITER:"reader/error/undefinedDelimiter",EMPTY_HEADERS:"reader/error/emptyHeaders",DIFFERENT_SEPARATORS:"reader/error/differentSeparators",FILE_NOT_FOUND:"reader/error/fileNotFoundOrPermissionsOrEmpty",REPEATED_KEYS:"reader/error/repeatedKeys"})},ensureDataIsCorrect({columns:t,rows:e},n){const i=t[this.keySize],[r]=e,o=n[i],a=r[i].trim();if(o&&!o(a))throw this.error(this.ERRORS.WRONG_TIME_COLUMN_OR_UNITS,void 0,a);if(!t.filter(Boolean).length)throw this.error(this.ERRORS.EMPTY_HEADERS)},getDatasetInfo(){return{name:this._basepath.split("/").pop()}},getCached:()=>r,async load(t){const e=this._name+this._basepath+this._lastModified;return r[e]||(r[e]=new Promise((e,n)=>{let i=Vizabi.utils.d3text;this.additionalTextReader&&(i=this.additionalTextReader),i(this._basepath,(i,r)=>{if(i)return i.name=this.ERRORS.FILE_NOT_FOUND,i.message=`No permissions, missing or empty file: ${this._basepath}`,i.endpoint=this._basepath,n(i);try{const{delimiter:i=this._guessDelimiter(r)}=this,o=d3.dsvFormat(i).parse(r,t=>Object.keys(t).every(e=>!t[e])?null:t),{columns:a}=o;this.hasNameColumn&&a.splice(this.keySize+1,0,a.splice(this.nameColumnIndex,1)[0]);const s=(this.isTimeInColumns?this.timeInColumns.bind(this):t=>t)({columns:a,rows:o},t);e(s)}catch(t){return n(t)}})}))},timeInColumns({columns:t,rows:e},n){const i=this.keySize;let r=null;this.hasNameColumn&&(r=t.splice(i+1,1)[0]||"name");const o=n&&n[this.timeKey]&&!!n[this.timeKey](t[i]);o&&Vizabi.utils.warn("Indicator column is missed.");const a=o?this.MISSED_INDICATOR_NAME:t[i],s=t.slice(0,i).concat(this.timeKey).concat(r||[]).concat(o?Vizabi.utils.capitalize(this.MISSED_INDICATOR_NAME):e.reduce((t,e)=>{const n=e[a];return!t.includes(n)&&n&&t.push(n),t},[])),l=s.slice(i+1+(r?1:0)),[u]=s;return{columns:s,rows:e.reduce((t,e)=>{const n=e[u],i=t.filter(t=>t[u]===n);if(i.length){if(null!==i[0][e[a]])throw this.error(this.ERRORS.REPEATED_KEYS,null,{indicator:e[a],key:e[u]});i.forEach(t=>{t[e[a]]=e[t[this.timeKey]]})}else Object.keys(e).forEach(n=>{if(![u,a,r].includes(n)){const i={[u]:e[u],[this.timeKey]:n},s=r?{[r]:e[r]}:{},c=l.reduce((t,i)=>(t[i]=o||e[a]===i?e[n]:null,t),{});t.push(Object.assign(i,s,c))}});return t},[])}},async getAsset(t,e={}){const n=this.assetsPath+t;let i=Vizabi.utils.d3json;return this.additionalJsonReader&&(i=this.additionalJsonReader),new Promise((t,e)=>{i(n,(i,r)=>{if(i)return i.name=this.ERRORS.FILE_NOT_FOUND,i.message=`No permissions, missing or empty file: ${n}`,i.endpoint=n,e(i);t(r)})})},_guessDelimiter(t){const e=this._getRows(t.replace(/"[^\r]*?"/g,""),2);if(2!==e.length)throw this.error(this.ERRORS.NOT_ENOUGH_ROWS_IN_FILE);const[n,i]=e,[r,o]=[",",";"],a=this._countCharsInLine(n,r),s=this._countCharsInLine(n,o),l=this._countCharsInLine(i,r),u=this._countCharsInLine(i,o);if(this._checkDelimiters(a,l,s,u))return r;if(this._checkDelimiters(s,u,a,l))return o;throw this.error(this.ERRORS.UNDEFINED_DELIMITER)},_checkDelimiters:(t,e,n,i)=>t===e&&t>1&&(n!==i||!n&&!i||t>n&&e>i),_getRows(t,e=0){const n=/([^\r\n]+)/g,i=[];let r,o=0;do{(r=n.exec(t))&&r.length>1&&(++o,i.push(r[1]))}while(r&&o!==e);return i},_countCharsInLine(t,e){const n=new RegExp(e,"g"),i=t.match(n);return i?i.length:0},_createParseStrategy(t){return e=>{if(!new RegExp(`[^-\\d${t}]`).test(e)&&e){const n=i(e,t);return isFinite(n)&&!isNaN(n)||(this._isParseSuccessful=!1),n}return e}},_mapRows(t,e,n){const i=this._getRowMapper(e,n);this._failedParseStrategies=0;for(const e of this._parseStrategies){this._parse=e,this._isParseSuccessful=!0;const n=[];for(const e of t){const t=i(e);if(!this._isParseSuccessful){this._failedParseStrategies++;break}n.push(t)}if(this._isParseSuccessful){if(this._failedParseStrategies===this._parseStrategies.length-1)throw this.error(this.ERRORS.DIFFERENT_SEPARATORS);return n}}},_onLoadError(t){delete r[this._basepath+this._lastModified],this._super(t)}}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(1);e.csvReaderObject=i.getReaderObject()}]);t.exports=n},55:function(t,e){var n=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=90)}([function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},,function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const i=n(8),r=n(4);e.SCHEMAS=new Set(["concepts.schema","entities.schema","datapoints.schema","*.schema"]),e.DATAPOINTS="datapoints",e.ENTITIES="entities",e.CONCEPTS="concepts",e.CONCEPT_TYPE_MEASURE="measure",e.CONCEPT_TYPE_STRING="string",e.CONCEPT_TYPE_ENTITY_DOMAIN="entity_domain",e.CONCEPT_TYPE_ENTITY_SET="entity_set",e.CONCEPT_TYPE_TIME="time",e.RESERVED_CONCEPT="concept",e.RESERVED_CONCEPT_TYPE="concept_type",e.RESERVED_DOMAIN="domain",e.RESERVED_UNIT="unit",e.RESERVED_DRILL_UP="drill_up",e.RESERVED_KEY="key",e.RESERVED_VALUE="value",e.AVAILABLE_QUERY_OPERATORS=new Set(["$eq","$gt","$gte","$lt","$lte","$ne","$in","$nin","$or","$and","$not","$nor","$size","$all","$elemMatch"]),e.AVAILABLE_FROM_CLAUSE_VALUES=new Set([e.CONCEPTS,e.ENTITIES,e.DATAPOINTS,...e.SCHEMAS]),e.AVAILABLE_ORDER_BY_CLAUSE_VALUES=new Set(["asc","desc",1,-1]),e.DEFAULT_REPOSITORY_NAME=t.env.DEFAULT_REPOSITORY_NAME||"systema_globalis",e.DEFAULT_REPOSITORY_BRANCH=t.env.DEFAULT_REPOSITORY_BRANCH||"master",e.DEFAULT_REPOSITORY_HASH="HEAD",e.isSchemaQuery=function(t){const n=i(t,"from");return e.SCHEMAS.has(n)},e.isDatapointsQuery=function(t){return i(t,"from")===e.DATAPOINTS},e.isEntitiesQuery=function(t){return i(t,"from")===e.ENTITIES},e.isConceptsQuery=function(t){return i(t,"from")===e.CONCEPTS},e.isEntityDomainOrSet=function(t,e){return r(e,t)},e.isMeasure=function(t){return r([e.CONCEPT_TYPE_MEASURE],t)},e.isIndicator=function(t){return r([e.CONCEPT_TYPE_MEASURE,e.CONCEPT_TYPE_STRING],t)}}).call(this,n(10))},function(t,e){var n=9007199254740991,i="[object Arguments]",r="[object Function]",o="[object GeneratorFunction]",a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=/^(?:0|[1-9]\d*)$/,h=parseInt;function d(t){return t!=t}var f,p,m=Object.prototype,v=m.hasOwnProperty,g=m.toString,y=m.propertyIsEnumerable,_=(f=Object.keys,p=Object,function(t){return f(p(t))}),b=Math.max;function x(t,e){var n=S(t)||function(t){return function(t){return z(t)&&M(t)}(t)&&v.call(t,"callee")&&(!y.call(t,"callee")||g.call(t)==i)}(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],r=n.length,o=!!r;for(var a in t)!e&&!v.call(t,a)||o&&("length"==a||w(a,r))||n.push(a);return n}function w(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||c.test(t))&&t>-1&&t%1==0&&t<e}var S=Array.isArray;function M(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function(t){var e=E(t)?g.call(t):"";return e==r||e==o}(t)}function E(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function z(t){return!!t&&"object"==typeof t}t.exports=function(t,e,n,i){var r;t=M(t)?t:(r=t)?function(t,e){return function(t,e){for(var n=-1,i=t?t.length:0,r=Array(i);++n<i;)r[n]=e(t[n]);return r}(e,function(e){return t[e]})}(r,function(t){return M(t)?x(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||m))return _(t);var e,n,i=[];for(var r in Object(t))v.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t)}(r)):[],n=n&&!i?function(t){var e=function(t){return t?(t=function(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||z(t)&&"[object Symbol]"==g.call(t)}(t))return NaN;if(E(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=E(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=l.test(t);return n||u.test(t)?h(t.slice(2),n?2:8):s.test(t)?NaN:+t}(t))===1/0||t===-1/0?1.7976931348623157e308*(t<0?-1:1):t==t?t:0:0===t?t:0}(t),n=e%1;return e==e?n?e-n:e:0}(n):0;var o=t.length;return n<0&&(n=b(o+n,0)),function(t){return"string"==typeof t||!S(t)&&z(t)&&"[object String]"==g.call(t)}(t)?n<=o&&t.indexOf(e,n)>-1:!!o&&function(t,e,n){if(e!=e)return function(t,e,n,i){for(var r=t.length,o=n+-1;++o<r;)if(e(t[o],o,t))return o;return-1}(t,d,n);for(var i=n-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}(t,e,n)>-1}},,,,function(t,e,n){(function(e){var n,i="Expected a function",r="__lodash_hash_undefined__",o=1/0,a="[object Function]",s="[object GeneratorFunction]",l="[object Symbol]",u=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/,h=/^\./,d=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,f=/\\(\\)?/g,p=/^\[object .+?Constructor\]$/,m="object"==typeof e&&e&&e.Object===Object&&e,v="object"==typeof self&&self&&self.Object===Object&&self,g=m||v||Function("return this")(),y=Array.prototype,_=Function.prototype,b=Object.prototype,x=g["__core-js_shared__"],w=(n=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",S=_.toString,M=b.hasOwnProperty,E=b.toString,z=RegExp("^"+S.call(M).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),k=g.Symbol,T=y.splice,O=F(g,"Map"),P=F(Object,"create"),C=k?k.prototype:void 0,A=C?C.toString:void 0;function I(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function L(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function j(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function D(t,e){for(var n,i,r=t.length;r--;)if((n=t[r][0])===(i=e)||n!=n&&i!=i)return r;return-1}function R(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function F(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!U(t)||w&&w in t)&&(function(t){var e=U(t)?E.call(t):"";return e==a||e==s}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?z:p).test(function(t){if(null!=t){try{return S.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}(n)?n:void 0}I.prototype.clear=function(){this.__data__=P?P(null):{}},I.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},I.prototype.get=function(t){var e=this.__data__;if(P){var n=e[t];return n===r?void 0:n}return M.call(e,t)?e[t]:void 0},I.prototype.has=function(t){var e=this.__data__;return P?void 0!==e[t]:M.call(e,t)},I.prototype.set=function(t,e){return this.__data__[t]=P&&void 0===e?r:e,this},L.prototype.clear=function(){this.__data__=[]},L.prototype.delete=function(t){var e=this.__data__,n=D(e,t);return!(n<0||(n==e.length-1?e.pop():T.call(e,n,1),0))},L.prototype.get=function(t){var e=this.__data__,n=D(e,t);return n<0?void 0:e[n][1]},L.prototype.has=function(t){return D(this.__data__,t)>-1},L.prototype.set=function(t,e){var n=this.__data__,i=D(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},j.prototype.clear=function(){this.__data__={hash:new I,map:new(O||L),string:new I}},j.prototype.delete=function(t){return R(this,t).delete(t)},j.prototype.get=function(t){return R(this,t).get(t)},j.prototype.has=function(t){return R(this,t).has(t)},j.prototype.set=function(t,e){return R(this,t).set(t,e),this};var B=q(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(H(t))return A?A.call(t):"";var e=t+"";return"0"==e&&1/t==-o?"-0":e}(e);var n=[];return h.test(t)&&n.push(""),t.replace(d,function(t,e,i,r){n.push(i?r.replace(f,"$1"):e||t)}),n});function N(t){if("string"==typeof t||H(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}function q(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new(q.Cache||j),n}q.Cache=j;var V=Array.isArray;function U(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function H(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&E.call(t)==l}t.exports=function(t,e,n){var i=null==t?void 0:function(t,e){for(var n,i=0,r=(e=function(t,e){if(V(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!H(t))||c.test(t)||!u.test(t)||null!=e&&t in Object(e)}(e,t)?[e]:V(n=e)?n:B(n)).length;null!=t&&i<r;)t=t[N(e[i++])];return i&&i==r?t:void 0}(t,e);return void 0===i?n:i}}).call(this,n(0))},function(t,e){t.exports=function(t){return null==t}},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!c){var t=s(d);c=!0;for(var e=u.length;e;){for(l=u,u=[];++h<e;)l&&l[h].run();h=-1,e=u.length}l=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){(function(t,n){var i,r,o,a=9007199254740991,s="[object Arguments]",l="[object Function]",u="[object GeneratorFunction]",c="[object Map]",h="[object Set]",d=/^\[object .+?Constructor\]$/,f="object"==typeof t&&t&&t.Object===Object&&t,p="object"==typeof self&&self&&self.Object===Object&&self,m=f||p||Function("return this")(),v="object"==typeof e&&e&&!e.nodeType&&e,g=v&&"object"==typeof n&&n&&!n.nodeType&&n,y=g&&g.exports===v,_=Function.prototype,b=Object.prototype,x=m["__core-js_shared__"],w=(i=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",S=_.toString,M=b.hasOwnProperty,E=b.toString,z=RegExp("^"+S.call(M).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),k=y?m.Buffer:void 0,T=b.propertyIsEnumerable,O=k?k.isBuffer:void 0,P=(r=Object.keys,o=Object,function(t){return r(o(t))}),C=V(m,"DataView"),A=V(m,"Map"),I=V(m,"Promise"),L=V(m,"Set"),j=V(m,"WeakMap"),D=!T.call({valueOf:1},"valueOf"),R=H(C),F=H(A),B=H(I),N=H(L),q=H(j);function V(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!X(t)||w&&w in t)&&(G(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?z:d).test(H(t))}(n)?n:void 0}var U=function(t){return E.call(t)};function H(t){if(null!=t){try{return S.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(C&&"[object DataView]"!=U(new C(new ArrayBuffer(1)))||A&&U(new A)!=c||I&&"[object Promise]"!=U(I.resolve())||L&&U(new L)!=h||j&&"[object WeakMap]"!=U(new j))&&(U=function(t){var e=E.call(t),n="[object Object]"==e?t.constructor:void 0,i=n?H(n):void 0;if(i)switch(i){case R:return"[object DataView]";case F:return c;case B:return"[object Promise]";case N:return h;case q:return"[object WeakMap]"}return e});var W=Array.isArray;function K(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}(t.length)&&!G(t)}var Y=O||function(){return!1};function G(t){var e=X(t)?E.call(t):"";return e==l||e==u}function X(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}n.exports=function(t){if(K(t)&&(W(t)||"string"==typeof t||"function"==typeof t.splice||Y(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&K(t)}(t)&&M.call(t,"callee")&&(!T.call(t,"callee")||E.call(t)==s)}(t)))return!t.length;var e=U(t);if(e==c||e==h)return!t.size;if(D||function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||b)}(t))return!P(t).length;for(var n in t)if(M.call(t,n))return!1;return!0}}).call(this,n(0),n(1)(t))},,,,,function(t,e,n){(function(t,n){var i="Expected a function",r="__lodash_hash_undefined__",o=1,a=2,s=1/0,l=9007199254740991,u="[object Arguments]",c="[object Array]",h="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",m="[object GeneratorFunction]",v="[object Map]",g="[object Number]",y="[object Object]",_="[object RegExp]",b="[object Set]",x="[object String]",w="[object Symbol]",S="[object ArrayBuffer]",M="[object DataView]",E=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,z=/^\w*$/,k=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,O=/\\(\\)?/g,P=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[u]=A[c]=A[S]=A[h]=A[M]=A[d]=A[f]=A[p]=A[v]=A[g]=A[y]=A[_]=A[b]=A[x]=A["[object WeakMap]"]=!1;var I="object"==typeof t&&t&&t.Object===Object&&t,L="object"==typeof self&&self&&self.Object===Object&&self,j=I||L||Function("return this")(),D="object"==typeof e&&e&&!e.nodeType&&e,R=D&&"object"==typeof n&&n&&!n.nodeType&&n,F=R&&R.exports===D&&I.process,B=function(){try{return F&&F.binding("util")}catch(t){}}(),N=B&&B.isTypedArray;function q(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}function V(t,e){for(var n=-1,i=t?t.length:0;++n<i;)if(e(t[n],n,t))return!0;return!1}function U(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function H(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}function W(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var K,Y,G,X=Array.prototype,$=Function.prototype,Z=Object.prototype,Q=j["__core-js_shared__"],J=(K=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",tt=$.toString,et=Z.hasOwnProperty,nt=Z.toString,it=RegExp("^"+tt.call(et).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=j.Symbol,ot=j.Uint8Array,at=Z.propertyIsEnumerable,st=X.splice,lt=rt?rt.isConcatSpreadable:void 0,ut=(Y=Object.keys,G=Object,function(t){return Y(G(t))}),ct=Bt(j,"DataView"),ht=Bt(j,"Map"),dt=Bt(j,"Promise"),ft=Bt(j,"Set"),pt=Bt(j,"WeakMap"),mt=Bt(Object,"create"),vt=Gt(ct),gt=Gt(ht),yt=Gt(dt),_t=Gt(ft),bt=Gt(pt),xt=rt?rt.prototype:void 0,wt=xt?xt.valueOf:void 0,St=xt?xt.toString:void 0;function Mt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Et(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function zt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function kt(t){var e=-1,n=t?t.length:0;for(this.__data__=new zt;++e<n;)this.add(t[e])}function Tt(t){this.__data__=new Et(t)}function Ot(t,e){for(var n=t.length;n--;)if($t(t[n][0],e))return n;return-1}Mt.prototype.clear=function(){this.__data__=mt?mt(null):{}},Mt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Mt.prototype.get=function(t){var e=this.__data__;if(mt){var n=e[t];return n===r?void 0:n}return et.call(e,t)?e[t]:void 0},Mt.prototype.has=function(t){var e=this.__data__;return mt?void 0!==e[t]:et.call(e,t)},Mt.prototype.set=function(t,e){return this.__data__[t]=mt&&void 0===e?r:e,this},Et.prototype.clear=function(){this.__data__=[]},Et.prototype.delete=function(t){var e=this.__data__,n=Ot(e,t);return!(n<0||(n==e.length-1?e.pop():st.call(e,n,1),0))},Et.prototype.get=function(t){var e=this.__data__,n=Ot(e,t);return n<0?void 0:e[n][1]},Et.prototype.has=function(t){return Ot(this.__data__,t)>-1},Et.prototype.set=function(t,e){var n=this.__data__,i=Ot(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},zt.prototype.clear=function(){this.__data__={hash:new Mt,map:new(ht||Et),string:new Mt}},zt.prototype.delete=function(t){return Ft(this,t).delete(t)},zt.prototype.get=function(t){return Ft(this,t).get(t)},zt.prototype.has=function(t){return Ft(this,t).has(t)},zt.prototype.set=function(t,e){return Ft(this,t).set(t,e),this},kt.prototype.add=kt.prototype.push=function(t){return this.__data__.set(t,r),this},kt.prototype.has=function(t){return this.__data__.has(t)},Tt.prototype.clear=function(){this.__data__=new Et},Tt.prototype.delete=function(t){return this.__data__.delete(t)},Tt.prototype.get=function(t){return this.__data__.get(t)},Tt.prototype.has=function(t){return this.__data__.has(t)},Tt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Et){var i=n.__data__;if(!ht||i.length<199)return i.push([t,e]),this;n=this.__data__=new zt(i)}return n.set(t,e),this};var Pt,Ct=(Pt=function(t,e){return t&&At(t,e,ae)},function(t,e){if(null==t)return t;if(!Jt(t))return Pt(t,e);for(var n=t.length,i=-1,r=Object(t);++i<n&&!1!==e(r[i],i,r););return t}),At=function(t,e,n){for(var i=-1,r=Object(t),o=n(t),a=o.length;a--;){var s=o[++i];if(!1===e(r[s],s,r))break}return t};function It(t,e){for(var n=0,i=(e=Ut(e,t)?[e]:Dt(e)).length;null!=t&&n<i;)t=t[Yt(e[n++])];return n&&n==i?t:void 0}function Lt(t,e){return null!=t&&e in Object(t)}function jt(t,e,n,i,r){return t===e||(null==t||null==e||!ne(t)&&!ie(e)?t!=t&&e!=e:function(t,e,n,i,r,s){var l=Qt(t),p=Qt(e),m=c,E=c;l||(m=(m=Nt(t))==u?y:m),p||(E=(E=Nt(e))==u?y:E);var z=m==y&&!U(t),k=E==y&&!U(e),T=m==E;if(T&&!z)return s||(s=new Tt),l||oe(t)?Rt(t,e,n,i,r,s):function(t,e,n,i,r,s,l){switch(n){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case S:return!(t.byteLength!=e.byteLength||!i(new ot(t),new ot(e)));case h:case d:case g:return $t(+t,+e);case f:return t.name==e.name&&t.message==e.message;case _:case x:return t==e+"";case v:var u=H;case b:var c=s&a;if(u||(u=W),t.size!=e.size&&!c)return!1;var p=l.get(t);if(p)return p==e;s|=o,l.set(t,e);var m=Rt(u(t),u(e),i,r,s,l);return l.delete(t),m;case w:if(wt)return wt.call(t)==wt.call(e)}return!1}(t,e,m,n,i,r,s);if(!(r&a)){var O=z&&et.call(t,"__wrapped__"),P=k&&et.call(e,"__wrapped__");if(O||P){var C=O?t.value():t,A=P?e.value():e;return s||(s=new Tt),n(C,A,i,r,s)}}return!!T&&(s||(s=new Tt),function(t,e,n,i,r,o){var s=r&a,l=ae(t),u=l.length;if(u!=ae(e).length&&!s)return!1;for(var c=u;c--;){var h=l[c];if(!(s?h in e:et.call(e,h)))return!1}var d=o.get(t);if(d&&o.get(e))return d==e;var f=!0;o.set(t,e),o.set(e,t);for(var p=s;++c<u;){var m=t[h=l[c]],v=e[h];if(i)var g=s?i(v,m,h,e,t,o):i(m,v,h,t,e,o);if(!(void 0===g?m===v||n(m,v,i,r,o):g)){f=!1;break}p||(p="constructor"==h)}if(f&&!p){var y=t.constructor,_=e.constructor;y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return o.delete(t),o.delete(e),f}(t,e,n,i,r,s))}(t,e,jt,n,i,r))}function Dt(t){return Qt(t)?t:Kt(t)}function Rt(t,e,n,i,r,s){var l=r&a,u=t.length,c=e.length;if(u!=c&&!(l&&c>u))return!1;var h=s.get(t);if(h&&s.get(e))return h==e;var d=-1,f=!0,p=r&o?new kt:void 0;for(s.set(t,e),s.set(e,t);++d<u;){var m=t[d],v=e[d];if(i)var g=l?i(v,m,d,e,t,s):i(m,v,d,t,e,s);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!V(e,function(t,e){if(!p.has(e)&&(m===t||n(m,t,i,r,s)))return p.add(e)})){f=!1;break}}else if(m!==v&&!n(m,v,i,r,s)){f=!1;break}}return s.delete(t),s.delete(e),f}function Ft(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function Bt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!ne(t)||J&&J in t)&&(te(t)||U(t)?it:P).test(Gt(t))}(n)?n:void 0}var Nt=function(t){return nt.call(t)};function qt(t){return Qt(t)||Zt(t)||!!(lt&&t&&t[lt])}function Vt(t,e){return!!(e=null==e?l:e)&&("number"==typeof t||C.test(t))&&t>-1&&t%1==0&&t<e}function Ut(t,e){if(Qt(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!re(t))||z.test(t)||!E.test(t)||null!=e&&t in Object(e)}function Ht(t){return t==t&&!ne(t)}function Wt(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}}(ct&&Nt(new ct(new ArrayBuffer(1)))!=M||ht&&Nt(new ht)!=v||dt&&"[object Promise]"!=Nt(dt.resolve())||ft&&Nt(new ft)!=b||pt&&"[object WeakMap]"!=Nt(new pt))&&(Nt=function(t){var e=nt.call(t),n=e==y?t.constructor:void 0,i=n?Gt(n):void 0;if(i)switch(i){case vt:return M;case gt:return v;case yt:return"[object Promise]";case _t:return b;case bt:return"[object WeakMap]"}return e});var Kt=Xt(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(re(t))return St?St.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}(e);var n=[];return k.test(t)&&n.push(""),t.replace(T,function(t,e,i,r){n.push(i?r.replace(O,"$1"):e||t)}),n});function Yt(t){if("string"==typeof t||re(t))return t;var e=t+"";return"0"==e&&1/t==-s?"-0":e}function Gt(t){if(null!=t){try{return tt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Xt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new(Xt.Cache||zt),n}function $t(t,e){return t===e||t!=t&&e!=e}function Zt(t){return function(t){return ie(t)&&Jt(t)}(t)&&et.call(t,"callee")&&(!at.call(t,"callee")||nt.call(t)==u)}Xt.Cache=zt;var Qt=Array.isArray;function Jt(t){return null!=t&&ee(t.length)&&!te(t)}function te(t){var e=ne(t)?nt.call(t):"";return e==p||e==m}function ee(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=l}function ne(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function ie(t){return!!t&&"object"==typeof t}function re(t){return"symbol"==typeof t||ie(t)&&nt.call(t)==w}var oe=N?function(t){return function(e){return t(e)}}(N):function(t){return ie(t)&&ee(t.length)&&!!A[nt.call(t)]};function ae(t){return Jt(t)?function(t,e){var n=Qt(t)||Zt(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],i=n.length,r=!!i;for(var o in t)!e&&!et.call(t,o)||r&&("length"==o||Vt(o,i))||n.push(o);return n}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||Z))return ut(t);var e,n,i=[];for(var r in Object(t))et.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t)}function se(t){return t}n.exports=function(t,e){return function t(e,n,i,r,o){var a=-1,s=e.length;for(i||(i=qt),o||(o=[]);++a<s;){var l=e[a];n>0&&i(l)?n>1?t(l,n-1,i,r,o):q(o,l):r||(o[o.length]=l)}return o}(function(t,e){return(Qt(t)?function(t,e){for(var n=-1,i=t?t.length:0,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}:function(t,e){var n=-1,i=Jt(t)?Array(t.length):[];return Ct(t,function(t,r,o){i[++n]=e(t,r,o)}),i})(t,function(t){return"function"==typeof t?t:null==t?se:"object"==typeof t?Qt(t)?function(t,e){return Ut(t)&&Ht(e)?Wt(Yt(t),e):function(n){var i=function(t,e,n){var i=null==t?void 0:It(t,e);return void 0===i?void 0:i}(n,t);return void 0===i&&i===e?function(t,e){return null!=n&&function(t,e,n){for(var i,r=-1,o=(e=Ut(e,t)?[e]:Dt(e)).length;++r<o;){var a=Yt(e[r]);if(!(i=null!=t&&n(t,a)))break;t=t[a]}return i||!!(o=t?t.length:0)&&ee(o)&&Vt(a,o)&&(Qt(t)||Zt(t))}(n,e,Lt)}(0,t):jt(e,i,void 0,o|a)}}(t[0],t[1]):function(t){var e=function(t){for(var e=ae(t),n=e.length;n--;){var i=e[n],r=t[i];e[n]=[i,r,Ht(r)]}return e}(t);return 1==e.length&&e[0][2]?Wt(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,i){var r=n.length,s=r;if(null==t)return!s;for(t=Object(t);r--;){var l=n[r];if(l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++r<s;){var u=(l=n[r])[0],c=t[u],h=l[1];if(l[2]){if(void 0===c&&!(u in t))return!1}else{var d,f=new Tt;if(!(void 0===d?jt(h,c,i,o|a,f):d))return!1}}return!0}(n,0,e)}}(t):Ut(e=t)?(n=Yt(e),function(t){return null==t?void 0:t[n]}):function(t){return function(e){return It(e,t)}}(e);var e,n}(e))}(t,e),1)}}).call(this,n(0),n(1)(t))},function(t,e,n){(function(t,n){var i="Expected a function",r="__lodash_hash_undefined__",o=1,a=2,s=1/0,l=9007199254740991,u="[object Arguments]",c="[object Array]",h="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",m="[object GeneratorFunction]",v="[object Map]",g="[object Number]",y="[object Object]",_="[object RegExp]",b="[object Set]",x="[object String]",w="[object Symbol]",S="[object ArrayBuffer]",M="[object DataView]",E=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,z=/^\w*$/,k=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,O=/\\(\\)?/g,P=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[u]=A[c]=A[S]=A[h]=A[M]=A[d]=A[f]=A[p]=A[v]=A[g]=A[y]=A[_]=A[b]=A[x]=A["[object WeakMap]"]=!1;var I="object"==typeof t&&t&&t.Object===Object&&t,L="object"==typeof self&&self&&self.Object===Object&&self,j=I||L||Function("return this")(),D="object"==typeof e&&e&&!e.nodeType&&e,R=D&&"object"==typeof n&&n&&!n.nodeType&&n,F=R&&R.exports===D&&I.process,B=function(){try{return F&&F.binding("util")}catch(t){}}(),N=B&&B.isTypedArray;function q(t,e){for(var n=-1,i=t?t.length:0;++n<i;)if(e(t[n],n,t))return!0;return!1}function V(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function U(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}function H(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var W,K,Y,G=Array.prototype,X=Function.prototype,$=Object.prototype,Z=j["__core-js_shared__"],Q=(W=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",J=X.toString,tt=$.hasOwnProperty,et=$.toString,nt=RegExp("^"+J.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),it=j.Symbol,rt=j.Uint8Array,ot=$.propertyIsEnumerable,at=G.splice,st=(K=Object.keys,Y=Object,function(t){return K(Y(t))}),lt=Rt(j,"DataView"),ut=Rt(j,"Map"),ct=Rt(j,"Promise"),ht=Rt(j,"Set"),dt=Rt(j,"WeakMap"),ft=Rt(Object,"create"),pt=Wt(lt),mt=Wt(ut),vt=Wt(ct),gt=Wt(ht),yt=Wt(dt),_t=it?it.prototype:void 0,bt=_t?_t.valueOf:void 0,xt=_t?_t.toString:void 0;function wt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function St(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Mt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Et(t){var e=-1,n=t?t.length:0;for(this.__data__=new Mt;++e<n;)this.add(t[e])}function zt(t){this.__data__=new St(t)}function kt(t,e){for(var n=t.length;n--;)if(Yt(t[n][0],e))return n;return-1}wt.prototype.clear=function(){this.__data__=ft?ft(null):{}},wt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},wt.prototype.get=function(t){var e=this.__data__;if(ft){var n=e[t];return n===r?void 0:n}return tt.call(e,t)?e[t]:void 0},wt.prototype.has=function(t){var e=this.__data__;return ft?void 0!==e[t]:tt.call(e,t)},wt.prototype.set=function(t,e){return this.__data__[t]=ft&&void 0===e?r:e,this},St.prototype.clear=function(){this.__data__=[]},St.prototype.delete=function(t){var e=this.__data__,n=kt(e,t);return!(n<0||(n==e.length-1?e.pop():at.call(e,n,1),0))},St.prototype.get=function(t){var e=this.__data__,n=kt(e,t);return n<0?void 0:e[n][1]},St.prototype.has=function(t){return kt(this.__data__,t)>-1},St.prototype.set=function(t,e){var n=this.__data__,i=kt(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},Mt.prototype.clear=function(){this.__data__={hash:new wt,map:new(ut||St),string:new wt}},Mt.prototype.delete=function(t){return Dt(this,t).delete(t)},Mt.prototype.get=function(t){return Dt(this,t).get(t)},Mt.prototype.has=function(t){return Dt(this,t).has(t)},Mt.prototype.set=function(t,e){return Dt(this,t).set(t,e),this},Et.prototype.add=Et.prototype.push=function(t){return this.__data__.set(t,r),this},Et.prototype.has=function(t){return this.__data__.has(t)},zt.prototype.clear=function(){this.__data__=new St},zt.prototype.delete=function(t){return this.__data__.delete(t)},zt.prototype.get=function(t){return this.__data__.get(t)},zt.prototype.has=function(t){return this.__data__.has(t)},zt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof St){var i=n.__data__;if(!ut||i.length<199)return i.push([t,e]),this;n=this.__data__=new Mt(i)}return n.set(t,e),this};var Tt,Ot=(Tt=function(t,e){return t&&Pt(t,e,ie)},function(t,e){if(null==t)return t;if(!$t(t))return Tt(t,e);for(var n=t.length,i=-1,r=Object(t);++i<n&&!1!==e(r[i],i,r););return t}),Pt=function(t,e,n){for(var i=-1,r=Object(t),o=n(t),a=o.length;a--;){var s=o[++i];if(!1===e(r[s],s,r))break}return t};function Ct(t,e){for(var n=0,i=(e=Nt(e,t)?[e]:Lt(e)).length;null!=t&&n<i;)t=t[Ht(e[n++])];return n&&n==i?t:void 0}function At(t,e){return null!=t&&e in Object(t)}function It(t,e,n,i,r){return t===e||(null==t||null==e||!Jt(t)&&!te(e)?t!=t&&e!=e:function(t,e,n,i,r,s){var l=Xt(t),p=Xt(e),m=c,E=c;l||(m=(m=Ft(t))==u?y:m),p||(E=(E=Ft(e))==u?y:E);var z=m==y&&!V(t),k=E==y&&!V(e),T=m==E;if(T&&!z)return s||(s=new zt),l||ne(t)?jt(t,e,n,i,r,s):function(t,e,n,i,r,s,l){switch(n){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case S:return!(t.byteLength!=e.byteLength||!i(new rt(t),new rt(e)));case h:case d:case g:return Yt(+t,+e);case f:return t.name==e.name&&t.message==e.message;case _:case x:return t==e+"";case v:var u=U;case b:var c=s&a;if(u||(u=H),t.size!=e.size&&!c)return!1;var p=l.get(t);if(p)return p==e;s|=o,l.set(t,e);var m=jt(u(t),u(e),i,r,s,l);return l.delete(t),m;case w:if(bt)return bt.call(t)==bt.call(e)}return!1}(t,e,m,n,i,r,s);if(!(r&a)){var O=z&&tt.call(t,"__wrapped__"),P=k&&tt.call(e,"__wrapped__");if(O||P){var C=O?t.value():t,A=P?e.value():e;return s||(s=new zt),n(C,A,i,r,s)}}return!!T&&(s||(s=new zt),function(t,e,n,i,r,o){var s=r&a,l=ie(t),u=l.length;if(u!=ie(e).length&&!s)return!1;for(var c=u;c--;){var h=l[c];if(!(s?h in e:tt.call(e,h)))return!1}var d=o.get(t);if(d&&o.get(e))return d==e;var f=!0;o.set(t,e),o.set(e,t);for(var p=s;++c<u;){var m=t[h=l[c]],v=e[h];if(i)var g=s?i(v,m,h,e,t,o):i(m,v,h,t,e,o);if(!(void 0===g?m===v||n(m,v,i,r,o):g)){f=!1;break}p||(p="constructor"==h)}if(f&&!p){var y=t.constructor,_=e.constructor;y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return o.delete(t),o.delete(e),f}(t,e,n,i,r,s))}(t,e,It,n,i,r))}function Lt(t){return Xt(t)?t:Ut(t)}function jt(t,e,n,i,r,s){var l=r&a,u=t.length,c=e.length;if(u!=c&&!(l&&c>u))return!1;var h=s.get(t);if(h&&s.get(e))return h==e;var d=-1,f=!0,p=r&o?new Et:void 0;for(s.set(t,e),s.set(e,t);++d<u;){var m=t[d],v=e[d];if(i)var g=l?i(v,m,d,e,t,s):i(m,v,d,t,e,s);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!q(e,function(t,e){if(!p.has(e)&&(m===t||n(m,t,i,r,s)))return p.add(e)})){f=!1;break}}else if(m!==v&&!n(m,v,i,r,s)){f=!1;break}}return s.delete(t),s.delete(e),f}function Dt(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function Rt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Jt(t)||Q&&Q in t)&&(Zt(t)||V(t)?nt:P).test(Wt(t))}(n)?n:void 0}var Ft=function(t){return et.call(t)};function Bt(t,e){return!!(e=null==e?l:e)&&("number"==typeof t||C.test(t))&&t>-1&&t%1==0&&t<e}function Nt(t,e){if(Xt(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ee(t))||z.test(t)||!E.test(t)||null!=e&&t in Object(e)}function qt(t){return t==t&&!Jt(t)}function Vt(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}}(lt&&Ft(new lt(new ArrayBuffer(1)))!=M||ut&&Ft(new ut)!=v||ct&&"[object Promise]"!=Ft(ct.resolve())||ht&&Ft(new ht)!=b||dt&&"[object WeakMap]"!=Ft(new dt))&&(Ft=function(t){var e=et.call(t),n=e==y?t.constructor:void 0,i=n?Wt(n):void 0;if(i)switch(i){case pt:return M;case mt:return v;case vt:return"[object Promise]";case gt:return b;case yt:return"[object WeakMap]"}return e});var Ut=Kt(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(ee(t))return xt?xt.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}(e);var n=[];return k.test(t)&&n.push(""),t.replace(T,function(t,e,i,r){n.push(i?r.replace(O,"$1"):e||t)}),n});function Ht(t){if("string"==typeof t||ee(t))return t;var e=t+"";return"0"==e&&1/t==-s?"-0":e}function Wt(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Kt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new(Kt.Cache||Mt),n}function Yt(t,e){return t===e||t!=t&&e!=e}function Gt(t){return function(t){return te(t)&&$t(t)}(t)&&tt.call(t,"callee")&&(!ot.call(t,"callee")||et.call(t)==u)}Kt.Cache=Mt;var Xt=Array.isArray;function $t(t){return null!=t&&Qt(t.length)&&!Zt(t)}function Zt(t){var e=Jt(t)?et.call(t):"";return e==p||e==m}function Qt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=l}function Jt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function te(t){return!!t&&"object"==typeof t}function ee(t){return"symbol"==typeof t||te(t)&&et.call(t)==w}var ne=N?function(t){return function(e){return t(e)}}(N):function(t){return te(t)&&Qt(t.length)&&!!A[et.call(t)]};function ie(t){return $t(t)?function(t,e){var n=Xt(t)||Gt(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],i=n.length,r=!!i;for(var o in t)!e&&!tt.call(t,o)||r&&("length"==o||Bt(o,i))||n.push(o);return n}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||$))return st(t);var e,n,i=[];for(var r in Object(t))tt.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t)}function re(t){return t}n.exports=function(t,e){return(Xt(t)?function(t,e){for(var n=-1,i=t?t.length:0,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}:function(t,e){var n=-1,i=$t(t)?Array(t.length):[];return Ot(t,function(t,r,o){i[++n]=e(t,r,o)}),i})(t,function(t){return"function"==typeof t?t:null==t?re:"object"==typeof t?Xt(t)?function(t,e){return Nt(t)&&qt(e)?Vt(Ht(t),e):function(n){var i=function(t,e,n){var i=null==t?void 0:Ct(t,e);return void 0===i?void 0:i}(n,t);return void 0===i&&i===e?function(t,e){return null!=n&&function(t,e,n){for(var i,r=-1,o=(e=Nt(e,t)?[e]:Lt(e)).length;++r<o;){var a=Ht(e[r]);if(!(i=null!=t&&n(t,a)))break;t=t[a]}return i||!!(o=t?t.length:0)&&Qt(o)&&Bt(a,o)&&(Xt(t)||Gt(t))}(n,e,At)}(0,t):It(e,i,void 0,o|a)}}(t[0],t[1]):function(t){var e=function(t){for(var e=ie(t),n=e.length;n--;){var i=e[n],r=t[i];e[n]=[i,r,qt(r)]}return e}(t);return 1==e.length&&e[0][2]?Vt(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,i){var r=n.length,s=r;if(null==t)return!s;for(t=Object(t);r--;){var l=n[r];if(l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++r<s;){var u=(l=n[r])[0],c=t[u],h=l[1];if(l[2]){if(void 0===c&&!(u in t))return!1}else{var d,f=new zt;if(!(void 0===d?It(h,c,i,o|a,f):d))return!1}}return!0}(n,0,e)}}(t):Nt(e=t)?(n=Ht(e),function(t){return null==t?void 0:t[n]}):function(t){return function(e){return Ct(e,t)}}(e);var e,n}(e))}}).call(this,n(0),n(1)(t))},function(t,e){t.exports=function(t){for(var e=-1,n=t?t.length:0,i=0,r=[];++e<n;){var o=t[e];o&&(r[i++]=o)}return r}},function(t,e,n){(function(e){var n=1/0,i=1.7976931348623157e308,r=NaN,o="[object Symbol]",a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt,h="object"==typeof e&&e&&e.Object===Object&&e,d="object"==typeof self&&self&&self.Object===Object&&self,f=h||d||Function("return this")(),p=Object.prototype.toString,m=f.Symbol,v=m?m.prototype:void 0,g=v?v.toString:void 0;function y(t){if("string"==typeof t)return t;if(b(t))return g?g.call(t):"";var e=t+"";return"0"==e&&1/t==-n?"-0":e}function _(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function b(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&p.call(t)==o}function x(t){return t?(t=function(t){if("number"==typeof t)return t;if(b(t))return r;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=l.test(t);return n||u.test(t)?c(t.slice(2),n?2:8):s.test(t)?r:+t}(t))===n||t===-n?(t<0?-1:1)*i:t==t?t:0:0===t?t:0}t.exports=function(t,e,n){var i,r,o;return t=null==(i=t)?"":y(i),r=function(t){var e=x(t),n=e%1;return e==e?n?e-n:e:0}(n),0,o=t.length,r==r&&(void 0!==o&&(r=r<=o?r:o),r=r>=0?r:0),n=r,e=y(e),t.slice(n,n+e.length)==e}}).call(this,n(0))},function(t,e){var n,i,r=9007199254740991,o="[object Arguments]",a="[object Function]",s="[object GeneratorFunction]",l=/^(?:0|[1-9]\d*)$/,u=Object.prototype,c=u.hasOwnProperty,h=u.toString,d=u.propertyIsEnumerable,f=(n=Object.keys,i=Object,function(t){return n(i(t))});function p(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||l.test(t))&&t>-1&&t%1==0&&t<e}var m=Array.isArray;function v(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?h.call(t):"";return e==a||e==s}(t)}t.exports=function(t){return v(t)?function(t,e){var n=m(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&v(t)}(t)&&c.call(t,"callee")&&(!d.call(t,"callee")||h.call(t)==o)}(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],i=n.length,r=!!i;for(var a in t)!e&&!c.call(t,a)||r&&("length"==a||p(a,i))||n.push(a);return n}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||u))return f(t);var e,n,i=[];for(var r in Object(t))c.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.WhereClauseBasedOnConjunction="WhereClauseBasedOnConjunction",t.ConjunctionPartFromWhereClauseCorrespondsToJoin="ConjunctionPartFromWhereClauseCorrespondsToJoin"}(e.QueryFeature||(e.QueryFeature={}))},function(t,e){t.exports=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}},function(t,e,n){(function(t,i){var r=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(s(arguments[n]));return e.join(" ")}n=1;for(var i=arguments,o=i.length,a=String(t).replace(r,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return t}}),l=i[n];n<o;l=i[++n])m(l)||!b(l)?a+=" "+l:a+=" "+s(l);return a},e.deprecate=function(n,r){if(y(t.process))return function(){return e.deprecate(n,r).apply(this,arguments)};if(!0===i.noDeprecation)return n;var o=!1;return function(){if(!o){if(i.throwDeprecation)throw new Error(r);i.traceDeprecation?console.trace(r):console.error(r),o=!0}return n.apply(this,arguments)}};var o,a={};function s(t,n){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),p(n)?i.showHidden=n:n&&e._extend(i,n),y(i.showHidden)&&(i.showHidden=!1),y(i.depth)&&(i.depth=2),y(i.colors)&&(i.colors=!1),y(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=l),c(i,t,i.depth)}function l(t,e){var n=s.styles[e];return n?"["+s.colors[n][0]+"m"+t+"["+s.colors[n][1]+"m":t}function u(t,e){return t}function c(t,n,i){if(t.customInspect&&n&&S(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,t);return g(r)||(r=c(t,r,i)),r}var o=function(t,e){if(y(e))return t.stylize("undefined","undefined");if(g(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return v(e)?t.stylize(""+e,"number"):p(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}(t,n);if(o)return o;var a=Object.keys(n),s=function(t){var e={};return a.forEach(function(t,n){e[t]=!0}),e}();if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),w(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return h(n);if(0===a.length){if(S(n)){var l=n.name?": "+n.name:"";return t.stylize("[Function"+l+"]","special")}if(_(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(x(n))return t.stylize(Date.prototype.toString.call(n),"date");if(w(n))return h(n)}var u,b="",M=!1,E=["{","}"];return f(n)&&(M=!0,E=["[","]"]),S(n)&&(b=" [Function"+(n.name?": "+n.name:"")+"]"),_(n)&&(b=" "+RegExp.prototype.toString.call(n)),x(n)&&(b=" "+Date.prototype.toUTCString.call(n)),w(n)&&(b=" "+h(n)),0!==a.length||M&&0!=n.length?i<0?_(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=M?function(t,e,n,i,r){for(var o=[],a=0,s=e.length;a<s;++a)k(e,String(a))?o.push(d(t,e,n,i,String(a),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(d(t,e,n,i,r,!0))}),o}(t,n,i,s,a):a.map(function(e){return d(t,n,i,s,e,M)}),t.seen.pop(),function(t,e,n){return t.reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}(u,b,E)):E[0]+b+E[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,n,i,r,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?s=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),k(i,r)||(a="["+r+"]"),s||(t.seen.indexOf(l.value)<0?(s=m(n)?c(t,l.value,null):c(t,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),y(a)){if(o&&r.match(/^\d+$/))return s;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function f(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function m(t){return null===t}function v(t){return"number"==typeof t}function g(t){return"string"==typeof t}function y(t){return void 0===t}function _(t){return b(t)&&"[object RegExp]"===M(t)}function b(t){return"object"==typeof t&&null!==t}function x(t){return b(t)&&"[object Date]"===M(t)}function w(t){return b(t)&&("[object Error]"===M(t)||t instanceof Error)}function S(t){return"function"==typeof t}function M(t){return Object.prototype.toString.call(t)}function E(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(y(o)&&(o=i.env.NODE_DEBUG||""),t=t.toUpperCase(),!a[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=i.pid;a[t]=function(){var i=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,i)}}else a[t]=function(){};return a[t]},e.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=f,e.isBoolean=p,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=v,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=y,e.isRegExp=_,e.isObject=b,e.isDate=x,e.isError=w,e.isFunction=S,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(48);var z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,n;console.log("%s - %s",(n=[E((t=new Date).getHours()),E(t.getMinutes()),E(t.getSeconds())].join(":"),[t.getDate(),z[t.getMonth()],n].join(" ")),e.format.apply(e,arguments))},e.inherits=n(47),e._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),i=n.length;i--;)t[n[i]]=e[n[i]];return t}}).call(this,n(0),n(10))},function(t,e,n){(function(t,n){var i="Expected a function",r="__lodash_hash_undefined__",o=1,a=2,s=1/0,l=9007199254740991,u="[object Arguments]",c="[object Array]",h="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",m="[object GeneratorFunction]",v="[object Map]",g="[object Number]",y="[object Object]",_="[object RegExp]",b="[object Set]",x="[object String]",w="[object Symbol]",S="[object ArrayBuffer]",M="[object DataView]",E=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,z=/^\w*$/,k=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,O=/\\(\\)?/g,P=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[u]=A[c]=A[S]=A[h]=A[M]=A[d]=A[f]=A[p]=A[v]=A[g]=A[y]=A[_]=A[b]=A[x]=A["[object WeakMap]"]=!1;var I="object"==typeof t&&t&&t.Object===Object&&t,L="object"==typeof self&&self&&self.Object===Object&&self,j=I||L||Function("return this")(),D="object"==typeof e&&e&&!e.nodeType&&e,R=D&&"object"==typeof n&&n&&!n.nodeType&&n,F=R&&R.exports===D&&I.process,B=function(){try{return F&&F.binding("util")}catch(t){}}(),N=B&&B.isTypedArray;function q(t,e){for(var n=-1,i=t?t.length:0;++n<i;)if(e(t[n],n,t))return!0;return!1}function V(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function U(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}function H(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var W,K,Y,G=Array.prototype,X=Function.prototype,$=Object.prototype,Z=j["__core-js_shared__"],Q=(W=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",J=X.toString,tt=$.hasOwnProperty,et=$.toString,nt=RegExp("^"+J.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),it=j.Symbol,rt=j.Uint8Array,ot=$.propertyIsEnumerable,at=G.splice,st=(K=Object.keys,Y=Object,function(t){return K(Y(t))}),lt=Rt(j,"DataView"),ut=Rt(j,"Map"),ct=Rt(j,"Promise"),ht=Rt(j,"Set"),dt=Rt(j,"WeakMap"),ft=Rt(Object,"create"),pt=Wt(lt),mt=Wt(ut),vt=Wt(ct),gt=Wt(ht),yt=Wt(dt),_t=it?it.prototype:void 0,bt=_t?_t.valueOf:void 0,xt=_t?_t.toString:void 0;function wt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function St(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Mt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Et(t){var e=-1,n=t?t.length:0;for(this.__data__=new Mt;++e<n;)this.add(t[e])}function zt(t){this.__data__=new St(t)}function kt(t,e){for(var n=t.length;n--;)if(Yt(t[n][0],e))return n;return-1}wt.prototype.clear=function(){this.__data__=ft?ft(null):{}},wt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},wt.prototype.get=function(t){var e=this.__data__;if(ft){var n=e[t];return n===r?void 0:n}return tt.call(e,t)?e[t]:void 0},wt.prototype.has=function(t){var e=this.__data__;return ft?void 0!==e[t]:tt.call(e,t)},wt.prototype.set=function(t,e){return this.__data__[t]=ft&&void 0===e?r:e,this},St.prototype.clear=function(){this.__data__=[]},St.prototype.delete=function(t){var e=this.__data__,n=kt(e,t);return!(n<0||(n==e.length-1?e.pop():at.call(e,n,1),0))},St.prototype.get=function(t){var e=this.__data__,n=kt(e,t);return n<0?void 0:e[n][1]},St.prototype.has=function(t){return kt(this.__data__,t)>-1},St.prototype.set=function(t,e){var n=this.__data__,i=kt(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},Mt.prototype.clear=function(){this.__data__={hash:new wt,map:new(ut||St),string:new wt}},Mt.prototype.delete=function(t){return Dt(this,t).delete(t)},Mt.prototype.get=function(t){return Dt(this,t).get(t)},Mt.prototype.has=function(t){return Dt(this,t).has(t)},Mt.prototype.set=function(t,e){return Dt(this,t).set(t,e),this},Et.prototype.add=Et.prototype.push=function(t){return this.__data__.set(t,r),this},Et.prototype.has=function(t){return this.__data__.has(t)},zt.prototype.clear=function(){this.__data__=new St},zt.prototype.delete=function(t){return this.__data__.delete(t)},zt.prototype.get=function(t){return this.__data__.get(t)},zt.prototype.has=function(t){return this.__data__.has(t)},zt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof St){var i=n.__data__;if(!ut||i.length<199)return i.push([t,e]),this;n=this.__data__=new Mt(i)}return n.set(t,e),this};var Tt,Ot=(Tt=function(t,e){return t&&Pt(t,e,ie)},function(t,e){if(null==t)return t;if(!$t(t))return Tt(t,e);for(var n=t.length,i=-1,r=Object(t);++i<n&&!1!==e(r[i],i,r););return t});var Pt=function(t,e,n){for(var i=-1,r=Object(t),o=n(t),a=o.length;a--;){var s=o[++i];if(!1===e(r[s],s,r))break}return t};function Ct(t,e){for(var n=0,i=(e=Nt(e,t)?[e]:Lt(e)).length;null!=t&&n<i;)t=t[Ht(e[n++])];return n&&n==i?t:void 0}function At(t,e){return null!=t&&e in Object(t)}function It(t,e,n,i,r){return t===e||(null==t||null==e||!Jt(t)&&!te(e)?t!=t&&e!=e:function(t,e,n,i,r,s){var l=Xt(t),p=Xt(e),m=c,E=c;l||(m=(m=Ft(t))==u?y:m),p||(E=(E=Ft(e))==u?y:E);var z=m==y&&!V(t),k=E==y&&!V(e),T=m==E;if(T&&!z)return s||(s=new zt),l||ne(t)?jt(t,e,n,i,r,s):function(t,e,n,i,r,s,l){switch(n){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case S:return!(t.byteLength!=e.byteLength||!i(new rt(t),new rt(e)));case h:case d:case g:return Yt(+t,+e);case f:return t.name==e.name&&t.message==e.message;case _:case x:return t==e+"";case v:var u=U;case b:var c=s&a;if(u||(u=H),t.size!=e.size&&!c)return!1;var p=l.get(t);if(p)return p==e;s|=o,l.set(t,e);var m=jt(u(t),u(e),i,r,s,l);return l.delete(t),m;case w:if(bt)return bt.call(t)==bt.call(e)}return!1}(t,e,m,n,i,r,s);if(!(r&a)){var O=z&&tt.call(t,"__wrapped__"),P=k&&tt.call(e,"__wrapped__");if(O||P){var C=O?t.value():t,A=P?e.value():e;return s||(s=new zt),n(C,A,i,r,s)}}return!!T&&(s||(s=new zt),function(t,e,n,i,r,o){var s=r&a,l=ie(t),u=l.length;if(u!=ie(e).length&&!s)return!1;for(var c=u;c--;){var h=l[c];if(!(s?h in e:tt.call(e,h)))return!1}var d=o.get(t);if(d&&o.get(e))return d==e;var f=!0;o.set(t,e),o.set(e,t);for(var p=s;++c<u;){var m=t[h=l[c]],v=e[h];if(i)var g=s?i(v,m,h,e,t,o):i(m,v,h,t,e,o);if(!(void 0===g?m===v||n(m,v,i,r,o):g)){f=!1;break}p||(p="constructor"==h)}if(f&&!p){var y=t.constructor,_=e.constructor;y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return o.delete(t),o.delete(e),f}(t,e,n,i,r,s))}(t,e,It,n,i,r))}function Lt(t){return Xt(t)?t:Ut(t)}function jt(t,e,n,i,r,s){var l=r&a,u=t.length,c=e.length;if(u!=c&&!(l&&c>u))return!1;var h=s.get(t);if(h&&s.get(e))return h==e;var d=-1,f=!0,p=r&o?new Et:void 0;for(s.set(t,e),s.set(e,t);++d<u;){var m=t[d],v=e[d];if(i)var g=l?i(v,m,d,e,t,s):i(m,v,d,t,e,s);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!q(e,function(t,e){if(!p.has(e)&&(m===t||n(m,t,i,r,s)))return p.add(e)})){f=!1;break}}else if(m!==v&&!n(m,v,i,r,s)){f=!1;break}}return s.delete(t),s.delete(e),f}function Dt(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function Rt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Jt(t)||Q&&Q in t)&&(Zt(t)||V(t)?nt:P).test(Wt(t))}(n)?n:void 0}var Ft=function(t){return et.call(t)};function Bt(t,e){return!!(e=null==e?l:e)&&("number"==typeof t||C.test(t))&&t>-1&&t%1==0&&t<e}function Nt(t,e){if(Xt(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ee(t))||z.test(t)||!E.test(t)||null!=e&&t in Object(e)}function qt(t){return t==t&&!Jt(t)}function Vt(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}}(lt&&Ft(new lt(new ArrayBuffer(1)))!=M||ut&&Ft(new ut)!=v||ct&&"[object Promise]"!=Ft(ct.resolve())||ht&&Ft(new ht)!=b||dt&&"[object WeakMap]"!=Ft(new dt))&&(Ft=function(t){var e=et.call(t),n=e==y?t.constructor:void 0,i=n?Wt(n):void 0;if(i)switch(i){case pt:return M;case mt:return v;case vt:return"[object Promise]";case gt:return b;case yt:return"[object WeakMap]"}return e});var Ut=Kt(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(ee(t))return xt?xt.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}(e);var n=[];return k.test(t)&&n.push(""),t.replace(T,function(t,e,i,r){n.push(i?r.replace(O,"$1"):e||t)}),n});function Ht(t){if("string"==typeof t||ee(t))return t;var e=t+"";return"0"==e&&1/t==-s?"-0":e}function Wt(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Kt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new(Kt.Cache||Mt),n}function Yt(t,e){return t===e||t!=t&&e!=e}function Gt(t){return function(t){return te(t)&&$t(t)}(t)&&tt.call(t,"callee")&&(!ot.call(t,"callee")||et.call(t)==u)}Kt.Cache=Mt;var Xt=Array.isArray;function $t(t){return null!=t&&Qt(t.length)&&!Zt(t)}function Zt(t){var e=Jt(t)?et.call(t):"";return e==p||e==m}function Qt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=l}function Jt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function te(t){return!!t&&"object"==typeof t}function ee(t){return"symbol"==typeof t||te(t)&&et.call(t)==w}var ne=N?function(t){return function(e){return t(e)}}(N):function(t){return te(t)&&Qt(t.length)&&!!A[et.call(t)]};function ie(t){return $t(t)?function(t,e){var n=Xt(t)||Gt(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],i=n.length,r=!!i;for(var o in t)!e&&!tt.call(t,o)||r&&("length"==o||Bt(o,i))||n.push(o);return n}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||$))return st(t);var e,n,i=[];for(var r in Object(t))tt.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t)}function re(t){return t}n.exports=function(t,e){return(Xt(t)?function(t,e){for(var n=-1,i=t?t.length:0,r=0,o=[];++n<i;){var a=t[n];e(a,n,t)&&(o[r++]=a)}return o}:function(t,e){var n=[];return Ot(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n})(t,function(t){return"function"==typeof t?t:null==t?re:"object"==typeof t?Xt(t)?function(t,e){return Nt(t)&&qt(e)?Vt(Ht(t),e):function(n){var i=function(t,e,n){var i=null==t?void 0:Ct(t,e);return void 0===i?void 0:i}(n,t);return void 0===i&&i===e?function(t,e){return null!=n&&function(t,e,n){for(var i,r=-1,o=(e=Nt(e,t)?[e]:Lt(e)).length;++r<o;){var a=Ht(e[r]);if(!(i=null!=t&&n(t,a)))break;t=t[a]}return i||!!(o=t?t.length:0)&&Qt(o)&&Bt(a,o)&&(Xt(t)||Gt(t))}(n,e,At)}(0,t):It(e,i,void 0,o|a)}}(t[0],t[1]):function(t){var e=function(t){for(var e=ie(t),n=e.length;n--;){var i=e[n],r=t[i];e[n]=[i,r,qt(r)]}return e}(t);return 1==e.length&&e[0][2]?Vt(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,i){var r=n.length,s=r;if(null==t)return!s;for(t=Object(t);r--;){var l=n[r];if(l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++r<s;){var u=(l=n[r])[0],c=t[u],h=l[1];if(l[2]){if(void 0===c&&!(u in t))return!1}else{var d,f=new zt;if(!(void 0===d?It(h,c,i,o|a,f):d))return!1}}return!0}(n,0,e)}}(t):Nt(e=t)?(n=Ht(e),function(t){return null==t?void 0:t[n]}):function(t){return function(e){return Ct(e,t)}}(e);var e,n}(e))}}).call(this,n(0),n(1)(t))},function(t,e,n){"use strict";n.r(e),n.d(e,"__extends",function(){return r}),n.d(e,"__assign",function(){return o}),n.d(e,"__rest",function(){return a}),n.d(e,"__decorate",function(){return s}),n.d(e,"__param",function(){return l}),n.d(e,"__metadata",function(){return u}),n.d(e,"__awaiter",function(){return c}),n.d(e,"__generator",function(){return h}),n.d(e,"__exportStar",function(){return d}),n.d(e,"__values",function(){return f}),n.d(e,"__read",function(){return p}),n.d(e,"__spread",function(){return m}),n.d(e,"__await",function(){return v}),n.d(e,"__asyncGenerator",function(){return g}),n.d(e,"__asyncDelegator",function(){return y}),n.d(e,"__asyncValues",function(){return _}),n.d(e,"__makeTemplateObject",function(){return b}),n.d(e,"__importStar",function(){return x}),n.d(e,"__importDefault",function(){return w});var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&(n[i[r]]=t[i[r]])}return n}function s(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function l(t,e){return function(n,i){e(n,i,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,i){return new(n||(n=Promise))(function(r,o){function a(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}l((i=i.apply(t,e||[])).next())})}function h(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function d(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function f(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function v(t){return this instanceof v?(this.v=t,this):new v(t)}function g(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(t,e||[]),o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(t){r[t]&&(i[t]=function(e){return new Promise(function(n,i){o.push([t,e,n,i])>1||s(t,e)})})}function s(t,e){try{(n=r[t](e)).value instanceof v?Promise.resolve(n.value.v).then(l,u):c(o[0][2],n)}catch(t){c(o[0][3],t)}var n}function l(t){s("next",t)}function u(t){s("throw",t)}function c(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function y(t){var e,n;return e={},i("next"),i("throw",function(t){throw t}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(i,r){e[i]=t[i]?function(e){return(n=!n)?{value:v(t[i](e)),done:"return"===i}:r?r(e):e}:r}}function _(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=f(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise(function(i,r){!function(t,e,n,i){Promise.resolve(i).then(function(e){t({value:e,done:n})},e)}(i,r,(e=t[n](e)).done,e.value)})}}}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function x(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function w(t){return t&&t.__esModule?t:{default:t}}},,function(t,e){t.exports=function(t){return t&&t.length?t[0]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(25);i.__exportStar(n(3),e),i.__exportStar(n(50),e),i.__exportStar(n(46),e),i.__exportStar(n(38),e),i.__exportStar(n(37),e),i.__exportStar(n(21),e)},function(t,e){var n=9007199254740991,i="[object Arguments]",r="[object Function]",o="[object GeneratorFunction]",a=/^(?:0|[1-9]\d*)$/;var s,l,u=Object.prototype,c=u.hasOwnProperty,h=u.toString,d=u.propertyIsEnumerable,f=(s=Object.keys,l=Object,function(t){return s(l(t))});function p(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||a.test(t))&&t>-1&&t%1==0&&t<e}var m=Array.isArray;function v(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?h.call(t):"";return e==r||e==o}(t)}t.exports=function(t){return t?function(t,e){return function(t,e){for(var n=-1,i=t?t.length:0,r=Array(i);++n<i;)r[n]=e(t[n]);return r}(e,function(e){return t[e]})}(t,function(t){return v(t)?function(t,e){var n=m(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&v(t)}(t)&&c.call(t,"callee")&&(!d.call(t,"callee")||h.call(t)==i)}(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],r=n.length,o=!!r;for(var a in t)!e&&!c.call(t,a)||o&&("length"==a||p(a,r))||n.push(a);return n}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||u))return f(t);var e,n,i=[];for(var r in Object(t))c.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t)}(t)):[]}},function(t,e,n){(function(t,n){var i="__lodash_hash_undefined__",r=9007199254740991,o="[object Arguments]",a="[object Boolean]",s="[object Date]",l="[object Function]",u="[object GeneratorFunction]",c="[object Map]",h="[object Number]",d="[object Object]",f="[object RegExp]",p="[object Set]",m="[object String]",v="[object Symbol]",g="[object ArrayBuffer]",y="[object DataView]",_="[object Float32Array]",b="[object Float64Array]",x="[object Int8Array]",w="[object Int16Array]",S="[object Int32Array]",M="[object Uint8Array]",E="[object Uint8ClampedArray]",z="[object Uint16Array]",k="[object Uint32Array]",T=/\w*$/,O=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,C={};C[o]=C["[object Array]"]=C[g]=C[y]=C[a]=C[s]=C[_]=C[b]=C[x]=C[w]=C[S]=C[c]=C[h]=C[d]=C[f]=C[p]=C[m]=C[v]=C[M]=C[E]=C[z]=C[k]=!0,C["[object Error]"]=C[l]=C["[object WeakMap]"]=!1;var A="object"==typeof t&&t&&t.Object===Object&&t,I="object"==typeof self&&self&&self.Object===Object&&self,L=A||I||Function("return this")(),j="object"==typeof e&&e&&!e.nodeType&&e,D=j&&"object"==typeof n&&n&&!n.nodeType&&n,R=D&&D.exports===j;function F(t,e){return t.set(e[0],e[1]),t}function B(t,e){return t.add(e),t}function N(t,e,n,i){var r=-1,o=t?t.length:0;for(i&&o&&(n=t[++r]);++r<o;)n=e(n,t[r],r,t);return n}function q(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function V(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}function U(t,e){return function(n){return t(e(n))}}function H(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var W,K=Array.prototype,Y=Function.prototype,G=Object.prototype,X=L["__core-js_shared__"],$=(W=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",Z=Y.toString,Q=G.hasOwnProperty,J=G.toString,tt=RegExp("^"+Z.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=R?L.Buffer:void 0,nt=L.Symbol,it=L.Uint8Array,rt=U(Object.getPrototypeOf,Object),ot=Object.create,at=G.propertyIsEnumerable,st=K.splice,lt=Object.getOwnPropertySymbols,ut=et?et.isBuffer:void 0,ct=U(Object.keys,Object),ht=Lt(L,"DataView"),dt=Lt(L,"Map"),ft=Lt(L,"Promise"),pt=Lt(L,"Set"),mt=Lt(L,"WeakMap"),vt=Lt(Object,"create"),gt=Bt(ht),yt=Bt(dt),_t=Bt(ft),bt=Bt(pt),xt=Bt(mt),wt=nt?nt.prototype:void 0,St=wt?wt.valueOf:void 0;function Mt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Et(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function zt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function kt(t){this.__data__=new Et(t)}function Tt(t,e,n){var i=t[e];Q.call(t,e)&&Nt(i,n)&&(void 0!==n||e in t)||(t[e]=n)}function Ot(t,e){for(var n=t.length;n--;)if(Nt(t[n][0],e))return n;return-1}function Pt(t,e,n,i,r,O,P){var A;if(i&&(A=O?i(t,r,O,P):i(t)),void 0!==A)return A;if(!Wt(t))return t;var I=qt(t);if(I){if(A=function(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&Q.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!e)return function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}(t,A)}else{var L=Dt(t),j=L==l||L==u;if(Ut(t))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(t,e);if(L==d||L==o||j&&!O){if(q(t))return O?t:{};if(A=function(t){return"function"!=typeof t.constructor||Ft(t)?{}:Wt(e=rt(t))?ot(e):{};var e}(j?{}:t),!e)return function(t,e){return At(t,jt(t),e)}(t,function(t,e){return t&&At(e,Kt(e),t)}(A,t))}else{if(!C[L])return O?t:{};A=function(t,e,n,i){var r,o,l,u=t.constructor;switch(e){case g:return Ct(t);case a:case s:return new u(+t);case y:return function(t,e){var n=i?Ct(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t);case _:case b:case x:case w:case S:case M:case E:case z:case k:return function(t,e){var n=i?Ct(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t);case c:return function(t,e,n){return N(i?n(V(t),!0):V(t),F,new t.constructor)}(t,0,n);case h:case m:return new u(t);case f:return(l=new(o=t).constructor(o.source,T.exec(o))).lastIndex=o.lastIndex,l;case p:return function(t,e,n){return N(i?n(H(t),!0):H(t),B,new t.constructor)}(t,0,n);case v:return r=t,St?Object(St.call(r)):{}}}(t,L,Pt,e)}}P||(P=new kt);var D=P.get(t);if(D)return D;if(P.set(t,A),!I)var R=n?function(t){return function(t,e,n){var i=Kt(t);return qt(t)?i:function(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}(i,n(t))}(t,0,jt)}(t):Kt(t);return function(t,e){for(var n=-1,i=t?t.length:0;++n<i&&!1!==e(t[n],n););}(R||t,function(r,o){R&&(r=t[o=r]),Tt(A,o,Pt(r,e,n,i,o,t,P))}),A}function Ct(t){var e=new t.constructor(t.byteLength);return new it(e).set(new it(t)),e}function At(t,e,n,i){n||(n={});for(var r=-1,o=e.length;++r<o;){var a=e[r],s=i?i(n[a],t[a],a,n,t):void 0;Tt(n,a,void 0===s?t[a]:s)}return n}function It(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function Lt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Wt(t)||$&&$ in t)&&(Ht(t)||q(t)?tt:O).test(Bt(t))}(n)?n:void 0}Mt.prototype.clear=function(){this.__data__=vt?vt(null):{}},Mt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Mt.prototype.get=function(t){var e=this.__data__;if(vt){var n=e[t];return n===i?void 0:n}return Q.call(e,t)?e[t]:void 0},Mt.prototype.has=function(t){var e=this.__data__;return vt?void 0!==e[t]:Q.call(e,t)},Mt.prototype.set=function(t,e){return this.__data__[t]=vt&&void 0===e?i:e,this},Et.prototype.clear=function(){this.__data__=[]},Et.prototype.delete=function(t){var e=this.__data__,n=Ot(e,t);return!(n<0||(n==e.length-1?e.pop():st.call(e,n,1),0))},Et.prototype.get=function(t){var e=this.__data__,n=Ot(e,t);return n<0?void 0:e[n][1]},Et.prototype.has=function(t){return Ot(this.__data__,t)>-1},Et.prototype.set=function(t,e){var n=this.__data__,i=Ot(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},zt.prototype.clear=function(){this.__data__={hash:new Mt,map:new(dt||Et),string:new Mt}},zt.prototype.delete=function(t){return It(this,t).delete(t)},zt.prototype.get=function(t){return It(this,t).get(t)},zt.prototype.has=function(t){return It(this,t).has(t)},zt.prototype.set=function(t,e){return It(this,t).set(t,e),this},kt.prototype.clear=function(){this.__data__=new Et},kt.prototype.delete=function(t){return this.__data__.delete(t)},kt.prototype.get=function(t){return this.__data__.get(t)},kt.prototype.has=function(t){return this.__data__.has(t)},kt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Et){var i=n.__data__;if(!dt||i.length<199)return i.push([t,e]),this;n=this.__data__=new zt(i)}return n.set(t,e),this};var jt=lt?U(lt,Object):function(){return[]},Dt=function(t){return J.call(t)};function Rt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||P.test(t))&&t>-1&&t%1==0&&t<e}function Ft(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||G)}function Bt(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Nt(t,e){return t===e||t!=t&&e!=e}(ht&&Dt(new ht(new ArrayBuffer(1)))!=y||dt&&Dt(new dt)!=c||ft&&"[object Promise]"!=Dt(ft.resolve())||pt&&Dt(new pt)!=p||mt&&"[object WeakMap]"!=Dt(new mt))&&(Dt=function(t){var e=J.call(t),n=e==d?t.constructor:void 0,i=n?Bt(n):void 0;if(i)switch(i){case gt:return y;case yt:return c;case _t:return"[object Promise]";case bt:return p;case xt:return"[object WeakMap]"}return e});var qt=Array.isArray;function Vt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}(t.length)&&!Ht(t)}var Ut=ut||function(){return!1};function Ht(t){var e=Wt(t)?J.call(t):"";return e==l||e==u}function Wt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Kt(t){return Vt(t)?function(t,e){var n=qt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Vt(t)}(t)&&Q.call(t,"callee")&&(!at.call(t,"callee")||J.call(t)==o)}(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],i=n.length,r=!!i;for(var a in t)!e&&!Q.call(t,a)||r&&("length"==a||Rt(a,i))||n.push(a);return n}(t):function(t){if(!Ft(t))return ct(t);var e=[];for(var n in Object(t))Q.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}n.exports=function(t){return Pt(t,!0,!0)}}).call(this,n(0),n(1)(t))},,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(20),r=n(22),o=n(27),a=n(3),s=n(21);function l(t){return a.isDatapointsQuery(t)&&1===i(t.where).length&&r(t.where)&&t.where.$and?s.QueryFeature.WhereClauseBasedOnConjunction:null}e.featureDetectors=[l,(t,e)=>{if(!l(t))return null;for(const n of t.where.$and){const r=i(n);if(1===r.length){const a=o(r),l=n[a];if(t.join&&t.join[l]){const n=t.join[l],r=n.where,u=o(i(r));if(n.key===a&&n.key===u&&1===i(r).length){const t=r[u],o=e.get(n.key);if(1===i(t).length&&t.$in&&("entity_set"===o.concept_type||"entity_domain"===o.concept_type))return s.QueryFeature.ConjunctionPartFromWhereClauseCorrespondsToJoin}}}}return null}]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(9),r=n(4),o=n(8),a=n(3);function s(t,e){const{dataset:n,branch:i,commit:r}=e;return`${t}${n}/${i}-${r}`}e.getRepositoryPath=s,e.getFilePath=function(t,e="datapackage.json"){return`${t}/${e}`},e.extendQueryWithRepository=function(t,e={}){const n=o(e,"repositoryDescriptors",{}),l=i(t.dataset)?"default ":"";if(!l){const[e,n]=t.dataset.split("#");!t.branch&&n&&(t.branch=n,t.dataset=e)}const u=i(t.branch)?"default ":"",c=i(t.commit)?"default ":"",{dataset:h=o(e,"defaultRepository",a.DEFAULT_REPOSITORY_NAME),branch:d=o(e,"defaultRepositoryBranch",a.DEFAULT_REPOSITORY_BRANCH),commit:f=o(e,"defaultRepositoryCommit",a.DEFAULT_REPOSITORY_HASH)}=t;if(i(n[h]))throw new Error(`No ${l}dataset '${h}' was found`);if(i(n[h][d]))throw new Error(`No ${u}branch '${d}' in ${l}dataset '${h}' was found`);if(!r(n[h][d],f))throw new Error(`No ${c}commit '${f}' in ${u}branch '${d}' in ${l}dataset '${h}' was found`);const p=s("",{dataset:h,branch:d,commit:f});Object.assign(t,{repositoryPath:p})}},function(t,e,n){(function(e){var n="__lodash_hash_undefined__",i="[object Function]",r="[object GeneratorFunction]",o=/^\[object .+?Constructor\]$/,a="object"==typeof e&&e&&e.Object===Object&&e,s="object"==typeof self&&self&&self.Object===Object&&self,l=a||s||Function("return this")();function u(t,e){return!(!t||!t.length)&&function(t,e,n){if(e!=e)return function(t,e,n,i){for(var r=t.length,o=-1;++o<r;)if(e(t[o],o,t))return o;return-1}(t,c);for(var i=-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}(t,e)>-1}function c(t){return t!=t}function h(t,e){return t.has(e)}function d(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var f,p=Array.prototype,m=Function.prototype,v=Object.prototype,g=l["__core-js_shared__"],y=(f=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||""))?"Symbol(src)_1."+f:"",_=m.toString,b=v.hasOwnProperty,x=v.toString,w=RegExp("^"+_.call(b).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=p.splice,M=L(l,"Map"),E=L(l,"Set"),z=L(Object,"create");function k(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function T(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function O(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function P(t){var e=-1,n=t?t.length:0;for(this.__data__=new O;++e<n;)this.add(t[e])}function C(t,e){for(var n,i,r=t.length;r--;)if((n=t[r][0])===(i=e)||n!=n&&i!=i)return r;return-1}k.prototype.clear=function(){this.__data__=z?z(null):{}},k.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},k.prototype.get=function(t){var e=this.__data__;if(z){var i=e[t];return i===n?void 0:i}return b.call(e,t)?e[t]:void 0},k.prototype.has=function(t){var e=this.__data__;return z?void 0!==e[t]:b.call(e,t)},k.prototype.set=function(t,e){return this.__data__[t]=z&&void 0===e?n:e,this},T.prototype.clear=function(){this.__data__=[]},T.prototype.delete=function(t){var e=this.__data__,n=C(e,t);return!(n<0||(n==e.length-1?e.pop():S.call(e,n,1),0))},T.prototype.get=function(t){var e=this.__data__,n=C(e,t);return n<0?void 0:e[n][1]},T.prototype.has=function(t){return C(this.__data__,t)>-1},T.prototype.set=function(t,e){var n=this.__data__,i=C(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},O.prototype.clear=function(){this.__data__={hash:new k,map:new(M||T),string:new k}},O.prototype.delete=function(t){return I(this,t).delete(t)},O.prototype.get=function(t){return I(this,t).get(t)},O.prototype.has=function(t){return I(this,t).has(t)},O.prototype.set=function(t,e){return I(this,t).set(t,e),this},P.prototype.add=P.prototype.push=function(t){return this.__data__.set(t,n),this},P.prototype.has=function(t){return this.__data__.has(t)};var A=E&&1/d(new E([,-0]))[1]==1/0?function(t){return new E(t)}:function(){};function I(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function L(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!j(t)||y&&y in t)&&(function(t){var e=j(t)?x.call(t):"";return e==i||e==r}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?w:o).test(function(t){if(null!=t){try{return _.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}(n)?n:void 0}function j(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=function(t){return t&&t.length?function(t,e,n){var i=-1,r=u,o=t.length,a=!0,s=[],l=s;if(o>=200){var c=A(t);if(c)return d(c);a=!1,r=h,l=new P}else l=s;t:for(;++i<o;){var f=t[i],p=f;if(f=0!==f?f:0,a&&p==p){for(var m=l.length;m--;)if(l[m]===p)continue t;s.push(f)}else r(l,p,n)||(l!==s&&l.push(p),s.push(f))}return s}(t):[]}}).call(this,n(0))},function(t,e){var n=Object.prototype.toString,i=Array.isArray;t.exports=function(t){return"string"==typeof t||!i(t)&&function(t){return!!t&&"object"==typeof t}(t)&&"[object String]"==n.call(t)}},function(t,e,n){(function(t,n){var i="Expected a function",r="__lodash_hash_undefined__",o=1,a=2,s=1/0,l=9007199254740991,u="[object Arguments]",c="[object Array]",h="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",m="[object GeneratorFunction]",v="[object Map]",g="[object Number]",y="[object Object]",_="[object RegExp]",b="[object Set]",x="[object String]",w="[object Symbol]",S="[object ArrayBuffer]",M="[object DataView]",E=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,z=/^\w*$/,k=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,O=/\\(\\)?/g,P=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[u]=A[c]=A[S]=A[h]=A[M]=A[d]=A[f]=A[p]=A[v]=A[g]=A[y]=A[_]=A[b]=A[x]=A["[object WeakMap]"]=!1;var I="object"==typeof t&&t&&t.Object===Object&&t,L="object"==typeof self&&self&&self.Object===Object&&self,j=I||L||Function("return this")(),D="object"==typeof e&&e&&!e.nodeType&&e,R=D&&"object"==typeof n&&n&&!n.nodeType&&n,F=R&&R.exports===D&&I.process,B=function(){try{return F&&F.binding("util")}catch(t){}}(),N=B&&B.isTypedArray;function q(t,e){for(var n=-1,i=t?t.length:0;++n<i;)if(!e(t[n],n,t))return!1;return!0}function V(t,e){for(var n=-1,i=t?t.length:0;++n<i;)if(e(t[n],n,t))return!0;return!1}function U(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function H(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}function W(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var K,Y,G,X=Array.prototype,$=Function.prototype,Z=Object.prototype,Q=j["__core-js_shared__"],J=(K=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",tt=$.toString,et=Z.hasOwnProperty,nt=Z.toString,it=RegExp("^"+tt.call(et).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=j.Symbol,ot=j.Uint8Array,at=Z.propertyIsEnumerable,st=X.splice,lt=(Y=Object.keys,G=Object,function(t){return Y(G(t))}),ut=Bt(j,"DataView"),ct=Bt(j,"Map"),ht=Bt(j,"Promise"),dt=Bt(j,"Set"),ft=Bt(j,"WeakMap"),pt=Bt(Object,"create"),mt=Yt(ut),vt=Yt(ct),gt=Yt(ht),yt=Yt(dt),_t=Yt(ft),bt=rt?rt.prototype:void 0,xt=bt?bt.valueOf:void 0,wt=bt?bt.toString:void 0;function St(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Mt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Et(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function zt(t){var e=-1,n=t?t.length:0;for(this.__data__=new Et;++e<n;)this.add(t[e])}function kt(t){this.__data__=new Mt(t)}function Tt(t,e){for(var n=t.length;n--;)if(Xt(t[n][0],e))return n;return-1}St.prototype.clear=function(){this.__data__=pt?pt(null):{}},St.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},St.prototype.get=function(t){var e=this.__data__;if(pt){var n=e[t];return n===r?void 0:n}return et.call(e,t)?e[t]:void 0},St.prototype.has=function(t){var e=this.__data__;return pt?void 0!==e[t]:et.call(e,t)},St.prototype.set=function(t,e){return this.__data__[t]=pt&&void 0===e?r:e,this},Mt.prototype.clear=function(){this.__data__=[]},Mt.prototype.delete=function(t){var e=this.__data__,n=Tt(e,t);return!(n<0||(n==e.length-1?e.pop():st.call(e,n,1),0))},Mt.prototype.get=function(t){var e=this.__data__,n=Tt(e,t);return n<0?void 0:e[n][1]},Mt.prototype.has=function(t){return Tt(this.__data__,t)>-1},Mt.prototype.set=function(t,e){var n=this.__data__,i=Tt(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},Et.prototype.clear=function(){this.__data__={hash:new St,map:new(ct||Mt),string:new St}},Et.prototype.delete=function(t){return Ft(this,t).delete(t)},Et.prototype.get=function(t){return Ft(this,t).get(t)},Et.prototype.has=function(t){return Ft(this,t).has(t)},Et.prototype.set=function(t,e){return Ft(this,t).set(t,e),this},zt.prototype.add=zt.prototype.push=function(t){return this.__data__.set(t,r),this},zt.prototype.has=function(t){return this.__data__.has(t)},kt.prototype.clear=function(){this.__data__=new Mt},kt.prototype.delete=function(t){return this.__data__.delete(t)},kt.prototype.get=function(t){return this.__data__.get(t)},kt.prototype.has=function(t){return this.__data__.has(t)},kt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Mt){var i=n.__data__;if(!ct||i.length<199)return i.push([t,e]),this;n=this.__data__=new Et(i)}return n.set(t,e),this};var Ot,Pt=(Ot=function(t,e){return t&&At(t,e,oe)},function(t,e){if(null==t)return t;if(!Qt(t))return Ot(t,e);for(var n=t.length,i=-1,r=Object(t);++i<n&&!1!==e(r[i],i,r););return t});function Ct(t,e){var n=!0;return Pt(t,function(t,i,r){return n=!!e(t,i,r)}),n}var At=function(t,e,n){for(var i=-1,r=Object(t),o=n(t),a=o.length;a--;){var s=o[++i];if(!1===e(r[s],s,r))break}return t};function It(t,e){for(var n=0,i=(e=Vt(e,t)?[e]:Dt(e)).length;null!=t&&n<i;)t=t[Kt(e[n++])];return n&&n==i?t:void 0}function Lt(t,e){return null!=t&&e in Object(t)}function jt(t,e,n,i,r){return t===e||(null==t||null==e||!ee(t)&&!ne(e)?t!=t&&e!=e:function(t,e,n,i,r,s){var l=Zt(t),p=Zt(e),m=c,E=c;l||(m=(m=Nt(t))==u?y:m),p||(E=(E=Nt(e))==u?y:E);var z=m==y&&!U(t),k=E==y&&!U(e),T=m==E;if(T&&!z)return s||(s=new kt),l||re(t)?Rt(t,e,n,i,r,s):function(t,e,n,i,r,s,l){switch(n){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case S:return!(t.byteLength!=e.byteLength||!i(new ot(t),new ot(e)));case h:case d:case g:return Xt(+t,+e);case f:return t.name==e.name&&t.message==e.message;case _:case x:return t==e+"";case v:var u=H;case b:var c=s&a;if(u||(u=W),t.size!=e.size&&!c)return!1;var p=l.get(t);if(p)return p==e;s|=o,l.set(t,e);var m=Rt(u(t),u(e),i,r,s,l);return l.delete(t),m;case w:if(xt)return xt.call(t)==xt.call(e)}return!1}(t,e,m,n,i,r,s);if(!(r&a)){var O=z&&et.call(t,"__wrapped__"),P=k&&et.call(e,"__wrapped__");if(O||P){var C=O?t.value():t,A=P?e.value():e;return s||(s=new kt),n(C,A,i,r,s)}}return!!T&&(s||(s=new kt),function(t,e,n,i,r,o){var s=r&a,l=oe(t),u=l.length;if(u!=oe(e).length&&!s)return!1;for(var c=u;c--;){var h=l[c];if(!(s?h in e:et.call(e,h)))return!1}var d=o.get(t);if(d&&o.get(e))return d==e;var f=!0;o.set(t,e),o.set(e,t);for(var p=s;++c<u;){var m=t[h=l[c]],v=e[h];if(i)var g=s?i(v,m,h,e,t,o):i(m,v,h,t,e,o);if(!(void 0===g?m===v||n(m,v,i,r,o):g)){f=!1;break}p||(p="constructor"==h)}if(f&&!p){var y=t.constructor,_=e.constructor;y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return o.delete(t),o.delete(e),f}(t,e,n,i,r,s))}(t,e,jt,n,i,r))}function Dt(t){return Zt(t)?t:Wt(t)}function Rt(t,e,n,i,r,s){var l=r&a,u=t.length,c=e.length;if(u!=c&&!(l&&c>u))return!1;var h=s.get(t);if(h&&s.get(e))return h==e;var d=-1,f=!0,p=r&o?new zt:void 0;for(s.set(t,e),s.set(e,t);++d<u;){var m=t[d],v=e[d];if(i)var g=l?i(v,m,d,e,t,s):i(m,v,d,t,e,s);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!V(e,function(t,e){if(!p.has(e)&&(m===t||n(m,t,i,r,s)))return p.add(e)})){f=!1;break}}else if(m!==v&&!n(m,v,i,r,s)){f=!1;break}}return s.delete(t),s.delete(e),f}function Ft(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function Bt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!ee(t)||J&&J in t)&&(Jt(t)||U(t)?it:P).test(Yt(t))}(n)?n:void 0}var Nt=function(t){return nt.call(t)};function qt(t,e){return!!(e=null==e?l:e)&&("number"==typeof t||C.test(t))&&t>-1&&t%1==0&&t<e}function Vt(t,e){if(Zt(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ie(t))||z.test(t)||!E.test(t)||null!=e&&t in Object(e)}function Ut(t){return t==t&&!ee(t)}function Ht(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}}(ut&&Nt(new ut(new ArrayBuffer(1)))!=M||ct&&Nt(new ct)!=v||ht&&"[object Promise]"!=Nt(ht.resolve())||dt&&Nt(new dt)!=b||ft&&"[object WeakMap]"!=Nt(new ft))&&(Nt=function(t){var e=nt.call(t),n=e==y?t.constructor:void 0,i=n?Yt(n):void 0;if(i)switch(i){case mt:return M;case vt:return v;case gt:return"[object Promise]";case yt:return b;case _t:return"[object WeakMap]"}return e});var Wt=Gt(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(ie(t))return wt?wt.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}(e);var n=[];return k.test(t)&&n.push(""),t.replace(T,function(t,e,i,r){n.push(i?r.replace(O,"$1"):e||t)}),n});function Kt(t){if("string"==typeof t||ie(t))return t;var e=t+"";return"0"==e&&1/t==-s?"-0":e}function Yt(t){if(null!=t){try{return tt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Gt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new(Gt.Cache||Et),n}function Xt(t,e){return t===e||t!=t&&e!=e}function $t(t){return function(t){return ne(t)&&Qt(t)}(t)&&et.call(t,"callee")&&(!at.call(t,"callee")||nt.call(t)==u)}Gt.Cache=Et;var Zt=Array.isArray;function Qt(t){return null!=t&&te(t.length)&&!Jt(t)}function Jt(t){var e=ee(t)?nt.call(t):"";return e==p||e==m}function te(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=l}function ee(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function ne(t){return!!t&&"object"==typeof t}function ie(t){return"symbol"==typeof t||ne(t)&&nt.call(t)==w}var re=N?function(t){return function(e){return t(e)}}(N):function(t){return ne(t)&&te(t.length)&&!!A[nt.call(t)]};function oe(t){return Qt(t)?function(t,e){var n=Zt(t)||$t(t)?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],i=n.length,r=!!i;for(var o in t)!e&&!et.call(t,o)||r&&("length"==o||qt(o,i))||n.push(o);return n}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||Z))return lt(t);var e,n,i=[];for(var r in Object(t))et.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t)}function ae(t){return t}n.exports=function(t,e,n){var i=Zt(t)?q:Ct;return n&&function(t,e,n){if(!ee(n))return!1;var i=typeof e;return!!("number"==i?Qt(n)&&qt(e,n.length):"string"==i&&e in n)&&Xt(n[e],t)}(t,e,n)&&(e=void 0),i(t,function(t){return"function"==typeof t?t:null==t?ae:"object"==typeof t?Zt(t)?function(t,e){return Vt(t)&&Ut(e)?Ht(Kt(t),e):function(n){var i=function(t,e,n){var i=null==t?void 0:It(t,e);return void 0===i?void 0:i}(n,t);return void 0===i&&i===e?function(t,e){return null!=n&&function(t,e,n){for(var i,r=-1,o=(e=Vt(e,t)?[e]:Dt(e)).length;++r<o;){var a=Kt(e[r]);if(!(i=null!=t&&n(t,a)))break;t=t[a]}return i||!!(o=t?t.length:0)&&te(o)&&qt(a,o)&&(Zt(t)||$t(t))}(n,e,Lt)}(0,t):jt(e,i,void 0,o|a)}}(t[0],t[1]):function(t){var e=function(t){for(var e=oe(t),n=e.length;n--;){var i=e[n],r=t[i];e[n]=[i,r,Ut(r)]}return e}(t);return 1==e.length&&e[0][2]?Ht(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,i){var r=n.length,s=r;if(null==t)return!s;for(t=Object(t);r--;){var l=n[r];if(l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++r<s;){var u=(l=n[r])[0],c=t[u],h=l[1];if(l[2]){if(void 0===c&&!(u in t))return!1}else{var d,f=new kt;if(!(void 0===d?jt(h,c,i,o|a,f):d))return!1}}return!0}(n,0,e)}}(t):Vt(e=t)?(n=Kt(e),function(t){return null==t?void 0:t[n]}):function(t){return function(e){return It(e,t)}}(e);var e,n}(e))}}).call(this,n(0),n(1)(t))},function(t,e,n){(function(e){var n,i="Expected a function",r="__lodash_hash_undefined__",o=1/0,a=9007199254740991,s="[object Arguments]",l="[object Function]",u="[object GeneratorFunction]",c="[object Symbol]",h=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,d=/^\w*$/,f=/^\./,p=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,m=/\\(\\)?/g,v=/^\[object .+?Constructor\]$/,g=/^(?:0|[1-9]\d*)$/,y="object"==typeof e&&e&&e.Object===Object&&e,_="object"==typeof self&&self&&self.Object===Object&&self,b=y||_||Function("return this")(),x=Array.prototype,w=Function.prototype,S=Object.prototype,M=b["__core-js_shared__"],E=(n=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",z=w.toString,k=S.hasOwnProperty,T=S.toString,O=RegExp("^"+z.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=b.Symbol,C=S.propertyIsEnumerable,A=x.splice,I=U(b,"Map"),L=U(Object,"create"),j=P?P.prototype:void 0,D=j?j.toString:void 0;function R(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function F(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function B(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function N(t,e){for(var n,i,r=t.length;r--;)if((n=t[r][0])===(i=e)||n!=n&&i!=i)return r;return-1}function q(t,e){return null!=t&&k.call(t,e)}function V(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function U(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!$(t)||E&&E in t)&&(G(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?O:v).test(function(t){if(null!=t){try{return z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}(n)?n:void 0}R.prototype.clear=function(){this.__data__=L?L(null):{}},R.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},R.prototype.get=function(t){var e=this.__data__;if(L){var n=e[t];return n===r?void 0:n}return k.call(e,t)?e[t]:void 0},R.prototype.has=function(t){var e=this.__data__;return L?void 0!==e[t]:k.call(e,t)},R.prototype.set=function(t,e){return this.__data__[t]=L&&void 0===e?r:e,this},F.prototype.clear=function(){this.__data__=[]},F.prototype.delete=function(t){var e=this.__data__,n=N(e,t);return!(n<0||(n==e.length-1?e.pop():A.call(e,n,1),0))},F.prototype.get=function(t){var e=this.__data__,n=N(e,t);return n<0?void 0:e[n][1]},F.prototype.has=function(t){return N(this.__data__,t)>-1},F.prototype.set=function(t,e){var n=this.__data__,i=N(n,t);return i<0?n.push([t,e]):n[i][1]=e,this},B.prototype.clear=function(){this.__data__={hash:new R,map:new(I||F),string:new R}},B.prototype.delete=function(t){return V(this,t).delete(t)},B.prototype.get=function(t){return V(this,t).get(t)},B.prototype.has=function(t){return V(this,t).has(t)},B.prototype.set=function(t,e){return V(this,t).set(t,e),this};var H=K(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(Q(t))return D?D.call(t):"";var e=t+"";return"0"==e&&1/t==-o?"-0":e}(e);var n=[];return f.test(t)&&n.push(""),t.replace(p,function(t,e,i,r){n.push(i?r.replace(m,"$1"):e||t)}),n});function W(t){if("string"==typeof t||Q(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}function K(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new(K.Cache||B),n}K.Cache=B;var Y=Array.isArray;function G(t){var e=$(t)?T.call(t):"";return e==l||e==u}function X(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}function $(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Z(t){return!!t&&"object"==typeof t}function Q(t){return"symbol"==typeof t||Z(t)&&T.call(t)==c}t.exports=function(t,e){return null!=t&&function(t,e,n){for(var i,r,o=-1,l=(e=function(t,e){if(Y(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Q(t))||d.test(t)||!h.test(t)||null!=e&&t in Object(e)}(e,t)?[e]:Y(i=e)?i:H(i)).length;++o<l;){var u=W(e[o]);if(!(r=null!=t&&n(t,u)))break;t=t[u]}return r||!!(l=t?t.length:0)&&X(l)&&function(t,e){return!!(e=null==e?a:e)&&("number"==typeof t||g.test(t))&&t>-1&&t%1==0&&t<e}(u,l)&&(Y(t)||function(t){return function(t){return Z(t)&&function(t){return null!=t&&X(t.length)&&!G(t)}(t)}(t)&&k.call(t,"callee")&&(!C.call(t,"callee")||T.call(t)==s)}(t))}(t,e,q)}}).call(this,n(0))},function(t,e){t.exports=function(t){return t?t[0]:void 0}},function(t,e,n){(function(e){var n,i="[object Function]",r="[object GeneratorFunction]",o="[object Map]",a="[object Set]",s=/^\[object .+?Constructor\]$/,l="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",u="\\ud83c[\\udffb-\\udfff]",c="[^\\ud800-\\udfff]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",d="[\\ud800-\\udbff][\\udc00-\\udfff]",f="(?:"+l+"|"+u+")?",p="[\\ufe0e\\ufe0f]?"+f+"(?:\\u200d(?:"+[c,h,d].join("|")+")[\\ufe0e\\ufe0f]?"+f+")*",m="(?:"+[c+l+"?",l,h,d,"[\\ud800-\\udfff]"].join("|")+")",v=RegExp(u+"(?="+u+")|"+m+p,"g"),g=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),y="object"==typeof e&&e&&e.Object===Object&&e,_="object"==typeof self&&self&&self.Object===Object&&self,b=y||_||Function("return this")(),x=(n="length",function(t){return null==t?void 0:t[n]});var w,S,M,E=Function.prototype,z=Object.prototype,k=b["__core-js_shared__"],T=(w=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"",O=E.toString,P=z.hasOwnProperty,C=z.toString,A=RegExp("^"+O.call(P).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),I=(S=Object.keys,M=Object,function(t){return S(M(t))}),L=H(b,"DataView"),j=H(b,"Map"),D=H(b,"Promise"),R=H(b,"Set"),F=H(b,"WeakMap"),B=K(L),N=K(j),q=K(D),V=K(R),U=K(F);function H(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!X(t)||T&&T in t)&&(G(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?A:s).test(K(t))}(n)?n:void 0}var W=function(t){return C.call(t)};function K(t){if(null!=t){try{return O.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(L&&"[object DataView]"!=W(new L(new ArrayBuffer(1)))||j&&W(new j)!=o||D&&"[object Promise]"!=W(D.resolve())||R&&W(new R)!=a||F&&"[object WeakMap]"!=W(new F))&&(W=function(t){var e=C.call(t),n="[object Object]"==e?t.constructor:void 0,i=n?K(n):void 0;if(i)switch(i){case B:return"[object DataView]";case N:return o;case q:return"[object Promise]";case V:return a;case U:return"[object WeakMap]"}return e});var Y=Array.isArray;function G(t){var e=X(t)?C.call(t):"";return e==i||e==r}function X(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=function(t){if(null==t)return 0;if(null!=(e=t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(e.length)&&!G(e))return function(t){return"string"==typeof t||!Y(t)&&function(t){return!!t&&"object"==typeof t}(t)&&"[object String]"==C.call(t)}(t)?function(t){return function(t){return g.test(t)}(t)?function(t){for(var e=v.lastIndex=0;v.test(t);)e++;return e}(t):x(t)}(t):t.length;var e,n=W(t);return n==o||n==a?t.size:function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||z))return I(t);var e,n,i=[];for(var r in Object(t))P.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t).length}}).call(this,n(0))},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(25);const i=n(11),r=n(9),o=n(22),a=n(45),s=n(44),l=(n(30),n(29)),u=n(20),c=n(17),h=(n(16),n(43)),d=n(24),f=n(19),p=n(8),m=n(42),v=n(41),g=n(18),y=n(40),_=n(4),b=n(39),x=n(3),w=n(23);function S(t){if(r(t))return"'select' clause couldn't be empty"}function M(t){return o(t)&&!a(t)}function E(t){return y(t)||M(t)&&1===s(t)&&x.AVAILABLE_ORDER_BY_CLAUSE_VALUES.has(h(l(t)))}function z(t){return p(t,"joinID",!1)?`join.${t.joinID}.`:""}function k(t,e){if(!a(e)&&!r(e))return`'select.value' clause for '${t}' queries should be array of strings or empty`}e.validateQueryStructure=function(t,e={}){return new Promise((n,l)=>{const h=[...function(t,e){const n=[],i=p(t,"dataset"),o=p(t,"branch"),a=p(t,"commit");return r(i)||y(i)||n.push("'dataset' clause must be string only"),r(o)||y(o)||n.push("'branch' clause must be string only"),r(a)||y(a)||n.push("'commit' clause must be string only"),n}(t),...function(t,e){const n=[],i=p(t,"from",null);if(r(i)&&n.push("'from' clause couldn't be empty"),y(i)||n.push("'from' clause must be string only"),!x.AVAILABLE_FROM_CLAUSE_VALUES.has(i)){const t=[...x.AVAILABLE_FROM_CLAUSE_VALUES];n.push(`'from' clause must be one of the list: ${t.join(", ")}`)}return n}(t),...function(t,e){const n=[],i=p(t,"select",null),r=p(t,"from",null),l=p(i,"key"),u=p(i,"value");switch(!0){case x.isSchemaQuery(t):n.push(S(i),function(t,e){if(!a(e)||2!==s(e))return`'select.key' clause for '${t}' queries must have exactly 2 items: 'key', 'value'`}(r,l),k(r,u));break;case x.isEntitiesQuery(t):case x.isConceptsQuery(t):n.push(S(i),function(t,e,n){if(!o(t)||!a(e))return"'select' clause must have next structure: { key: [...], value: [...] }"}(i,l),function(t,e){if(!a(e)||1!==s(e))return`'select.key' clause for '${t}' queries must have only 1 item`}(r,l),k(r,u));break;case x.isDatapointsQuery(t):n.push(S(i),function(t,e,n){if(!o(i)||!a(e)||!a(n))return"'select' clause must have next structure: { key: [...], value: [...] }"}(0,l,u),function(t,e){if(s(l)<2)return`'select.key' clause for '${t}' queries must have at least 2 items`}(r),function(t,e){const n=d(l,(t,e,n)=>_(n,t,e+1));if(s(n)>0)return`'select.key' clause for '${t}' queries contains duplicates: ${b(n).join(",")}`}(r),function(t,e){if(s(u)<1)return`'select.value' clause for '${t}' queries must have at least 1 item`}(r));break;default:n.push(S(i))}return g(n)}(t),...function(t,e){const n=[],o=p(t,"join",null),a=p(t,"where",null),s=function t(e){const n=[];for(const i in e)f(i,"$")&&n.push({name:i,isLeaf:!1}),w.isPrimitive(e[i])?f(e[i],"$")&&n.push({name:e[i],isLeaf:!0}):n.push(...t(e[i]));return n}(a);return n.push(function(t,e){if(!r(t)&&!M(t))return`'${e}where' clause must be object only`}(a,z(e)),function(t,e,n){const r=d(e,e=>!function(t,e){return function(t){return!t.isLeaf&&x.AVAILABLE_QUERY_OPERATORS.has(t.name)}(e)||function(t,e){return e.isLeaf&&f(e.name,"$")&&m(t,e.name)}(t,e)}(t,e)).map(t=>t.name),o=[...x.AVAILABLE_QUERY_OPERATORS.values(),...u(t)];if(!i(r))return`'${n}where' clause has unknown operator(s) '${r.join(", ")}', replace it with allowed operators: ${o.join(", ")}`}(o,s,z(e))),g(n)}(t,e),...function(t,e){const n=[],i=p(t,"language",null);switch(!0){case x.isSchemaQuery(t):n.push(function(t){if(m(t,"language"))return"'language' clause for '*.schema' queries shouldn't be present in query"}(t));break;case x.isEntitiesQuery(t):case x.isConceptsQuery(t):case x.isDatapointsQuery(t):default:n.push(function(t){if(!r(t)&&!y(t))return"'language' clause must be string only"}(i))}return g(n)}(t),...function(t,e){const n=[],i=p(t,"join",null);switch(!0){case x.isSchemaQuery(t):case x.isConceptsQuery(t):n.push(function(t){if(m(t,"join"))return`'join' clause for '${t.from}' queries shouldn't be present in query`}(t));break;case x.isEntitiesQuery(t):case x.isDatapointsQuery(t):default:n.push(function(t){if(!r(t)&&!M(t))return"'join' clause must be object only"}(i),...c(i,(t,e)=>(function(t,e){if(!r(t.key)&&!y(t.key))return`'${e}key' clause must be string only`})(t,z({joinID:e}))))}return g(n)}(t),...function(t,e){const n=[],i=p(t,"order_by",null);return n.push(function(t){if(!(r(t)||y(t)||(e=t,a(e)&&v(e,y))||function(t,e){return a(t)&&v(t,e)}(t,E)))return"'order_by' clause must be string or array of strings || objects only";var e}(i)),g(n)}(t)];return i(h)?n():l(`Too many query structure errors: \n* ${h.join("\n* ")}`)})}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e,n){(function(e){var n=1/0,i="[object Symbol]",r=/^\s+/,o="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",a="\\ud83c[\\udffb-\\udfff]",s="[^\\ud800-\\udfff]",l="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+o+"|"+a+")?",h="[\\ufe0e\\ufe0f]?"+c+"(?:\\u200d(?:"+[s,l,u].join("|")+")[\\ufe0e\\ufe0f]?"+c+")*",d="(?:"+[s+o+"?",o,l,u,"[\\ud800-\\udfff]"].join("|")+")",f=RegExp(a+"(?="+a+")|"+d+h,"g"),p=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),m="object"==typeof e&&e&&e.Object===Object&&e,v="object"==typeof self&&self&&self.Object===Object&&self,g=m||v||Function("return this")();function y(t,e,n){if(e!=e)return function(t,e,n,i){for(var r=t.length,o=n+-1;++o<r;)if(e(t[o],o,t))return o;return-1}(t,_,n);for(var i=n-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}function _(t){return t!=t}function b(t){return function(t){return p.test(t)}(t)?function(t){return t.match(f)||[]}(t):function(t){return t.split("")}(t)}var x=Object.prototype.toString,w=g.Symbol,S=w?w.prototype:void 0,M=S?S.toString:void 0;function E(t){if("string"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&x.call(t)==i}(t))return M?M.call(t):"";var e=t+"";return"0"==e&&1/t==-n?"-0":e}t.exports=function(t,e,n){var i;if((t=null==(i=t)?"":E(i))&&(n||void 0===e))return t.replace(r,"");if(!t||!(e=E(e)))return t;var o=b(t);return function(t,e,n){var i=t.length;return n=void 0===n?i:n,!e&&n>=i?t:function(t,e,n){var i=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(n=n>r?r:n)<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(r);++i<r;)o[i]=t[i+e];return o}(t,e,n)}(o,function(t,e){for(var n=-1,i=t.length;++n<i&&y(e,t[n],0)>-1;);return n}(o,b(e))).join("")}}).call(this,n(0))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(11),r=n(24),o=n(17),a=n(8),s=n(18),l=n(4),u=n(19),c=n(9),h=n(49),d=(n(16),n(3)),f=n(23);function p(t,e){return r(t,t=>!l(e,t))}function m(t,e){const n=r([...e.values()],({concept_type:e})=>l(t,e));return o(n,"concept")}e.validateQueryDefinitions=function(t,e={}){return new Promise((n,r)=>{const o=[...function(t,e){const n=[],r=a(t,"from",null),o=a(t,"select",null),l=a(o,"key"),u=a(o,"value"),c=[],h=[],{conceptsLookup:f}=e;switch(!0){case d.isDatapointsQuery(t):const e=[d.CONCEPT_TYPE_ENTITY_SET,d.CONCEPT_TYPE_ENTITY_DOMAIN,d.CONCEPT_TYPE_TIME];c.push(...m(e,f)),h.push(...f.keys());break;case d.isEntitiesQuery(t):const n=[d.CONCEPT_TYPE_ENTITY_SET,d.CONCEPT_TYPE_ENTITY_DOMAIN];c.push(...m(n,f)),h.push(...f.keys());break;case d.isConceptsQuery(t):c.push(d.RESERVED_CONCEPT),h.push(...f.keys(),d.RESERVED_CONCEPT,d.RESERVED_CONCEPT_TYPE,d.RESERVED_DOMAIN,d.RESERVED_UNIT,d.RESERVED_DRILL_UP);break;default:c.push(d.RESERVED_KEY,d.RESERVED_VALUE),h.push(d.RESERVED_KEY,d.RESERVED_VALUE)}return n.push(function(t,e,n){const r=p(l,c);if(!i(r))return`'select.key' clause for '${t}' query contains unavailable item(s): ${r.join(", ")}`}(r),function(t,e,n){const r=p(e,h);if(!i(e)&&!i(r))return`'select.value' clause for '${t}' query contains unavailable item(s): ${r.join(", ")}`}(r,u)),s(n)}(t,e),...function(t,e){const n=[],r=a(t,"where",null),o=(a(t,"from",null),a(t,"select",null)),{conceptsLookup:l}=e;switch(a(o,"key"),a(o,"value"),function t(e,n,r){for(const o in e){const a=!!c(r)&&!u(o,"$")&&isNaN(+o),[s,...l]=o.split(".");a&&(c(n[s])&&(n[h(s,"is--")]=[]),i(l)||n[s].push(h(l.join("."),"is--"))),f.isPrimitive(e[o])||t(e[o],n,a?s:r)}}(r,{}),!0){case d.isDatapointsQuery(t):[].push(d.CONCEPT_TYPE_ENTITY_SET,d.CONCEPT_TYPE_ENTITY_DOMAIN,d.CONCEPT_TYPE_TIME),n.push()}return s(n)}(t,e)];return i(o)?n():r(`Too many query definition errors [repo: ${e.basePath}]: \n* ${o.join("\n* ")}`)})}},,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){(function(t){function n(t,e){for(var n=0,i=t.length-1;i>=0;i--){var r=t[i];"."===r?t.splice(i,1):".."===r?(t.splice(i,1),n++):n&&(t.splice(i,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,r=function(t){return i.exec(t).slice(1)};function o(t,e){if(t.filter)return t.filter(e);for(var n=[],i=0;i<t.length;i++)e(t[i],i,t)&&n.push(t[i]);return n}e.resolve=function(){for(var e="",i=!1,r=arguments.length-1;r>=-1&&!i;r--){var a=r>=0?arguments[r]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,i="/"===a.charAt(0))}return e=n(o(e.split("/"),function(t){return!!t}),!i).join("/"),(i?"/":"")+e||"."},e.normalize=function(t){var i=e.isAbsolute(t),r="/"===a(t,-1);return(t=n(o(t.split("/"),function(t){return!!t}),!i).join("/"))||i||(t="."),t&&r&&(t+="/"),(i?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(o(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function i(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var r=i(t.split("/")),o=i(n.split("/")),a=Math.min(r.length,o.length),s=a,l=0;l<a;l++)if(r[l]!==o[l]){s=l;break}var u=[];for(l=s;l<r.length;l++)u.push("..");return(u=u.concat(o.slice(s))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=r(t),n=e[0],i=e[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},e.basename=function(t,e){var n=r(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){return r(t)[3]};var a="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,n(10))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FILE_READING_ERROR="File reading error",e.JSON_PARSING_ERROR="JSON parsing error",e.CSV_PARSING_ERROR="CSV parsing error",e.DDF_ERROR="DDF error",e.DdfCsvError=class extends Error{constructor(t,e,n){super(),this.name="DdfCsvError",this.message=`${t} [filepath: ${n}]. ${e}.`,this.details=e,this.file=n}}},function(t,e,n){var i,r;void 0===(r="function"==typeof(i=function(){"use strict";var t,e,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},i=!n.document&&!!n.postMessage,r=i&&/(\?|&)papaworker(=|&|$)/.test(n.location.search),o=!1,a={},s=0,l={parse:function(e,i){var r=(i=i||{}).dynamicTyping||!1;if(w(r)&&(i.dynamicTypingFunction=r,r={}),i.dynamicTyping=r,i.worker&&l.WORKERS_SUPPORTED){var u=function(){if(!l.WORKERS_SUPPORTED)return!1;if(!o&&null===l.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var e=l.SCRIPT_PATH||t;e+=(-1!==e.indexOf("?")?"&":"?")+"papaworker";var i=new n.Worker(e);return i.onmessage=g,i.id=s++,a[i.id]=i,i}();return u.userStep=i.step,u.userChunk=i.chunk,u.userComplete=i.complete,u.userError=i.error,i.step=w(i.step),i.chunk=w(i.chunk),i.complete=w(i.complete),i.error=w(i.error),delete i.worker,void u.postMessage({input:e,config:i,workerId:u.id})}var c=null;return"string"==typeof e?c=i.download?new h(i):new f(i):!0===e.readable&&w(e.read)&&w(e.on)?c=new p(i):(n.File&&e instanceof File||e instanceof Object)&&(c=new d(i)),c.stream(e)},unparse:function(t,e){var n=!1,i=!0,r=",",o="\r\n",a='"';"object"==typeof e&&("string"==typeof e.delimiter&&1===e.delimiter.length&&-1===l.BAD_DELIMITERS.indexOf(e.delimiter)&&(r=e.delimiter),("boolean"==typeof e.quotes||e.quotes instanceof Array)&&(n=e.quotes),"string"==typeof e.newline&&(o=e.newline),"string"==typeof e.quoteChar&&(a=e.quoteChar),"boolean"==typeof e.header&&(i=e.header));var s=new RegExp(a,"g");if("string"==typeof t&&(t=JSON.parse(t)),t instanceof Array){if(!t.length||t[0]instanceof Array)return c(null,t);if("object"==typeof t[0])return c(u(t[0]),t)}else if("object"==typeof t)return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),t.data instanceof Array&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=t.data[0]instanceof Array?t.fields:u(t.data[0])),t.data[0]instanceof Array||"object"==typeof t.data[0]||(t.data=[t.data])),c(t.fields||[],t.data||[]);throw"exception: Unable to serialize unrecognized input";function u(t){if("object"!=typeof t)return[];var e=[];for(var n in t)e.push(n);return e}function c(t,e){var n="";"string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e));var a=t instanceof Array&&t.length>0,s=!(e[0]instanceof Array);if(a&&i){for(var l=0;l<t.length;l++)l>0&&(n+=r),n+=h(t[l],l);e.length>0&&(n+=o)}for(var u=0;u<e.length;u++){for(var c=a?t.length:e[u].length,d=0;d<c;d++){d>0&&(n+=r);var f=a&&s?t[d]:d;n+=h(e[u][f],d)}u<e.length-1&&(n+=o)}return n}function h(t,e){return void 0===t||null===t?"":(t=t.toString().replace(s,a+a),"boolean"==typeof n&&n||n instanceof Array&&n[e]||function(t,e){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])>-1)return!0;return!1}(t,l.BAD_DELIMITERS)||t.indexOf(r)>-1||" "===t.charAt(0)||" "===t.charAt(t.length-1)?a+t+a:t)}}};if(l.RECORD_SEP=String.fromCharCode(30),l.UNIT_SEP=String.fromCharCode(31),l.BYTE_ORDER_MARK="\ufeff",l.BAD_DELIMITERS=["\r","\n",'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!i&&!!n.Worker,l.SCRIPT_PATH=null,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=v,l.ParserHandle=m,l.NetworkStreamer=h,l.FileStreamer=d,l.StringStreamer=f,l.ReadableStreamStreamer=p,n.jQuery){var u=n.jQuery;u.fn.parse=function(t){var e=t.config||{},i=[];return this.each(function(t){if(!("INPUT"===u(this).prop("tagName").toUpperCase()&&"file"===u(this).attr("type").toLowerCase()&&n.FileReader)||!this.files||0===this.files.length)return!0;for(var r=0;r<this.files.length;r++)i.push({file:this.files[r],inputElem:this,instanceConfig:u.extend({},e)})}),r(),this;function r(){if(0!==i.length){var e,n,r,a,s=i[0];if(w(t.before)){var c=t.before(s.file,s.inputElem);if("object"==typeof c){if("abort"===c.action)return e="AbortError",n=s.file,r=s.inputElem,a=c.reason,void(w(t.error)&&t.error({name:e},n,r,a));if("skip"===c.action)return void o();"object"==typeof c.config&&(s.instanceConfig=u.extend(s.instanceConfig,c.config))}else if("skip"===c)return void o()}var h=s.instanceConfig.complete;s.instanceConfig.complete=function(t){w(h)&&h(t,s.file,s.inputElem),o()},l.parse(s.file,s.instanceConfig)}else w(t.complete)&&t.complete()}function o(){i.splice(0,1),r()}}}function c(t){this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var e=b(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null),this._handle=new m(e),this._handle.streamer=this,this._config=e}.call(this,t),this.parseChunk=function(t){if(this.isFirstChunk&&w(this._config.beforeFirstChunk)){var e=this._config.beforeFirstChunk(t);void 0!==e&&(t=e)}this.isFirstChunk=!1;var i=this._partialLine+t;this._partialLine="";var o=this._handle.parse(i,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var a=o.meta.cursor;this._finished||(this._partialLine=i.substring(a-this._baseIndex),this._baseIndex=a),o&&o.data&&(this._rowCount+=o.data.length);var s=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)n.postMessage({results:o,workerId:l.WORKER_ID,finished:s});else if(w(this._config.chunk)){if(this._config.chunk(o,this._handle),this._paused)return;o=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!s||!w(this._config.complete)||o&&o.meta.aborted||this._config.complete(this._completeResults,this._input),s||o&&o.meta.paused||this._nextChunk(),o}},this._sendError=function(t){w(this._config.error)?this._config.error(t):r&&this._config.error&&n.postMessage({workerId:l.WORKER_ID,error:t,finished:!1})}}function h(t){var e;(t=t||{}).chunkSize||(t.chunkSize=l.RemoteChunkSize),c.call(this,t),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(t){this._input=t,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),i||(e.onload=x(this._chunkLoaded,this),e.onerror=x(this._chunkError,this)),e.open("GET",this._input,!i),this._config.downloadRequestHeaders){var t=this._config.downloadRequestHeaders;for(var n in t)e.setRequestHeader(n,t[n])}if(this._config.chunkSize){var r=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+r),e.setRequestHeader("If-None-Match","webkit-no-cache")}try{e.send()}catch(t){this._chunkError(t.message)}i&&0===e.status?this._chunkError():this._start+=this._config.chunkSize}},this._chunkLoaded=function(){4==e.readyState&&(e.status<200||e.status>=400?this._chunkError():(this._finished=!this._config.chunkSize||this._start>function(t){var e=t.getResponseHeader("Content-Range");return null===e?-1:parseInt(e.substr(e.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(t){var n=e.statusText||t;this._sendError(n)}}function d(t){var e,n;(t=t||{}).chunkSize||(t.chunkSize=l.LocalChunkSize),c.call(this,t);var i="undefined"!=typeof FileReader;this.stream=function(t){this._input=t,n=t.slice||t.webkitSlice||t.mozSlice,i?((e=new FileReader).onload=x(this._chunkLoaded,this),e.onerror=x(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var t=this._input;if(this._config.chunkSize){var r=Math.min(this._start+this._config.chunkSize,this._input.size);t=n.call(t,this._start,r)}var o=e.readAsText(t,this._config.encoding);i||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(t.target.result)},this._chunkError=function(){this._sendError(e.error)}}function f(t){var e;t=t||{},c.call(this,t),this.stream=function(t){return e=t,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var t=this._config.chunkSize,n=t?e.substr(0,t):e;return e=t?e.substr(t):"",this._finished=!e,this.parseChunk(n)}}}function p(t){t=t||{},c.call(this,t);var e=[],n=!0;this.stream=function(t){this._input=t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._nextChunk=function(){e.length?this.parseChunk(e.shift()):n=!0},this._streamData=x(function(t){try{e.push("string"==typeof t?t:t.toString(this._config.encoding)),n&&(n=!1,this.parseChunk(e.shift()))}catch(t){this._streamError(t)}},this),this._streamError=x(function(t){this._streamCleanUp(),this._sendError(t.message)},this),this._streamEnd=x(function(){this._streamCleanUp(),this._finished=!0,this._streamData("")},this),this._streamCleanUp=x(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(t){var e,n,i,r=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,o=this,a=0,s=!1,u=!1,c=[],h={data:[],errors:[],meta:{}};if(w(t.step)){var d=t.step;t.step=function(e){if(h=e,p())f();else{if(f(),0===h.data.length)return;a+=e.data.length,t.preview&&a>t.preview?n.abort():d(h,o)}}}function f(){if(h&&i&&(g("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),i=!1),t.skipEmptyLines)for(var e=0;e<h.data.length;e++)1===h.data[e].length&&""===h.data[e][0]&&h.data.splice(e--,1);return p()&&function(){if(h){for(var t=0;p()&&t<h.data.length;t++)for(var e=0;e<h.data[t].length;e++)c.push(h.data[t][e]);h.data.splice(0,1)}}(),function(){if(!h||!t.header&&!t.dynamicTyping)return h;for(var e=0;e<h.data.length;e++){for(var n=t.header?{}:[],i=0;i<h.data[e].length;i++){var r=i,o=h.data[e][i];t.header&&(r=i>=c.length?"__parsed_extra":c[i]),o=m(r,o),"__parsed_extra"===r?(n[r]=n[r]||[],n[r].push(o)):n[r]=o}h.data[e]=n,t.header&&(i>c.length?g("FieldMismatch","TooManyFields","Too many fields: expected "+c.length+" fields but parsed "+i,e):i<c.length&&g("FieldMismatch","TooFewFields","Too few fields: expected "+c.length+" fields but parsed "+i,e))}return t.header&&h.meta&&(h.meta.fields=c),h}()}function p(){return t.header&&0===c.length}function m(e,n){return function(e){return t.dynamicTypingFunction&&void 0===t.dynamicTyping[e]&&(t.dynamicTyping[e]=t.dynamicTypingFunction(e)),!0===(t.dynamicTyping[e]||t.dynamicTyping)}(e)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(i=n,r.test(i)?parseFloat(i):i):n;var i}function g(t,e,n,i){h.errors.push({type:t,code:e,message:n,row:i})}this.parse=function(r,o,a){if(t.newline||(t.newline=function(t){var e=(t=t.substr(0,1048576)).split("\r"),n=t.split("\n"),i=n.length>1&&n[0].length<e[0].length;if(1===e.length||i)return"\n";for(var r=0,o=0;o<e.length;o++)"\n"===e[o][0]&&r++;return r>=e.length/2?"\r\n":"\r"}(r)),i=!1,t.delimiter)w(t.delimiter)&&(t.delimiter=t.delimiter(r),h.meta.delimiter=t.delimiter);else{var u=function(e,n,i){for(var r,o,a,s=[",","\t","|",";",l.RECORD_SEP,l.UNIT_SEP],u=0;u<s.length;u++){var c=s[u],h=0,d=0,f=0;a=void 0;for(var p=new v({delimiter:c,newline:n,preview:10}).parse(e),m=0;m<p.data.length;m++)if(i&&1===p.data[m].length&&0===p.data[m][0].length)f++;else{var g=p.data[m].length;d+=g,void 0!==a?g>1&&(h+=Math.abs(g-a),a=g):a=g}p.data.length>0&&(d/=p.data.length-f),(void 0===o||h<o)&&d>1.99&&(o=h,r=c)}return t.delimiter=r,{successful:!!r,bestDelimiter:r}}(r,t.newline,t.skipEmptyLines);u.successful?t.delimiter=u.bestDelimiter:(i=!0,t.delimiter=l.DefaultDelimiter),h.meta.delimiter=t.delimiter}var c=b(t);return t.preview&&t.header&&c.preview++,e=r,n=new v(c),h=n.parse(e,o,a),f(),s?{meta:{paused:!0}}:h||{meta:{paused:!1}}},this.paused=function(){return s},this.pause=function(){s=!0,n.abort(),e=e.substr(n.getCharIndex())},this.resume=function(){s=!1,o.streamer.parseChunk(e)},this.aborted=function(){return u},this.abort=function(){u=!0,n.abort(),h.meta.aborted=!0,w(t.complete)&&t.complete(h),e=""}}function v(t){var e=(t=t||{}).delimiter,n=t.newline,i=t.comments,r=t.step,o=t.preview,a=t.fastMode,s=t.quoteChar||'"';if(("string"!=typeof e||l.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),i===e)throw"Comment character same as delimiter";!0===i?i="#":("string"!=typeof i||l.BAD_DELIMITERS.indexOf(i)>-1)&&(i=!1),"\n"!=n&&"\r"!=n&&"\r\n"!=n&&(n="\n");var u=0,c=!1;this.parse=function(t,l,h){if("string"!=typeof t)throw"Input must be a string";var d=t.length,f=e.length,p=n.length,m=i.length,v=w(r);u=0;var g=[],y=[],_=[],b=0;if(!t)return C();if(a||!1!==a&&-1===t.indexOf(s)){for(var x=t.split(n),S=0;S<x.length;S++){_=x[S];if(u+=_.length,S!==x.length-1)u+=n.length;else if(h)return C();if(!i||_.substr(0,m)!==i){if(v){if(g=[],T(_.split(e)),A(),c)return C()}else T(_.split(e));if(o&&S>=o)return g=g.slice(0,o),C(!0)}}return C()}for(var M=t.indexOf(e,u),E=t.indexOf(n,u),z=new RegExp(s+s,"g");;)if(t[u]!==s)if(i&&0===_.length&&t.substr(u,m)===i){if(-1===E)return C();u=E+p,E=t.indexOf(n,u),M=t.indexOf(e,u)}else if(-1!==M&&(M<E||-1===E))_.push(t.substring(u,M)),u=M+f,M=t.indexOf(e,u);else{if(-1===E)break;if(_.push(t.substring(u,E)),P(E+p),v&&(A(),c))return C();if(o&&g.length>=o)return C(!0)}else{var k=u;for(u++;;){if(-1===(k=t.indexOf(s,k+1)))return h||y.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:g.length,index:u}),O();if(k===d-1)return O(t.substring(u,k).replace(z,s));if(t[k+1]!==s){if(t[k+1]===e){_.push(t.substring(u,k).replace(z,s)),u=k+1+f,M=t.indexOf(e,u),E=t.indexOf(n,u);break}if(t.substr(k+1,p)===n){if(_.push(t.substring(u,k).replace(z,s)),P(k+1+p),M=t.indexOf(e,u),v&&(A(),c))return C();if(o&&g.length>=o)return C(!0);break}y.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:g.length,index:u}),k++}else k++}}return O();function T(t){g.push(t),b=u}function O(e){return h?C():(void 0===e&&(e=t.substr(u)),_.push(e),u=d,T(_),v&&A(),C())}function P(e){u=e,T(_),_=[],E=t.indexOf(n,u)}function C(t){return{data:g,errors:y,meta:{delimiter:e,linebreak:n,aborted:c,truncated:!!t,cursor:b+(l||0)}}}function A(){r(C()),g=[],y=[]}},this.abort=function(){c=!0},this.getCharIndex=function(){return u}}function g(t){var e=t.data,n=a[e.workerId],i=!1;if(e.error)n.userError(e.error,e.file);else if(e.results&&e.results.data){var r={abort:function(){i=!0,y(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_,resume:_};if(w(n.userStep)){for(var o=0;o<e.results.data.length&&(n.userStep({data:[e.results.data[o]],errors:e.results.errors,meta:e.results.meta},r),!i);o++);delete e.results}else w(n.userChunk)&&(n.userChunk(e.results,r,e.file),delete e.results)}e.finished&&!i&&y(e.workerId,e.results)}function y(t,e){var n=a[t];w(n.userComplete)&&n.userComplete(e),n.terminate(),delete a[t]}function _(){throw"Not implemented."}function b(t){if("object"!=typeof t)return t;var e=t instanceof Array?[]:{};for(var n in t)e[n]=b(t[n]);return e}function x(t,e){return function(){t.apply(e,arguments)}}function w(t){return"function"==typeof t}return r?n.onmessage=function(t){var e=t.data;if(void 0===l.WORKER_ID&&e&&(l.WORKER_ID=e.workerId),"string"==typeof e.input)n.postMessage({workerId:l.WORKER_ID,results:l.parse(e.input,e.config),finished:!0});else if(n.File&&e.input instanceof File||e.input instanceof Object){var i=l.parse(e.input,e.config);i&&n.postMessage({workerId:l.WORKER_ID,results:i,finished:!0})}}:l.WORKERS_SUPPORTED&&(e=document.getElementsByTagName("script"),t=e.length?e[e.length-1].src:"",document.body?document.addEventListener("DOMContentLoaded",function(){o=!0},!0):o=!0),h.prototype=Object.create(c.prototype),h.prototype.constructor=h,d.prototype=Object.create(c.prototype),d.prototype.constructor=d,f.prototype=Object.create(f.prototype),f.prototype.constructor=f,p.prototype=Object.create(c.prototype),p.prototype.constructor=p,l})?i.apply(e,[]):i)||(t.exports=r)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(89),e.FrontendFileReader=class{setRecordTransformer(t){this.recordTransformer=t}readText(t,e){fetch(t).then(t=>t.text()).then(t=>{e(null,t)}).catch(n=>{e(`${t} read error: ${n}`)})}}},,,,function(t,e,n){(function(e){var n=9007199254740991,i="[object Arguments]",r="[object Function]",o="[object GeneratorFunction]",a="object"==typeof e&&e&&e.Object===Object&&e,s="object"==typeof self&&self&&self.Object===Object&&self,l=a||s||Function("return this")();function u(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}var c=Object.prototype,h=c.hasOwnProperty,d=c.toString,f=l.Symbol,p=c.propertyIsEnumerable,m=f?f.isConcatSpreadable:void 0;function v(t){return g(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?d.call(t):"";return e==r||e==o}(t)}(t)}(t)&&h.call(t,"callee")&&(!p.call(t,"callee")||d.call(t)==i)}(t)||!!(m&&t&&t[m])}var g=Array.isArray;t.exports=function(t){return t&&t.length?function t(e,n,i,r,o){var a=-1,s=e.length;for(i||(i=v),o||(o=[]);++a<s;){var l=e[a];n>0&&i(l)?n>1?t(l,n-1,i,r,o):u(o,l):r||(o[o.length]=l)}return o}(t,1/0):[]}}).call(this,n(0))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(76),r=n(27),o=n(29),a=n(20),s=n(8),l=n(83),u=n(11),c=n(19),h=n(4),d=n(18),f=n(77),p=n(28),m=n(78),v="$and",g=t=>r(o(t)),y=t=>r(a(t)),_=t=>1===a(t).length;e.InClauseUnderConjunction=class{constructor(t,e){this.flow={},this.fileReader=e.fileReader,this.datasetPath=e.basePath,this.query=t,this.datapackage=e.datapackage,this.conceptsLookup=e.conceptsLookup}isMatched(){this.flow.joinObject=s(this.query,"join");const t=d(p.featureDetectors.map(t=>t(this.query,this.conceptsLookup)));return h(t,p.QueryFeature.WhereClauseBasedOnConjunction)&&h(t,p.QueryFeature.ConjunctionPartFromWhereClauseCorrespondsToJoin)}async getRecommendedFilesSet(){if(this.isMatched()){let t;try{this.fillResourceToFileHash(),this.collectProcessableClauses(),this.collectEntityFilesNames();const e=await this.collectEntities();this.fillEntityValuesHash(e),this.getFilesGroupsQueryClause(),t=this.getOptimalFilesGroup()}catch(t){return[]}return t}throw new f.DdfCsvError('Plugin "InClauseUnderConjunction" is not matched!',"InClauseUnderConjunction plugin")}fillResourceToFileHash(){return this.flow.resourceToFile=s(this.datapackage,"resources",[]).reduce((t,e)=>(t.set(e.name,e.path),t),new Map),this}collectProcessableClauses(){const t=a(this.flow.joinObject);this.flow.processableClauses=[];for(const e of t){const t=s(this.flow.joinObject,`${e}.where`,{});this.singleAndField(t)?this.flow.processableClauses.push(...l(t[v].map(t=>this.getProcessableClauses(t)))):this.flow.processableClauses.push(...this.getProcessableClauses(t))}return this}collectEntityFilesNames(){this.flow.entityFilesNames=[],this.flow.fileNameToPrimaryKeyHash=new Map;for(const t of this.datapackage.ddfSchema.entities)for(const e of this.flow.processableClauses){const n=y(e);if(r(t.primaryKey)===n)for(const e of t.resources){const t=this.flow.resourceToFile.get(e);this.flow.entityFilesNames.push(t),this.flow.fileNameToPrimaryKeyHash.set(t,n)}}return this}collectEntities(){const t=this,e=t.flow.entityFilesNames.map(e=>new Promise((n,r)=>{t.fileReader.readText(i.join(t.datasetPath,e),(t,i)=>{if(t)return r(t);m.parse(i,{header:!0,skipEmptyLines:!0,complete:t=>n({file:e,result:t}),error:t=>r(t)})})}));return Promise.all(e)}fillEntityValuesHash(t){const e=t=>d(a(t).filter(e=>c(e,"is--")&&("TRUE"===t[e]||"true"===t[e])).map(t=>t.replace(/^is--/,"")));this.flow.entityValueToFileHash=new Map,this.flow.entityValueToDomainHash=new Map;for(const n of t)for(const t of n.result.data){const i=this.flow.fileNameToPrimaryKeyHash.get(n.file),r=t[i],o=[...e(t)];u(o)&&o.push(i),this.flow.entityValueToDomainHash.set(r,o),this.flow.entityValueToFileHash.set(r,n.file)}return this}getFilesGroupsQueryClause(){const t=new Map;for(const e of this.flow.processableClauses){const n={entities:new Set,datapoints:new Set,concepts:new Set},i=g(e).$in;for(const t of i){n.entities.add(this.flow.entityValueToFileHash.get(t));const e=this.flow.entityValueToDomainHash.get(t);for(const t of e)for(const e of this.datapackage.ddfSchema.datapoints)for(const i of e.resources)h(e.primaryKey,t)&&n.datapoints.add(this.flow.resourceToFile.get(i))}for(const t of this.datapackage.ddfSchema.concepts)for(const e of t.resources)n.concepts.add(this.flow.resourceToFile.get(e));t.set(e,n)}return this.flow.filesGroupsByClause=t,this}getOptimalFilesGroup(){const t=this.flow.filesGroupsByClause.keys();let e,n;for(const i of t){const t=this.flow.filesGroupsByClause.get(i).datapoints.size+this.flow.filesGroupsByClause.get(i).entities.size+this.flow.filesGroupsByClause.get(i).concepts.size;(!e||t<n)&&(e=i,n=t)}return[...Array.from(this.flow.filesGroupsByClause.get(e).concepts),...Array.from(this.flow.filesGroupsByClause.get(e).entities),...Array.from(this.flow.filesGroupsByClause.get(e).datapoints)]}getProcessableClauses(t){const e=[],n=a(t);for(const i of n)!c(i,"$")&&_(t[i])&&"$in"===r(a(t[i]))&&e.push(t);return e}singleAndField(t){return _(t)&&!!s(t,v)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(84),r=n(27);e.getAppropriatePlugin=function(t,e){const n=[new i.InClauseUnderConjunction(t,e)];return r(n.filter(t=>t.isMatched()))}},function(t,e,n){(function(e){var n=9007199254740991,i="[object Arguments]",r="[object Function]",o="[object GeneratorFunction]",a="object"==typeof e&&e&&e.Object===Object&&e,s="object"==typeof self&&self&&self.Object===Object&&self,l=a||s||Function("return this")();function u(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}var c=Object.prototype,h=c.hasOwnProperty,d=c.toString,f=l.Symbol,p=c.propertyIsEnumerable,m=f?f.isConcatSpreadable:void 0;function v(t){return g(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?d.call(t):"";return e==r||e==o}(t)}(t)}(t)&&h.call(t,"callee")&&(!p.call(t,"callee")||d.call(t)==i)}(t)||!!(m&&t&&t[m])}var g=Array.isArray;t.exports=function(){for(var t=arguments.length,e=Array(t?t-1:0),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return t?u(g(n)?function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}(n):[n],function t(e,n,i,r,o){var a=-1,s=e.length;for(i||(i=v),o||(o=[]);++a<s;){var l=e[a];n>0&&i(l)?n>1?t(l,n-1,i,r,o):u(o,l):r||(o[o.length]=l)}return o}(e,1)):[]}}).call(this,n(0))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(4),r=n(30),o=n(11),a=n(86),s=n(85),l=n(77),u=n(28),c=n(78),h=t=>!("number"!=typeof t&&!t);e.ddfCsvReader=function(t){const e=[{concept:"concept",concept_type:"string",domain:null},{concept:"concept_type",concept_type:"string",domain:null}],n=new Map([["$and",(t,e)=>e.every(e=>_(t,e))],["$or",(t,e)=>e.some(e=>_(t,e))],["$not",(t,e)=>!_(t,e)],["$nor",(t,e)=>!e.some(e=>_(t,e))],["$eq",(t,e)=>t==e],["$ne",(t,e)=>t!=e],["$gt",(t,e)=>h(t)&&t>e],["$gte",(t,e)=>h(t)&&t>=e],["$lt",(t,e)=>h(t)&&t<e],["$lte",(t,e)=>h(t)&&t<=e],["$in",(t,e)=>e.has(t)],["$nin",(t,e)=>!e.has(t)]]),d=new Map,f=new Map;let p=[];async function m(t,n){v(e,n);const i={select:{key:["concept"],value:["concept_type","domain"]},from:"concepts"};let r;try{!function(t,n){const i=t.filter(t=>"entity_set"===t.concept_type).map(t=>({concept:"is--"+t.concept,concept_type:"boolean",domain:null}));v(t=t.concat(i).concat(e),n)}(await y(i,n),n),r=await function({conceptsLookup:t}){const e=new Map([["boolean",t=>"true"===t||"TRUE"===t],["measure",t=>parseFloat(t)]]),n=[...S(["concept"])].map(n=>n.data.then(n=>{const i=Object.keys(n.data[0]),r=new Map;return i.forEach(n=>{const i=t.get(n).concept_type,o=e.get(i);o&&r.set(n,o)}),n.data.forEach(t=>{for(const[e,n]of r)t[e]=n(t[e])})}));return Promise.all(n)}(n)}catch(t){throw t}return r}function v(t,e){e.conceptsLookup.clear(),t.forEach(t=>e.conceptsLookup.set(t.concept,t))}async function g(t,e){let n;try{if(await u.validateQueryStructure(t,e),e.datapackage=await function(t){const e=u.getFilePath(t.basePath);return new Promise((n,i)=>{t.fileReader.readText(e,(t,r)=>{if(t)return i(new l.DdfCsvError(l.FILE_READING_ERROR,t,e));let o;try{o=JSON.parse(r),p=[],function(t){if(f.size>0)return f;t.resources.forEach(t=>{Array.isArray(t.schema.primaryKey)||(t.schema.primaryKey=[t.schema.primaryKey]),t.translations={},f.set(t.name,t)})}(o),function(t){if(d.size>0)return d;for(const e in t.ddfSchema)t.ddfSchema[e].map(t=>{const e=k(t.primaryKey),n=t.resources.map(t=>f.get(t));d.has(e)?d.get(e).set(t.value,n):d.set(e,new Map([[t.value,n]]))})}(o)}catch(t){return i(new l.DdfCsvError(l.JSON_PARSING_ERROR,t.message,e))}n(o)})})}(e),await m(0,e),u.isSchemaQuery(t))n=await function(t,{datapackage:e}){const n=t=>e.ddfSchema[t].map(({primaryKey:t,value:e})=>({key:t,value:e})),i=t.from.split(".")[0];return e.ddfSchema[i]?n(i):"*"===i?Object.keys(e.ddfSchema).map(n).reduce((t,e)=>t.concat(e)):void z(new l.DdfCsvError(l.DDF_ERROR,`No valid collection (${i}) for schema query`))}(t,{datapackage:e.datapackage});else{const i=s.getAppropriatePlugin(t,e);if(i){p=[];const e=await i.getRecommendedFilesSet();p=e,t.optimalFilesSet=a([],e,t.optimalFilesSet)}n=await y(t,e)}}catch(t){throw t}return n}function y(t,e){const{select:{key:n=[],value:o=[]},from:a="",where:s={},join:l={},order_by:u=[],language:c}=t,h={key:n,value:o},d=new Set(h.key.concat(h.value)),f=x(s).filter(t=>!d.has(t)),p=function(t,e,n,r){const o=S(t,e);return Promise.all([...o].map(t=>(function(t,e,n){const r=[];void 0===t.data&&(t.data=T(t.path,n)),r.push(t.data);const o=void 0!==e&&i(function({datapackage:t}){return t.translations?t.translations.map(t=>t.id):[]}(n),e),a=void 0!==t.translations[e];if(o){if(!a){const i=`lang/${e}/${t.path}`;t.translations[e]=T(i,n).catch(t=>Promise.resolve({}))}r.push(t.translations[e])}return Promise.all(r).then(e=>{const n=e.map(t=>t.data||[]);return{data:E(t.schema.primaryKey,"translation",...n),resource:t}})})(t,n,r)))}(h.key,[...h.value,...f],c,e),m=function(t,e,n){return Promise.all(Object.keys(t).map(e=>(function(t,e,n,i){return"time"===i.conceptsLookup.get(e.key).concept_type?Promise.resolve({[t]:e.where}):g({select:{key:[e.key]},where:e.where,from:i.conceptsLookup.has(e.key)?"entities":"concepts"},Object.assign({joinID:t},r(i))).then(n=>({[t]:{[e.key]:{$in:new Set(n.map(t=>t[e.key]))}}}))})(e,t[e],0,n))).then(t=>t.reduce(b,{}))}(l,0,e),v=function(t,e,n){const i=w(["entity_set"],t,n).map(t=>g({select:{key:[t.domain],value:["is--"+t.concept]},from:"entities"},Object.assign({},r(n))).then(e=>({[t.concept]:{$in:new Set(e.filter(e=>e["is--"+t.concept]).map(e=>e[t.domain]))}})));return Promise.all(i).then(t=>t.reduce((t,e)=>Object.assign(t,e),{}))}(h.key,0,e);return Promise.all([p,v,m]).then(([t,n,r])=>{const o=function(...t){return t.reduce((t,e)=>(t.$and.push(e),t),{$and:[]})}(n,function t(e,n){const r={};for(const o in e){const a=e[o];i(["$and","$or","$nor"],o)?r[o]=a.map(e=>t(e,n)):"$in"===o||"$nin"===o?r[o]=new Set(a):void 0!==n[a]?Object.assign(r,n[a]):r[o]="object"==typeof a?t(a,n):a}return r}(s,r)),a=t.map(t=>(function(t,e,n,i){const r=t.resource.schema.primaryKey,o=new Set([...r,...e.value,...n]),a=function(t,e,n){const i=new Set(e),r=["entity_set","entity_domain"],o=w(r,t,n);if(0===o.length)return new Map;const a=w(r,null,n);return o.map(t=>a.filter(e=>"entity_set"===t.concept_type?i.has(e.concept)&&e.concept!==t.concept&&(e.domain===t.domain||e.concept===t.domain):i.has(e.concept)&&e.concept!==t.concept&&e.domain===t.concept).reduce((e,n)=>e.set(n.concept,t.concept),new Map)).reduce((t,e)=>new Map([...t,...e]),new Map)}(e.key,r,i);return t.data.map(t=>M(t,o)).map(t=>(function(t,e){const n={};for(const i in t)n[e.get(i)||i]=t[i];return n})(t,a))})(t,h,f,e)),l=E(h.key,"overwrite",...a).filter(t=>_(t,o)).map(t=>(function(t,e){for(const n of e)void 0===t[n]&&(t[n]=null);return t})(t,d)).map(t=>M(t,d));return function(t,e=[]){if(0===e.length)return;const n=e.map(t=>{if("string"==typeof t)return{concept:t,direction:1};{const e=Object.keys(t)[0];return{concept:e,direction:"asc"===t[e]?1:-1}}}),i=n.length;t.sort((t,e)=>{for(let r=0;r<i;r++){const i=n[r];if(t[i.concept]<e[i.concept])return-1*i.direction;if(t[i.concept]>e[i.concept])return 1*i.direction}return 0})}(l,u),l})}function _(t,e){return Object.keys(e).every(i=>{const r=n.get(i);return r?r(t,e[i]):"object"!=typeof e[i]?n.get("$eq")(t[i],e[i]):_(t[i],e[i])})}function b(t,e){return Object.assign(t,e)}function x(t){const e=[];for(const n in t)i(["$and","$or","$not","$nor"],n)?t[n].map(x).forEach(t=>e.push(...t)):e.push(n);return e}function w(t,e,n){const r=e||Array.from(n.conceptsLookup.keys()),o=[];for(const e of r){const r=n.conceptsLookup.get(e);i(t,r.concept_type)&&o.push(r)}return o}function S(t,e){if(!e||0===e.length)return new Set([...d.get(k(t)).values()].reduce((t,e)=>t.concat(e)));if(Array.isArray(e))return e.map(e=>S(t,e)).reduce((t,e)=>new Set([...t,...e]),new Set);let n=d.get(k(t)).get(e);return n&&(n=n.filter(t=>o(p)||i(p,t.path))),new Set(n)}function M(t,e){const n={};for(const i in t)e.has(i)&&(n[i]=t[i]);return n}function E(t,e,...n){if(1===n.length)return n[0];const i=t.slice(0).sort();return[...n.reduce((t,n)=>(n.forEach(n=>{const r=i.map(t=>n[t]).join(",");t.has(r)?function(t,e,n){switch(n){case"overwrite":Object.assign(t,e);break;case"translation":for(const n in e)""!==e[n]&&(t[n]=e[n]);break;case"overwriteWithError":for(const n in e)if(void 0!==t[n]&&t[n]!==e[n]){const i=`JOIN Error: two resources have different data for "${n}": ${JSON.stringify(e)},${JSON.stringify(t)}`;z(new l.DdfCsvError(l.DDF_ERROR,i))}else t[n]=e[n]}}(t.get(r),n,e):t.set(r,n)}),t),new Map).values()]}function z(e){throw(t||console).error(e.message),e}function k(t,e=!1){const n=t.slice(0).sort();return e?n.map(t=>e[t]).join(","):n.join(",")}function T(t,e){const n=u.getFilePath(e.basePath,t);return new Promise((r,o)=>{e.fileReader.readText(n,(a,s)=>{if(a)return o(new l.DdfCsvError(l.FILE_READING_ERROR,a,n));c.parse(s,{header:!0,skipEmptyLines:!0,dynamicTyping:t=>{if(!e.conceptsLookup)return!0;const n=e.conceptsLookup.get(t)||{};return i(["boolean","measure"],n.concept_type)},complete:t=>r(t),error:e=>o(new l.DdfCsvError(l.CSV_PARSING_ERROR,e,t))})})})}return{query:g}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(87);e.prepareDDFCsvReaderObject=function(t){return function(e,n){return{init(r){this._basePath=r.path,this._lastModified=r._lastModified,this.fileReader=e||t,this.logger=n,this.resultTransformer=r.resultTransformer,this.readerOptions={basePath:this._basePath,fileReader:this.fileReader,logger:this.logger},this.reader=i.ddfCsvReader(this.logger)},async getAsset(t){const e=".json"===t.slice(-".json".length),n=`${this._basePath}/${t}`;return new Promise((t,i)=>{this.fileReader.readText(n,(n,r)=>{if(n)i(n);else if(e)try{t(JSON.parse(r))}catch(t){i(n)}else t(r)})})},async read(t,e){let i;try{i=await this.reader.query(t,{basePath:this._basePath,fileReader:this.fileReader,logger:this.logger,conceptsLookup:new Map}),i=e?this._prettifyData(i,e):i,this.resultTransformer&&(i=this.resultTransformer(i)),this.logger&&this.logger.log&&(n.log(JSON.stringify(t),i.length),n.log(i))}catch(t){throw t}return i},_prettifyData:(t,e)=>t.map(t=>(Object.keys(t).forEach(n=>{e[n]&&(t[n]=e[n](t[n]))}),t))}}}},function(t,e){!function(){"use strict";if(!self.fetch){o.prototype.append=function(t,e){t=i(t),e=r(e);var n=this.map[t];n||(n=[],this.map[t]=n),n.push(e)},o.prototype.delete=function(t){delete this.map[i(t)]},o.prototype.get=function(t){var e=this.map[i(t)];return e?e[0]:null},o.prototype.getAll=function(t){return this.map[i(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(i(t))},o.prototype.set=function(t,e){this.map[i(t)]=[r(e)]},o.prototype.forEach=function(t){var e=this;Object.getOwnPropertyNames(this.map).forEach(function(n){t(n,e.map[n])})};var t={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in self},e=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],n=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);u.call(c.prototype),u.call(d.prototype),self.Headers=o,self.Request=c,self.Response=d,self.fetch=function(e,i){var r;return r=c.prototype.isPrototypeOf(e)&&!i?e:new c(e,i),new fetch.Promise(function(e,i){var a=function(){return n&&!/^(get|post|head|put|delete|options)$/i.test(this.method)?(this.usingActiveXhr=!0,new ActiveXObject("Microsoft.XMLHTTP")):new XMLHttpRequest}();function s(){if(4===a.readyState){var t=1223===a.status?204:a.status;if(t<100||t>599)i(new TypeError("Network request failed"));else{var n={status:t,statusText:a.statusText,headers:function(t){var e=new o;return t.getAllResponseHeaders().trim().split("\n").forEach(function(t){var n=t.trim().split(":"),i=n.shift().trim(),r=n.join(":").trim();e.append(i,r)}),e}(a),url:"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0},r="response"in a?a.response:a.responseText;e(new d(r,n))}}}"cors"===r.credentials&&(a.withCredentials=!0),a.onreadystatechange=s,self.usingActiveXhr||(a.onload=s,a.onerror=function(){i(new TypeError("Network request failed"))}),a.open(r.method,r.url,!0),"responseType"in a&&t.blob&&(a.responseType="blob"),r.headers.forEach(function(t,e){e.forEach(function(e){a.setRequestHeader(t,e)})}),a.send(void 0===r._bodyInit?null:r._bodyInit)})},fetch.Promise=self.Promise,self.fetch.polyfill=!0}function i(t){if("string"!=typeof t&&(t=t.toString()),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!=typeof t&&(t=t.toString()),t}function o(t){this.map={};var e=this;t instanceof o?t.forEach(function(t,n){n.forEach(function(n){e.append(t,n)})}):t&&Object.getOwnPropertyNames(t).forEach(function(n){e.append(n,t[n])})}function a(t){if(t.bodyUsed)return fetch.Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function s(t){return new fetch.Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function l(t){var e=new FileReader;return e.readAsArrayBuffer(t),s(e)}function u(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else{if(e)throw new Error("unsupported BodyInit type");this._bodyText=""}},t.blob?(this.blob=function(){var t=a(this);if(t)return t;if(this._bodyBlob)return fetch.Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return fetch.Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(l)},this.text=function(){var t,e,n=a(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,(e=new FileReader).readAsText(t),s(e);if(this._bodyFormData)throw new Error("could not read FormData body as text");return fetch.Promise.resolve(this._bodyText)}):this.text=function(){return a(this)||fetch.Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(function(t){return JSON.parse(t)})},this}function c(t,n){var i,r;if(n=n||{},this.url=t,this.credentials=n.credentials||"omit",this.headers=new o(n.headers),this.method=(r=(i=n.method||"GET").toUpperCase(),e.indexOf(r)>-1?r:i),this.mode=n.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n.body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n.body)}function h(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}}),e}function d(t,e){e||(e={}),this._initBody(t),this.type="default",this.url=null,this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof o?e.headers:new o(e.headers),this.url=e.url||""}}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(79);var r=n(79);e.FrontendFileReader=r.FrontendFileReader;var o=n(77);e.DdfCsvError=o.DdfCsvError;const a=n(88);e.getDDFCsvReaderObject=a.prepareDDFCsvReaderObject(new i.FrontendFileReader)}]);t.exports=n},56:function(t,e){var n=function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=45)}([function(t,e,n){"use strict";var i=Array.isArray;t.exports=i},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(29),o="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,a=r||o||Function("return this")();t.exports=a},function(t,e,n){"use strict";var i=n(61),r=n(67);t.exports=function(t,e){var n=r(t,e);return i(n)?n:void 0}},function(t,e,n){"use strict";var i=n(11),r=n(63),o=n(64),a="[object Null]",s="[object Undefined]",l=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?s:a:l&&l in Object(t)?r(t):o(t)}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){return null!=t&&"object"==(void 0===t?"undefined":i(t))}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){var e=void 0===t?"undefined":i(t);return null!=t&&("object"==e||"function"==e)}},function(t,e,n){"use strict";var i=n(7);t.exports=function(t){return null==t?"":i(t)}},function(t,e,n){"use strict";var i=n(11),r=n(26),o=n(0),a=n(15),s=1/0,l=i?i.prototype:void 0,u=l?l.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(o(e))return r(e,t)+"";if(a(e))return u?u.call(e):"";var n=e+"";return"0"==n&&1/e==-s?"-0":n}},function(t,e,n){"use strict";function i(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}var r=n(51),o=n(52),a=n(53),s=n(54),l=n(55);i.prototype.clear=r,i.prototype.delete=o,i.prototype.get=a,i.prototype.has=s,i.prototype.set=l,t.exports=i},function(t,e,n){"use strict";var i=n(10);t.exports=function(t,e){for(var n=t.length;n--;)if(i(t[n][0],e))return n;return-1}},function(t,e,n){"use strict";t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,n){"use strict";var i=n(1).Symbol;t.exports=i},function(t,e,n){"use strict";var i=n(2)(Object,"create");t.exports=i},function(t,e,n){"use strict";var i=n(76);t.exports=function(t,e){var n=t.__data__;return i(e)?n["string"==typeof e?"string":"hash"]:n.map}},function(t,e,n){"use strict";var i=n(28),r=n(22);t.exports=function(t){return null!=t&&r(t.length)&&!i(t)}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(3),o=n(4),a="[object Symbol]";t.exports=function(t){return"symbol"==(void 0===t?"undefined":i(t))||o(t)&&r(t)==a}},function(t,e,n){"use strict";var i=n(15),r=1/0;t.exports=function(t){if("string"==typeof t||i(t))return t;var e=t+"";return"0"==e&&1/t==-r?"-0":e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WS_RESPONSE_ERROR="WS response error",e.NETWORK_ERROR="Network error",e.WS_BAD_RESPONSE="WS bad response",e.WS_ERROR="WS error",e.WS_MESSAGE="WS message",e.WsError=function(t){function e(t,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.name="WaffleServerError",i.message=t,i.details=n,i.endpoint=null,i.url=null,i.ddfql=null,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,Error),e}()},function(t,e,n){"use strict";var i=n(2)(n(1),"Map");t.exports=i},function(t,e,n){"use strict";function i(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}var r=n(68),o=n(75),a=n(77),s=n(78),l=n(79);i.prototype.clear=r,i.prototype.delete=o,i.prototype.get=a,i.prototype.has=s,i.prototype.set=l,t.exports=i},function(t,e,n){"use strict";var i=n(97),r=n(102),o=n(14);t.exports=function(t){return o(t)?i(t):r(t)}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var n=void 0===t?"undefined":i(t);return!!(e=null==e?r:e)&&("number"==n||"symbol"!=n&&o.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,n){"use strict";var i=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(0),o=n(15),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;t.exports=function(t,e){if(r(t))return!1;var n=void 0===t?"undefined":i(t);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!o(t))||s.test(t)||!a.test(t)||null!=e&&t in Object(e)}},function(t,e,n){"use strict";var i=n(144);t.exports=function(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:i(t,e,n)}},function(t,e,n){"use strict";var i=n(148),r=n(43),o=n(149);t.exports=function(t){return r(t)?o(t):i(t)}},function(t,e,n){"use strict";t.exports=function(t,e){for(var n=-1,i=null==t?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}},function(t,e,n){"use strict";function i(t){var e=this.__data__=new r(t);this.size=e.size}var r=n(8),o=n(56),a=n(57),s=n(58),l=n(59),u=n(60);i.prototype.clear=o,i.prototype.delete=a,i.prototype.get=s,i.prototype.has=l,i.prototype.set=u,t.exports=i},function(t,e,n){"use strict";var i=n(3),r=n(5),o="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",l="[object Proxy]";t.exports=function(t){if(!r(t))return!1;var e=i(t);return e==a||e==s||e==o||e==l}},function(t,e,n){"use strict";(function(e){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i="object"==(void 0===e?"undefined":n(e))&&e&&e.Object===Object&&e;t.exports=i}).call(e,n(62))},function(t,e,n){"use strict";var i=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return i.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,n){"use strict";var i=n(80),r=n(4);t.exports=function t(e,n,o,a,s){return e===n||(null==e||null==n||!r(e)&&!r(n)?e!=e&&n!=n:i(e,n,o,a,t,s))}},function(t,e,n){"use strict";var i=n(81),r=n(84),o=n(85),a=1,s=2;t.exports=function(t,e,n,l,u,c){var h=n&a,d=t.length,f=e.length;if(d!=f&&!(h&&f>d))return!1;var p=c.get(t);if(p&&c.get(e))return p==e;var m=-1,v=!0,g=n&s?new i:void 0;for(c.set(t,e),c.set(e,t);++m<d;){var y=t[m],_=e[m];if(l)var b=h?l(_,y,m,e,t,c):l(y,_,m,t,e,c);if(void 0!==b){if(b)continue;v=!1;break}if(g){if(!r(e,function(t,e){if(!o(g,e)&&(y===t||u(y,t,n,l,c)))return g.push(e)})){v=!1;break}}else if(y!==_&&!u(y,_,n,l,c)){v=!1;break}}return c.delete(t),c.delete(e),v}},function(t,e,n){"use strict";var i=n(99),r=n(4),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=i(function(){return arguments}())?i:function(t){return r(t)&&a.call(t,"callee")&&!s.call(t,"callee")};t.exports=l},function(t,e,n){"use strict";(function(t){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(1),o=n(100),a="object"==i(e)&&e&&!e.nodeType&&e,s=a&&"object"==i(t)&&t&&!t.nodeType&&t,l=s&&s.exports===a?r.Buffer:void 0,u=(l?l.isBuffer:void 0)||o;t.exports=u}).call(e,n(35)(t))},function(t,e,n){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";var i=n(101),r=n(37),o=n(38),a=o&&o.isTypedArray,s=a?r(a):i;t.exports=s},function(t,e,n){"use strict";t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){"use strict";(function(t){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(29),o="object"==i(e)&&e&&!e.nodeType&&e,a=o&&"object"==i(t)&&t&&!t.nodeType&&t,s=a&&a.exports===o&&r.process,l=function(){try{return s&&s.binding&&s.binding("util")}catch(t){}}();t.exports=l}).call(e,n(35)(t))},function(t,e,n){"use strict";var i=n(5);t.exports=function(t){return t==t&&!i(t)}},function(t,e,n){"use strict";t.exports=function(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}}},function(t,e,n){"use strict";var i=n(42),r=n(16);t.exports=function(t,e){for(var n=0,o=(e=i(e,t)).length;null!=t&&n<o;)t=t[r(e[n++])];return n&&n==o?t:void 0}},function(t,e,n){"use strict";var i=n(0),r=n(23),o=n(114),a=n(6);t.exports=function(t,e){return i(t)?t:r(t,e)?[t]:o(a(t))}},function(t,e,n){"use strict";var i=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return i.test(t)}},function(t,e,n){"use strict";var i=n(152),r=n(153),o=n(154);t.exports=function(t,e,n){return e==e?o(t,e,n):i(t,r,n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WsReader=e.WsError=void 0;var i=n(17);Object.defineProperty(e,"WsError",{enumerable:!0,get:function(){return i.WsError}});var r=n(46),o=n(136),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(159));e.WsReader={getReader:function(){for(var t={ajax:a.ajax},e=(0,o.getBaseWsReader)(t),n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];return Object.assign.apply(Object,[e].concat(i)),Object.assign({},e,r.WsJsonReader)}}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.WsJsonReader=void 0;var r=i(n(47)),o=i(n(130)),a=i(n(135));e.WsJsonReader={_toPojo:function(t){var e=t.rows,n=t.headers;return(0,r.default)(e,function(t){return(0,o.default)(n,(0,r.default)(t,function(t){return(0,a.default)(t)?null:t}))})}}},function(t,e,n){"use strict";var i=n(26),r=n(48),o=n(124),a=n(0);t.exports=function(t,e){return(a(t)?i:o)(t,r(e,3))}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(49),o=n(112),a=n(120),s=n(0),l=n(121);t.exports=function(t){return"function"==typeof t?t:null==t?a:"object"==(void 0===t?"undefined":i(t))?s(t)?o(t[0],t[1]):r(t):l(t)}},function(t,e,n){"use strict";var i=n(50),r=n(111),o=n(40);t.exports=function(t){var e=r(t);return 1==e.length&&e[0][2]?o(e[0][0],e[0][1]):function(n){return n===t||i(n,t,e)}}},function(t,e,n){"use strict";var i=n(27),r=n(31),o=1,a=2;t.exports=function(t,e,n,s){var l=n.length,u=l,c=!s;if(null==t)return!u;for(t=Object(t);l--;){var h=n[l];if(c&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++l<u;){var d=(h=n[l])[0],f=t[d],p=h[1];if(c&&h[2]){if(void 0===f&&!(d in t))return!1}else{var m=new i;if(s)var v=s(f,p,d,t,e,m);if(!(void 0===v?r(p,f,o|a,s,m):v))return!1}}return!0}},function(t,e,n){"use strict";t.exports=function(){this.__data__=[],this.size=0}},function(t,e,n){"use strict";var i=n(9),r=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=i(e,t);return!(n<0||(n==e.length-1?e.pop():r.call(e,n,1),--this.size,0))}},function(t,e,n){"use strict";var i=n(9);t.exports=function(t){var e=this.__data__,n=i(e,t);return n<0?void 0:e[n][1]}},function(t,e,n){"use strict";var i=n(9);t.exports=function(t){return i(this.__data__,t)>-1}},function(t,e,n){"use strict";var i=n(9);t.exports=function(t,e){var n=this.__data__,r=i(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}},function(t,e,n){"use strict";var i=n(8);t.exports=function(){this.__data__=new i,this.size=0}},function(t,e,n){"use strict";t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},function(t,e,n){"use strict";t.exports=function(t){return this.__data__.get(t)}},function(t,e,n){"use strict";t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){"use strict";var i=n(8),r=n(18),o=n(19),a=200;t.exports=function(t,e){var n=this.__data__;if(n instanceof i){var s=n.__data__;if(!r||s.length<a-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new o(s)}return n.set(t,e),this.size=n.size,this}},function(t,e,n){"use strict";var i=n(28),r=n(65),o=n(5),a=n(30),s=/^\[object .+?Constructor\]$/,l=Function.prototype,u=Object.prototype,c=l.toString,h=u.hasOwnProperty,d=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!o(t)||r(t))&&(i(t)?d:s).test(a(t))}},function(t,e,n){"use strict";var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"===("undefined"==typeof window?"undefined":r(window))&&(i=window)}t.exports=i},function(t,e,n){"use strict";var i=n(11),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,s=i?i.toStringTag:void 0;t.exports=function(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var i=!0}catch(t){}var r=a.call(t);return i&&(e?t[s]=n:delete t[s]),r}},function(t,e,n){"use strict";var i=Object.prototype.toString;t.exports=function(t){return i.call(t)}},function(t,e,n){"use strict";var i=n(66),r=function(){var t=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=function(t){return!!r&&r in t}},function(t,e,n){"use strict";var i=n(1)["__core-js_shared__"];t.exports=i},function(t,e,n){"use strict";t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,n){"use strict";var i=n(69),r=n(8),o=n(18);t.exports=function(){this.size=0,this.__data__={hash:new i,map:new(o||r),string:new i}}},function(t,e,n){"use strict";function i(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}var r=n(70),o=n(71),a=n(72),s=n(73),l=n(74);i.prototype.clear=r,i.prototype.delete=o,i.prototype.get=a,i.prototype.has=s,i.prototype.set=l,t.exports=i},function(t,e,n){"use strict";var i=n(12);t.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(t,e,n){"use strict";t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,n){"use strict";var i=n(12),r="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(i){var n=e[t];return n===r?void 0:n}return o.call(e,t)?e[t]:void 0}},function(t,e,n){"use strict";var i=n(12),r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return i?void 0!==e[t]:r.call(e,t)}},function(t,e,n){"use strict";var i=n(12),r="__lodash_hash_undefined__";t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=i&&void 0===e?r:e,this}},function(t,e,n){"use strict";var i=n(13);t.exports=function(t){var e=i(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){var e=void 0===t?"undefined":i(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,n){"use strict";var i=n(13);t.exports=function(t){return i(this,t).get(t)}},function(t,e,n){"use strict";var i=n(13);t.exports=function(t){return i(this,t).has(t)}},function(t,e,n){"use strict";var i=n(13);t.exports=function(t,e){var n=i(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}},function(t,e,n){"use strict";var i=n(27),r=n(32),o=n(86),a=n(90),s=n(106),l=n(0),u=n(34),c=n(36),h=1,d="[object Arguments]",f="[object Array]",p="[object Object]",m=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,v,g,y){var _=l(t),b=l(e),x=_?f:s(t),w=b?f:s(e),S=(x=x==d?p:x)==p,M=(w=w==d?p:w)==p,E=x==w;if(E&&u(t)){if(!u(e))return!1;_=!0,S=!1}if(E&&!S)return y||(y=new i),_||c(t)?r(t,e,n,v,g,y):o(t,e,x,n,v,g,y);if(!(n&h)){var z=S&&m.call(t,"__wrapped__"),k=M&&m.call(e,"__wrapped__");if(z||k){var T=z?t.value():t,O=k?e.value():e;return y||(y=new i),g(T,O,n,v,y)}}return!!E&&(y||(y=new i),a(t,e,n,v,g,y))}},function(t,e,n){"use strict";function i(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new r;++e<n;)this.add(t[e])}var r=n(19),o=n(82),a=n(83);i.prototype.add=i.prototype.push=o,i.prototype.has=a,t.exports=i},function(t,e,n){"use strict";var i="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,i),this}},function(t,e,n){"use strict";t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){"use strict";t.exports=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}},function(t,e,n){"use strict";t.exports=function(t,e){return t.has(e)}},function(t,e,n){"use strict";var i=n(11),r=n(87),o=n(10),a=n(32),s=n(88),l=n(89),u=1,c=2,h="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Map]",m="[object Number]",v="[object RegExp]",g="[object Set]",y="[object String]",_="[object Symbol]",b="[object ArrayBuffer]",x="[object DataView]",w=i?i.prototype:void 0,S=w?w.valueOf:void 0;t.exports=function(t,e,n,i,w,M,E){switch(n){case x:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case b:return!(t.byteLength!=e.byteLength||!M(new r(t),new r(e)));case h:case d:case m:return o(+t,+e);case f:return t.name==e.name&&t.message==e.message;case v:case y:return t==e+"";case p:var z=s;case g:var k=i&u;if(z||(z=l),t.size!=e.size&&!k)return!1;var T=E.get(t);if(T)return T==e;i|=c,E.set(t,e);var O=a(z(t),z(e),i,w,M,E);return E.delete(t),O;case _:if(S)return S.call(t)==S.call(e)}return!1}},function(t,e,n){"use strict";var i=n(1).Uint8Array;t.exports=i},function(t,e,n){"use strict";t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}},function(t,e,n){"use strict";t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}},function(t,e,n){"use strict";var i=n(91),r=1,o=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,a,s,l){var u=n&r,c=i(t),h=c.length;if(h!=i(e).length&&!u)return!1;for(var d=h;d--;){var f=c[d];if(!(u?f in e:o.call(e,f)))return!1}var p=l.get(t);if(p&&l.get(e))return p==e;var m=!0;l.set(t,e),l.set(e,t);for(var v=u;++d<h;){var g=t[f=c[d]],y=e[f];if(a)var _=u?a(y,g,f,e,t,l):a(g,y,f,t,e,l);if(!(void 0===_?g===y||s(g,y,n,a,l):_)){m=!1;break}v||(v="constructor"==f)}if(m&&!v){var b=t.constructor,x=e.constructor;b!=x&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x)&&(m=!1)}return l.delete(t),l.delete(e),m}},function(t,e,n){"use strict";var i=n(92),r=n(94),o=n(20);t.exports=function(t){return i(t,o,r)}},function(t,e,n){"use strict";var i=n(93),r=n(0);t.exports=function(t,e,n){var o=e(t);return r(t)?o:i(o,n(t))}},function(t,e,n){"use strict";t.exports=function(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}},function(t,e,n){"use strict";var i=n(95),r=n(96),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(t){return null==t?[]:(t=Object(t),i(a(t),function(e){return o.call(t,e)}))}:r;t.exports=s},function(t,e,n){"use strict";t.exports=function(t,e){for(var n=-1,i=null==t?0:t.length,r=0,o=[];++n<i;){var a=t[n];e(a,n,t)&&(o[r++]=a)}return o}},function(t,e,n){"use strict";t.exports=function(){return[]}},function(t,e,n){"use strict";var i=n(98),r=n(33),o=n(0),a=n(34),s=n(21),l=n(36),u=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=o(t),c=!n&&r(t),h=!n&&!c&&a(t),d=!n&&!c&&!h&&l(t),f=n||c||h||d,p=f?i(t.length,String):[],m=p.length;for(var v in t)!e&&!u.call(t,v)||f&&("length"==v||h&&("offset"==v||"parent"==v)||d&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,m))||p.push(v);return p}},function(t,e,n){"use strict";t.exports=function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}},function(t,e,n){"use strict";var i=n(3),r=n(4),o="[object Arguments]";t.exports=function(t){return r(t)&&i(t)==o}},function(t,e,n){"use strict";t.exports=function(){return!1}},function(t,e,n){"use strict";var i=n(3),r=n(22),o=n(4),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return o(t)&&r(t.length)&&!!a[i(t)]}},function(t,e,n){"use strict";var i=n(103),r=n(104),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!i(t))return r(t);var e=[];for(var n in Object(t))o.call(t,n)&&"constructor"!=n&&e.push(n);return e}},function(t,e,n){"use strict";var i=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||i)}},function(t,e,n){"use strict";var i=n(105)(Object.keys,Object);t.exports=i},function(t,e,n){"use strict";t.exports=function(t,e){return function(n){return t(e(n))}}},function(t,e,n){"use strict";var i=n(107),r=n(18),o=n(108),a=n(109),s=n(110),l=n(3),u=n(30),c=u(i),h=u(r),d=u(o),f=u(a),p=u(s),m=l;(i&&"[object DataView]"!=m(new i(new ArrayBuffer(1)))||r&&"[object Map]"!=m(new r)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(t){var e=l(t),n="[object Object]"==e?t.constructor:void 0,i=n?u(n):"";if(i)switch(i){case c:return"[object DataView]";case h:return"[object Map]";case d:return"[object Promise]";case f:return"[object Set]";case p:return"[object WeakMap]"}return e}),t.exports=m},function(t,e,n){"use strict";var i=n(2)(n(1),"DataView");t.exports=i},function(t,e,n){"use strict";var i=n(2)(n(1),"Promise");t.exports=i},function(t,e,n){"use strict";var i=n(2)(n(1),"Set");t.exports=i},function(t,e,n){"use strict";var i=n(2)(n(1),"WeakMap");t.exports=i},function(t,e,n){"use strict";var i=n(39),r=n(20);t.exports=function(t){for(var e=r(t),n=e.length;n--;){var o=e[n],a=t[o];e[n]=[o,a,i(a)]}return e}},function(t,e,n){"use strict";var i=n(31),r=n(113),o=n(117),a=n(23),s=n(39),l=n(40),u=n(16),c=1,h=2;t.exports=function(t,e){return a(t)&&s(e)?l(u(t),e):function(n){var a=r(n,t);return void 0===a&&a===e?o(n,t):i(e,a,c|h)}}},function(t,e,n){"use strict";var i=n(41);t.exports=function(t,e,n){var r=null==t?void 0:i(t,e);return void 0===r?n:r}},function(t,e,n){"use strict";var i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,o=n(115)(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(i,function(t,n,i,o){e.push(i?o.replace(r,"$1"):n||t)}),e});t.exports=o},function(t,e,n){"use strict";var i=n(116),r=500;t.exports=function(t){var e=i(t,function(t){return n.size===r&&n.clear(),t}),n=e.cache;return e}},function(t,e,n){"use strict";function i(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(o);var n=function n(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a)||o,a};return n.cache=new(i.Cache||r),n}var r=n(19),o="Expected a function";i.Cache=r,t.exports=i},function(t,e,n){"use strict";var i=n(118),r=n(119);t.exports=function(t,e){return null!=t&&r(t,e,i)}},function(t,e,n){"use strict";t.exports=function(t,e){return null!=t&&e in Object(t)}},function(t,e,n){"use strict";var i=n(42),r=n(33),o=n(0),a=n(21),s=n(22),l=n(16);t.exports=function(t,e,n){for(var u=-1,c=(e=i(e,t)).length,h=!1;++u<c;){var d=l(e[u]);if(!(h=null!=t&&n(t,d)))break;t=t[d]}return h||++u!=c?h:!!(c=null==t?0:t.length)&&s(c)&&a(d,c)&&(o(t)||r(t))}},function(t,e,n){"use strict";t.exports=function(t){return t}},function(t,e,n){"use strict";var i=n(122),r=n(123),o=n(23),a=n(16);t.exports=function(t){return o(t)?i(a(t)):r(t)}},function(t,e,n){"use strict";t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e,n){"use strict";var i=n(41);t.exports=function(t){return function(e){return i(e,t)}}},function(t,e,n){"use strict";var i=n(125),r=n(14);t.exports=function(t,e){var n=-1,o=r(t)?Array(t.length):[];return i(t,function(t,i,r){o[++n]=e(t,i,r)}),o}},function(t,e,n){"use strict";var i=n(126),r=n(129)(i);t.exports=r},function(t,e,n){"use strict";var i=n(127),r=n(20);t.exports=function(t,e){return t&&i(t,e,r)}},function(t,e,n){"use strict";var i=n(128)();t.exports=i},function(t,e,n){"use strict";t.exports=function(t){return function(e,n,i){for(var r=-1,o=Object(e),a=i(e),s=a.length;s--;){var l=a[t?s:++r];if(!1===n(o[l],l,o))break}return e}}},function(t,e,n){"use strict";var i=n(14);t.exports=function(t,e){return function(n,r){if(null==n)return n;if(!i(n))return t(n,r);for(var o=n.length,a=e?o:-1,s=Object(n);(e?a--:++a<o)&&!1!==r(s[a],a,s););return n}}},function(t,e,n){"use strict";var i=n(131),r=n(134);t.exports=function(t,e){return r(t||[],e||[],i)}},function(t,e,n){"use strict";var i=n(132),r=n(10),o=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];o.call(t,e)&&r(a,n)&&(void 0!==n||e in t)||i(t,e,n)}},function(t,e,n){"use strict";var i=n(133);t.exports=function(t,e,n){"__proto__"==e&&i?i(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},function(t,e,n){"use strict";var i=n(2),r=function(){try{var t=i(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=r},function(t,e,n){"use strict";t.exports=function(t,e,n){for(var i=-1,r=t.length,o=e.length,a={};++i<r;){var s=i<o?e[i]:void 0;n(a,t[i],s)}return a}},function(t,e,n){"use strict";t.exports=function(t){return null==t}},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.getBaseWsReader=function(t){return{init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._name="waffle",this._dataset=t.dataset,this._assetsPath=(0,c.default)(t.assetsPath||"/api/ddf/assets","/"),this._basepath=t.path,this._dataset_access_token=t.dataset_access_token,this.versionInfo={version:"2.5.0",build:1522324694627},this._basepath||console.error("There is no base path for waffle reader, please, consider to provide one")},getAsset:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._toDatasetPath(n.dataset||this._dataset),r=(0,h.default)(e,"/"),o=(0,a.default)(r,".json"),s=n.dataset_access_token||this._dataset_access_token?"dataset_access_token="+(n.dataset_access_token||this._dataset_access_token):"",l=this._assetsPath+"/"+i+"/"+r;return t.ajax({url:s?l+"?"+s:l,json:o})},_toDatasetPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if("default"===t)return t;var e=(0,u.default)(t,"#"),n=o(e,2),i=n[0],r=n[1];return i?i+"/"+(void 0===r?"master":r):"default"},read:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.dataset||this._dataset,o=(0,l.default)(r)?Object.assign({},e,{dataset:encodeURIComponent(r)}):e;this._dataset_access_token&&(o.dataset_access_token=this._dataset_access_token);var a=this._basepath+"?"+d.stringify(o),u=this._basepath;return t.ajax({url:a,json:!0}).then(function(t){var e=null;if((0,s.default)(t)?t.error?e=new p.WsError(p.WS_ERROR,t.error):t.message&&(e=new p.WsError(p.WS_MESSAGE,t.message)):e=new p.WsError(p.WS_BAD_RESPONSE,t),e){var r=Object.assign(e,{endpoint:u,url:a,ddfql:o});return Promise.reject(r)}return f.mapRows(n._toPojo(t),i)}).catch(function(t){var e=Object.assign(t,{endpoint:u,url:a,ddfql:o});return Promise.reject(e)})}}};var a=r(n(137)),s=r(n(5)),l=r(n(142)),u=r(n(143)),c=r(n(150)),h=r(n(155)),d=i(n(157)),f=i(n(158)),p=n(17)},function(t,e,n){"use strict";var i=n(138),r=n(7),o=n(139),a=n(6);t.exports=function(t,e,n){t=a(t),e=r(e);var s=t.length,l=n=void 0===n?s:i(o(n),0,s);return(n-=e.length)>=0&&t.slice(n,l)==e}},function(t,e,n){"use strict";t.exports=function(t,e,n){return t==t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}},function(t,e,n){"use strict";var i=n(140);t.exports=function(t){var e=i(t),n=e%1;return e==e?n?e-n:e:0}},function(t,e,n){"use strict";var i=n(141),r=1/0,o=1.7976931348623157e308;t.exports=function(t){return t?(t=i(t))===r||t===-r?(t<0?-1:1)*o:t==t?t:0:0===t?t:0}},function(t,e,n){"use strict";var i=n(5),r=n(15),o=NaN,a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(r(t))return o;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=l.test(t);return n||u.test(t)?c(t.slice(2),n?2:8):s.test(t)?o:+t}},function(t,e,n){"use strict";var i=n(3),r=n(0),o=n(4),a="[object String]";t.exports=function(t){return"string"==typeof t||!r(t)&&o(t)&&i(t)==a}},function(t,e,n){"use strict";var i=n(7),r=n(24),o=n(43),a=n(145),s=n(146),l=n(25),u=n(6),c=4294967295;t.exports=function(t,e,n){return n&&"number"!=typeof n&&a(t,e,n)&&(e=n=void 0),(n=void 0===n?c:n>>>0)?(t=u(t))&&("string"==typeof e||null!=e&&!s(e))&&!(e=i(e))&&o(t)?r(l(t),0,n):t.split(e,n):[]}},function(t,e,n){"use strict";t.exports=function(t,e,n){var i=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(n=n>r?r:n)<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(r);++i<r;)o[i]=t[i+e];return o}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(10),o=n(14),a=n(21),s=n(5);t.exports=function(t,e,n){if(!s(n))return!1;var l=void 0===e?"undefined":i(e);return!!("number"==l?o(n)&&a(e,n.length):"string"==l&&e in n)&&r(n[e],t)}},function(t,e,n){"use strict";var i=n(147),r=n(37),o=n(38),a=o&&o.isRegExp,s=a?r(a):i;t.exports=s},function(t,e,n){"use strict";var i=n(3),r=n(4),o="[object RegExp]";t.exports=function(t){return r(t)&&i(t)==o}},function(t,e,n){"use strict";t.exports=function(t){return t.split("")}},function(t,e,n){"use strict";var i="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",r="\\ud83c[\\udffb-\\udfff]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",l="[\\ufe0e\\ufe0f]?"+s+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",o,a].join("|")+")[\\ufe0e\\ufe0f]?"+s+")*"),u="(?:"+["[^\\ud800-\\udfff]"+i+"?",i,o,a,"[\\ud800-\\udfff]"].join("|")+")",c=RegExp(r+"(?="+r+")|"+u+l,"g");t.exports=function(t){return t.match(c)||[]}},function(t,e,n){"use strict";var i=n(7),r=n(24),o=n(151),a=n(25),s=n(6),l=/\s+$/;t.exports=function(t,e,n){if((t=s(t))&&(n||void 0===e))return t.replace(l,"");if(!t||!(e=i(e)))return t;var u=a(t),c=o(u,a(e))+1;return r(u,0,c).join("")}},function(t,e,n){"use strict";var i=n(44);t.exports=function(t,e){for(var n=t.length;n--&&i(e,t[n],0)>-1;);return n}},function(t,e,n){"use strict";t.exports=function(t,e,n,i){for(var r=t.length,o=n+(i?1:-1);i?o--:++o<r;)if(e(t[o],o,t))return o;return-1}},function(t,e,n){"use strict";t.exports=function(t){return t!=t}},function(t,e,n){"use strict";t.exports=function(t,e,n){for(var i=n-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}},function(t,e,n){"use strict";var i=n(7),r=n(24),o=n(156),a=n(25),s=n(6),l=/^\s+/;t.exports=function(t,e,n){if((t=s(t))&&(n||void 0===e))return t.replace(l,"");if(!t||!(e=i(e)))return t;var u=a(t),c=o(u,a(e));return r(u,c).join("")}},function(t,e,n){"use strict";var i=n(44);t.exports=function(t,e){for(var n=-1,r=t.length;++n<r&&i(e,t[n],0)>-1;);return n}},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t){function e(t){return encodeURI(t.replace(/([=:&@_;\/])/g,"/$1"))}return function t(n){if("number"==typeof n||!0===n||!1===n||null===n)return":"+n;if(n instanceof Array){for(var r=[],o=0;o<n.length;++o)r.push(t(n[o]));return"@"+r.join("&")+";"}if("object"===(void 0===n?"undefined":i(n))){for(var a in r=[],n)r.push(e(a)+t(n[a]));return"_"+r.join("&")+";"}return"="+e((null!==n?void 0!==n?n:"undefined":"null").toString())}(t).replace(/;+$/g,"")},o=function(t){function e(){for(var e="";n!==t.length;++n){if("/"===t.charAt(n)){if((n+=1)===t.length){e+=";";break}}else if(t.charAt(n).match(/[=:&@_;]/))break;e+=t.charAt(n)}return e}var n=0;return t=decodeURI(t),function i(){var r=t.charAt(n++);if("="===r)return e();if(":"===r){var o=e();return"true"===o||"false"!==o&&(o=parseFloat(o),isNaN(o)?null:o)}if("@"===r){var a=[];t:if(!(n>=t.length||";"===t.charAt(n)))for(;;){if(a.push(i()),n>=t.length||";"===t.charAt(n))break t;n+=1}return n+=1,a}if("_"===r){a={};t:if(!(n>=t.length||";"===t.charAt(n)))for(;;){if(a[e()]=i(),n>=t.length||";"===t.charAt(n))break t;n+=1}return n+=1,a}throw"Unexpected char "+r}()};e.stringify=r,e.parse=o},function(t,e,n){"use strict";function i(t){if(""===t||null===t)return null;if(!t.trim)return t;if(null==t.trim().match(/^[0-9.,]+$/))return t;var e=parseFloat(t);return isNaN(e)||!isFinite(e)?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.mapRows=void 0;var r=function(t){return t&&t.__esModule?t:{default:t}}(n(0));e.mapRows=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.map(function(t){return Object.keys(t).forEach(function(n){t[n]=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;return(0,r.default)(e)?e.map(function(e){return t(e,n)}):n(e)}(t[n],e[n])}),t})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0,n(160);var i=n(17),r=500;e.ajax=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.url,n=void 0===e?"":e,o=t.json,a=void 0!==o&&o,s={};return a&&(s["Content-Type"]="text/plain; charset=UTF-8"),fetch(n,{method:"GET",headers:s}).then(function(t){if(!t.ok)throw new i.WsError(i.WS_RESPONSE_ERROR,t.error);return t}).then(function(t){return a?t.json():t.text()}).catch(function(t){if("WaffleServerError"===t.name)throw t;var e=t.response?t.response.status:r;throw new i.WsError(i.NETWORK_ERROR+" with status code "+e,t)})}},function(t,e,n){"use strict";!function(t){function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function n(t){return"string"!=typeof t&&(t=String(t)),t}function i(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return p.iterable&&(e[Symbol.iterator]=function(){return e}),e}function r(t){this.map={},t instanceof r?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function o(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function a(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function s(t){var e=new FileReader,n=a(e);return e.readAsArrayBuffer(t),n}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function u(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(p.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(p.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(p.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(p.arrayBuffer&&p.blob&&v(t))this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!p.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!g(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=a(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(t,e){var n=(e=e||{}).body;if(t instanceof c){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new r(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new r(e.headers)),this.method=function(t){var e=t.toUpperCase();return y.indexOf(e)>-1?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function h(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}}),e}function d(t){var e=new r;return t.split(/\r?\n/).forEach(function(t){var n=t.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();e.append(i,r)}}),e}function f(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new r(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var p={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(p.arrayBuffer)var m=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(t){return t&&DataView.prototype.isPrototypeOf(t)},g=ArrayBuffer.isView||function(t){return t&&m.indexOf(Object.prototype.toString.call(t))>-1};r.prototype.append=function(t,i){t=e(t),i=n(i);var r=this.map[t];this.map[t]=r?r+","+i:i},r.prototype.delete=function(t){delete this.map[e(t)]},r.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(t,i){this.map[e(t)]=n(i)},r.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},r.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),i(t)},r.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),i(t)},r.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),i(t)},p.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];c.prototype.clone=function(){return new c(this,{body:this._bodyInit})},u.call(c.prototype),u.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},f.error=function(){var t=new f(null,{status:0,statusText:""});return t.type="error",t};var _=[301,302,303,307,308];f.redirect=function(t,e){if(-1===_.indexOf(e))throw new RangeError("Invalid status code");return new f(null,{status:e,headers:{location:t}})},t.Headers=r,t.Request=c,t.Response=f,t.fetch=function(t,e){return new Promise(function(n,i){var r=new c(t,e),o=new XMLHttpRequest;o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:d(o.getAllResponseHeaders()||"")};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var e="response"in o?o.response:o.responseText;n(new f(e,t))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(r.method,r.url,!0),"include"===r.credentials&&(o.withCredentials=!0),"responseType"in o&&p.blob&&(o.responseType="blob"),r.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send(void 0===r._bodyInit?null:r._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:void 0)}]);t.exports=n},57:function(t,e){var i,r;i=this,r=function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=186)}([function(t,e,n){var i=n(3),r=n(22),o=n(14),a=n(15),s=n(23),l=function(t,e,n){var u,c,h,d,f=t&l.F,p=t&l.G,m=t&l.S,v=t&l.P,g=t&l.B,y=p?i:m?i[e]||(i[e]={}):(i[e]||{}).prototype,_=p?r:r[e]||(r[e]={}),b=_.prototype||(_.prototype={});for(u in p&&(n=e),n)h=((c=!f&&y&&void 0!==y[u])?y:n)[u],d=g&&c?s(h,i):v&&"function"==typeof h?s(Function.call,h):h,y&&a(y,u,h,t&l.U),_[u]!=h&&o(_,u,d),v&&b[u]!=h&&(b[u]=h)};i.core=r,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getOSname=e.normaliseLink=e.getBrowserDetails=e.getSubtitle=e.replaceNumberSpacesToNonBreak=e.px2num=e.getProp=e.isFunction=e.isMobileOrTablet=e.capitalize=e.setIcon=e.pruneTree=e.isTouchDevice=e.debounce=e.memoize=e.post=e.get=e.ajax=e.interpolatePoint=e.interpolateVector=e.nestArrayToValues=e.nestArrayToObjWithFlatKeys=e.nestArrayToObj=e.hashCode=e.clearDelay=e.delay=e.defer=e.diffObject=e.arrayLast=e.arrayMedian=e.arraySum=e.arrayMean=e.arrayMax=e.arrayMin=e.values=e.keys=e.throttle=e.hasClass=e.classed=e.removeClass=e.addClass=e.countDecimals=e.error=e.groupEnd=e.groupCollapsed=e.warn=e.timeStamp=e.areaToRadius=e.cathetus=e.hypotenuse=e.radiusToArea=e.preventAncestorScrolling=e.matchAny=e.filterAny=e.filter=e.find=e.uniqueLast=e.unique=e.without=e.deepClone=e.clone=e.merge=e.deepExtend=e.extend=e.forEach=e.strToFloat=e.roundStep=e.findScrollableAncestor=e.getViewportPosition=e.comparePlainObjects=e.deepArrayEquals=e.arrayEquals=e.isPlainObject=e.isNumber=e.isEmpty=e.isNaN=e.isString=e.isDate=e.isObject=e.isArray=e.isElement=e.uniqueId=e.printAutoconfigResult=e.approxEqual=e.d3text=e.d3json=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.makeAbsoluteContext=function(t,e){return function(n,i){var r=e.getBoundingClientRect(),o=t.getScreenCTM();return{x:o.a*n+o.c*i+o.e-r.left,y:o.b*n+o.d*i+o.f-r.top}}},e.firstBy=function(){function t(t){return t}function e(t){return"string"==typeof t?t.toLowerCase():t}return function n(i,r){var o="function"==typeof this&&this;var a=function(n,i){if(i="number"==typeof i?{direction:i}:i||{},"function"!=typeof n){var r=n;n=function(t){return t[r]?t[r]:""}}if(1===n.length){var o=n,a=i.ignoreCase?e:t;n=function(t,e){return a(o(t))<a(o(e))?-1:a(o(t))>a(o(e))?1:0}}return-1===i.direction?function(t,e){return-n(t,e)}:n}(i,r);var s=o?function(t,e){return o(t,e)||a(t,e)}:a;s.thenBy=n;return s}},e.transform=function(t){var e=t.transform.baseVal.consolidate().matrix,n=e.a,i=e.b,r=e.c,o=e.d,a=e.e,s=e.f;return function(t,e,n,i,r,o){var a=void 0,s=void 0,l=void 0;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*Math.PI/180,skewX:Math.atan(l)*Math.PI/180,scaleX:a,scaleY:s}}(n,i,r,o,a,s)},e.getKey=function(t,e){for(var n=t[e[0]],i=1,r=e.length;i<r;i++)n=n+","+t[e[i]];return n};var r,o=n(390),a=(r=o)&&r.__esModule?r:{default:r};e.d3json=function(t,e){window.fetch&&-1===navigator.userAgent.toLowerCase().indexOf(" electron/")?fetch(t).then(function(t){if(t.ok)return t.json();e(new Error)}).then(function(t){e(null,t)}).catch(function(t){return e(t)}):d3.json(t,e)},e.d3text=function(t,e){window.fetch&&-1===navigator.userAgent.toLowerCase().indexOf(" electron/")?fetch(t).then(function(t){if(t.ok)return t.text();e(new Error)}).then(function(t){e(null,t)}).catch(function(t){return e(t)}):d3.text(t,e)},e.approxEqual=function(t,e,n){return n=n||0,e>0?(1-n)*e<=t&&t<=e*(1+n):e<0?(1+n)*e<=t&&t<=e*(1-n):Math.abs(t)<=n},e.printAutoconfigResult=function(t){console.info("AUTOCONFIG: "+t._name+(t.isHook()?" of "+t._parent._name:"")+" choses "+(t.dim||t.which)+" from "+(t.dataSource?t.dataSource._name:"<DATA SOURCE MISSING!>")+" to be "+("entities"===t._type||"time"===t._type?"DIM":"WHICH"))},e.uniqueId=(s=0,function(t){return t?t+(s+=1):s+=1}),e.isElement=function(t){return!(!t||1!==t.nodeType)};var s,l=e.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},u=e.isObject=function(t){return"object"===(void 0===t?"undefined":i(t))&&!!t},c=(e.isDate=function(t){return t instanceof Date},e.isString=function(t){return"string"==typeof t}),h=e.isNaN=function(t){return f(t)&&t!==+t},d=e.isEmpty=function(t){return 0===Object.keys(t).length&&t.constructor===Object},f=e.isNumber=function(t){return"number"==typeof t||!!t&&"object"===(void 0===t?"undefined":i(t))&&"[object Number]"===Object.prototype.toString.call(t)},p=e.isPlainObject=function(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)},m=(e.arrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0},e.deepArrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var n=0;n<t.length;++n)if(p(t[n])&&p(e[n])){if(!v(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}),v=e.comparePlainObjects=function(t,e){var n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e=void 0===t?"undefined":i(t);return"object"===e&&(e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]}(t).toLowerCase()),"number"===e?t.toString().indexOf(".")>0?"float":"integer":e},r=function(t,e){if(t===e)return!0;for(var n in t){if(!e.hasOwnProperty(n))return!1;if(!a(t[n],e[n]))return!1}for(var i in e)if(!t.hasOwnProperty(i))return!1;return!0},o={array:function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!a(t[n],e[n]))return!1;return!0}};o.object=r,o.date=function(t,e){return t.getTime()===e.getTime()},o.regexp=function(t,e){return t.toString()===e.toString()};var a=function(t,e){if(t!==e){var i=n(t);return i===n(e)&&(o.hasOwnProperty(i)?o[i](t,e):t==e)}return!0};return r(t,e)},g=(e.getViewportPosition=function(t){for(var e=0,n=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,n+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:n}},e.findScrollableAncestor=function(t){for(var e=["scroll","auto"];t=t.parentNode;){if(t.scrollHeight>t.clientHeight&&-1!==e.indexOf(d3.select(t).style("overflow")))return t}return null},e.roundStep=function(t,e){return Math.round(t/e)*e},e.strToFloat=function(t){return+t.replace(/[^\d.-]/g,"")},e.forEach=function(t,e,n){if(t){var i=void 0,r=void 0;if(l(t))for(r=t.length,i=0;i<r;i+=1){if(!1===e.apply(n,[t[i],i]))break}else{var o=Object.keys(t);for(r=o.length,i=0;i<r;i+=1){if(!1===e.apply(n,[t[o[i]],o[i]]))break}}}});e.extend=function(t){var e=Array.prototype.slice.call(arguments,1);return g(e,function(e,n){g(e,function(n,i){e.hasOwnProperty(i)&&(t[i]=n)})}),t};function y(t){return Boolean(t instanceof Date||t instanceof RegExp)}function _(t){if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);throw new Error("Unexpected situation")}function b(t){var e=[];return g(t,function(t,n){"object"===(void 0===t?"undefined":i(t))&&null!==t?l(t)?e[n]=b(t):y(t)?e[n]=_(t):e[n]=x({},t):e[n]=t}),e}var x=e.deepExtend=function t(){if(arguments.length<1||"object"!==i(arguments[0]))return!1;if(arguments.length<2)return arguments[0];var e=arguments[0],n="boolean"==typeof arguments[arguments.length-1],r=n&&arguments[arguments.length-1],o=Array.prototype.slice.call(arguments,1,n?-1:arguments.length),a=void 0,s=void 0;return g(o,function(n){"object"!==(void 0===n?"undefined":i(n))||l(n)||g(Object.keys(n),function(o){s=e[o],(a=n[o])===e||("object"!==(void 0===a?"undefined":i(a))||null===a||a._data?e[o]=a:l(a)?e[o]=b(a):y(a)?e[o]=_(a):"object"!==(void 0===s?"undefined":i(s))||null===s||l(s)?e[o]=t({},a):r&&d(a)?e[o]={}:e[o]=t(s,a,r))})}),e},w=(e.merge=function(t){var e=Array.prototype.slice.call(arguments,1);return g(e,function(e,n){g(e,function(n,i){e.hasOwnProperty(i)&&(t.hasOwnProperty(i)?(l(t[i])||(t[i]=[t[i]]),t[i].push(n)):t[i]=n)})}),t},e.clone=function(t,e,n){if(l(t))return t.slice(0);var i={};return g(t,function(r,o){e&&-1===e.indexOf(o)||n&&-1!==n.indexOf(o)||t.hasOwnProperty(o)&&(i[o]=r)}),i},e.deepClone=function t(e){var n={};return l(e)&&(n=[]),g(e,function(e,i){u(e)||l(e)?n[i]=t(e):n[i]=e}),n},e.without=function(t,e){var n=t.indexOf(e);return-1!==n&&t.splice(n,1),t},e.unique=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},n={};return t.filter(function(t){var i=e(t);return!n.hasOwnProperty(i)&&(n[i]=1,!0)})},e.uniqueLast=function(t,e){var n={},i=[];e||(e=function(t){return t});for(var r=0,o=t.length;r<o;r+=1){var a=e(t[r]);n.hasOwnProperty(a)&&i.splice(n[a],1),i.push(t[r]),n[a]=i.length-1}return i},e.find=function(t,e){var n=void 0;return g(t,function(t){if(e(t))return n=t,!1}),n},e.filter=function(t,e){for(var n=-1,i=t.length,r=-1,o=[],a=Object.keys(e),s=a.length,l=void 0,u=void 0;(n+=1)<i;){var c=t[n],h=!0;for(l=0;l<s;l+=1)if(u=a[l],!c.hasOwnProperty(u)||c[u]!==e[u]){h=!1;break}h&&(o[r+=1]=c)}return o},e.filterAny=function(t,e,n){for(var i=-1,r=t.length,o=-1,a=[],s=Object.keys(e),l=s.length,u=void 0,c=void 0;(i+=1)<r;){var h=t[i],d=!0;for(u=0;u<l;u+=1)if(c=s[u],!h.hasOwnProperty(c)||!w(h[c],e[c],n)){d=!1;break}d&&(a[o+=1]=h)}return a},e.matchAny=function(t,e,n){l(t)||(t=[t]),n||(n="*");for(var i=!1,r=0;r<t.length;r++){var o=t[r];if(!l(e)&&o==e){i=!0;break}if(l(e)){for(var a=-1,s=0;s<e.length;s++){var u=e[s];if(!(l(u)||u!=o&&u!==n)){a=s;break}if(l(u)){var c=u[0],h=u[1]||c;if(o>=c&&o<=h){a=s;break}}}if(-1!==a){i=!0;break}}}return i}),S=(e.preventAncestorScrolling=function(t){var e=!1;t.on("mousewheel",function(n,i){var r=this.scrollTop,o=this.scrollHeight,a=t.node().offsetHeight,s=d3.event.wheelDelta,l=s>0,u=function(t){return function(){var e=this,n=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=n(t)}}};if(l?l&&(s>r&&r>0?(t.transition().delay(0).duration(0).tween("scrolltween",u(0)),e=!0,setTimeout(function(){e=!1},2e3)):o==a+r&&(e=!1)):-s>o-a-r&&o!=a+r?(t.transition().delay(0).duration(0).tween("scrolltween",u(o)),e=!0,setTimeout(function(){e=!1},2e3)):0==r&&(e=!1),e)return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1})},e.radiusToArea=function(t){return t*t*Math.PI},e.hypotenuse=function(t,e){return Math.sqrt(t*t+e*e)},e.cathetus=function(t,e){return Math.sqrt(t*t-e*e)},e.areaToRadius=function(t){return Math.sqrt(t/Math.PI)},e.timeStamp=function(t){console&&"function"==typeof console.timeStamp&&console.timeStamp(t)},e.warn=function(t){return t=Array.prototype.slice.call(arguments).map(function(t){return t instanceof Object?JSON.stringify(t,null,4):t}).join(" "),console&&"function"==typeof console.warn&&console.warn(t),!0}),M=(e.groupCollapsed=function(t){t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.groupCollapsed&&console.groupCollapsed(t)},e.groupEnd=function(){console&&"function"==typeof console.groupEnd&&console.groupEnd()},e.error=function(t){console&&"function"==typeof console.error&&(t.stack?console.error(t.stack):console.error(t),arguments.length>1&&console.error.apply(this,Array.prototype.slice.call(arguments,1)))},e.countDecimals=function(t){return Math.floor(t.valueOf())===t.valueOf()?0:t.toString().split(".")[1].length||0},e.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e}),E=e.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},z=(e.classed=function(t,e,n){if(!0===n)M(t,e);else{if(!1!==n)return z(t,e);E(t,e)}},e.hasClass=function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}),k=(e.throttle=function(t,e){var n=!1,i=void 0,r=void 0,o=void 0,a=function(){n&&(n=!1,t.apply(r,i))},s=function(){if(o>Date.now())return n=!0,i=arguments,void(r=this);o=Date.now()+e,n=!1,t.apply(this,arguments),setTimeout(function(){a()},e)};return s.recallLast=a,s},e.keys=function(t){return Object.keys(t)},e.values=function(t){for(var e=[],n=Object.keys(t),i=n.length,r=0;r<i;r+=1)e.push(t[n[r]]);return e},e.arrayMin=function(t){return t.reduce(function(t,e){return t<e?t:e})},e.arrayMax=function(t){return t.reduce(function(t,e){return t>e?t:e})},e.arrayMean=function(t){return k(t)/t.length},e.arraySum=function(t){return t.reduce(function(t,e){return t+e})}),T=(e.arrayMedian=function(t){t=t.sort(function(t,e){return t-e});var e=Math.floor((t.length-1)/2);return t.length%2?t[e]:(t[e]+t[e+1])/2},e.arrayLast=function(t){return t.length?t[t.length-1]:null},e.diffObject=function t(e,n){var i={};return g(n,function(n,r){!e.hasOwnProperty(r)&&p(n)&&(i[r]=t({},n))}),g(e,function(e,r){if(n.hasOwnProperty(r)){if(e!==n[r])if(p(e)&&p(n[r]))if(d(e))d(n[r])||(i[r]={});else{var o=t(e,n[r]);Object.keys(o).length>0&&(i[r]=o)}else l(e)&&l(n[r])&&m(e,n[r])||(i[r]=e)}else i[r]=e}),i},e.defer=function(t){setTimeout(t,1)},e.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},e.clearDelay=function(t){return clearTimeout(t)},e.hashCode=function(t){c(t)||(t=JSON.stringify(t));var e=0,n=t.length;if(0===n)return e;for(var i=0;i<n;i+=1)e=(e<<5)-e+t.charCodeAt(i),e&=e;return e.toString()},e.nestArrayToObj=function t(e){if(!e||!e.length||!e[0].key)return e;for(var n={},i=0;i<e.length;i++)n[e[i].key]=t(e[i].values);return n},e.nestArrayToObjWithFlatKeys=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e||!e.length||!e[0].key)return i?(!n[i+="]"]&&(n[i]={}),n[i][r]=e):n[r]=e,e;r&&(i=i?i+","+JSON.stringify(r):"["+JSON.stringify(r));for(var o=0;o<e.length;o++)t(e[o].values||e[o].value,n,i,e[o].key);return n},e.nestArrayToValues=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e&&e.length&&e[0].key){for(var i=0;i<e.length;i++)t(e[i].values||e[i].value,n);return n}n.push.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(e))},e.interpolateVector=function(){},e.interpolatePoint=function(t,e,n,i,r,o,s,l){if(!t||0===t.length)return S("interpolatePoint failed because incoming array is empty. It was "+n),null;if("constant"===e)return n;if("property"===e)return t[0][n];if(l){if(o-t[0][r]<=0)return t[0][n];if(o-t[t.length-1][r]>=0)return t[t.length-1][n]}else if(o<t[0][r]||o>t[t.length-1][r])return null;if(i||0===i||(i=d3.bisectLeft(t.map(function(t){return t[r]}),o)),0===i)return t[0][n];if(void 0===t[i]||null===t[i][n]||null===t[i-1][n]||""===t[i][n])return S("interpolatePoint failed because next/previous points are bad in "+n),null;var u=a.default[s||"linear"](t[i-1][r],t[i][r],t[i-1][n],t[i][n],o);return n===r&&(u=new Date(u)),h(u)&&(S("interpolatePoint failed because result is NaN. It was "+n),u=null),u},e.ajax=function(t){var e=new XMLHttpRequest;e.open(t.method,t.url,!0),"POST"!==t.method||t.json?"POST"===t.method&&t.json&&e.setRequestHeader("Content-Type","application/json; charset=UTF-8"):e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onload=function(){if(e.status>=200&&e.status<400){var n=t.json?JSON.parse(e.responseText):e.responseText;t.success&&t.success(n)}else t.error&&t.error()},e.onerror=function(){t.error&&t.error()},e.send(t.data)});e.get=function(t,e,n,i,r){g(e=e||[],function(t,n){e.push(n+"="+t)}),t=e.length?t+"?"+e.join("&"):t,T({method:"GET",url:t,success:n,error:i,json:r})},e.post=function(t,e,n,i,r){T({method:"POST",url:t,success:n,error:i,json:r,data:e})},e.memoize=function(t){return function(){for(var e=Array.prototype.slice.call(arguments),n="",i=e.length,r=null;i--;)n+=(r=e[i])===Object(r)?JSON.stringify(r):r,t.memoize||(t.memoize={});return n in t.memoize?t.memoize[n]:t.memoize[n]=t.apply(this,e)}},e.debounce=function(t,e,n){var i=void 0;return function(){var r=this,o=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,o)},e),a&&t.apply(r,o)}},e.isTouchDevice=function(){return null!=((d3.event||{}).sourceCapabilities||{}).firesTouchEvents?d3.event.sourceCapabilities.firesTouchEvents:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},e.pruneTree=function t(e,n){var i={},r=[];return e.hasOwnProperty("children")&&(r=e.children.map(function(e){return t(e,n)}).filter(function(t){return 0!==Object.keys(t).length})),(0!=r.length||n(e))&&g(e,function(t,e){i[e]=t}),0!=r.length&&(i.children=r),i},e.setIcon=function(t,e){return t.selectAll("*").remove(),t.node().appendChild(t.node().ownerDocument.importNode((new DOMParser).parseFromString(e,"application/xml").documentElement,!0)),t};e.capitalize=function(t){return t.slice(0,1).toUpperCase()+t.slice(1).toLowerCase()},e.isMobileOrTablet=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4))};e.isFunction=function(t){return"function"==typeof t},e.getProp=function(t,e,n){for(;e.length;){var i=e.shift();if(!t.hasOwnProperty(i))return n;t=t[i]}return t},e.px2num=function(t){return c(t)&&t.endsWith("px")?parseFloat(t):console.warn("Strange pixels value: "+t)||t},e.replaceNumberSpacesToNonBreak=function(t){return t?t.replace(/\d{1,3}(?: \d{3})+(?=\W)/g,function(t){return t.replace(/ /g," ")}):t},e.getSubtitle=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],n=t.replace(e,"");","===n[0]&&(n=n.slice(1));var i=/^\((.*)\)$|.*/.exec(n.trim());return i[1]||i[0]||""},e.getBrowserDetails=function(){navigator.appVersion;var t=navigator.userAgent,e=navigator.appName,n=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10),r=void 0,o=void 0,a=void 0,s=navigator.userAgent.toLowerCase().indexOf(" electron/")>-1;return-1!=(o=t.indexOf("Opera"))?(e="Opera",n=t.substring(o+6),-1!=(o=t.indexOf("Version"))&&(n=t.substring(o+8))):-1!=(o=t.indexOf("MSIE"))?(e="Microsoft Internet Explorer",n=t.substring(o+5)):-1!=(o=t.indexOf("Chrome"))?(e="Chrome",n=t.substring(o+7)):-1!=(o=t.indexOf("Safari"))?(e="Safari",n=t.substring(o+7),-1!=(o=t.indexOf("Version"))&&(n=t.substring(o+8))):-1!=(o=t.indexOf("Firefox"))?(e="Firefox",n=t.substring(o+8)):(r=t.lastIndexOf(" ")+1)<(o=t.lastIndexOf("/"))&&(e=t.substring(r,o),n=t.substring(o+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),-1!=(a=n.indexOf(";"))&&(n=n.substring(0,a)),-1!=(a=n.indexOf(" "))&&(n=n.substring(0,a)),i=parseInt(""+n,10),h(i)&&(n=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10)),(s?"Electron ":"")+e+" "+i+" ("+n+")"},e.normaliseLink=function(t){return 0===t.indexOf("http://")||0===t.indexOf("https://")?t:0===t.indexOf("//")?"http://"+t.slice(2):"http://"+t},e.getOSname=function(){var t="Unknown";return-1!=window.navigator.userAgent.indexOf("Windows NT 10.0")&&(t="Windows 10"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(t="Windows 8"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(t="Windows 7"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(t="Windows Vista"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(t="Windows XP"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(t="Windows 2000"),-1!=window.navigator.userAgent.indexOf("Mac")&&(t="Mac/iOS"),-1!=window.navigator.userAgent.indexOf("X11")&&(t="UNIX"),-1!=window.navigator.userAgent.indexOf("Linux")&&(t="Linux"),t}},function(t,e,n){var i=n(5);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=l(n(49)),o=l(n(48)),a=l(n(110)),s=n(21);function l(t){return t&&t.__esModule?t:{default:t}}var u={},c=r.default.extend({init:function(t,e){if(this._id=this._id||i.uniqueId("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||t.name||this._id,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||t.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!i.isElement(this.placeholder))try{this.placeholder=e.placeholder.querySelector(this.placeholder)}catch(t){i.error("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=e||null,this.root=this.parent?this.parent.root:this,this.components=this.components||[],this._components_config=this.components.map(function(t){return i.clone(t)}),this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.createModel(t.model),this.ui=this.model.ui||this.ui||t.ui,this._super(),this.registerListeners()},createModel:function(t){this.model=this._modelMapping(t)},registerListeners:function(){this.on({readyOnce:this.readyOnce,ready:this.ready,domReady:this.domReady,resize:this.resize})},startPreload:function(){var t=[];return t.push(this.preload()),i.forEach(this.components,function(e){return t.push(e.startPreload())}),Promise.all(t)},preload:function(){return Promise.resolve()},afterPreload:function(){this.model&&this.model.afterPreload(),i.forEach(this.components,function(t){t.afterPreload()})},render:function(){this.prerender(),this.postrender()},prerender:function(){this.loadTemplate(),this.loadSubComponents()},postrender:function(){var t=this;i.forEach(this.components,function(e){e.render(),t.on("resize",function(){e.trigger("resize")})}),this.startLoading()},startLoading:function(){var t=this;this.model.on("ready",function(){t.loadingDone()}),this.model&&this.model.isLoading()||this.loadingDone()},loadingDone:function(){i.removeClass(this.placeholder,"vzb-loading-first"),i.removeClass(this.placeholder,"vzb-loading-data"),this.setReady()},renderError:function(t){var e=this;if(!t)return i.warn("renderError() was called without any specific error. Not rendering anything then.");if(i.hasClass(this.placeholder,"vzb-error"))return i.warn("The app is already showing error dialog. Not rendering again.");i.removeClass(this.placeholder,"vzb-loading-first"),i.removeClass(this.placeholder,"vzb-loading-data"),i.addClass(this.placeholder,"vzb-error");var n=JSON.stringify(t,null,2);"{}"==n&&(n=t.stack);var r=this.model._root.locale.getTFunction(),o="mailto:angie@gapminder.org?subject=Gapminder Vizabi error report&body=Hi Angie! Please have a look at this! %0D%0A %0D%0A %0D%0A\n      These are the steps to reproduce the error: %0D%0A \n      1. Go to "+window.location.origin+" %0D%0A \n      2. %5Bplease write here what you did%5D %0D%0A %0D%0A %0D%0A"+encodeURIComponent(n);this.errorMessageEl.classed("vzb-hidden",!1);var a=this.errorMessageEl.select(".vzb-error-message-technical").html(n);this.errorMessageEl.select(".vzb-error-message-expand").on("click",function(){return a.classed("vzb-hidden",!a.classed("vzb-hidden"))}).html(r("crash/expand")),this.errorMessageEl.select(".vzb-error-message-close").on("click",function(){e.errorMessageEl.classed("vzb-hidden",!0),i.removeClass(e.placeholder,"vzb-error")}),this.errorMessageEl.select(".vzb-error-message-title").select("h1").html(t.icon||"🙄");var s="crash/intro",l="crash/outro",u={};r(t.name)!==t.name&&(s="reader/error/generic",l=t.name,"reader/error/wrongTimeUnitsOrColumn"===t.name&&(u={expected:this.model._root.state.time.getFormatter()(new Date),found:t.details}),"reader/error/repeatedKeys"===t.name&&(u=t.details),"reader/error/undefinedDelimiter"===t.name&&(u={file:t.endpoint})),this.errorMessageEl.select(".vzb-error-message-intro").html(r(s,u).replace("mailto",o)),this.errorMessageEl.select(".vzb-error-message-outro").html(r(l,u).replace("mailto",o)),i.error(n)},setReady:function(t){this._readyOnce||(this.trigger("readyOnce"),this._readyOnce=!0),this._ready=!0,this.trigger("ready")},loadTemplate:function(){var t=this.template,e=this.template_data,n="";if(this.placeholder){if(e=i.extend(e,{t:this.getTranslationFunction(!0)}),this.template)try{n=function t(e,n){var i=/<[a-z][\s\S]*>/i.test(e)?function(t){return e.replace(/<%=([^%]*)%>/g,function(e){var n=e.match(/t\s*\(([^)]+)\)/g);return n.length?n=t.t(n[0].match(/"([^"]+)"/g)[0].split('"').join("")):(n=e.match(/([a-z\-A-Z]+([a-z\-A-Z0-9]?[a-zA-Z0-9]?)?)/g)[0],n=t[n]||n),n})}:u[e]=u[e]||t(a.default.templates[e]);return n?i(n):i}(t,e)}catch(t){var r=new Error;r.name="template",r.message="Templating error for component. Check if template name is unique and correct",r.details=this.name,this.renderError(r)}i.addClass(this.placeholder,"vzb-loading-data"),i.addClass(this.placeholder,"vzb-loading-first"),this.placeholder.innerHTML=n,this.element=this.placeholder.children[0],this.errorMessageEl=d3.select(this.element).append("div").attr("class","vzb-error-message vzb-hidden").html('\n        <div class="vzb-error-message-background"></div>\n        <div class="vzb-error-message-box">\n          <div class="vzb-error-message-close">'+s.close+'</div>\n          <div class="vzb-error-message-title"><h1></h1></div>\n          <div class="vzb-error-message-body">\n            <p class="vzb-error-message-intro"></p>\n            <br>\n            <p class="vzb-error-message-expand"></p>\n            <textarea class="vzb-error-message-technical vzb-hidden"></textarea>\n            <br>\n            <p class="vzb-error-message-outro"></p>\n          </div>\n        </div>\n      '),this.trigger("domReady")}},getActiveProfile:function(t,e){var n=this.getLayoutProfile(),r=this.getPresentationMode(),o=i.deepClone(t[n]);return r&&(e||{})[n]&&i.deepExtend(o,e[n]),o},loadSubComponents:function(){var t=this,e=void 0,n=void 0;this.components=[],i.forEach(this._components_config,function(r){if(r.model=r.model||{},r.component){if(n=i.isString(r.component)?c.get(r.component):r.component){e=i.extend(r,{name:r.component,ui:t._uiMapping(r.placeholder,r.ui)});var o=new n(e,t);t.components.push(o)}}else i.error("Error loading component: name not provided")})},findChildByName:function(t){return i.find(this.components,function(e){return e.name===t})},getLayoutProfile:function(){return this.model.ui?this.model.ui.currentProfile():this.parent.getLayoutProfile()},getPresentationMode:function(){return this.model.ui?this.model.ui.getPresentationMode():this.parent.getPresentationMode()},_uiMapping:function(t,e){if(e)return new o.default("ui",e);if(t&&this.ui){t=t.replace(".","");var n=this.ui[t];if(n)return n}return this.ui},_modelMapping:function(t){var e=this,n={};if(i.isArray(t)&&i.isArray(this.model_expects)){this.model_expects.length!==t.length&&(i.groupCollapsed("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),i.warn("Please, configure the 'model_expects' attribute accordingly in '"+this.name+"' or check the models passed in '"+e.parent.name+"'.\n\nComponent: '"+e.parent.name+"'\nSubcomponent: '"+this.name+"'\nNumber of Models Expected: "+this.model_expects.length+"\nNumber of Models Received: "+t.length),i.groupEnd()),i.forEach(t,function(r,o){if(r){var a=function(t){var n=t.split("."),i=e.parent.model,r="";for(;n.length;)r=n.shift(),i=i[r];return{name:t,model:i,type:i?i.getType():null}}(r),s=void 0;e.model_expects[o]?(s=e.model_expects[o].name,!e.model_expects[o].type||a.type===e.model_expects[o].type||i.isArray(e.model_expects[o].type)&&-1!==e.model_expects[o].type.indexOf(a.type)||(i.groupCollapsed("UNEXPECTED MODEL TYPE: '"+a.type+"' instead of '"+e.model_expects[o].type+"'"),i.warn("Please, configure the 'model_expects' attribute accordingly in '"+e.name+"' or check the models passed in '"+e.parent.name+"'.\n\nComponent: '"+e.parent.name+"'\nSubcomponent: '"+e.name+"'\nExpected Model: '"+e.model_expects[o].type+"'\nReceived Model: '"+a.type+"'\nModel order: "+o),i.groupEnd())):(i.groupCollapsed("UNEXPECTED MODEL: '"+t[o]+"'"),i.warn("Please, configure the 'model_expects' attribute accordingly in '"+e.name+"' or check the models passed in '"+e.parent.name+"'.\n\nComponent: '"+e.parent.name+"'\nSubcomponent: '"+e.name+"'\nNumber of Models Expected: "+e.model_expects.length+"\nNumber of Models Received: "+t.length),i.groupEnd(),s=a.name),n[s]=a.model}});var r=t.length,a=this.model_expects.length;return a>r&&(this.model_expects.splice(0,r),i.forEach(a,function(t){n[t.name]={}})),new o.default(this.name,n,null,this.model_binds)}},getTranslationFunction:function(t){var e=void 0;try{e=this.model.get("locale").getTFunction()}catch(t){this.parent&&this.parent!==this&&(e=this.parent.getTranslationFunction())}return e||(e=function(t){return t}),t?this._translatedStringFunction(e):e},_translatedStringFunction:function(t){return function(e){return'<span data-vzb-translate="'+e+'">'+t(e)+"</span>"}},translateStrings:function(){var t=this.getTranslationFunction(),e=this.placeholder.querySelectorAll("[data-vzb-translate]");0!==e.length&&i.forEach(e,function(e){e&&e.getAttribute&&(e.innerHTML=t(e.getAttribute("data-vzb-translate")))})},readyOnce:function(){},ready:function(){},resize:function(){},domReady:function(){},clear:function(){this.freeze(),this.model&&this.model.freeze(),i.forEach(this.components,function(t){t.clear()})}});c.isComponent=function(t){return t._id&&("t"===t._id[0]||"c"===t._id[0])},e.default=c},function(t,e,n){var i=n(61)("wks"),r=n(39),o=n(3).Symbol,a="function"==typeof o;(t.exports=function(t){return i[t]||(i[t]=a&&o[t]||(a?o:r)("Symbol."+t))}).store=i},function(t,e,n){t.exports=!n(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,n){var i=n(2),r=n(113),o=n(26),a=Object.defineProperty;e.f=n(8)?Object.defineProperty:function(t,e,n){if(i(t),e=o(e,!0),i(n),r)try{return a(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var i=n(28),r=Math.min;t.exports=function(t){return t>0?r(i(t),9007199254740991):0}},function(t,e,n){var i=n(27);t.exports=function(t){return Object(i(t))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=a(n(6)),o=n(21);function a(t){return t&&t.__esModule?t:{default:t}}var s=(0,a(n(105)).default)(n(402)),l=r.default.extend({isDialog:!0,init:function(t,e){this.name=this.name||"",this.model_expects=this.model_expects||[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this.template=s[this.name],this._super(t,e),this.transitionEvents=["webkitTransitionEnd","transitionend","msTransitionEnd","oTransitionEnd"]},readyOnce:function(){this.element=d3.select(this.element),this.titleEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-title"),this.buttonsEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-buttons"),this.contentEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-content")},ready:function(){var t=this;this.placeholderEl=d3.select(this.placeholder),this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),this.dragHandler=this.placeholderEl.select("[data-click='dragDialog']"),this.dragHandler.html(o.drag),this.pinIcon=this.placeholderEl.select("[data-click='pinDialog']"),this.pinIcon.html(o.pin),this.topPos="";var e,n,r,a,s,l,u,c,h,d,f,p,m,v,g,y,_,b=this.getLayoutProfile(),x=(e=this.placeholderEl,n=this.rootEl,r=10,a=void 0,s=void 0,l=void 0,u=void 0,c=void 0,h=void 0,d=void 0,f=void 0,p=void 0,m=void 0,v=void 0,g=void 0,y=void 0,_=void 0,{move:function(t,n){e.style("right",t+"px"),e.style("top",n+"px")},dragStart:function(t){if(i.isTouchDevice()){var o=d3.touches(n.node());a=o[0][0],s=o[0][1]}else a=t.sourceEvent.clientX,s=t.sourceEvent.clientY;l=parseInt(e.style("top"))||0,u=parseInt(e.style("right"))||0,h=parseInt(e.style("margin-left"))||0,c=parseInt(e.style("margin-right"))||0,f=Math.min(r,h),d=Math.min(r,c),p=parseInt(e.style("width"),10)+h-f||0,m=parseInt(e.style("height"),10)||0,v=parseInt(n.style("width"),10)-c||0,g=parseInt(n.style("height"),10)||0,y=a+u,_=s-l},drag:function(t){if(i.isTouchDevice()){var e=d3.touches(n.node());a=e[0][0],s=e[0][1]}else a=t.sourceEvent.clientX,s=t.sourceEvent.clientY;var r=-a+y,o=s-_;r<-d&&(r=-d),o<0&&(o=0),r+p>v&&(r=v-p),o+m>g&&(o=g-m),this.move(r,o)}}),w=d3.drag().on("start",function(){var e=t.placeholderEl.node().offsetTop;t.placeholderEl.style("top",e+"px"),t.placeholderEl.style("bottom","auto"),t.trigger("dragstart"),x.dragStart(d3.event)}).on("drag",function(){t.trigger("drag"),x.drag(d3.event)}).on("end",function(){t.rightPos=t.placeholderEl.style("right"),t.topPos=t.placeholderEl.style("top"),t.trigger("dragend")});this.dragHandler.call(w),this.dragHandler.classed("vzb-hidden","small"===b),this.pinIcon.classed("vzb-hidden","small"===b),this.resize()},resize:function(){if(this.placeholderEl&&this.rootEl&&this.placeholderEl.classed("vzb-top-dialog")){this.placeholderEl.classed("notransition",!0);var t=this.getLayoutProfile();if("small"!==t){var e=parseInt(this.rootEl.style("width"),10)||0,n=parseInt(this.rootEl.style("height"),10)||0,r=parseInt(this.placeholderEl.style("width"),10)||0,o=parseInt(this.placeholderEl.style("height"),10)||0,a=parseInt(this.rightPos,10),s=parseInt(this.topPos,10),l=parseInt(this.placeholderEl.style("margin-right"),10)||0;i.isNumber(a)&&a>e-r-l&&this.rightPos&&(this.rightPos=e-r-l+"px",this.isOpen&&this.placeholderEl.style("right",this.rightPos)),i.isNumber(s)&&i.isNumber(o)&&s>=0&&s>n-o&&this.topPos&&(this.topPos=(n-o>0?n-o:0)+"px",this.isOpen&&this.placeholderEl.style("top",this.topPos)),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style("bottom","auto"),this.rootEl.classed("vzb-landscape"),this.element.style("max-height","")}else this.rightPos="",this.topPos="",this.placeholderEl.attr("style","");this.dragHandler.classed("vzb-hidden","small"===t),this.pinIcon.classed("vzb-hidden","small"===t),this._setMaxHeight()}},_setMaxHeight:function(){var t=this.root.element.offsetHeight;"small"!==this.getLayoutProfile()?!this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")?t-=parseInt(this.placeholderEl.style("bottom"),10):t-=this.topPos?parseInt(this.topPos,10):this.placeholderEl.node().offsetTop:t=this.rootEl.classed("vzb-portrait")?t-50:t-10;this.element.style("max-height",t+"px");var e=t-this.titleEl.node().offsetHeight-this.buttonsEl.node().offsetHeight;this.contentEl.style("max-height",e+"px")},beforeOpen:function(){var t=this;if(this.transitionEvents.forEach(function(e){t.placeholderEl.on(e,t.transitionEnd.bind(t,e))}),this.placeholderEl.classed("notransition",!0),this.placeholderEl.style("top",""),this.placeholderEl.style("bottom",""),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=this.placeholderEl.node().offsetTop;this.placeholderEl.style("top",e+"px"),this.placeholderEl.style("bottom","auto")}else this.getLayoutProfile();this.placeholderEl.node().offsetTop,this.placeholderEl.classed("notransition",!1),"small"===this.getLayoutProfile()?this.placeholderEl.style("top",""):this.rootEl.classed("vzb-landscape")},open:function(){this.isOpen=!0,"small"!==this.getLayoutProfile()&&this.topPos&&(this.placeholderEl.style("top",this.topPos),this.placeholderEl.style("right",this.rightPos))},beforeClose:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()&&this.placeholderEl.style("top","auto"),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.topPos0=this.topPos?this.placeholderEl.node().parentNode.offsetHeight-this.placeholderEl.node().offsetHeight+"px":""),this.placeholderEl.classed("notransition",!1),this.placeholderEl.node().offsetHeight},close:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()||(this.placeholderEl.style("top",""),this.placeholderEl.style("right","")),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.placeholderEl.style("top",this.topPos0),this.placeholderEl.style("right","")),this.isOpen=!1,this.trigger("close")},transitionEnd:function(t){var e=this;this.transitionEvents.forEach(function(t){e.placeholderEl.on(t,null)}),this.isOpen&&this.placeholderEl.classed("notransition",!0)}});e.default=l},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var i=n(9),r=n(38);t.exports=n(8)?function(t,e,n){return i.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var i=n(3),r=n(14),o=n(17),a=n(39)("src"),s=Function.toString,l=(""+s).split("toString");n(22).inspectSource=function(t){return s.call(t)},(t.exports=function(t,e,n,s){var u="function"==typeof n;u&&(o(n,"name")||r(n,"name",e)),t[e]!==n&&(u&&(o(n,a)||r(n,a,t[e]?""+t[e]:l.join(String(e)))),t===i?t[e]=n:s?t[e]?t[e]=n:r(t,e,n):(delete t[e],r(t,e,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||s.call(this)})},function(t,e,n){var i=n(0),r=n(4),o=n(27),a=/"/g,s=function(t,e,n,i){var r=String(o(t)),s="<"+e;return""!==n&&(s+=" "+n+'="'+String(i).replace(a,"&quot;")+'"'),s+">"+r+"</"+e+">"};t.exports=function(t,e){var n={};n[t]=e(s),i(i.P+i.F*r(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",n)}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var i=n(56),r=n(27);t.exports=function(t){return i(r(t))}},function(t,e,n){var i=n(57),r=n(38),o=n(18),a=n(26),s=n(17),l=n(113),u=Object.getOwnPropertyDescriptor;e.f=n(8)?u:function(t,e){if(t=o(t),e=a(e,!0),l)try{return u(t,e)}catch(t){}if(s(t,e))return r(!i.f.call(t,e),t[e])}},function(t,e,n){var i=n(17),r=n(11),o=n(81)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),i(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.paintbrush='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1615 0q70 0 122.5 46.5t52.5 116.5q0 63-45 151-332 629-465 752-97 91-218 91-126 0-216.5-92.5t-90.5-219.5q0-128 92-212l638-579q59-54 130-54zm-909 1034q39 76 106.5 130t150.5 76l1 71q4 213-129.5 347t-348.5 134q-123 0-218-46.5t-152.5-127.5-86.5-183-29-220q7 5 41 30t62 44.5 59 36.5 46 17q41 0 55-37 25-66 57.5-112.5t69.5-76 88-47.5 103-25.5 125-10.5z"/></svg>',e.search='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.circle='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1664 896q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"/></svg>',e.expand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M883 1056q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23zm781-864v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45z"/></svg>',e.asterisk='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1546 1050q46 26 59.5 77.5t-12.5 97.5l-64 110q-26 46-77.5 59.5t-97.5-12.5l-266-153v307q0 52-38 90t-90 38h-128q-52 0-90-38t-38-90v-307l-266 153q-46 26-97.5 12.5t-77.5-59.5l-64-110q-26-46-12.5-97.5t59.5-77.5l266-154-266-154q-46-26-59.5-77.5t12.5-97.5l64-110q26-46 77.5-59.5t97.5 12.5l266 153v-307q0-52 38-90t90-38h128q52 0 90 38t38 90v307l266-153q46-26 97.5-12.5t77.5 59.5l64 110q26 46 12.5 97.5t-59.5 77.5l-266 154z"/></svg>',e.trails='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M 1381.375 17.1875 C 1375.7825 17.176804 1370.1216 17.316078 1364.4375 17.5625 C 1273.4913 21.505489 1197.0982 57.199956 1135.2188 124.6875 C 1076.5961 188.62338 1047.6964 263.96059 1048.5312 350.65625 L 835.71875 433 C 797.77288 391.67699 749.96961 361.96416 692.3125 343.84375 C 604.96227 316.39162 520.95691 323.70366 440.25 365.8125 C 359.5432 407.92133 305.45225 472.64985 278 560 C 250.54783 647.35004 257.89117 731.38694 300 812.09375 C 342.10886 892.80075 406.83755 946.89147 494.1875 974.34375 C 576.9404 1000.3512 657.38873 994.58645 735.5625 957.09375 L 959.28125 1171.4375 L 972.375 1184.4062 C 966.2931 1198.3454 961.94845 1209.2226 959.34375 1217.0625 C 956.73915 1224.9024 953.7186 1236.224 950.25 1251.0312 L 711.03125 1285.1875 C 669.59175 1209.0324 607.72526 1157.2863 525.40625 1129.9375 C 438.51381 1101.0693 354.34933 1107.021 272.96875 1147.8125 C 191.58796 1188.6039 136.49335 1252.4513 107.625 1339.3438 C 78.756758 1426.2362 84.708528 1510.3694 125.5 1591.75 C 166.29138 1673.1307 230.1387 1728.2567 317.03125 1757.125 C 403.92369 1785.9933 488.05682 1780.0415 569.4375 1739.25 C 650.81799 1698.4587 705.94425 1634.6111 734.8125 1547.7188 C 737.41718 1539.8788 740.43763 1528.5573 743.90625 1513.75 L 983.125 1479.5938 C 1024.5644 1555.7487 1086.4309 1607.4948 1168.75 1634.8438 C 1255.6425 1663.7119 1339.8069 1657.7603 1421.1875 1616.9688 C 1502.5682 1576.1772 1557.6631 1512.3299 1586.5312 1425.4375 C 1615.3996 1338.5451 1609.4477 1254.4119 1568.6562 1173.0312 C 1527.8647 1091.6506 1464.0174 1036.5244 1377.125 1007.6562 C 1294.9259 980.34721 1214.5066 984.74084 1135.8438 1020.8125 L 1120.2812 1005.9062 L 898.0625 785.96875 C 902.79653 774.40321 906.33847 765.03422 908.5 758.15625 C 920.42249 720.22 925.7916 682.90194 924.59375 646.21875 L 1130.9688 566.34375 C 1141.2015 577.59424 1149.3796 586.0106 1155.4688 591.59375 C 1222.9566 653.47326 1302.1474 682.44278 1393.0938 678.5 C 1484.04 674.55731 1560.4642 638.83151 1622.3438 571.34375 C 1684.2232 503.85591 1713.1929 424.6337 1709.25 333.6875 C 1705.3072 242.74139 1669.5816 166.34819 1602.0938 104.46875 C 1538.8238 46.456824 1465.2625 17.347946 1381.375 17.1875 z "/></svg>',e.lock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"/></svg>',e.unlock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1376 768q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-320q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45q0-106-75-181t-181-75-181 75-75 181v320h736z"/></svg>',e.unexpand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 960v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45zm755-672q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23z"/></svg>',e.axes='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M430.25,379.655l-75.982-43.869v59.771H120.73V151.966h59.774l-43.869-75.983L92.767,0L48.898,75.983L5.029,151.966h59.775 v271.557c0,15.443,12.52,27.965,27.963,27.965h261.5v59.773l75.982-43.869l75.982-43.867L430.25,379.655z"/></svg>',e.gear='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z"/></svg>',e.stack='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54.849 54.849"><g><path d="M54.497,39.614l-10.363-4.49l-14.917,5.968c-0.537,0.214-1.165,0.319-1.793,0.319c-0.627,0-1.254-0.104-1.79-0.318     l-14.921-5.968L0.351,39.614c-0.472,0.203-0.467,0.524,0.01,0.716L26.56,50.81c0.477,0.191,1.251,0.191,1.729,0L54.488,40.33     C54.964,40.139,54.969,39.817,54.497,39.614z"/><path d="M54.497,27.512l-10.364-4.491l-14.916,5.966c-0.536,0.215-1.165,0.321-1.792,0.321c-0.628,0-1.256-0.106-1.793-0.321     l-14.918-5.966L0.351,27.512c-0.472,0.203-0.467,0.523,0.01,0.716L26.56,38.706c0.477,0.19,1.251,0.19,1.729,0l26.199-10.479     C54.964,28.036,54.969,27.716,54.497,27.512z"/><path d="M0.361,16.125l13.662,5.465l12.537,5.015c0.477,0.191,1.251,0.191,1.729,0l12.541-5.016l13.658-5.463     c0.477-0.191,0.48-0.511,0.01-0.716L28.277,4.048c-0.471-0.204-1.236-0.204-1.708,0L0.351,15.41     C-0.121,15.614-0.116,15.935,0.361,16.125z"/></g></svg>',e.drag='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 384q-53 0-90.5 37.5t-37.5 90.5v128h-32v-93q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v429l-32-30v-172q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v224q0 47 35 82l310 296q39 39 39 102 0 26 19 45t45 19h640q26 0 45-19t19-45v-25q0-41 10-77l108-436q10-36 10-77v-246q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v32h-32v-125q0-40-25-72.5t-64-40.5q-14-2-23-2-46 0-79 33t-33 79v128h-32v-122q0-51-32.5-89.5t-82.5-43.5q-5-1-13-1zm0-128q84 0 149 50 57-34 123-34 59 0 111 27t86 76q27-7 59-7 100 0 170 71.5t70 171.5v246q0 51-13 108l-109 436q-6 24-6 71 0 80-56 136t-136 56h-640q-84 0-138-58.5t-54-142.5l-308-296q-76-73-76-175v-224q0-99 70.5-169.5t169.5-70.5q11 0 16 1 6-95 75.5-160t164.5-65q52 0 98 21 72-69 174-69z"/></svg>',e.warn='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.209 512.209"><path d="M507.345,439.683L288.084,37.688c-3.237-5.899-7.71-10.564-13.429-13.988c-5.705-3.427-11.893-5.142-18.554-5.142   s-12.85,1.718-18.558,5.142c-5.708,3.424-10.184,8.089-13.418,13.988L4.859,439.683c-6.663,11.998-6.473,23.989,0.57,35.98   c3.239,5.517,7.664,9.897,13.278,13.128c5.618,3.237,11.66,4.859,18.132,4.859h438.529c6.479,0,12.519-1.622,18.134-4.859   c5.62-3.23,10.038-7.611,13.278-13.128C513.823,463.665,514.015,451.681,507.345,439.683z M292.655,411.132   c0,2.662-0.91,4.897-2.71,6.704c-1.807,1.811-3.949,2.71-6.427,2.71h-54.816c-2.474,0-4.616-0.899-6.423-2.71   c-1.809-1.807-2.713-4.042-2.713-6.704v-54.248c0-2.662,0.905-4.897,2.713-6.704c1.807-1.811,3.946-2.71,6.423-2.71h54.812   c2.479,0,4.62,0.899,6.428,2.71c1.803,1.807,2.71,4.042,2.71,6.704v54.248H292.655z M292.088,304.357   c-0.198,1.902-1.198,3.47-3.001,4.709c-1.811,1.238-4.046,1.854-6.711,1.854h-52.82c-2.663,0-4.947-0.62-6.849-1.854   c-1.908-1.243-2.858-2.807-2.858-4.716l-4.853-130.47c0-2.667,0.953-4.665,2.856-5.996c2.474-2.093,4.758-3.14,6.854-3.14h62.809   c2.098,0,4.38,1.043,6.854,3.14c1.902,1.331,2.851,3.14,2.851,5.424L292.088,304.357z"/></svg>',e.pin='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M800 864v-448q0-14-9-23t-23-9-23 9-9 23v448q0 14 9 23t23 9 23-9 9-23zm672 352q0 26-19 45t-45 19h-429l-51 483q-2 12-10.5 20.5t-20.5 8.5h-1q-27 0-32-27l-76-485h-404q-26 0-45-19t-19-45q0-123 78.5-221.5t177.5-98.5v-512q-52 0-90-38t-38-90 38-90 90-38h640q52 0 90 38t38 90-38 90-90 38v512q99 0 177.5 98.5t78.5 221.5z"/></svg>',e.question='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="17 17 483 483"> <circle stroke-width="40" cx="258.57" cy="258.57" r="220"/> <path d="M299.756,413.021v-61.78c0-3.003-0.966-5.472-2.896-7.401s-4.398-2.896-7.401-2.896h-61.78 c-3.003,0-5.47,0.965-7.4,2.896c-1.932,1.931-2.896,4.398-2.896,7.401v61.78c0,3.002,0.965,5.47,2.896,7.399 c1.931,1.931,4.396,2.896,7.4,2.896h61.779c3.003,0,5.472-0.967,7.401-2.896S299.756,416.021,299.756,413.021z"/> <path d="M382.128,196.789c0-18.877-5.952-36.36-17.856-52.449c-11.905-16.088-26.762-28.53-44.566-37.325 c-17.804-8.795-36.037-13.192-54.7-13.192c-52.127,0-91.919,22.845-119.377,68.537c-3.218,5.148-2.359,9.653,2.574,13.514 l42.474,32.177c1.502,1.287,3.54,1.931,6.114,1.931c3.433,0,6.115-1.287,8.044-3.861c11.369-14.587,20.594-24.454,27.672-29.603 c7.294-5.148,16.519-7.723,27.673-7.723c10.297,0,19.468,2.789,27.513,8.366c8.044,5.578,12.065,11.906,12.065,18.985 c0,8.151-2.146,14.694-6.437,19.628c-4.29,4.934-11.583,9.76-21.881,14.479c-13.514,6.006-25.901,15.284-37.164,27.834 c-11.263,12.549-16.894,26.01-16.894,40.382v11.583c0,3.004,0.965,5.472,2.896,7.401c1.931,1.93,4.396,2.896,7.4,2.896h61.779 c3.003,0,5.471-0.965,7.401-2.896c1.93-1.931,2.896-4.397,2.896-7.401c0-4.075,2.306-9.385,6.917-15.928 c4.612-6.542,10.458-11.852,17.537-15.927c6.863-3.861,12.119-6.918,15.768-9.171c3.646-2.252,8.579-6.008,14.802-11.263 c6.22-5.255,10.993-10.402,14.317-15.443c3.325-5.042,6.328-11.53,9.01-19.467C380.788,214.916,382.128,206.228,382.128,196.789z"/> </svg>',e.close='<svg class="vzb-icon vzb-icon-pin" viewBox="-150 -250 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1149 414q0 26 -19 45l-181 181l181 181q19 19 19 45q0 27 -19 46l-90 90q-19 19 -46 19q-26 0 -45 -19l-181 -181l-181 181q-19 19 -45 19q-27 0 -46 -19l-90 -90q-19 -19 -19 -46q0 -26 19 -45l181 -181l-181 -181q-19 -19 -19 -45q0 -27 19 -46l90 -90q19 -19 46 -19 q26 0 45 19l181 181l181 -181q19 -19 45 -19q27 0 46 19l90 90q19 19 19 46z"/></svg>',e.presentation='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="flip-chart-1" d="M334.549,393.834l58.607,68.666h-45.096l-58.709-68.666H334.549z M240.333,462.5h34.333v-68.666h-34.333 V462.5z M360.5,153.5h-34.334v137.334H360.5V153.5z M121.566,462.5h45.113l58.709-68.666h-45.197L121.566,462.5z M206,273.666 h-34.333v17.168H206V273.666z M257.5,239.333h-34.333v51.5H257.5V239.333z M309,205h-34.334v85.834H309V205z M446.334,102h-17.168 v257.5H85.833V102H68.667V50.5h377.667V102z M394.834,102H120.167v223.166h274.667V102z"/></svg>',e.about='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1088 1256v240q0 16-12 28t-28 12h-240q-16 0-28-12t-12-28v-240q0-16 12-28t28-12h240q16 0 28 12t12 28zm316-600q0 54-15.5 101t-35 76.5-55 59.5-57.5 43.5-61 35.5q-41 23-68.5 65t-27.5 67q0 17-12 32.5t-28 15.5h-240q-15 0-25.5-18.5t-10.5-37.5v-45q0-83 65-156.5t143-108.5q59-27 84-56t25-76q0-42-46.5-74t-107.5-32q-65 0-108 29-35 25-107 115-13 16-31 16-12 0-25-8l-164-125q-13-10-15.5-25t5.5-28q160-266 464-266 80 0 161 31t146 83 106 127.5 41 158.5z"/></svg>',e.cursorArrow='<svg class="vzb-icon" viewBox="-200 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1389 1043q31 30 14 69-17 40-59 40h-382l201 476q10 25 0 49t-34 35l-177 75q-25 10-49 0t-35-34l-191-452-312 312q-19 19-45 19-12 0-24-5-40-17-40-59v-1504q0-42 40-59 12-5 24-5 27 0 45 19z"/></svg>',e.cursorPlus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-224v224q0 13-9.5 22.5t-22.5 9.5h-64q-13 0-22.5-9.5t-9.5-22.5v-224h-224q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h224v-224q0-13 9.5-22.5t22.5-9.5h64q13 0 22.5 9.5t9.5 22.5v224h224q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.cursorMinus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-576q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h576q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.hundredPercent='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg"><g transform="translate(18 11)"><text transform="scale(0.9 1)" x="0" y="0">100</text><text transform="scale(0.6 1)" class="percent" x="0" y="0">%</text></g></svg>',e.percent='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 1280q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm-768-768q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm1024 768q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5zm-96-1088q0 20-13 38l-1056 1408q-19 26-51 26h-160q-26 0-45-19t-19-45q0-20 13-38l1056-1408q19-26 51-26h160q26 0 45 19t19 45zm-672 320q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5z"/></svg>',e.side='<svg class="vzb-icon" viewBox="-120 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="rotate(-90) scale(1.2)" d="M1024 448q0 -26 -19 -45l-448 -448q-19 -19 -45 -19t-45 19l-448 448q-19 19 -19 45t19 45t45 19h896q26 0 45 -19t19 -45zM1024 832q0 -26 -19 -45t-45 -19h-896q-26 0 -45 19t-19 45t19 45l448 448q19 19 45 19t45 -19l448 -448q19 -19 19 -45z"/></svg>',e.cursorHand='<svg class="vzb-icon" viewBox="0 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="scale(1,-1)" d="M880 1408q-46 0 -79 -33t-33 -79v-656h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528v-256l-154 205q-38 51 -102 51q-53 0 -90.5 -37.5t-37.5 -90.5q0 -43 26 -77l384 -512q38 -51 102 -51h688q34 0 61 22t34 56l76 405q5 32 5 59v498q0 46 -33 79t-79 33t-79 -33t-33 -79v-272h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528h-32v656q0 46 -33 79t-79 33zM880 1536q68 0 125.5 -35.5t88.5 -96.5q19 4 42 4q99 0 169.5 -70.5t70.5 -169.5v-17q105 6 180.5 -64t75.5 -175v-498q0 -40 -8 -83l-76 -404q-14 -79 -76.5 -131t-143.5 -52h-688q-60 0 -114.5 27.5t-90.5 74.5l-384 512q-51 68 -51 154q0 106 75 181t181 75q78 0 128 -34v434q0 99 70.5 169.5t169.5 70.5q23 0 42 -4q31 61 88.5 96.5t125.5 35.5z"/></svg>'},function(t,e){var n=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},function(t,e,n){var i=n(13);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){"use strict";var i=n(4);t.exports=function(t,e){return!!t&&i(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e,n){var i=n(5);t.exports=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:n)(t)}},function(t,e,n){var i=n(0),r=n(22),o=n(4);t.exports=function(t,e){var n=(r.Object||{})[t]||Object[t],a={};a[t]=e(n),i(i.S+i.F*o(function(){n(1)}),"Object",a)}},function(t,e,n){var i=n(23),r=n(56),o=n(11),a=n(10),s=n(98);t.exports=function(t,e){var n=1==t,l=2==t,u=3==t,c=4==t,h=6==t,d=5==t||h,f=e||s;return function(e,s,p){for(var m,v,g=o(e),y=r(g),_=i(s,p,3),b=a(y.length),x=0,w=n?f(e,b):l?f(e,0):void 0;b>x;x++)if((d||x in y)&&(v=_(m=y[x],x,g),t))if(n)w[x]=v;else if(v)switch(t){case 3:return!0;case 5:return m;case 6:return x;case 2:w.push(m)}else if(c)return!1;return h?-1:u||c?c:w}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=!1,o=/xyz/.test(function(){})?/\b_super\b/:/.*/;var a=function(){};a.extend=function t(e,n){n=1===arguments.length?e:n;var a=this.prototype;r=!0;var s=new this;function l(){this.trackInstances&&l.instances.push(this),!r&&this.init&&this.init.apply(this,arguments)}return r=!1,(0,i.forEach)(n,function(t,e){"function"==typeof n[e]&&"function"==typeof a[e]&&o.test(n[e])?s[e]=function(t,e){return function(){var n=this._super;this._super=a[t];var i=e.apply(this,arguments);return this._super=n,i}}(e,n[e]):s[e]=t}),l.prototype=s,l.prototype.constructor=l,l.extend=t,l._collection={},l.instances=[],l.register=function(t,e){void 0!==this._collection[t]&&(0,i.warn)('"'+t+'" is already registered. Overwriting...'),this._collection[t]=e},l.unregister=function(t){this._collection[t]=void 0},l.getCollection=function(){return this._collection},l.define=function(t,e){this.prototype[t]=e},l.get=function(t,e){return this._collection.hasOwnProperty(t)?this._collection[t]:(e||(0,i.warn)('"'+t+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(e,l),l},e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=a(n(55));a(n(49));function a(t){return t&&t.__esModule?t:{default:t}}var s=o.default.extend({_important:!1,objectLeafs:["autoconfig"],dataConnectedChildren:["use","which"],getClassDefaults:function(){return r.deepExtend(this._super(),{data:"data",which:null})},buildScale:function(){},setInterModelListeners:function(){var t=this,e=this._parent.getSpace(this);r.forEach(e,function(e){t._space[e]=t.getClosestModel(e),t._space[e].on("dataConnectedChange",t.handleDataConnectedChange.bind(t)),t._space[e].setLinkWith(t)}),this.getClosestModel("locale").on("dataConnectedChange",this.handleDataConnectedChange.bind(this))},onSuccessfullLoad:function(){this.trigger("onSuccessfullLoad"),this.validate(),this.buildScale(),this._super()},setWhich:function(t){var e={which:t.concept};t.dataSource&&(e.data=t.dataSource);var n=(this.dataSource=this.getClosestModel(e.data||this.data)).getConceptprops(t.concept);t.use&&(e.use=t.use),n&&n.scales&&(e.scaleType=n.scales[0]),"axis"!==this.getType()&&"size"!==this.getType()||(e.domainMin=null,e.domainMax=null,e.zoomedMin=null,e.zoomedMax=null),"property"===t.use&&t.key&&1===t.key.length&&(e.spaceRef=r.find(this._space,function(e){return e.dim===t.key[0].concept})._name),"constant"!==t.use&&"indicator"!==t.use||(e.spaceRef=null),this.set(e,void 0,void 0,void 0,this.setWhich),this._root.trigger("change_hook_which",{which:e.which,hook:this._name})},setScaleType:function(t){this.buildScale(t)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data),this._super()},afterPreload:function(){this.autoconfigureModel(),this.spaceRef||(this.spaceRef=this.updateSpaceReference())},autoconfigureModel:function(t){if(!this.which&&this.autoconfig){if(t||(t=this._parent.getAvailableConcept(this.autoconfig)),t){var e=t.value,n={which:e.concept,use:(t.key.size||t.key.length)>1||"time"===this.autoconfig.type?"indicator":"property",scaleType:e.scales[0]||"linear"};this.set(n)}else{this.set({which:"_default",use:"constant",scaleType:"ordinal"})}r.printAutoconfigResult(this)}},updateSpaceReference:function(){if("property"!==this.use)return null;var t="entities"+this._name.replace(this._type,"");return this._space[t]?t:this._parent.getSpace()[0]._name},loadData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.which||"constant"===this.use)return Promise.resolve();this.trigger("hook_change");var e=this.getQuery(t.splashScreen);if(!0===e)return Promise.resolve();this._loadCall=!0,this.setReady(!1),r.timeStamp("Vizabi Model: Loading Data: "+this._id);var n=this._getAllParsers(),i=this.dataSource.load(e,n);return i.then(this.afterLoad.bind(this),function(t){return r.warn("Problem with query: ",t,JSON.stringify(e))}),i},handleDataConnectedChange:function(t){var e=this;r.defer(function(){e.startLoading().catch(r.warn)})},_isLoading:function(){return!this._loadedOnce||this._loadCall},afterLoad:function(t){this._dataId=t,r.timeStamp("Vizabi Model: Data loaded: "+this._id)},getQuery:function(t){var e=void 0;if(Object.keys(this._space).length<1)return r.error("Error:",this._id,"can't find the space"),!0;var n="property"===this.use||"constant"===this.use,i=n?{exceptType:"time"}:{},o=r.unique(this._getAllDimensions(i)),a="property"===this.use&&o.length>1?[-1!==o.indexOf(this.which)?this.which:this.getEntity().dim]:o;if(!a||!a.length)return r.warn("getQuery() produced no query because no keys are available"),!0;var s={key:a,value:-1!=a.indexOf(this.which)||"constant"===this.use?[]:[this.which]},l=this._getFirstDimension({type:"time"}),u=n?"entities":"datapoints";if(e=this._getAllFilters(i,{splash:t,entityTypeRequest:n}),n&&o.length>1){var c={};e[a]&&(c[a]=e[a]),e=c}var h={};if(Object.keys(e).length>0)for(var d in h.$and=[],e){var f={};f[d]=e[d],h.$and.push(f)}var p=this._getAllJoins(i,{splash:t,entityTypeRequest:n});if(n&&o.length>1){var m={};p["$"+a]&&(m["$"+a]=p["$"+a]),p=m}var v=this._parent._getGrouping();v&&(v=r.clone(v,a),r.isEmpty(v)&&(v=!1));var g={language:this.getClosestModel("locale").id,from:u,animatable:l,gapfill:!this.disable_gapfill,select:s,where:h,join:p,order_by:n?["rank"]:[this._space.time.dim]};return v&&(g.grouping=v),g},_getAllDimensions:function(t){return this._parent._getAllDimensions(t)},_getFirstDimension:function(t){return this._parent._getFirstDimension(t)},_getAllFilters:function(t,e){t=t||{};var n={},i=this;return r.forEach(this._space,function(o){if(t.exceptType&&o.getType()===t.exceptType)return!0;if(t.onlyType&&o.getType()!==t.onlyType)return!0;if(r.arrayEquals(i._getAllDimensions(t),[o.getDimension()]))n=r.extend(n,o.getFilter(e));else{var a=o.getFilter(e);if(null!=a&&!r.isEmpty(a)){var s={};s[o.getDimension()]="$"+o.getDimension(),n=r.extend(n,s)}}}),n},_getAllJoins:function(t,e){var n={},i=this;return r.forEach(this._space,function(o){if(t.exceptType&&o.getType()===t.exceptType)return!0;if(t.onlyType&&o.getType()!==t.onlyType)return!0;if(r.arrayEquals(i._getAllDimensions(t),[o.getDimension()]))return!0;var a=o.getFilter(e);null==a||r.isEmpty(a)||(n["$"+o.getDimension()]={key:o.getDimension(),where:o.getFilter(e)})}),n},_getAllParsers:function(){return Object.values(this._space).concat(this).reduce(function(t,e){var n=e.getParser(),i=e.getDimensionOrWhich();return n&&i&&!(i in t)&&(t[i]=n),t},{})},getTickFormatter:function(){var t=this;return function(e,n,i,o,a){if("share"===(a=t.getConceptprops().format)&&(e*=100),r.isDate(e))return t._space.time.formatDate(e);if("time"===t.scaleType&&!r.isDate(e))return t._space.time.formatDate(new Date(e));if(r.isString(e)||!e&&0!==e)return e;if(Math.abs(e)<1e-14)return"0";var s="";if(o)return d3.format(".3r")(e);switch(Math.floor(Math.log(Math.abs(e))/Math.LN10+1e-14)){case-13:e*=1e12,s="p";break;case-10:e*=1e9,s="n";break;case-7:case-6:case-5:e*=1e6,s="µ";break;case-4:case-3:case-2:case-1:case 0:case 1:case 2:case 3:break;case 4:case 5:e/=1e3,s="k";break;case 6:case 7:case 8:e/=1e6,s="M";break;case 9:case 10:case 11:e/=1e9,s="B";break;case 12:case 13:case 14:e/=1e12,s="TR";break;default:return d3.format(".3s")(e).replace("G","B")}var l=d3.format(".3r")(e);return l.indexOf(".")>-1&&(l=l.replace(/0+$/,"").replace(/\.$/,"")),l+s+("percent"===a||"share"===a?"%":"")}},getScale:function(){return null==this.scale&&console.warn("scale is null"),this.scale},getUnique:function(t){if(this.isHook())return t||(t=this._getFirstDimension({type:"time"})),this.dataSource.getData(this._dataId,"unique",t)},getData:function(){return this.dataSource.getData(this._dataId)},getValidItems:function(){return this.dataSource.getData(this._dataId,"valid",this.which)},getNestedItems:function(t){return t?this.dataSource.getData(this._dataId,"nested",t):r.warn("No keys provided to getNestedItems(<keys>)")},getHaveNoDataPointsPerKey:function(){return this.dataSource.getData(this._dataId,"haveNoDataPointsPerKey",this.which)},getLimits:function(t){return this.dataSource.getData(this._dataId,"limits",t)},getTimespan:function(){var t=this._parent._parent.time;if("indicator"===this.use&&this.which!=t.dim&&this._important&&this._dataId)return this.dataSource.getData(this._dataId,"timespan",this.which)},getFrame:function(t,e,n){return this.dataSource.getFrame(this._dataId,t,e,n)},getFrames:function(t,e){return this.dataSource.getFrames(this._dataId,t,e)},getItems:function(t){var e=this,n=this.spaceRef&&this._space[this.spaceRef]?this._space[this.spaceRef].dim:e._getFirstDimension({exceptType:"time"}),i={},o=this.getValidItems(),a=t?this.getEntity().getFilteredEntities().map(function(t){return t[n]}):[],s=a.length;return r.isArray(o)&&o.forEach(function(t){s&&!a.includes(t[n])||(i[t[n]]=t[e.which])}),i},getLimitsByDimensions:function(t){var e=this.dataSource.getData(this._dataId,"nested",t),n={},i=this.which;return r.forEach(e,function(t,e){var o=n[JSON.parse(e).join(",")]={};r.forEach(t,function(t,e){!function(t,e,n){for(var o=t.reduce(function(t,e){var n=r.isDate(e[i])?e[i]:parseFloat(e[i]);return isNaN(n)||t.push(n),t},[]),a=void 0,s=void 0,l={},u=0;u<o.length;u+=1){var c=o[u];(void 0===a||c<a)&&(a=c),(void 0===s||c>s)&&(s=c)}l.min=a||0,l.max=s||100,e[n]=l}(t,o,e)})}),n},getConceptprops:function(){return"constant"!==this.use&&this.dataSource?this.dataSource.getConceptprops(this.which):{}},isDiscrete:function(){return"ordinal"===this.scaleType},validate:function(){var t=this;if(this._super(),this.which){var e=this.scaleType,n=(this.getConceptprops()||{}).scales,r=void 0===n?[]:n;this.allow&&this.allow.scales&&this.allow.scales.length>0&&(r=r.filter(function(e){return-1!=t.allow.scales.indexOf(e)}));var o=r.includes(e),a=r.includes("log")&&"genericLog"===e;if(!o&&!a&&r.length>0){var s=i(r,1)[0];this.set({scaleType:s},null,!1)}}},getEntity:function(){return this._space[this.spaceRef]||this._parent._space[this.spaceRef]||this._parent._space[this._parent.getSpace()[0]]},getDataKeys:function(){return this.spaceRef?[this.getEntity().dim]:this._getAllDimensions({exceptType:"time"})}});e.default=s},function(t,e,n){"use strict";if(n(8)){var i=n(36),r=n(3),o=n(4),a=n(0),s=n(72),l=n(104),u=n(23),c=n(45),h=n(38),d=n(14),f=n(47),p=n(28),m=n(10),v=n(139),g=n(41),y=n(26),_=n(17),b=n(58),x=n(5),w=n(11),S=n(95),M=n(42),E=n(20),z=n(43).f,k=n(97),T=n(39),O=n(7),P=n(30),C=n(62),A=n(69),I=n(100),L=n(53),j=n(66),D=n(44),R=n(99),F=n(129),B=n(9),N=n(19),q=B.f,V=N.f,U=r.RangeError,H=r.TypeError,W=r.Uint8Array,K=Array.prototype,Y=l.ArrayBuffer,G=l.DataView,X=P(0),$=P(2),Z=P(3),Q=P(4),J=P(5),tt=P(6),et=C(!0),nt=C(!1),it=I.values,rt=I.keys,ot=I.entries,at=K.lastIndexOf,st=K.reduce,lt=K.reduceRight,ut=K.join,ct=K.sort,ht=K.slice,dt=K.toString,ft=K.toLocaleString,pt=O("iterator"),mt=O("toStringTag"),vt=T("typed_constructor"),gt=T("def_constructor"),yt=s.CONSTR,_t=s.TYPED,bt=s.VIEW,xt=P(1,function(t,e){return zt(A(t,t[gt]),e)}),wt=o(function(){return 1===new W(new Uint16Array([1]).buffer)[0]}),St=!!W&&!!W.prototype.set&&o(function(){new W(1).set({})}),Mt=function(t,e){var n=p(t);if(n<0||n%e)throw U("Wrong offset!");return n},Et=function(t){if(x(t)&&_t in t)return t;throw H(t+" is not a typed array!")},zt=function(t,e){if(!(x(t)&&vt in t))throw H("It is not a typed array constructor!");return new t(e)},kt=function(t,e){return Tt(A(t,t[gt]),e)},Tt=function(t,e){for(var n=0,i=e.length,r=zt(t,i);i>n;)r[n]=e[n++];return r},Ot=function(t,e,n){q(t,e,{get:function(){return this._d[n]}})},Pt=function(t){var e,n,i,r,o,a,s=w(t),l=arguments.length,c=l>1?arguments[1]:void 0,h=void 0!==c,d=k(s);if(void 0!=d&&!S(d)){for(a=d.call(s),i=[],e=0;!(o=a.next()).done;e++)i.push(o.value);s=i}for(h&&l>2&&(c=u(c,arguments[2],2)),e=0,n=m(s.length),r=zt(this,n);n>e;e++)r[e]=h?c(s[e],e):s[e];return r},Ct=function(){for(var t=0,e=arguments.length,n=zt(this,e);e>t;)n[t]=arguments[t++];return n},At=!!W&&o(function(){ft.call(new W(1))}),It=function(){return ft.apply(At?ht.call(Et(this)):Et(this),arguments)},Lt={copyWithin:function(t,e){return F.call(Et(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return Q(Et(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return R.apply(Et(this),arguments)},filter:function(t){return kt(this,$(Et(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return J(Et(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(Et(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){X(Et(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return nt(Et(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return et(Et(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ut.apply(Et(this),arguments)},lastIndexOf:function(t){return at.apply(Et(this),arguments)},map:function(t){return xt(Et(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return st.apply(Et(this),arguments)},reduceRight:function(t){return lt.apply(Et(this),arguments)},reverse:function(){for(var t,e=Et(this).length,n=Math.floor(e/2),i=0;i<n;)t=this[i],this[i++]=this[--e],this[e]=t;return this},some:function(t){return Z(Et(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return ct.call(Et(this),t)},subarray:function(t,e){var n=Et(this),i=n.length,r=g(t,i);return new(A(n,n[gt]))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,m((void 0===e?i:g(e,i))-r))}},jt=function(t,e){return kt(this,ht.call(Et(this),t,e))},Dt=function(t){Et(this);var e=Mt(arguments[1],1),n=this.length,i=w(t),r=m(i.length),o=0;if(r+e>n)throw U("Wrong length!");for(;o<r;)this[e+o]=i[o++]},Rt={entries:function(){return ot.call(Et(this))},keys:function(){return rt.call(Et(this))},values:function(){return it.call(Et(this))}},Ft=function(t,e){return x(t)&&t[_t]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Bt=function(t,e){return Ft(t,e=y(e,!0))?h(2,t[e]):V(t,e)},Nt=function(t,e,n){return!(Ft(t,e=y(e,!0))&&x(n)&&_(n,"value"))||_(n,"get")||_(n,"set")||n.configurable||_(n,"writable")&&!n.writable||_(n,"enumerable")&&!n.enumerable?q(t,e,n):(t[e]=n.value,t)};yt||(N.f=Bt,B.f=Nt),a(a.S+a.F*!yt,"Object",{getOwnPropertyDescriptor:Bt,defineProperty:Nt}),o(function(){dt.call({})})&&(dt=ft=function(){return ut.call(this)});var qt=f({},Lt);f(qt,Rt),d(qt,pt,Rt.values),f(qt,{slice:jt,set:Dt,constructor:function(){},toString:dt,toLocaleString:It}),Ot(qt,"buffer","b"),Ot(qt,"byteOffset","o"),Ot(qt,"byteLength","l"),Ot(qt,"length","e"),q(qt,mt,{get:function(){return this[_t]}}),t.exports=function(t,e,n,l){var u=t+((l=!!l)?"Clamped":"")+"Array",h="get"+t,f="set"+t,p=r[u],g=p||{},y=p&&E(p),_=!p||!s.ABV,w={},S=p&&p.prototype,k=function(t,n){q(t,n,{get:function(){return function(t,n){var i=t._d;return i.v[h](n*e+i.o,wt)}(this,n)},set:function(t){return function(t,n,i){var r=t._d;l&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),r.v[f](n*e+r.o,i,wt)}(this,n,t)},enumerable:!0})};_?(p=n(function(t,n,i,r){c(t,p,u,"_d");var o,a,s,l,h=0,f=0;if(x(n)){if(!(n instanceof Y||"ArrayBuffer"==(l=b(n))||"SharedArrayBuffer"==l))return _t in n?Tt(p,n):Pt.call(p,n);o=n,f=Mt(i,e);var g=n.byteLength;if(void 0===r){if(g%e)throw U("Wrong length!");if((a=g-f)<0)throw U("Wrong length!")}else if((a=m(r)*e)+f>g)throw U("Wrong length!");s=a/e}else s=v(n),o=new Y(a=s*e);for(d(t,"_d",{b:o,o:f,l:a,e:s,v:new G(o)});h<s;)k(t,h++)}),S=p.prototype=M(qt),d(S,"constructor",p)):o(function(){p(1)})&&o(function(){new p(-1)})&&j(function(t){new p,new p(null),new p(1.5),new p(t)},!0)||(p=n(function(t,n,i,r){var o;return c(t,p,u),x(n)?n instanceof Y||"ArrayBuffer"==(o=b(n))||"SharedArrayBuffer"==o?void 0!==r?new g(n,Mt(i,e),r):void 0!==i?new g(n,Mt(i,e)):new g(n):_t in n?Tt(p,n):Pt.call(p,n):new g(v(n))}),X(y!==Function.prototype?z(g).concat(z(y)):z(g),function(t){t in p||d(p,t,g[t])}),p.prototype=S,i||(S.constructor=p));var T=S[pt],O=!!T&&("values"==T.name||void 0==T.name),P=Rt.values;d(p,vt,!0),d(S,_t,u),d(S,bt,!0),d(S,gt,p),(l?new p(1)[mt]==u:mt in S)||q(S,mt,{get:function(){return u}}),w[u]=p,a(a.G+a.W+a.F*(p!=g),w),a(a.S,u,{BYTES_PER_ELEMENT:e}),a(a.S+a.F*o(function(){g.of.call(p,1)}),u,{from:Pt,of:Ct}),"BYTES_PER_ELEMENT"in S||d(S,"BYTES_PER_ELEMENT",e),a(a.P,u,Lt),D(u),a(a.P+a.F*St,u,{set:Dt}),a(a.P+a.F*!O,u,Rt),i||S.toString==dt||(S.toString=dt),a(a.P+a.F*o(function(){new p(1).slice()}),u,{slice:jt}),a(a.P+a.F*(o(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!o(function(){S.toLocaleString.call([1,2])})),u,{toLocaleString:It}),L[u]=O?T:P,i||O||d(S,pt,P)}}else t.exports=function(){}},function(t,e,n){var i=n(134),r=n(0),o=n(61)("metadata"),a=o.store||(o.store=new(n(137))),s=function(t,e,n){var r=a.get(t);if(!r){if(!n)return;a.set(t,r=new i)}var o=r.get(e);if(!o){if(!n)return;r.set(e,o=new i)}return o};t.exports={store:a,map:s,has:function(t,e,n){var i=s(e,n,!1);return void 0!==i&&i.has(t)},get:function(t,e,n){var i=s(e,n,!1);return void 0===i?void 0:i.get(t)},set:function(t,e,n,i){s(n,i,!0).set(t,e)},keys:function(t,e){var n=s(t,e,!1),i=[];return n&&n.forEach(function(t,e){i.push(e)}),i},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){r(r.S,"Reflect",t)}}},function(t,e,n){var i=n(39)("meta"),r=n(5),o=n(17),a=n(9).f,s=0,l=Object.isExtensible||function(){return!0},u=!n(4)(function(){return l(Object.preventExtensions({}))}),c=function(t){a(t,i,{value:{i:"O"+ ++s,w:{}}})},h=t.exports={KEY:i,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,i)){if(!l(t))return"F";if(!e)return"E";c(t)}return t[i].i},getWeak:function(t,e){if(!o(t,i)){if(!l(t))return!0;if(!e)return!1;c(t)}return t[i].w},onFreeze:function(t){return u&&h.NEED&&l(t)&&!o(t,i)&&c(t),t}}},function(t,e){t.exports=!1},function(t,e,n){var i=n(7)("unscopables"),r=Array.prototype;void 0==r[i]&&n(14)(r,i,{}),t.exports=function(t){r[i][t]=!0}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e,n){var i=n(115),r=n(82);t.exports=Object.keys||function(t){return i(t,r)}},function(t,e,n){var i=n(28),r=Math.max,o=Math.min;t.exports=function(t,e){return(t=i(t))<0?r(t+e,0):o(t,e)}},function(t,e,n){var i=n(2),r=n(116),o=n(82),a=n(81)("IE_PROTO"),s=function(){},l=function(){var t,e=n(79)("iframe"),i=o.length;for(e.style.display="none",n(83).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;i--;)delete l.prototype[o[i]];return l()};t.exports=Object.create||function(t,e){var n;return null!==t?(s.prototype=i(t),n=new s,s.prototype=null,n[a]=t):n=l(),void 0===e?n:r(n,e)}},function(t,e,n){var i=n(115),r=n(82).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,r)}},function(t,e,n){"use strict";var i=n(3),r=n(9),o=n(8),a=n(7)("species");t.exports=function(t){var e=i[t];o&&e&&!e[a]&&r.f(e,a,{configurable:!0,get:function(){return this}})}},function(t,e){t.exports=function(t,e,n,i){if(!(t instanceof e)||void 0!==i&&i in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,e,n){var i=n(23),r=n(127),o=n(95),a=n(2),s=n(10),l=n(97),u={},c={};(e=t.exports=function(t,e,n,h,d){var f,p,m,v,g=d?function(){return t}:l(t),y=i(n,h,e?2:1),_=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(f=s(t.length);f>_;_++)if((v=e?y(a(p=t[_])[0],p[1]):y(t[_]))===u||v===c)return v}else for(m=g.call(t);!(p=m.next()).done;)if((v=r(m,y,p.value,e))===u||v===c)return v}).BREAK=u,e.RETURN=c},function(t,e,n){var i=n(15);t.exports=function(t,e,n){for(var r in e)i(t,r,e[r],n);return t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=n(49),o=s(r),a=s(n(391));function s(t){return t&&t.__esModule?t:{default:t}}var l=o.default.extend({_name:"",_parent:null,_persistent:!0,init:function(t,e,n,i,r){Object.defineProperty(this,"value",{get:this.get,set:this.set}),Object.defineProperty(this,"persistent",{get:function(){return this._persistent}}),this._super(),this._name=t,this._parent=n,this._root=n._root,this.set(e,!1,r),this.on(i)},get:function(t){return t&&!this._persistent?this._persistentVal:this._val},set:function(t,e,n){return!!this.isSetAllowed(t,e)&&((n=void 0===n||n)&&(this._persistentVal=t),this._previousVal=i.deepClone(this._val),this._val=t,this._persistent=n,this.trigger(new r.ChangeEvent(this),this._name),!0)},isSetAllowed:function(t,e){return e||this._val!==t&&JSON.stringify(this._val)!==JSON.stringify(t)},setTreeFreezer:function(t){t?this.freeze(["hook_change"]):this.unfreeze()}}),u=o.default.extend({getClassDefaults:function(){return{}},objectLeafs:[],init:function(t,e,n,r){this._type=this._type||"model",this._id=this._id||i.uniqueId("m"),this._data={},this._parent=n,this._root=n?n._root:this,this._name=t,this._inError=!1,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._intervals=function t(e){return e._intervals||(e._parent?t(e._parent):new a.default)}(this),this._space={},this._dataId=!1,this._limits={},this._super();var o=i.deepExtend({},this.getClassDefaults(),e);this.set(o),r&&this.on(r)},get:function(t){if(t){var e=this._data[t];return u.isModel(e)?e:e.value}return this._data},set:function(t,e,n,r,o){var a=this._setting,s=void 0,d=!1;if(i.isPlainObject(t)?(s=t,r=n,n=e):(s={})[t]=e,0!==Object.keys(s).length){this._setting=!0,this._freeze||(d=!0,this.setTreeFreezer(!0));var f=[];for(var p in s){e=s[p];var m=i.isPlainObject(e)&&this._data[p]instanceof u,v=(!i.isPlainObject(e)||this.isObjectLeaf(p))&&this._data[p]instanceof l;if(this._data[p]&&(m||v)){var g=this._data[p].value,y=this._data[p].set(e,n,r);v&&y&&f.push(p);var _="set"+i.capitalize(p[0])+p.slice(1);this.isHook()&&i.isFunction(this[_])&&o!==this[_]&&e!==g&&this[_]("which"===p?{concept:e}:e)}else this._data[p]=h(p,e,this,r),c(this,p)}a||(this.checkDataChanges(f),this.validate&&this.validate()),a&&!n||(this._setting=!1,!d||this.isHook()&&this.isLoading()||this.setTreeFreezer(!1),this.isHook()||this.isLoading()||this.setReady())}},checkDataChanges:function(){},setTreeFreezer:function(t){i.forEach(this._data,function(e){e.setTreeFreezer(t)}),t?this.freeze(["hook_change"]):this.unfreeze()},getType:function(){return this._type},getSubmodels:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=t?{}:[];return i.forEach(this._data,function(i,r){i&&void 0!==i._id&&u.isModel(i)&&e(i)&&(t?n[r]=i:n.push(i))}),n},getPlainObject:function(t){var e={},n=this;return i.forEach(this._data,function(r,o){if(r instanceof u)e[o]=r.getPlainObject(t);else if(!t||r.persistent){var a=r.get(t);i.isDate(a)&&(a=n.formatDate(a)),e[o]=a}}),e},formatDate:function(t){return t.toString()},getModelObject:function(t){return t?this._data[t]:this},clear:function(){var t=this.getSubmodels();for(var e in t)t[e].clear();this.setReady(!1),this.off(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},_isLoading:function(){return!1},isLoading:function(){if(this._isLoading())return!0;var t=this.getSubmodels(),e=void 0;for(e=0;e<t.length;e+=1)if(t[e].isLoading())return!0;return!1},setReady:function(t){if(!1===t)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));var e=this._ready;this._ready=!this.isLoading()&&!this._setting,this._ready&&e!==this._ready&&(this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready"))},setInterModelListeners:function(){i.forEach(this.getSubmodels(),function(t){return t.setInterModelListeners()})},startPreload:function(){var t=[];return t.push(this.preloadData()),i.forEach(this.getSubmodels(),function(e){return t.push(e.startPreload())}),Promise.all(t)},preloadData:function(){return Promise.resolve()},startLoading:function(t){var e=this;this.trigger("startLoading");var n=[];return n.push(this.loadData(t)),i.forEach(this.getSubmodels(),function(e){return n.push(e.startLoading(t))}),Promise.all(n).then(this.onSuccessfullLoad.bind(this)).catch(function(t){i.error("error in model "+e._name),e.triggerLoadError(t)})},loadData:function(t){return this.isHook()&&i.warn("Hook "+this._name+" is not loading because it's not extending Hook prototype."),Promise.resolve()},loadSubmodels:function(t){var e=[],n=this.getSubmodels();return i.forEach(n,function(n){e.push(n.startLoading(t))}),e.length>0?Promise.all(e):Promise.resolve()},onSuccessfullLoad:function(){var t=this;this.validate(),i.timeStamp("Vizabi Model: Model loaded: "+this._name+"("+this._id+")"),this._loadedOnce=!0,this._loadCall=!1,this.setTreeFreezer(!1),i.defer(function(){return t.setReady()})},handleLoadError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getDefaultError();this.triggerLoadError(t)},getDefaultError:function(){var t=new Error;return t.message=this.getClosestModel("locale").getTFunction()("connection/error"),t},triggerLoadError:function(t){if(o.default.unfreezeAll(),this._inError)return i.error("Model "+this._name+" already in error");this._inError=!0,this._root.trigger("load_error",t),this._root.trigger("load_error1",t)},afterPreload:function(){var t=this.getSubmodels();i.forEach(t,function(t){t.afterPreload()})},isHook:function(){return Boolean(this.use)},getSubhooks:function(t){return this.getSubmodels(t,function(t){return t.isHook()})},getHookWhich:function(t){var e=[];return this.use&&this.use===t&&e.push(this.which),i.forEach(this.getSubmodels(),function(n){e=i.unique(e.concat(n.getHookWhich(t)))}),e},getIndicators:function(){return this.getHookWhich("indicator")},getProperties:function(){return this.getHookWhich("property")},getDimension:function(){return this.dim||!1},getDimensionOrWhich:function(){return this.dim||"constant"!=this.use&&this.which},getFilter:function(){return{}},mapValue:function(t){return t},getParser:function(){return null},getDefaults:function(){return i.deepExtend({},this.getClassDefaults(),this.getSubmodelDefaults())},getSubmodelDefaults:function(){var t={};return i.forEach(this.getSubmodels(!0),function(e,n){t[n]=e.getDefaults()}),t},isObjectLeaf:function(t){return-1!==this.objectLeafs.indexOf(t)},getClosestModel:function(t){var e=this.findSubmodel(t);return e||(this._parent?this._parent.getClosestModel(t):null)},findSubmodel:function(t){for(var e in this._data)if(e===t&&u.isModel(this._data[e]))return this._data[e];return null},isEntities:function(){return!1}});function c(t,e){var n;Object.defineProperty(t,e,{configurable:!0,get:(n=e,function(){return t.get(n)}),set:function(e){return function(n){return t.set(e,n)}}(e)})}function h(t,e,r,o){var a=void 0;if(!i.isPlainObject(e)||i.isArray(e)||r.isObjectLeaf(t)){a=new l(t,e,r,{change:d},o)}else{var s={change:d,hook_change:function(t,e){r.trigger(t,e)},load_error:function(){return r.trigger.apply(r,arguments)},dataLoaded:function(){return r.trigger.apply(r,arguments)},ready:function(t,e){r.setReady(!1),i.defer(function(){r.setReady()})}};if(u.isModel(e,!0))(a=e).on(s);else{var c=t.split("_")[0],h=u.get(c,!0);if(!h)try{h=n(392)("./"+c).default}catch(t){h=u}a=new h(t,e,r,s)}}return a;function d(t,e){r._ready&&(e=r._name+"."+e,r.trigger(t,e))}}u.isModel=function(t,e){return t&&(t.hasOwnProperty("_data")||e&&t.hasOwnProperty("_val"))},e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=e.DefaultEvent=void 0;var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),a=n(31),s=(i=a)&&i.__esModule?i:{default:i};var l=!1,u=[],c={},h=e.DefaultEvent=s.default.extend({source:"",type:"default",init:function(t,e){this.source=t,e&&(this.type=e)}}),d=(e.ChangeEvent=h.extend("change",{type:"change",init:function(t){this._super(t)}}),s.default.extend({init:function(){this._id=this._id||o.uniqueId("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(t,e,n){if(!this.splitEventParameters(t,e,n,this.on)){var i=this.traversePath(e);i&&(i._events[t]=i._events[t]||[],"function"==typeof n?i._events[t].push(n):o.warn("Can't bind event '"+t+"'. It must be a function."))}},off:function(t,e,n){if(0!=arguments.length){if(!this.splitEventParameters(t,e,n,this.off)){var i=this.traversePath(e);if(i&&i._events.hasOwnProperty(t)){if(void 0===n)return void(i._events[t]=[]);var r=i._events[t].indexOf(n);r>-1?i._events[t].splice(r,1):o.warn("Could not unbind function "+n.name+". Function not in bound function list.")}}}else this._events={}},splitEventParameters:function(t,e,n,i){var r=void 0;if(o.isArray(t)){for(r=0;r<t.length;r+=1)i.call(this,t[r],n);return!0}if(o.isObject(t)){for(r in t)i.call(this,r,t[r]);return!0}if("function"==typeof e){if(n=e,-1!==t.indexOf(":")){var a=t.split(":");t=a[0],e=a[1]}else e=void 0;return i.call(this,t,e,n),!0}if(o.isArray(e)){for(r=0;r<e.length;r+=1)i.call(this,t,e[r],n);return!0}if(n&&o.isArray(n)){for(r=0;r<n.length;r+=1)i.call(this,t,e,n[r]);return!0}return!1},traversePath:function(t){if(void 0===t||o.isArray(t)&&0==t.length)return this;if("string"==typeof t&&(t=t.split(".")),!o.isArray(t))return o.error("Path is wrong type. Path should be a string or array but is "+(void 0===t?"undefined":r(t))+"."),null;var e=t.shift();if(void 0!==this[e])return this.getModelObject(e).traversePath(t);o.warn("Can't find child \""+e+'" of the model '+this._name+".")},createEventFromType:function(t){if(t instanceof h)return t;var e=h.get(t,!0);return e?new e(this):new h(this,t)},trigger:function(t,e){var n=this,i=void 0,r=void 0;if(o.isArray(t))for(i=0,r=t.length;i<r;i+=1)this.trigger(t[i],e);else{var a=this.createEventFromType(t);if(this._events.hasOwnProperty(a.type)){var s=this;o.forEach(this._events[a.type],function(t){var i=function(){var n="Vizabi Event: "+a.type;o.timeStamp(n),t.apply(s,[a,e])};n.allowExecution(a)?i():(n._freezer.push(i),l&&!u[n._id]&&(n.freeze(),u[n._id]=n))})}}},allowExecution:function(t){return!this._freeze&&!l||l&&c.hasOwnProperty(t.type)||!l&&this._freeze&&this._freezeExceptions.hasOwnProperty(t.type)},freeze:function(t){if(this._freeze=!0,t){o.isArray(t)||(t=[t]);for(var e=0;e<t.length;e+=1)this._freezeExceptions[t[e]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){this._freezer.shift()()}},clearFrozen:function(){this._freeze=!1,this._freezeExceptions={},this._freezer=[]}}));d.freezeAll=function(t){if(l=!0,!t)return;o.isArray(t)||(t=[t]);o.forEach(t,function(t){c[t]=!0})},d.unfreezeAll=function(){l=!1,c={};for(var t=Object.keys(u),e=0;e<t.length;e++){var n=u[t[e]];n&&n.unfreeze()}u={}},e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=u(n(6)),o=u(n(109)),a=u(n(32)),s=u(n(76)),l=n(21);function u(t){return t&&t.__esModule?t:{default:t}}var c=r.default.extend({init:function(t,e){this.name="gapminder-indicatorpicker",this.template='<span class="vzb-ip-holder"><span class="vzb-ip-select"></span><span class="vzb-ip-info"></span></span>';var n=this;this.model_expects=[{name:"time",type:"time"},{name:"targetModel"},{name:"locale",type:"locale"}],this.showHoverValues=t.showHoverValues||!1,this.model_binds={"translate:locale":function(t){n.updateView()},ready:function(t){n.updateView()}},this.model_binds["change:targetModel"]=function(t,e){-1!=e.indexOf("."+n.targetProp)&&n.updateView()},this._super(t,e),this.model.targetModel.isHook()&&this.showHoverValues&&this.model.targetModel._parent.on("change:highlight",function(t,e){var r=n.model.targetModel;if(r.isHook()){var o=r._parent;if(n.showHoverValues&&"constant"!=r.use){var a=o.getHighlighted();a.length>1||(a.length?o.getFrame(n.model.time.value,function(t){if(!n._highlighted&&t){var e=o.getHighlighted();if(e.length){var a=r.getDataKeys(),s=t[r._name][i.getKey(e[0],a)];if(s&&"color"===r._type&&r.isDiscrete()){var l=r.getColorlegendMarker();l.label.getItems()[s]&&(s=l.label.getItems()[s])}n._highlightedValue=s,n._highlighted=!n._highlightedValue&&0!==n._highlightedValue||"constant"!==r.use,n.updateView()}}}):(null!==e&&"highlight"!==e?e&&(n._highlightedValue=e[r._name],n._highlighted=!n._highlightedValue&&0!==n._highlightedValue||"constant"!==r.use):n._highlighted=!1,n.updateView()))}}}),this.targetProp=t.targetProp||this.model.targetModel instanceof a.default?"which":this.model.targetModel instanceof o.default?"dim":this.model.targetModel instanceof s.default?"space":null},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.el_select=d3.select(this.element).select(".vzb-ip-select"),this.el_select.on("click",function(){var e=t.el_select.node().getBoundingClientRect(),n=(t.root.element instanceof Array?t.root.element:d3.select(t.root.element)).node().getBoundingClientRect(),i=t.root.findChildByName("gapminder-treemenu"),r=i.activeProfile.col_width,o=parseInt(i.wrapper.style("padding-left"),10)||0,a=parseInt(i.wrapper.style("padding-right"),10)||0,s=e.bottom-n.top,l=e.left-n.left-.5*(o+a+r-e.width);i.targetModel(t.model.targetModel).alignX("left").alignY("top").top(s).left(l).updateView().toggle()}),this.infoEl=d3.select(this.element).select(".vzb-ip-info"),t.model.targetModel.isHook()&&(i.setIcon(this.infoEl,l.question).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.root.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=t.el_select.node().getBoundingClientRect(),n=t.root.element.getBoundingClientRect(),i=e.bottom-n.top,r=e.left-n.left+e.width;t.root.findChildByName("gapminder-datanotes").setHook(t.model.targetModel._name).show().setPos(r,i)}),this.infoEl.on("mouseout",function(){t.root.findChildByName("gapminder-datanotes").hide()}))},updateView:function(){if(this._readyOnce){var t=this.model.locale.getTFunction(),e=this.model.targetModel,n=e[this.targetProp],i=e._type,r=void 0,o=void 0;if(e instanceof a.default)if(r=e.getConceptprops(),this.showHoverValues&&this._highlighted){var s=e.getTickFormatter();o=this._highlightedValue||0===this._highlightedValue?s(this._highlightedValue):t("hints/nodata")}else o="_default"===n?t("indicator/_default/"+i):r.name_short;else{var l=e._root.dataManager;o=e.space.map(function(t){return l.getConceptProperty(e._space[t].dim,"name")}).join(", ")}this.el_select.text(o).attr("title",function(t){return this.offsetWidth<this.scrollWidth?o:null});var u=r&&!r.description&&!r.sourceName&&!r.sourceLink;this.infoEl.classed("vzb-invisible",u)}}});e.default=c},function(t,e,n){var i=n(9).f,r=n(17),o=n(7)("toStringTag");t.exports=function(t,e,n){t&&!r(t=n?t:t.prototype,o)&&i(t,o,{configurable:!0,value:e})}},function(t,e,n){var i=n(0),r=n(27),o=n(4),a=n(85),s="["+a+"]",l=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),c=function(t,e,n){var r={},s=o(function(){return!!a[t]()||"​"!="​"[t]()}),l=r[t]=s?e(h):a[t];n&&(r[n]=l),i(i.P+i.F*s,"String",r)},h=c.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=c},function(t,e){t.exports={}},function(t,e,n){var i=n(5);t.exports=function(t,e){if(!i(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=o(n(48));o(n(49));function o(t){return t&&t.__esModule?t:{default:t}}var a=r.default.extend({dataConnectedChildren:[],checkDataChanges:function(t){var e=this;t&&this.dataConnectedChildren&&(!i.isArray(t)&&i.isObject(t)&&(t=Object.keys(t)),0!=t.length&&0!=this.dataConnectedChildren.length&&t.filter(function(t){return-1!==e.dataConnectedChildren.indexOf(t)}).length>0&&(this.trigger("dataConnectedChange"),this.startLoading({dataConnectedChange:!0})))}});e.default=a},function(t,e,n){var i=n(24);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,n){var i=n(24),r=n(7)("toStringTag"),o="Arguments"==i(function(){return arguments}());t.exports=function(t){var e,n,a;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?n:o?i(e):"Object"==(a=i(e))&&"function"==typeof e.callee?"Arguments":a}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(77);var a={THUMB_HEIGHT:17,THUMB_STROKE_WIDTH:3},s={small:{},medium:{},large:{}},l=((i=o)&&i.__esModule?i:{default:i}).default.extend({init:function(t,e){this.name="singlehandleslider";var n=r.extend({},a);this.options=r.extend(n,this.options||{});var i=r.extend({},s);this.profiles=r.extend(i,this.profiles||{}),this.slider_properties=t.properties||{};var o=this.slider_properties.roundDigits;(o||0==o)&&(this.options.ROUND_DIGITS=o),this.slider_properties.domain&&(this.options.EXTENT_MIN=this.slider_properties.domain[0],this.options.EXTENT_MAX=this.slider_properties.domain[1]),this._super(t,e)},readyOnce:function(){this._super();var t=this.options,e=t.BAR_WIDTH,n=t.THUMB_HEIGHT;this.padding.top=.5*(n+t.THUMB_STROKE_WIDTH),this.padding.bottom=.5*(n+t.THUMB_STROKE_WIDTH)-e;var i=this._getComponentWidth();i<0&&(i=0),this.rescaler.domain(this.slider_properties.domain||[this.options.EXTENT_MIN,this.options.EXTENT_MAX]),this.rescaler.range(d3.range(0,i,i/(this.rescaler.domain().length-1)).concat([i])),this.sliderEl.call(this.brush.handleSize(t.THUMB_HEIGHT+t.THUMB_STROKE_WIDTH)),this.sliderEl.selectAll(".w").classed("vzb-hidden",!0),this.sliderEl.select(".selection").classed("vzb-hidden",!0),this.sliderEl.select(".overlay").lower().style("stroke-opacity","0").style("stroke-width",.5*n+"px").attr("rx",.5*e).attr("ry",.5*e),this.sliderEl.selectAll(".vzb-slider-thumb-badge").style("stroke-width",this.options.THUMB_STROKE_WIDTH+"px")},_getBrushEventListeners:function(){var t=this,e=this,n=this._super();return{start:n.start,brush:function(){!e.nonBrushChange&&d3.event.sourceEvent&&(e.slider_properties.suppressInput?e._snap(d3.event.selection):n.brush.apply(n,arguments))},end:function(){!e.nonBrushChange&&d3.event.sourceEvent&&(e.slider_properties.snapValue&&t._snap(d3.event.selection),e._setFromExtent(!0,!0))}}},_snap:function(t){var e=this.rescaler.invert(this._extentToValue(t)),n=this.rescaler.domain(),i=n[n.length-1]>n[0],r=d3.bisector(d3[i?"ascending":"descending"]).left(n,e)||1;e=(i?1:-1)*(e-n[r-1]-(n[r]-e))>0?n[r]:n[r-1],this._moveBrush(this._valueToExtent(e))},_createThumbs:function(t){this.options.BAR_WIDTH;var e=.5*this.options.THUMB_HEIGHT,n=d3.arc().outerRadius(e).startAngle(0).endAngle(2*Math.PI);t.attr("transform","translate("+(e+.5*this.options.THUMB_STROKE_WIDTH)+","+(e+.5*this.options.THUMB_STROKE_WIDTH)+")").append("path").attr("d",n)},_resize:function(){this._super();var t=this._getComponentWidth();this.rescaler.range(d3.range(0,t||1,t/(this.rescaler.domain().length-1)||1).concat([t]))},_valueToExtent:function(t){return[this.rescaler.domain()[0],t]},_extentToValue:function(t){return t[1]},_setModel:function(t,e,n){if(this.slider_properties.suppressInput&&this._extentToValue(t).toFixed(this.options.ROUND_DIGITS)==this.model.submodel[this.arg])return;this._super(t,e,n)}});e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(6),o=(i=r)&&i.__esModule?i:{default:i};e.default=o.default.extend({init:function(t,e){this.template='<span class="vzb-sc-holder vzb-dialog-checkbox"><input type="checkbox"><label></label></span>';var n=this;this.name="gapminder-simplecheckbox",this.checkbox=t.checkbox,this.submodel=t.submodel,this.model_expects=[{name:"mdl"},{name:"locale",type:"locale"}],this.model_binds={"change:mdl":function(t){n.updateView()},"translate:locale":function(t){n.updateView()}};var i=this.submodel?this.submodel+":":"";this.model_binds["change:mdl."+i+this.checkbox]=function(){n.updateView()},this._super(t,e)},ready:function(){this.parentModel=this.submodel?this.model.mdl[this.submodel]:this.model.mdl,this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element);var e="-check-"+t._id;this.labelEl=this.element.select("label").attr("for",e),this.checkEl=this.element.select("input").attr("id",e).on("change",function(){t._setModel(d3.select(this).property("checked"))})},updateView:function(){this.translator=this.model.locale.getTFunction();var t=this.parentModel&&(this.parentModel[this.checkbox]||!1===this.parentModel[this.checkbox]);this.labelEl.classed("vzb-hidden",!t),t&&(this.labelEl.text(this.translator("check/"+this.checkbox)),this.checkEl.property("checked",!!this.parentModel[this.checkbox]))},_setModel:function(t){this.parentModel[this.checkbox]=t}})},function(t,e,n){var i=n(22),r=n(3),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:n(36)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(t,e,n){var i=n(18),r=n(10),o=n(41);t.exports=function(t){return function(e,n,a){var s,l=i(e),u=r(l.length),c=o(a,u);if(t&&n!=n){for(;u>c;)if((s=l[c++])!=s)return!0}else for(;u>c;c++)if((t||c in l)&&l[c]===n)return t||c||0;return!t&&-1}}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var i=n(24);t.exports=Array.isArray||function(t){return"Array"==i(t)}},function(t,e,n){var i=n(5),r=n(24),o=n(7)("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[o])?!!e:"RegExp"==r(t))}},function(t,e,n){var i=n(7)("iterator"),r=!1;try{var o=[7][i]();o.return=function(){r=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var n=!1;try{var o=[7],a=o[i]();a.next=function(){return{done:n=!0}},o[i]=function(){return a},t(o)}catch(t){}return n}},function(t,e,n){"use strict";var i=n(2);t.exports=function(){var t=i(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,n){"use strict";var i=n(14),r=n(15),o=n(4),a=n(27),s=n(7);t.exports=function(t,e,n){var l=s(t),u=n(a,l,""[t]),c=u[0],h=u[1];o(function(){var e={};return e[l]=function(){return 7},7!=""[t](e)})&&(r(String.prototype,t,c),i(RegExp.prototype,l,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)}))}},function(t,e,n){var i=n(2),r=n(13),o=n(7)("species");t.exports=function(t,e){var n,a=i(t).constructor;return void 0===a||void 0==(n=i(a)[o])?e:r(n)}},function(t,e,n){var i=n(3).navigator;t.exports=i&&i.userAgent||""},function(t,e,n){"use strict";var i=n(3),r=n(0),o=n(15),a=n(47),s=n(35),l=n(46),u=n(45),c=n(5),h=n(4),d=n(66),f=n(51),p=n(86);t.exports=function(t,e,n,m,v,g){var y=i[t],_=y,b=v?"set":"add",x=_&&_.prototype,w={},S=function(t){var e=x[t];o(x,t,"delete"==t?function(t){return!(g&&!c(t))&&e.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!c(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!c(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,n){return e.call(this,0===t?0:t,n),this})};if("function"==typeof _&&(g||x.forEach&&!h(function(){(new _).entries().next()}))){var M=new _,E=M[b](g?{}:-0,1)!=M,z=h(function(){M.has(1)}),k=d(function(t){new _(t)}),T=!g&&h(function(){for(var t=new _,e=5;e--;)t[b](e,e);return!t.has(-0)});k||((_=e(function(e,n){u(e,_,t);var i=p(new y,e,_);return void 0!=n&&l(n,v,i[b],i),i})).prototype=x,x.constructor=_),(z||T)&&(S("delete"),S("has"),v&&S("get")),(T||E)&&S(b),g&&x.clear&&delete x.clear}else _=m.getConstructor(e,t,v,b),a(_.prototype,n),s.NEED=!0;return f(_,t),w[t]=_,r(r.G+r.W+r.F*(_!=y),w),g||m.setStrong(_,t,v),_}},function(t,e,n){for(var i,r=n(3),o=n(14),a=n(39),s=a("typed_array"),l=a("view"),u=!(!r.ArrayBuffer||!r.DataView),c=u,h=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h<9;)(i=r[d[h++]])?(o(i.prototype,s,!0),o(i.prototype,l,!0)):c=!1;t.exports={ABV:u,CONSTR:c,TYPED:s,VIEW:l}},function(t,e,n){"use strict";t.exports=n(36)||!n(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete n(3)[t]})},function(t,e,n){"use strict";var i=n(0);t.exports=function(t){i(i.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,n){"use strict";var i=n(0),r=n(13),o=n(23),a=n(46);t.exports=function(t){i(i.S,t,{from:function(t){var e,n,i,s,l=arguments[1];return r(this),(e=void 0!==l)&&r(l),void 0==t?new this:(n=[],e?(i=0,s=o(l,arguments[2],2),a(t,!1,function(t){n.push(s(t,i++))})):a(t,!1,n.push,n),new this(n))}})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(48);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{select:[],highlight:[],superHighlight:[],opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:1,limit:1e3,allowSelectMultiple:!0})},init:function(t,e,n,i,r){this._type="marker",this._visible=[],this._super(t,e,n,i,r),this.on("change","space",this.setInterModelListeners.bind(this))},setInterModelListeners:function(){var t=this;r.forEach(this.getSpace(),function(e){t._space[e]=t.getClosestModel(e)}),this._super()},setSpace:function(t){var e=this,n=Object.keys(this.getSubhooks(!0)),i={},o={};(i.space=this._root.dimensionManager.getDimensionModelsForSpace(this._space,t)).filter(function(t){return!e.space.includes(t)}).forEach(function(t){var r=e.getClosestModel(t),a="label"+t.replace(r._type,""),s={which:r.dim,use:"property"},l=e._root.dataManager.getAvailableDataForKey(r.dim,"name","entities")[0];l&&(s.which=l.value,s.data=l.data),n.includes(a)?(s.spaceRef=t,i[a]=s):(s.key=[{concept:r.dim}],s.dataSource=s.data,s.concept=s.which,o[a]=s,i[a]={})}),this.set(i),r.forEach(o,function(t,n){e[n].setInterModelListeners(),e[n].setWhich(t)}),this._dataCube=this.getSubhooks(!0)},getAvailableSpaces:function(){var t=new Map;return r.forEach(this._root._data,function(e){if("data"===e._type){var n=e.getConceptprops();e.keyAvailability.forEach(function(e,i){e.length>1&&t.set(i,e.map(function(t){return n[t]}))})}}),t},getAvailableData:function(){var t=this,e=[];if(0===d3.keys(this._space).length)return r.warn("getAvailableData() is trying to access missing _space items of marker '"+this._name+"' which likely haven't been resoled in time");var n=r.unique(this.space.map(function(e){return t._space[e].dim}));r.forEach(this._root._data,function(t){if("data"===t._type){var i=t.getConceptprops();t.dataAvailability.datapoints.forEach(function(r){n.length==r.key.size&&n.every(function(t){return r.key.has(t)})&&e.push({key:r.key,value:i[r.value],dataSource:t})});t.dataAvailability.entities.forEach(function(r){null!=r.value&&n.forEach(function(n){r.key.has(n)&&-1===r.value.indexOf("is--")&&e.push({key:Array.from(r.key).map(function(t){return i[t]}),value:i[r.value],dataSource:t})})})}});var i=this._root.dataManager.getDataModels().values().next().value;return n.filter(function(t){return null!=t}).forEach(function(t){return e.push({key:[i.getConceptprops(t)],value:i.getConceptprops(t),dataSource:i})}),e.push({key:[i.getConceptprops("_default")],value:i.getConceptprops("_default"),dataSource:i}),e},getAvailableConcept:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.index,n=void 0===e?0:e,i=t.type,r=void 0===i?null:i,o=t.includeOnlyIDs,a=void 0===o?[]:o,s=t.excludeIDs,l=void 0===s?[]:s;if(!r&&0==a.length&&0==l.length)return null;var u=this.getAvailableData().filter(function(t){return!(r&&t.value.concept_type&&t.value.concept_type!==r||0!=a.length&&-1===a.indexOf(t.value.concept)||0!=l.length&&-1!=l.indexOf(t.value.concept))});return u[n]||u[u.length-1]},setDataSourceForAllSubhooks:function(t){var e={};this.getSubhooks().forEach(function(n){e[n._name]={data:t}}),this.set(e,null,!1)},validate:function(){var t=this.getDimension(),e=this._visible.map(function(e){return e[t]});e.length&&(this.select=this.select.filter(function(n){return-1!==e.indexOf(n[t])}),this.setHighlight(this.highlight.filter(function(n){return-1!==e.indexOf(n[t])})))},setVisible:function(t){this._visible=t},getVisible:function(t){return this._visible},getSelected:function(t){return t?this.select.map(function(e){return e[t]}):this.select},selectMarker:function(t){var e=this,n=this._createValue(t);this.isSelected(t)?this.select=this.select.filter(function(t){return JSON.stringify(e._createValue(t))!==JSON.stringify(n)}):this.select=this.allowSelectMultiple?this.select.concat(n):[n]},selectAll:function(t,e){if(this.allowSelectMultiple){var n=void 0,i=r.unique(this._getAllDimensions({exceptType:"time"}));this.select=this._visible.map(function(t){return n={},i.forEach(function(e){return n[e]=t[e]}),n})}},isSelected:function(t){var e=this,n=JSON.stringify(this._createValue(t));return-1!==this.select.map(function(t){return JSON.stringify(e._createValue(t))===n}).indexOf(!0)},_createValue:function(t){return this._getAllDimensions({exceptType:"time"}).reduce(function(e,n){return e[n]=t[n],e},{})},getHighlighted:function(t){return t?this.highlight.map(function(e){return e[t]}):this.highlight},setHighlight:function(t){r.isArray(t)?this.getModelObject("highlight").set(t,!1,!1):this.setHighlight([].concat(t))},setSuperHighlight:function(t){this.getModelObject("superHighlight").set(r.isArray(t)?t:[t],!1,!1)},clearSuperHighlighted:function(){this.setSuperHighlight([])},isSuperHighlighted:function(t){var e=JSON.stringify(this._createValue(t));return~this.superHighlight.findIndex(function(t){return JSON.stringify(t)===e})},setSelect:function(t){r.isArray(t)?this.getModelObject("select").set(t):this.setSelect([].concat(t))},highlightMarker:function(t){var e=this._createValue(t);this.isHighlighted(t)||this.setHighlight(this.highlight.concat(e))},unhighlightEntity:function(t){var e=this._createValue(t);this.isHighlighted(t)&&this.setHighlight(this.highlight.filter(function(t){return t[dimension]!==e}))},isHighlighted:function(t){var e=this,n=JSON.stringify(this._createValue(t));return-1!==this.highlight.map(function(t){return JSON.stringify(e._createValue(t))===n}).indexOf(!0)},clearHighlighted:function(){this.setHighlight([])},clearSelected:function(){this.select=[]},setLabelOffset:function(t,e){if(0!==e[0]||1!==e[1]){var n=r.unique(this._getAllDimensions({exceptType:"time"})),i=n.join(",");this.select.find(function(e){return r.getKey(e,n)==t[i]}).labelOffset=[Math.round(1e3*e[0])/1e3,Math.round(1e3*e[1])/1e3],this.set("select",this.select,!0)}},getImportantHooks:function(){var t=[];return r.forEach(this._dataCube||this.getSubhooks(!0),function(e,n){e._important&&t.push(n)}),t},getLabelHookNames:function(){var t=this;return r.unique(this._getAllDimensions({exceptType:"time"})).reduce(function(e,n){var i={};r.forEach(t._dataCube||t.getSubhooks(!0),function(t,e){if(t.isDiscrete())return"label"===t._type&&t.getEntity().dim===n&&(i.label=e),"label"!==t._type&&t.getEntity().dim===n&&(i.key=e),!i.label||!i.key});var o=i.label||i.key;return o&&(e[n]=o),e},{})},getDataKeysPerHook:function(){var t={};return r.forEach(this._dataCube||this.getSubhooks(!0),function(e,n){t[n]=e.getDataKeys()}),t},getKeys:function(t){var e=void 0;t=t||r.unique(this._getAllDimensions({exceptType:"time"})),t=Array.isArray(t)?t:[t];var n=this._getFirstDimension({type:"time"}),i=this._dataCube||this.getSubhooks(!0),o=t.map(function(t){return[]}),a=t.map(function(t){return[]});return r.forEach(i,function(e,n){if("property"===e.use){var i=t.indexOf(e.getEntity().dim);-1===i||a[i].includes(e.dataSource)||(o[i].push(e),a[i].push(e.dataSource))}}),r.forEach(i,function(e,n){"indicator"===e.use&&e.getDataKeys().forEach(function(n){var i=t.indexOf(n);-1===i||a[i].includes(e.dataSource)||o[i].push(e)})}),o.forEach(function(i,o){var a=[];i.forEach(function(e){var i=e.getDataKeys(),r=i.indexOf(t[o]);a=a.concat(Object.keys(e.getNestedItems(i.concat(n))).map(function(t){return[JSON.parse(t)[r]]}))}),a=r.unique(a),e=e?d3.cross(e,a,function(t,e){return t.concat(e)}):a}),r.forEach(i,function(i,r){if(i._important&&"constant"!==i.use){var o=i.getDataKeys(),a=o.map(function(e){return t.indexOf(e)}).reduce(function(t,e,n){return-1!==e&&(t[n]=e),t},[]);if(a.length){var s=i.getNestedItems(o.concat(n)),l=i.getHaveNoDataPointsPerKey(),u=Object.keys(s),c=Object.keys(l||[]),h=(t.every(function(t,e){return t===o[e]}),u.reduce(function(t,e){return-1==c.indexOf(e)&&(t[JSON.stringify(a.map(function(t,n){return JSON.parse(e)[n]}))]=!0),t},{})),d=e.map(function(t){return JSON.stringify(a.map(function(e){return t[e]}))});e=e.filter(function(t,e){return h[d[e]]})}}}),e.length>this.limit&&(r.warn("MARKER getKeys(): only showing the first "+this.limit+" markerElements of "+this._name+". The rest are not displayed because chart may become slow and crash. Set a higher number in marker.limit or apply entity filters"),e=e.slice(0,this.limit)),e.map(function(e){var n={};return t.map(function(t,i){return n[t]=e[i]}),n})},_getCachePath:function(t){var e=this._parent.time.getAllSteps(),n=this.getClosestModel("locale").id+" - "+e[0]+" - "+e[e.length-1]+" - step:"+this._parent.time.step;this._dataCube=this._dataCube||this.getSubhooks(!0);var i=!1;return r.forEach(this._dataCube,function(t,e){t._loadCall&&(i=!0),n=n+"_"+t._dataId+t.which}),i?null:(t&&(n=n+"_"+t.join(",")),n)},_getGrouping:function(){var t=this._dataCube||this.getSubhooks(!0),e=t[Object.keys(t)[0]]._space,n={};return r.forEach(e,function(t){t.grouping&&(n[t.dim]={grouping:t.grouping})}),!r.isEmpty(n)&&n},_getAllDimensions:function(t){var e=[],n=this;r.forEach(this.space,function(t){e.push(n.getClosestModel(t))}),t=t||{};var i=[],o=void 0;return r.forEach(e,function(e){return!(!t.exceptType||e.getType()!==t.exceptType)||(!(!t.onlyType||e.getType()===t.onlyType)||void((o=e.getDimension())&&i.push(o)))}),i},_getFirstDimension:function(t){var e=[],n=this;r.forEach(this.space,function(t){e.push(n.getClosestModel(t))}),t=t||{};var i=!1;return r.forEach(e,function(e){return t.exceptType&&e.getType()!==t.exceptType?(i=e.getDimension(),!1):t.type&&e.getType()===t.type?(i=e.getDimension(),!1):t.exceptType||t.type?void 0:(i=e.getDimension(),!1)}),i},framesAreReady:function(){var t=this._getCachePath();return!!this.cachedFrames&&Object.keys(this.cachedFrames[t]).length==this._parent.time.getAllSteps().length},getFrame:function(t,e,n){var i=this;this.cachedFrames||(this.cachedFrames={});var o=this._parent.time.getAllSteps(),a=this._getCachePath();if(!a)return e(null,t);if(t&&i.cachedFrames[a]&&i.cachedFrames[a][t])return e(i.cachedFrames[a][t],t);if(!(a=this._getCachePath(n)))return e(null,t);if(t&&i.cachedFrames[a]&&i.cachedFrames[a][t])return e(i.cachedFrames[a][t],t);if(t&&o.length>1){var s=d3.bisectLeft(o,t);if(!o[s])return r.warn("The requested frame is out of range: "+t),e(null,t),null;if(o[s].toString()!=t.toString())return this._interpolateBetweenFrames(t,s,o,function(n){e(n,t)},n),null}i.getFrames(t,n).then(function(){return!t&&i.cachedFrames[a]?e(i.cachedFrames[a],t):i.cachedFrames[a]&&i.cachedFrames[a][t]?e(i.cachedFrames[a][t],t):(r.warn("marker.js getFrame: Data is not available for frame: "+t),e(null,t))})},_interpolateBetweenFrames:function(t,e,n,i,o){var a=this;if(0==e)this.getFrame(n[e],function(t){return i(t)},o);else{var s=n[e-1],l=n[e];this.getFrame(s,function(e){a.getFrame(l,function(n){var o=(t-s)/(l-s),a={};r.forEach(e,function(e,i){a[i]={},r.forEach(e,function(e,s){var l=n[i][s];r.isDate(e)?a[i][s]=t:r.isNumber(e)?a[i][s]=null==e||null==l?null:e+(l-e)*o:a[i][s]=e})}),i(a)},o)},o)}},getFrames:function(t,e){var n=this;this.cachedFrames||(this.cachedFrames={});var i=r.unique(this._getAllDimensions({exceptType:"time"})),o=this._getFirstDimension({type:"time"});this.frameQueues||(this.frameQueues={}),this.partialResult||(this.partialResult={});var a=this._parent.time.getAllSteps(),s=this._getCachePath(e);return s?(this.frameQueues[s]&&this.frameQueues[s]instanceof Promise||(this.frameQueues[s]=new Promise(function(t,u){n.partialResult[s]={},n.partialResult[s].timeOrConstantHooks=[],a.forEach(function(t){n.partialResult[s][t]={}});var c=[];if(r.forEach(n._dataCube,function(t,e){if("constant"===t.use||t.which===o)n.partialResult[s].timeOrConstantHooks.push({name:e,which:t.which});else if(i.includes(t.which)){var r=t.getValidItems();a.forEach(function(i){n.partialResult[s][i][e]={},r.forEach(function(r){n.partialResult[s][i][e][r[t.which]]=r[t.which]})})}else c.push(t)}),c.length>0){var h=[];r.forEach(c,function(t){h.push(new Promise(function(i,o){var l=t._name,u=t.which;t.getFrames(a,e).then(function(t){r.forEach(t,function(t,e){n.partialResult[s][e][l]=t[u]}),i()})}))}),Promise.all(h).then(function(){l(),n.cachedFrames[s]=n.partialResult[s],t()})}else l(),n.cachedFrames[s]=n.partialResult[s],t()})),new Promise(function(u,c){if(a.length<2||!t)n.frameQueues[s].then(function(){u()});else{var h=[];r.forEach(n._dataCube,function(r,l){var u,c;"constant"===r.use||i.includes(r.which)||r.which===o||(u=r,c=l,h.push(new Promise(function(i,r){u.getFrame(a,t,e).then(function(e){n.partialResult[s][t][c]=e[t][u.which],i()})})))}),h.length>0?Promise.all(h).then(function(){l(),n.cachedFrames[s]||(n.cachedFrames[s]={}),n.cachedFrames[s][t]=n.partialResult[s][t],u()}):u()}})):new Promise(function(t,e){t()});function l(){if(n.partialResult[s].timeOrConstantHooks){var t=n.partialResult[s].timeOrConstantHooks,e=n.getKeys();t.forEach(function(t){var l=t.which,u=t.name,c=l===o;a.forEach(function(t){n.partialResult[s][t][u]={},e.forEach(function(e){n.partialResult[s][t][u][r.getKey(e,i)]=c?new Date(t):l})})}),delete n.partialResult[s].timeOrConstantHooks}}},listenFramesQueue:function(t,e){var n=this,i=r.unique(this._getAllDimensions({exceptType:"time"})),o=this._getFirstDimension({type:"time"}),a=this._parent.time.getAllSteps(),s={};this.getFrames();var l=[],u=a.length,c=!1;r.forEach(n._dataCube,function(r,h){"constant"===r.use||i.includes(r.which)||r.which===o||l.includes(r._dataId)||(l.push(r._dataId),r.dataSource.listenFrame(r._dataId,a,t,function(t,i){var r=i.toString();void 0===s[r]&&(s[r]=[]),s[r].includes(t)||s[r].push(t),s[r].length===l.length&&(c||u!==Object.keys(s).length||(c=!0,n.trigger("dataLoaded")),e(i))}))})},getEntityLimits:function(t){var e=this,n=this._parent.time.getAllSteps(),i=[],o=[];r.forEach(e.getSubhooks(),function(t){"constant"!=t.use&&t._important&&o.push(t._name)});var a=function i(r,a){var s=r();if(null==s)return a(s);e.getFrame(n[s],function(e){!function(e){if(!e)return!1;for(var n=0,i=o.length;n<i;n++)if(!e[o[n]][t]&&0!==e[o[n]][t])return!1;return!0}(e)?i(r,a):a(s)})},s=[];return s.push(new Promise(function(t,e){var r,o;a((r=n.length,o=0,function(){return o<r?o++:null}),function(e){i[0]=n[e],t()})})),s.push(new Promise(function(t,e){var r;a((r=n.length-1,function(){return r>=0?r--:null}),function(e){i[1]=n[e],t()})})),Promise.all(s).then(function(){return{min:i[0],max:i[1]}})},getCompoundLabelText:function(t,e){var n=this._root.dataManager,i=r.unique(this._getAllDimensions({exceptType:"time"})),o=this.getLabelHookNames(),a=i.filter(function(e){return t[e]!==n.getConceptProperty(e,"totals_among_entities")}).map(function(n){return e[o[n]]&&e[o[n]][t[n]]||t[n]}).join(", ");return""===a&&(a=this._root.locale.getTFunction()("hints/grandtotal")),a},getSpace:function(){if(r.isArray(this.space))return this.space;r.error('ERROR: space not found.\n You must specify the objects this hook will use under the "space" attribute in the state.\n Example:\n space: ["entities", "time"]')}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(6);var a={EXTENT_MIN:0,EXTENT_MAX:1,BAR_WIDTH:6,THUMB_HEIGHT:20,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250,ROUND_DIGITS:2},s={small:{},medium:{},large:{}},l=((i=o)&&i.__esModule?i:{default:i}).default.extend({init:function(t,e){this.name=this.name||"brushslider";var i=r.extend({},a);this.options=r.extend(i,this.options||{});var o=r.extend({},s);this.profiles=r.extend(o,this.profiles||{}),this.template=this.template||n(399),this.arg=t.arg||"extent",this.model_expects=this.model_expects||[{name:"submodel"},{name:"locale",type:"locale"}],this.model_binds=this.model_binds||{},this.model_binds.ready||(this.model_binds.ready=this.readyHandler.bind(this)),this.model_binds["change:submodel."+this.arg]||(this.model_binds["change:submodel."+this.arg]=this.changeHandler.bind(this)),this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var n=this._valueToExtent(this.model.submodel[this.arg])||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._moveBrush(n)},readyHandler:function(t){},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-slider-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-slider").classed("vzb-slider-"+this.name,!0);var e=this.options,n=e.BAR_WIDTH,i=.5*e.THUMB_HEIGHT,r=(this.padding={top:.5*n,left:i,right:i,bottom:i+e.THUMB_STROKE_WIDTH},this._getComponentWidth()||0);r<0&&(r=0),this.rescaler=d3.scaleLinear().domain([e.EXTENT_MIN,e.EXTENT_MAX]).range([0,r]).clamp(!0),this.brushEventListeners=this._getBrushEventListeners(),this.brush=d3.brushX().handleSize(2*i+2*n).on("start",this.brushEventListeners.start).on("brush",this.brushEventListeners.brush).on("end",this.brushEventListeners.end),this.sliderThumbs=this.sliderEl.selectAll(".handle").data([{type:"w"},{type:"e"}],function(t){return t.type}).enter().append("svg").attr("class",function(t){return"handle handle--"+t.type+" "+t.type}).classed("vzb-slider-thumb",!0),this._createThumbs(this.sliderThumbs.append("g").attr("class","vzb-slider-thumb-badge")),this.sliderEl.call(t.brush),this.sliderEl.selectAll(".selection,.overlay").attr("height",n).attr("rx",.25*n).attr("ry",.25*n).attr("transform","translate(0,"+.5*-n+")"),this.on("resize",function(){t._resize(),t._updateView()})},ready:function(){this.isRTL=this.model.locale.isRTL(),this._resize(),this._updateView()},_getBrushEventListeners:function(){var t=this;return{start:function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1])t.sliderEl.node().__brush.selection[1][0]+=.01;t._setFromExtent(!1,!1,!1)}},brush:function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1])t.sliderEl.node().__brush.selection[1][0]+=.01;t._setFromExtent(!0,!1,!1)}},end:function(){!t.nonBrushChange&&d3.event.sourceEvent&&t._setFromExtent(!0,!0)}}},_createThumbs:function(t){var e=this.options.BAR_WIDTH,n=.5*this.options.THUMB_HEIGHT;t.append("path").attr("d","M"+(n+e)+" "+(n+1.5*e)+"l"+-n+" "+1.5*n+"h"+2*n+"Z")},_updateThumbs:function(t){},_updateSize:function(){var t=this._getComponentWidth()+this.padding.left+this.padding.right;this.sliderSvg.attr("height",this._getComponentHeight()+this.padding.top+this.padding.bottom).attr("width",t),this.sliderWrap.attr("transform",this.isRTL?"translate("+(t-this.padding.right)+","+this.padding.top+") scale(-1,1)":"translate("+this.padding.left+","+this.padding.top+")")},_resize:function(){this._updateSize();var t=this._getComponentWidth();this.rescaler.range([0,t])},_getComponentWidth:function(){var t=this.element.node().offsetWidth-this.padding.left-this.padding.right;return t<0?0:t},_getComponentHeight:function(){return this.options.BAR_WIDTH},_updateView:function(){this.sliderEl.call(this.brush.extent([[0,0],[this._getComponentWidth(),this._getComponentHeight()]]));var t=this._valueToExtent(this.model.submodel[this.arg])||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._moveBrush(t)},_moveBrush:function(t){var e=t.map(this.rescaler);this.nonBrushChange=!0,this.sliderEl.call(this.brush.move,[e[0],e[1]+.01]),this.nonBrushChange=!1,this._setFromExtent(!1,!1,!1)},_valueToExtent:function(t){return t},_extentToValue:function(t){return t},_setFromExtent:function(t,e,n){var i=d3.brushSelection(this.sliderEl.node());i&&(i=[this.rescaler.invert(i[0]),this.rescaler.invert(+i[1].toFixed(1))],this._updateThumbs(i),t&&this._setModel(i,e,n))},_setModel:function(t,e,n){var i=this.options.ROUND_DIGITS;t=[+t[0].toFixed(i),+t[1].toFixed(i)];var r={};r[this.arg]=this._extentToValue(t),this.model.submodel.set(r,e,n)}});e.default=l},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var i=n(5),r=n(3).document,o=i(r)&&i(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,n){var i=n(3),r=n(22),o=n(36),a=n(114),s=n(9).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=o?{}:i.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:a.f(t)})}},function(t,e,n){var i=n(61)("keys"),r=n(39);t.exports=function(t){return i[t]||(i[t]=r(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){var i=n(3).document;t.exports=i&&i.documentElement},function(t,e,n){var i=n(5),r=n(2),o=function(t,e){if(r(t),!i(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,i){try{(i=n(23)(Function.call,n(19).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return o(t,n),e?t.__proto__=n:i(t,n),t}}({},!1):void 0),check:o}},function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,e,n){var i=n(5),r=n(84).set;t.exports=function(t,e,n){var o,a=e.constructor;return a!==n&&"function"==typeof a&&(o=a.prototype)!==n.prototype&&i(o)&&r&&r(t,o),t}},function(t,e,n){"use strict";var i=n(28),r=n(27);t.exports=function(t){var e=String(r(this)),n="",o=i(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(n+=e);return n}},function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,e){var n=Math.expm1;t.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:n},function(t,e,n){var i=n(28),r=n(27);t.exports=function(t){return function(e,n){var o,a,s=String(r(e)),l=i(n),u=s.length;return l<0||l>=u?t?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===u||(a=s.charCodeAt(l+1))<56320||a>57343?t?s.charAt(l):o:t?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}}},function(t,e,n){"use strict";var i=n(36),r=n(0),o=n(15),a=n(14),s=n(53),l=n(92),u=n(51),c=n(20),h=n(7)("iterator"),d=!([].keys&&"next"in[].keys()),f=function(){return this};t.exports=function(t,e,n,p,m,v,g){l(n,e,p);var y,_,b,x=function(t){if(!d&&t in E)return E[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},w=e+" Iterator",S="values"==m,M=!1,E=t.prototype,z=E[h]||E["@@iterator"]||m&&E[m],k=z||x(m),T=m?S?x("entries"):k:void 0,O="Array"==e&&E.entries||z;if(O&&(b=c(O.call(new t)))!==Object.prototype&&b.next&&(u(b,w,!0),i||"function"==typeof b[h]||a(b,h,f)),S&&z&&"values"!==z.name&&(M=!0,k=function(){return z.call(this)}),i&&!g||!d&&!M&&E[h]||a(E,h,k),s[e]=k,s[w]=f,m)if(y={values:S?k:x("values"),keys:v?k:x("keys"),entries:T},g)for(_ in y)_ in E||o(E,_,y[_]);else r(r.P+r.F*(d||M),e,y);return y}},function(t,e,n){"use strict";var i=n(42),r=n(38),o=n(51),a={};n(14)(a,n(7)("iterator"),function(){return this}),t.exports=function(t,e,n){t.prototype=i(a,{next:r(1,n)}),o(t,e+" Iterator")}},function(t,e,n){var i=n(65),r=n(27);t.exports=function(t,e,n){if(i(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(t))}},function(t,e,n){var i=n(7)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[i]=!1,!"/./"[t](e)}catch(t){}}return!0}},function(t,e,n){var i=n(53),r=n(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||o[r]===t)}},function(t,e,n){"use strict";var i=n(9),r=n(38);t.exports=function(t,e,n){e in t?i.f(t,e,r(0,n)):t[e]=n}},function(t,e,n){var i=n(58),r=n(7)("iterator"),o=n(53);t.exports=n(22).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||o[i(t)]}},function(t,e,n){var i=n(279);t.exports=function(t,e){return new(i(t))(e)}},function(t,e,n){"use strict";var i=n(11),r=n(41),o=n(10);t.exports=function(t){for(var e=i(this),n=o(e.length),a=arguments.length,s=r(a>1?arguments[1]:void 0,n),l=a>2?arguments[2]:void 0,u=void 0===l?n:r(l,n);u>s;)e[s++]=t;return e}},function(t,e,n){"use strict";var i=n(37),r=n(130),o=n(53),a=n(18);t.exports=n(91)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(t,e,n){var i,r,o,a=n(23),s=n(120),l=n(83),u=n(79),c=n(3),h=c.process,d=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,m=c.Dispatch,v=0,g={},y=function(){var t=+this;if(g.hasOwnProperty(t)){var e=g[t];delete g[t],e()}},_=function(t){y.call(t.data)};d&&f||(d=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return g[++v]=function(){s("function"==typeof t?t:Function(t),e)},i(v),v},f=function(t){delete g[t]},"process"==n(24)(h)?i=function(t){h.nextTick(a(y,t,1))}:m&&m.now?i=function(t){m.now(a(y,t,1))}:p?(o=(r=new p).port2,r.port1.onmessage=_,i=a(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(i=function(t){c.postMessage(t+"","*")},c.addEventListener("message",_,!1)):i="onreadystatechange"in u("script")?function(t){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),y.call(t)}}:function(t){setTimeout(a(y,t,1),0)}),t.exports={set:d,clear:f}},function(t,e,n){var i=n(3),r=n(101).set,o=i.MutationObserver||i.WebKitMutationObserver,a=i.process,s=i.Promise,l="process"==n(24)(a);t.exports=function(){var t,e,n,u=function(){var i,r;for(l&&(i=a.domain)&&i.exit();t;){r=t.fn,t=t.next;try{r()}catch(i){throw t?n():e=void 0,i}}e=void 0,i&&i.enter()};if(l)n=function(){a.nextTick(u)};else if(!o||i.navigator&&i.navigator.standalone)if(s&&s.resolve){var c=s.resolve(void 0);n=function(){c.then(u)}}else n=function(){r.call(i,u)};else{var h=!0,d=document.createTextNode("");new o(u).observe(d,{characterData:!0}),n=function(){d.data=h=!h}}return function(i){var r={fn:i,next:void 0};e&&(e.next=r),t||(t=r,n()),e=r}}},function(t,e,n){"use strict";var i=n(13);t.exports.f=function(t){return new function(t){var e,n;this.promise=new t(function(t,i){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=i}),this.resolve=i(e),this.reject=i(n)}(t)}},function(t,e,n){"use strict";var i=n(3),r=n(8),o=n(36),a=n(72),s=n(14),l=n(47),u=n(4),c=n(45),h=n(28),d=n(10),f=n(139),p=n(43).f,m=n(9).f,v=n(99),g=n(51),y="prototype",_="Wrong index!",b=i.ArrayBuffer,x=i.DataView,w=i.Math,S=i.RangeError,M=i.Infinity,E=b,z=w.abs,k=w.pow,T=w.floor,O=w.log,P=w.LN2,C=r?"_b":"buffer",A=r?"_l":"byteLength",I=r?"_o":"byteOffset";function L(t,e,n){var i,r,o,a=new Array(n),s=8*n-e-1,l=(1<<s)-1,u=l>>1,c=23===e?k(2,-24)-k(2,-77):0,h=0,d=t<0||0===t&&1/t<0?1:0;for((t=z(t))!=t||t===M?(r=t!=t?1:0,i=l):(i=T(O(t)/P),t*(o=k(2,-i))<1&&(i--,o*=2),(t+=i+u>=1?c/o:c*k(2,1-u))*o>=2&&(i++,o/=2),i+u>=l?(r=0,i=l):i+u>=1?(r=(t*o-1)*k(2,e),i+=u):(r=t*k(2,u-1)*k(2,e),i=0));e>=8;a[h++]=255&r,r/=256,e-=8);for(i=i<<e|r,s+=e;s>0;a[h++]=255&i,i/=256,s-=8);return a[--h]|=128*d,a}function j(t,e,n){var i,r=8*n-e-1,o=(1<<r)-1,a=o>>1,s=r-7,l=n-1,u=t[l--],c=127&u;for(u>>=7;s>0;c=256*c+t[l],l--,s-=8);for(i=c&(1<<-s)-1,c>>=-s,s+=e;s>0;i=256*i+t[l],l--,s-=8);if(0===c)c=1-a;else{if(c===o)return i?NaN:u?-M:M;i+=k(2,e),c-=a}return(u?-1:1)*i*k(2,c-e)}function D(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function R(t){return[255&t]}function F(t){return[255&t,t>>8&255]}function B(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function N(t){return L(t,52,8)}function q(t){return L(t,23,4)}function V(t,e,n){m(t[y],e,{get:function(){return this[n]}})}function U(t,e,n,i){var r=f(+n);if(r+e>t[A])throw S(_);var o=t[C]._b,a=r+t[I],s=o.slice(a,a+e);return i?s:s.reverse()}function H(t,e,n,i,r,o){var a=f(+n);if(a+e>t[A])throw S(_);for(var s=t[C]._b,l=a+t[I],u=i(+r),c=0;c<e;c++)s[l+c]=u[o?c:e-c-1]}if(a.ABV){if(!u(function(){b(1)})||!u(function(){new b(-1)})||u(function(){return new b,new b(1.5),new b(NaN),"ArrayBuffer"!=b.name})){for(var W,K=(b=function(t){return c(this,b),new E(f(t))})[y]=E[y],Y=p(E),G=0;Y.length>G;)(W=Y[G++])in b||s(b,W,E[W]);o||(K.constructor=b)}var X=new x(new b(2)),$=x[y].setInt8;X.setInt8(0,2147483648),X.setInt8(1,2147483649),!X.getInt8(0)&&X.getInt8(1)||l(x[y],{setInt8:function(t,e){$.call(this,t,e<<24>>24)},setUint8:function(t,e){$.call(this,t,e<<24>>24)}},!0)}else b=function(t){c(this,b,"ArrayBuffer");var e=f(t);this._b=v.call(new Array(e),0),this[A]=e},x=function(t,e,n){c(this,x,"DataView"),c(t,b,"DataView");var i=t[A],r=h(e);if(r<0||r>i)throw S("Wrong offset!");if(r+(n=void 0===n?i-r:d(n))>i)throw S("Wrong length!");this[C]=t,this[I]=r,this[A]=n},r&&(V(b,"byteLength","_l"),V(x,"buffer","_b"),V(x,"byteLength","_l"),V(x,"byteOffset","_o")),l(x[y],{getInt8:function(t){return U(this,1,t)[0]<<24>>24},getUint8:function(t){return U(this,1,t)[0]},getInt16:function(t){var e=U(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=U(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return D(U(this,4,t,arguments[1]))},getUint32:function(t){return D(U(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return j(U(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return j(U(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){H(this,1,t,R,e)},setUint8:function(t,e){H(this,1,t,R,e)},setInt16:function(t,e){H(this,2,t,F,e,arguments[2])},setUint16:function(t,e){H(this,2,t,F,e,arguments[2])},setInt32:function(t,e){H(this,4,t,B,e,arguments[2])},setUint32:function(t,e){H(this,4,t,B,e,arguments[2])},setFloat32:function(t,e){H(this,4,t,q,e,arguments[2])},setFloat64:function(t,e){H(this,8,t,N,e,arguments[2])}});g(b,"ArrayBuffer"),g(x,"DataView"),s(x[y],a.VIEW,!0),e.ArrayBuffer=b,e.DataView=x},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return t.match(/\//g).length};e.default=function(t,e){var n=t.keys();return e&&(n=n.filter("function"==typeof e?function(t){return e(i(t))}:function(t){return i(t)===e+1})),n.reduce(function(e,n){var i=/([^/]+)\..+$/.exec(n)[1];try{var r=t(n);e[i]=r.default||r}catch(t){console.warn("Import error",n,t)}return e},{})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(32);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({_important:!0,getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,fixBaseline:null,scaleType:"linear",allow:{scales:["linear","log","genericLog","time","pow"]}})},autoconfigureModel:function(t){!this.which&&this.autoconfig&&"axis"===this._type&&(t=this._parent.getAvailableConcept(this.autoconfig)||this._parent.getAvailableConcept({type:"time"})),this._super(t)},_type:"axis",validate:function(){if(this._super(),this.scale&&"time"==this.scaleType){var t={};null==this.zoomedMin||r.isDate(this.zoomedMin)||(t.zoomedMin=this._space.time.parse(this.zoomedMin.toString())),null==this.zoomedMax||r.isDate(this.zoomedMax)||(t.zoomedMax=this._space.time.parse(this.zoomedMax.toString())),this.set(t)}},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=void 0;if("time"==t){var n=this._space.time,i=n.splash?{min:n.parse(n.startOrigin),max:n.parse(n.endOrigin)}:{min:n.start,max:n.end};e=[i.min,i.max],this.scale=d3.scaleUtc().domain(e)}else{if(this.isDiscrete())e="constant"===this.use?[this.which]:this.getUnique(this.which);else{var o=this.getLimits(this.which);(e=[o.min,o.max])[0]=(this.fixBaseline||0===this.fixBaseline)&&o.min>0?+this.fixBaseline:e[0],e[0]=null!=this.domainMin?+this.domainMin:e[0],e[1]=null!=this.domainMax?+this.domainMax:e[1]}var a=("ordinal"===(t=d3.min(e)<=0&&d3.max(e)>=0&&"log"===t?"genericLog":t)?"point":t)||"linear";this.scale=d3["scale"+r.capitalize(a)]().domain(e)}this.scaleType=t},formatDate:function(t){return this._space.time.formatDate(t)},_getZoomed:function(t){var e=this["zoomed"+t];return null!==e?e:d3[t.toLowerCase()](this.getScale().domain())},getZoomedMin:function(){return this._getZoomed("Min")},getZoomedMax:function(){return this._getZoomed("Max")}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=l(n(48)),o=l(n(108)),a=l(n(49)),s=n(393);function l(t){return t&&t.__esModule?t:{default:t}}var u=r.default.extend({getClassDefaults:function(){return i.deepExtend(this._super(),{reader:"inline"})},trackInstances:!0,init:function(t,e,n,i){this._type="data",this.queryQueue={},this._collection={},this._collectionPromises={},this._super(t,e,n,i),this.readerObject=this.getReader()},preloadData:function(){return this.loadDataAvailability().then(this.loadConceptProps.bind(this))},load:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];t=i.deepClone(t),this.dataset&&(t.dataset=this.dataset),this.version&&(t.version=this.version);var o=s.DataStorage.getDataId(t,this.readerObject,n);return o?t.grouping?s.DataStorage.aggregateData(o,t,this.readerObject,this.getConceptprops()):Promise.resolve(o):(i.timeStamp("Vizabi Data: Loading Data"),r||a.default.freezeAll(["hook_change","resize"]),s.DataStorage.loadFromReader(t,n,this.readerObject).then(function(n){return t.grouping?s.DataStorage.aggregateData(n,t,e.readerObject,e.getConceptprops()):n}).then(function(t){return r||a.default.unfreezeAll(),t}).catch(function(t){r||a.default.unfreezeAll(),e.handleLoadError(t)}))},getAsset:function(t,e){var n=this;return this.readerObject.getAsset(t).then(function(t){return e(t)}).catch(function(t){return n.handleLoadError(t)})},getReader:function(){var t=o.default.get(this.reader);if(!t)throw new Error("Unknown reader: "+this.reader);return new t(this.getPlainObject())},getData:function(t,e,n,r){return t?s.DataStorage.getData(t,e,n,r):i.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)},loadDataAvailability:function(){var t=this,e={select:{key:["key","value"],value:[]},from:"concepts.schema"},n=i.extend({},e,{from:"entities.schema"}),r=i.extend({},e,{from:"datapoints.schema"});return Promise.all([this.load(e),this.load(n),this.load(r)]).then(this.handleDataAvailabilityResponse.bind(this)).catch(function(e){return t.handleLoadError(e)})},handleDataAvailabilityResponse:function(t){var e=this;this.keyAvailability=new Map,this.dataAvailability=[],t.forEach(function(t){var n=e.getData(t,"query").from.split(".")[0];e.dataAvailability[n]=[],e.getData(t).forEach(function(t){var i=("string"==typeof t.key?JSON.parse(t.key):t.key).sort();e.dataAvailability[n].push({key:new Set(i),value:t.value}),e.keyAvailability.set(i.join(","),i)})})},loadConceptProps:function(){var t=this,e=this.dataAvailability.concepts.map(function(t){return t.value}),n={select:{key:["concept"],value:["concept_type","domain","totals_among_entities","source_url","source","color","scales","interpolation","tags","name","name_short","name_catalog","description","format"].filter(function(t){return e.includes(t)})},from:"concepts",where:{},language:this.getClosestModel("locale").id};return this.load(n).then(this.handleConceptPropsResponse.bind(this)).catch(function(e){return t.handleLoadError(e)})},handleConceptPropsResponse:function(t){var e=this;this.conceptDictionary={_default:{concept:"_default",concept_type:"string",use:"constant",scales:["ordinal"],tags:"_root"}},this.conceptArray=[],this.getData(t).forEach(function(t){var n={};n.concept=t.concept,n.concept_type=t.concept_type,n.sourceLink=t.source_url,n.sourceName=t.source;try{n.color=t.color&&""!==t.color?"string"==typeof t.color?JSON.parse(t.color):t.color:null}catch(t){n.color=null}try{n.scales=t.scales&&""!==t.color?"string"==typeof t.scales?JSON.parse(t.scales):t.scales:null}catch(t){n.scales=null}if(!n.scales)switch(t.concept_type){case"measure":n.scales=["linear","log"];break;case"string":case"entity_domain":case"entity_set":case"boolean":n.scales=["ordinal"];break;case"time":n.scales=["time"];break;default:n.scales=["linear","log"]}t.interpolation?n.interpolation=t.interpolation:"measure"==t.concept_type?n.interpolation=n.scales&&"log"==n.scales[0]?"exp":"linear":"time"==t.concept_type?n.interpolation="linear":n.interpolation="stepMiddle",n.domain=t.domain,n.totals_among_entities=t.totals_among_entities,n.tags=t.tags,n.format=t.format,n.name=t.name||t.concept||"",n.name_catalog=t.name_catalog||"",n.name_short=t.name_short||t.name||t.concept||"",n.description=t.description,e.conceptDictionary[t.concept]=n,e.conceptArray.push(n)})},getConceptprops:function(t){return void 0!==t?this.conceptDictionary[t]?this.conceptDictionary[t]:(i.warn("The concept "+t+" is not found in the dictionary"),null):this.conceptDictionary},getConcept:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.index,n=void 0===e?0:e,i=t.type,r=void 0===i?null:i,o=t.includeOnlyIDs,a=void 0===o?[]:o,s=t.excludeIDs,l=void 0===s?[]:s;if(!r&&0==a.length&&0==l.length)return null;var u=this.conceptArray.filter(function(t){return!(r&&t.concept_type&&t.concept_type!==r||0!=a.length&&-1===a.indexOf(t.concept)||0!=l.length&&-1!=l.indexOf(t.concept))});return u[n]||u[u.length-1]},getDatasetName:function(){if(this.readerObject.getDatasetInfo){var t=this.readerObject.getDatasetInfo();return t.name+(t.version?" "+t.version:"")}return this._name.replace("data_","")},setGrouping:function(t,e){s.DataStorage.setGrouping(t,e)},getFrames:function(t,e,n){return s.DataStorage.getFrames(t,e,n,this.getConceptprops())},getFrame:function(t,e,n,i){return s.DataStorage.getFrame(t,e,n,i)},listenFrame:function(t,e,n,i){s.DataStorage.listenFrame(t,e,n,i)},handleLoadError:function(t){t.browserDetails=i.getBrowserDetails(),t.osName=i.getOSname(),t.homepoint=window.location.href,t.time=(new Date).toString(),this._super(t)}});e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),s=n(31);function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=((i=s)&&i.__esModule?i:{default:i}).default.extend({QUERY_FROM_CONCEPTS:"concepts",QUERY_FROM_DATAPOINTS:"datapoints",QUERY_FROM_ENTITIES:"entities",SCHEMA_QUERY_FROM_CONCEPTS:"concepts.schema",SCHEMA_QUERY_FROM_DATAPOINTS:"datapoints.schema",SCHEMA_QUERY_FROM_ENTITIES:"entities.schema",CONDITION_CALLBACKS:{$gt:function(t,e){return e>t},$gte:function(t,e){return e>=t},$lt:function(t,e){return e<t},$lte:function(t,e){return e<=t},$in:function(t,e){return t.includes(e)}},LOGICAL_TEST:{$and:"every",$or:"some"},ERRORS:{GENERIC_ERROR:"reader/error/generic"},_name:"reader",load:function(){return Promise.resolve({rows:[],columns:[]})},read:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t,r=t=this._normalizeQuery(t,n),o=r.select,s=r.from;return this.load(n).then(function(i){var r=i.rows,a=i.columns;switch(e._checkTimeParser(a,n),e.ensureDataIsCorrect(i,n),!0){case s===e.SCHEMA_QUERY_FROM_CONCEPTS:return[{key:["concept"],value:"concept_type"}];case s===e.SCHEMA_QUERY_FROM_ENTITIES:return a.slice(0,e.keySize).map(function(t){return{key:[t],value:t}});case s===e.SCHEMA_QUERY_FROM_DATAPOINTS:var l=a.slice(0,e.keySize+1);return a.slice(e.keySize+1).map(function(t){return{key:l,value:t}});case s===e.QUERY_FROM_CONCEPTS:return e._getConcepts(a,e._mapRows(r,t,n));case e._isDataQuery(s)&&o.key.length>0:return e._getData(r,t,n);default:return[]}}).catch(function(t){throw e._onLoadError(t),a.find(e.ERRORS,function(e){return e===t.name})||(t=e.error(e.ERRORS.GENERIC_ERROR,t)),t.endpoint||(t.endpoint=e._basepath),t.ddfql||(t.ddfql=i),t.details||(t.details=e._name),t})},ensureDataIsCorrect:function(){},_checkTimeParser:function(t,e){var n=t[this.keySize];e[n]||(e[n]=function(t){return t})},_normalizeQuery:function(t,e){var n=Object.assign({},t),i=n.where,r=void 0===i?{}:i,a=n.join,s=void 0===a?{}:a;return r.$and&&(r.$and=r.$and.reduce(function(t,n){return Object.keys(n).forEach(function(i){var r=n[i];if("string"==typeof r&&r.startsWith("$")){var a=s[r].where;Object.keys(a).forEach(function(n){var i=a[n],r=e[n];t.push(l({},n,r?"object"===(void 0===i?"undefined":o(i))?Object.keys(i).reduce(function(t,e){return t[e]=r(i[e]),t},{}):r(i):i))})}else{var u=e[i];t.push(l({},i,u?u(r):r))}}),t},[])),n},_getConcepts:function(t,e){var n=this;return t.map(function(i,o){var s={concept:i};if(o<n.keySize)s.concept_type="entity_domain";else if(o===n.keySize)s.concept_type="time";else{s.concept_type="measure";for(var l=e.length-1;l>-1;--l)if(a.isString(e[l][i])&&""!==e[l][i]){s.concept_type="string";var u=r(t,1);s.domain=u[0];break}}return s})},_getData:function(t,e,n){var i=e.order_by,o=r(void 0===i?[]:i,1)[0];return this._mapRows(t,e,n).reduce(this._applyQuery(e),[]).sort(function(t,e){return t[o]-e[o]})},_isDataQuery:function(t){return[this.QUERY_FROM_DATAPOINTS,this.QUERY_FROM_ENTITIES].includes(t)},_mapRows:function(t,e,n){return t.map(this._getRowMapper(e,n))},_getRowMapper:function(t,e){var n=this;return function(i){var r=!0,o=Object.keys(i).reduce(function(o,s){if(r){var l=i[s],u=String(l).trim(),c=e[s],h=a.isString(l)?c?c(u):n._parse(u):l;h||0===h?o[s]=h:t.select.key.includes(s)&&(r=!1)}return o},{});return r&&o}},_parse:function(t){return t},_applyQuery:function(t){var e=this,n=t.select,i=t.from,o=r(n.key,1)[0],a=[];return function(r,s){if(s){var l=s[o],u=i!==e.QUERY_FROM_ENTITIES||!a.includes(l);if(e._isSuitableRow(t,s)&&u){i===e.QUERY_FROM_ENTITIES&&a.push(l);var c=Object.keys(s).reduce(function(t,e){return(n.key.includes(e)||n.value.includes(e))&&(t[e]=s[e]),t},{});r.push(c)}}return r}},_isSuitableRow:function(t,e){var n=this,i=t.where;return!i||Object.keys(i).every(function(t){return n._testCondition(i[t],t,e)})},_testCondition:function(t,e,n){var i=this,r=this.LOGICAL_TEST[e],s=r?e:n[e];return void 0===s||(t instanceof Date?!(+t-+s):"object"!==(void 0===t?"undefined":o(t))?s===t||!0===t&&a.isString(s)&&"true"===s.toLowerCase().trim()||!1===t&&a.isString(s)&&"false"===s.toLowerCase().trim():r?t[r](function(t){return Object.keys(t).every(function(e){return i._testCondition(t[e],e,n)})}):Object.keys(t).every(function(e){return i.CONDITION_CALLBACKS[e](t[e],s,n)}))},_onLoadError:function(t){},error:function(t,e,n,i,r){var o=new Error;return o.name=t,o.message=e,o.details=n,o.ddfql=i,o.endpoint=r,o}});e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(55);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{show:{},showFallback:{},showItemsMaxCount:null,filter:{},dim:null,skipFilter:!1})},objectLeafs:["show","showFallback","filter","autoconfig"],dataConnectedChildren:["show","dim","grouping"],init:function(t,e,n,i){this._type="entities",this._super(t,e,n,i)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data||"data"),this._super()},afterPreload:function(){this.autoconfigureModel()},setLinkWith:function(t){},autoconfigureModel:function(){if(!this.dim&&this.autoconfig){var t=this.dataSource.getConcept(this.autoconfig);t&&(this.dim=t.concept),r.printAutoconfigResult(this)}},setInterModelListeners:function(){this.getClosestModel("locale").on("dataConnectedChange",this.handleDataConnectedChange.bind(this))},validate:function(){var t=this;if(this._super(),this.showFallback[this.dim]||this.showItemsMaxCount){var e=this.show[this.dim]||this.show.$and&&this.show.$and.filter(function(e){return e[t.dim]})[0];e?e.$in&&this.showItemsMaxCount&&e.$in.length>this.showItemsMaxCount&&(e.$in.splice(0,e.$in.length-this.showItemsMaxCount),this.show=r.deepClone(this.show)):this.showFallback[this.dim]&&(this.show=a({},this.dim,r.deepClone(this.showFallback[this.dim])))}},handleDataConnectedChange:function(t){var e=this;r.defer(function(){e.startLoading().catch(r.warn)})},_isLoading:function(){return!this._loadedOnce||this._loadCall},loadData:function(){var t=this;this.setReady(!1),this._loadCall=!0;var e=this;if(!this.dim)return this._entitySets={},this._entitySetsData={},this._entitySetsValues={},Promise.resolve();var n=this.dim;if(this._entitySets=a({},n,this._root.dataManager.getAvailableDataForKey(n,null,"entities").filter(function(e){return e.value!==n&&["entity_set","entity_domain"].includes(t._root.dataManager.getConceptProperty(e.value,"concept_type"))}).map(function(t){return t.value})),!this._entitySets[n].length)return this._entitySetsValues=a({},n,[]),this._entitySetsData=a({},n,{}),Promise.resolve();var i={language:this.getClosestModel("locale").id},r=[this._root.dataManager.getDimensionValues(n,this._entitySets[n],i)].concat(this._entitySets[n].map(function(e){return t._root.dataManager.getDimensionValues(e,["name"],i)}));return Promise.all(r).then(function(t){e._entitySetsValues=a({},n,t[0]),e._entitySetsData=a({},n,{}),e._entitySets[n].forEach(function(i,r){e._entitySetsData[n][i]=t[r+1]})})},getEntitySets:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this["_entitySets"+r.capitalize(t)][this.dim]},getDimension:function(){return this.dim},setDimension:function(t){if(this.dim!==t){var e={show:{}};e.dim=t,this.set(e)}},getFilter:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).entityTypeRequest,e=r.deepClone(this.filter[this.dim]||{});if(t||this.skipFilter)return e;var n=r.deepClone(this.show);n[this.dim]&&r.isEmpty(n[this.dim])&&delete n[this.dim];var i=[];return r.isEmpty(e)||i.push(e),r.isEmpty(n)||i.push(n),i.length>1?{$and:i}:i[0]||{}},showEntity:function(t){var e=this,n=r.deepClone(this.show),i=this.getDimension(),o=void 0;o=r.isArray(t)?t:[t];var s=n[i]||(n.$and||[]).filter(function(t){return t[i]})[0]||{$in:[]};r.forEach(o,function(t){var n=t[i];e.isShown(t)?s.$in=s.$in.filter(function(t){return t!==n}):s.$in=s.$in.concat(n)}),0===s.$in.length?n.$and?n.$and=n.$and.filter(function(t){return!t[i]}):delete n[i]:n.$and?n.$and.push(a({},i,s)):n[i]=s,this.show=n},isShown:function(t){var e=this.getDimension(),n=(this.show[e]||(this.show.$and||[]).filter(function(t){return t[e]})[0]||{}).$in;return(void 0===n?[]:n).includes(t[e])},isInShowFilter:function(t,e){t[this.getDimension()];var n=(this.show.$and||[this.show]).filter(function(t){return t[e]})[0]||{};return r.getProp(n,[e,"$in"],[]).includes(t[e])},clearShow:function(){var t=this.getDimension(),e=r.deepClone(this.show);delete e[t],this.show=e},getFilteredEntities:function(){var t=this.getDimension(),e=(this.show[t]||{}).$in;return(void 0===e?[]:e).map(function(e){return a({},t,e)})},isEntities:function(){return!0}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={build:1539165482304,version:"0.35.1"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function e(n){var r="vertical axis",o="horizontal axis",a="labels stack side by side",s="labels stack top to bottom",l="optimistic approximation: labels have different lengths",u="pessimistic approximation: all labels have the largest length";function c(t,e,n){return n.indexOf(t)===e}function h(t){var e=h.scale().domain(),l=h.scale().range();if(!e[0]&&0!==e[0]||!e[1]&&0!==e[1]||!l[0]&&0!==l[0]||!l[1]&&0!==l[1])return i.warn("d3.axisSmart() skips action because of invalid domain "+JSON.stringify(e)+" or range "+JSON.stringify(l)+" of the attached scale");if(null==f){var u=t.append("g").attr("class","tick widthSampling"),c=u.append("text").text("0");_.cssMargin||(_.cssMargin={}),_.cssMargin.top=c.style("margin-top"),_.cssMargin.bottom=c.style("margin-bottom"),_.cssMargin.left=c.style("margin-left"),_.cssMargin.right=c.style("margin-right"),_.widthOfOneDigit=c.node().getBBox().width,_.heightOfOneDigit=c.node().getBBox().height,u.remove(),h.labelFactory(_);var d=null;_.transitionDuration>0?n(d=t.transition().duration(_.transitionDuration)):n(t),t.attr("fill",null),t.attr("font-size",null),t.attr("font-family",null),t.attr("text-anchor",null);var p="top"==h.orient()||"bottom"==h.orient()?o:r,m=p==o&&h.pivot()||p==r&&!h.pivot()?s:a;t.selectAll(".vzb-axis-value").data([null]).enter().append("g").attr("class","vzb-axis-value").classed("vzb-hidden",!0).append("text");var v=h.tickPadding();if(t.selectAll("text").each(function(t,e){if(null!=h.pivot()){var n=d3.select(this);n.attr("transform","rotate("+(h.pivot()?-90:0)+")"),n.style("text-anchor",m==a?"middle":"end"),n.attr("x",m==a?p==r?-v:0:-v),n.attr("y",m==a?p==r?0:v:0),n.attr("dx",m==a&&p==r?v:0),n.attr("dy",m==a?p==r?-v:".72em":".32em")}}),null!=h.repositionLabels()){var y=function(){t.selectAll(".tick").each(function(t){var e=d3.select(this).select("text"),n=h.repositionLabels()[t]||{x:0,y:0};e.attr("x",+e.attr("x")+n.x),e.attr("y",+e.attr("y")+n.y)})};d?d.on("end",function(){return y()}):y()}var b=h.scale();_.viewportLength&&t.selectAll(".tick").classed("vzb-hidden",function(t){return b(t)<0||b(t)>_.viewportLength}),null==h.tickValuesMinor()&&h.tickValuesMinor([]);var x=t.selectAll(".tick-minor").data(g);x.exit().remove(),x=x.enter().append("line").attr("class","tick-minor").merge(x);var w=h.tickSizeMinor().outbound,S=h.tickSizeMinor().inbound;x.classed("vzb-hidden",function(t){return b(t)<0||b(t)>_.viewportLength}).attr("y1",p==o?("top"==h.orient()?1:-1)*S:b).attr("y2",p==o?("top"==h.orient()?-1:1)*w:b).attr("x1",p==r?("right"==h.orient()?-1:1)*S:b).attr("x2",p==r?("right"==h.orient()?1:-1)*w:b),t.selectAll("path").remove();var M=t.selectAll(".vzb-axis-line").data([0]);M.exit().remove(),M=M.enter().append("line").attr("class","vzb-axis-line").merge(M),_.viewportLength?M.attr("x1",p==r?0:-1).attr("x2",p==r?0:_.viewportLength).attr("y1",0).attr("y2",p==o?0:_.viewportLength):M.attr("x1",p==r?0:d3.min(b.range())-(_.bump||0)-1).attr("x2",p==r?0:d3.max(b.range())+(_.bump||0)).attr("y1",p==o?0:d3.min(b.range())-(_.bump||0)).attr("y2",p==o?0:d3.max(b.range())+(_.bump||0))}else h.highlightValueRun(t)}h.highlightValueRun=function(t){_.viewportLength&&"none"!=f&&(h.scale()(f)>_.viewportLength||h.scale()(f)<0)&&(f="none");var e="top"==h.orient()||"bottom"==h.orient()?o:r,n=e==o&&h.pivot()||e==r&&!h.pivot()?"y":"x",i=h.pivot()?-1:1;t.select(".vzb-axis-value").classed("vzb-hidden","none"==f);var a=void 0,s={};"none"!=f&&(a=t.select(".vzb-axis-value").node().getBBox(),s.bump=_.bump,s.formatter=_.formatter,s.viewportLength=_.viewportLength,s.toolMargin=_.toolMargin,s.cssMargin=_.cssMargin,s.widthOfOneDigit=a[h.pivot()?"height":"width"]/_.formatter(f).length,s.heightOfOneDigit=a[h.pivot()?"width":"height"]);var l=("none"==f?{x:0,y:0}:x([f],s,e,h.scale(),n)[f])[n],u=function(t){return"none"==f?"translate(0,0)":"translate("+(e==o?h.scale()(f)+l*i:0)+","+(e==r?h.scale()(f)+l*i:0)+")"},c=function(t,r,s){if("none"==f)return 1;var u=e==o?"width":"height",c=((h.repositionLabels()||{})[t]||{x:0,y:0})[n];return h.hlOpacityScale()(Math.abs(h.scale()(t)+c*i-h.scale()(f)-l*i)-s.getBBox()[u]/2-a[u]/2)};p?(t.select(".vzb-axis-value").transition().duration(p).ease(d3.easeLinear).attr("transform",u),t.select(".vzb-axis-value").select("text").transition("text").delay(p).text("none"==f?"":_.formatter(f)),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").transition().duration(p).ease(d3.easeLinear).style("opacity",c(t,e,this))})):(t.select(".vzb-axis-value").interrupt().attr("transform",u).transition(),t.select(".vzb-axis-value").select("text").interrupt("text").text("none"==f?"":_.formatter(f)).transition(),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").interrupt().style("opacity",c(t,e,this)).transition()})),f=null};var d=d3.scaleLinear().domain([0,5]).range([0,1]).clamp(!0);h.hlOpacityScale=function(t){return arguments.length?(d=t,h):d};var f=null;h.highlightValue=function(t){return arguments.length?(f=t,h):f};var p=0;h.highlightTransDuration=function(t){return arguments.length?(p=t,h):p};var m=null;h.repositionLabels=function(t){return arguments.length?(m=t,h):m};var v=!1;h.pivot=function(t){return arguments.length?(v=!!t,h):v};var g=[];h.tickValuesMinor=function(t){return arguments.length?(g=t,h):g};var y={outbound:0,inbound:0};h.tickSizeMinor=function(t,e){return arguments.length?(w("setting",y={outbound:t,inbound:e||0}),h):y};var _={};function b(t,e){null==e&&(e=!0);var n=[],i=[];-1!=t.indexOf(0)&&(n.push([0]),i.push(t.indexOf(0)));for(var r=function(r){n.push(t.filter(function(t,n){return!(n%Math.floor(r)!=0||-1!=i.indexOf(n)&&e)&&(i.push(n),!0)}))},o=t.length;o>=1;o=o<4?o-1:o/2)r(o);return n}function x(t,e,n,i,a){if(!t)return null;var s={},l=n==r?{head:e.toolMargin.top,tail:e.toolMargin.bottom}:{head:e.toolMargin.right,tail:e.toolMargin.left},u=i.range(),c=e.bump;return e.viewportLength&&(t=t.filter(function(t){return i(t)>=0&&i(t)<=e.viewportLength}),u=[0,e.viewportLength],c=0),t.forEach(function(h,d){if(0==d||d==t.length-1){var f=Math.min(l.head,.5*e.widthOfOneDigit)+c+(n==o?1:0)*d3.max(u)-(n==o?0:1)*d3.min(u)+(n==o?-1:1)*i(h)-("x"==a)*e.formatter(h).length*e.widthOfOneDigit/2-("y"==a)*e.heightOfOneDigit/2-("x"==a)*parseInt(e.cssMargin.right)-("y"==a)*parseInt(e.cssMargin.top),p=Math.min(l.tail,.5*e.widthOfOneDigit)+c+(n==r?1:0)*d3.max(u)-(n==r?0:1)*d3.min(u)+(n==r?-1:1)*i(h)-("x"==a)*e.formatter(h).length*e.widthOfOneDigit/2-("y"==a)*e.heightOfOneDigit/2-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom);f>0&&(f=0),p>0&&(p=0),s[h]={x:0,y:0},s[h][a]=("y"==a&&n==r?-1:1)*(f-p)}}),t.forEach(function(l,u){if(0!=u&&u!=t.length-1){var c=Math.abs(i(l)-i(t[t.length-1]))-("y"==a)*(n==o?-1:1)*s[t[t.length-1]][a]-("x"==a)*(n==o?1:-1)*s[t[t.length-1]][a]-("x"==a)*e.widthOfOneDigit/2*e.formatter(l).length-("x"==a)*e.widthOfOneDigit/2*e.formatter(t[t.length-1]).length-("y"==a)*e.heightOfOneDigit*.7-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom),h=Math.abs(i(l)-i(t[0]))-("y"==a)*(n==r?-1:1)*s[t[0]][a]-("x"==a)*(n==r?1:-1)*s[t[0]][a]-("x"==a)*e.widthOfOneDigit/2*e.formatter(l).length-("x"==a)*e.widthOfOneDigit/2*e.formatter(t[0]).length-("y"==a)*e.heightOfOneDigit*.7-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom);c>0&&(c=0),h>0&&(h=0),s[l]={x:0,y:0},s[l][a]=("y"==a&&n==r?-1:1)*(c-h)}}),s}return h.labelerOptions=function(t){return arguments.length?(_=t,h):_},h.METHOD_REPEATING="repeating specified powers",h.METHOD_DOUBLING="doubling the value",h.labelFactory=function(t){if(null==t&&(t={}),"linear"!=t.scaleType&&"time"!=t.scaleType&&"genericLog"!=t.scaleType&&"log"!=t.scaleType&&"ordinal"!=t.scaleType)return h.ticks(t.limitMaxTickNumber).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==t.scaleType)return h;null==t.logBase&&(t.logBase=10),null==t.stops&&(t.stops=[1,2,5,3,7,4,6,8,9]),null==t.removeAllLabels&&(t.removeAllLabels=!1),null==t.formatter&&(t.formatter=h.tickFormat()?h.tickFormat():function(t){return t+""}),t.cssLabelMarginLimit=5,null==t.cssMargin&&(t.cssMargin={}),(null==t.cssMargin.left||parseInt(t.cssMargin.left)<t.cssLabelMarginLimit)&&(t.cssMargin.left=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.right||parseInt(t.cssMargin.right)<t.cssLabelMarginLimit)&&(t.cssMargin.right=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.top||parseInt(t.cssMargin.top)<t.cssLabelMarginLimit)&&(t.cssMargin.top=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.bottom||parseInt(t.cssMargin.bottom)<t.cssLabelMarginLimit)&&(t.cssMargin.bottom=t.cssLabelMarginLimit+"px"),null==t.toolMargin&&(t.toolMargin={left:30,bottom:30,right:30,top:30}),null==t.bump&&(t.bump=0),null==t.viewportLength&&(t.viewportLength=0),null==t.pivotingLimit&&(t.pivotingLimit=t.toolMargin[this.orient()]),null==t.showOuter&&(t.showOuter=!1),null==t.limitMaxTickNumber&&(t.limitMaxTickNumber=0);var e="top"==this.orient()||"bottom"==this.orient()?o:r;null==t.isPivotAuto&&(t.isPivotAuto=e==r),null==t.cssFontSize&&(t.cssFontSize="13px"),null==t.widthToFontsizeRatio&&(t.widthToFontsizeRatio=.75),null==t.heightToFontsizeRatio&&(t.heightToFontsizeRatio=1.2),null==t.widthOfOneDigit&&(t.widthOfOneDigit=parseInt(t.cssFontSize)*t.widthToFontsizeRatio),null==t.heightOfOneDigit&&(t.heightOfOneDigit=parseInt(t.cssFontSize)*t.heightToFontsizeRatio),null!=t.fitIntoScale&&"pessimistic"!=t.fitIntoScale||(t.fitIntoScale=u),"optimistic"==t.fitIntoScale&&(t.fitIntoScale=l),w("********** "+e+" **********");var n=h.scale().domain(),i=h.scale().range(),a=(Math.abs(n[n.length-1]-n[0]),Math.abs(i[i.length-1]-i[0])),s=d3.min([n[0],n[n.length-1]]),d=d3.max([n[0],n[n.length-1]]),f=("linear"==t.scaleType?s<0:s<=0)&&d>=0&&"time"!=t.scaleType,p=t.showOuter?[s,d]:[],m=[],v=5;function g(e,n){return 0==e||0==n?0:(null==n&&(n=t.logBase),Math.log(e)/Math.log(n))}var y=d3.max(d3.range(s,d,(d-s)/17).concat(d).map(function(e){return t.formatter(e).replace(".","").length}))*t.widthOfOneDigit+parseInt(t.cssMargin.left),_=t.isPivotAuto&&(y>t.pivotingLimit&&e==r||!(y>t.pivotingLimit)&&!(e==r)),S=e==o&&_||e==r&&!_,M=!S&&t.heightOfOneDigit>t.pivotingLimit;if(t.removeAllLabels)return h.tickValues([]);if(s==d)return h.tickValues([s]).ticks(1).tickFormat(t.formatter);var E=function(e,n,i,r){if(null==e||e.length<=1)return!0;if(null==i&&(i=u),null==r&&(scaleType="none"),S)return n>e.length*(t.heightOfOneDigit+parseInt(t.cssMargin.top)+parseInt(t.cssMargin.bottom));var o=parseInt(t.cssMargin.left)+parseInt(t.cssMargin.right),a=d3.max(e.map(function(e){return t.formatter(e).length}));return"log"==r?(n=Math.abs(h.scale()(d3.max(e))-h.scale()(d3.min(e))))>d3.sum(e.map(function(e){return(t.widthOfOneDigit*(i==u?a:t.formatter(e).length)+o)*(1+Math.log(e.toString().replace(/([0.])/g,"")[0])/Math.LN10)})):n>e.length*o+(i==u?t.widthOfOneDigit*e.length*a:0)+(i==l?t.widthOfOneDigit*e.map(function(e){return t.formatter(e)}).join("").length:0)},z=function(e,n){if(null==n||0==n.length)return!1;n instanceof Array||(n=[n]);for(var i=0;i<n.length;i++)if(e!=n[i]&&0!=e&&Math.abs(h.scale()(e)-h.scale()(n[i]))<(S?t.heightOfOneDigit:(t.formatter(e).length+t.formatter(n[i]).length)*t.widthOfOneDigit/2))return!0;return!1};if("genericLog"==t.scaleType||"log"==t.scaleType){var k=h.scale().eps?h.scale().eps():0,T=f?[0]:[],O=d<k?[]:d3.range(Math.floor(g(Math.max(k,s))),Math.ceil(g(d)),1).concat(Math.ceil(g(d))).map(function(e){return Math.pow(t.logBase,e)}),P=s>-k?[]:d3.range(Math.floor(g(Math.max(k,-d))),Math.ceil(g(-s)),1).concat(Math.ceil(g(-s))).map(function(e){return-Math.pow(t.logBase,e)});if(null==t.method){var C=f?Math.max(Math.abs(d),Math.abs(s))/k:Math.max(Math.abs(d),Math.abs(s))/Math.min(Math.abs(d),Math.abs(s));t.method=10<=C&&C<=1024?this.METHOD_DOUBLING:this.METHOD_REPEATING}if(t.method==this.METHOD_DOUBLING&&function(){var t=[];f&&p.push(0);var e=[].concat(p),n=d<k?null:4*O[Math.floor(O.length/2)-1],i=s>-k?null:4*P[Math.floor(P.length/2)-1];if(n)for(var r=n;r<=d;r*=2)t.push(r);if(n)for(var o=n/2;o>=Math.max(s,k);o/=2)t.push(o);if(i)for(var l=i;l>=s;l*=2)t.push(l);if(i)for(var h=i/2;h<=Math.min(d,-k);h/=2)t.push(h);t=t.sort(d3.ascending).filter(function(t){return s<=t&&t<=d}),m=m.concat(t),t=b(t,!1);for(var v=p,g=0;g<t.length;g++){var y=v.concat(t[g]).filter(function(t){return!z(t,e)}).filter(c);if(!E(y,a,u,"none"))break;p=y}}(),t.method==this.METHOD_REPEATING){var A=T.concat(O).concat(P).sort(d3.ascending);t.stops.forEach(function(t,e){m=m.concat(A.map(function(e){return e*t}))}),A=b(A);var I=T.concat(p),L=!1;t.stops.forEach(function(e,n){if(0==n){for(var i,r=0;r<A.length;r++){var o=p.concat(A[r].map(function(t){return t*e})).filter(function(t){return!z(t,I)}).filter(function(t){return s<=t&&t<=d}).filter(c);if(!E(o,a,u,"none"))break;p=o}A=(i=[]).concat.apply(i,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(A))}else{if(L)return;var l=p.concat(A.map(function(t){return t*e})).filter(function(t){return s<=t&&t<=d}).filter(c);if(!E(l,a,u,"log"))return void(L=!0);if(p.length>t.limitMaxTickNumber&&0!=t.limitMaxTickNumber)return void(L=!0);p=l}})}}return"linear"!=t.scaleType&&"time"!=t.scaleType||function(){f&&p.push(0);var e=[].concat(p);v=S?Math.max(Math.floor(a/(t.heightOfOneDigit+parseInt(t.cssMargin.top))),2):Math.max(Math.floor(a/y),2),0!=t.limitMaxTickNumber&&v>t.limitMaxTickNumber&&(v=t.limitMaxTickNumber);var n=h.scale().ticks(v).sort(d3.ascending).filter(function(t){return s<=t&&t<=d});m=m.concat(n),n=b(n,!1);for(var i=p,r=0;r<n.length;r++){var o=i.concat(n[r]).filter(function(t){return!z(t,e)}).filter(c);if(!E(o,a,t.fitIntoScale,"none"))break;p=o}p=p.filter(function(t){return!z(t,e)}).filter(c)}(),null!=p&&p.length<=2&&!f&&(1!=(p=Math.abs(h.scale()(s)-h.scale()(d))<(S?t.heightOfOneDigit:(t.formatter(s).length+t.formatter(d).length)*t.widthOfOneDigit)?[d]:[s,d]).length||"linear"!=t.scaleType&&"time"!=t.scaleType||(m=[])),null!=p&&p.length<=3&&f&&(p=z(0,[s,d])?[s,d]:[s,0,d]),null!=p&&p.sort(function(t,n){return(e==o?-1:1)*(h.scale()(n)-h.scale()(t))}),M&&(p=[]),m=m.filter(function(t){return-1==p.indexOf(t)&&s<=t&&t<=d}),w("final result",p),h.ticks(v).tickFormat(t.formatter).tickValues(p).tickValuesMinor(m).pivot(_).repositionLabels(x(p,t,e,h.scale(),S?"y":"x"))},h.copy=function(){return e(d3["axis"+i.capitalize(t)]())},h.orient=function(){return arguments.length?h:t},d3.rebind(h,n,"scale","ticks","tickArguments","tickValues","tickFormat","tickSize","tickSizeInner","tickSizeOuter","tickPadding");function w(){var t;h.labelerOptions().isDevMode&&(t=console).log.apply(t,arguments)}}(d3["axis"+i.capitalize(t)]())};var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(6);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({init:function(t,e){this.name="show";this.template=this.template||n(165),this.model_expects=this.model_expects||[{name:"state"},{name:"locale",type:"locale"}],this.tabsConfig=((t.ui.dialogs.dialog||{}).find||{}).showTabs||{},this._super(t,e)},readyOnce:function(){var t=this;this._super(),this.KEYS=r.unique(this.model.state.marker._getAllDimensions({exceptType:"time"})),this.resetFilter={};var e=this.model.state.marker._space;this.KEYS.forEach(function(n){t.resetFilter[n]=r.find(e,function(t){return t.dim===n}).show}),this.parentElement=d3.select(this.parent.element),this.contentEl=this.element=d3.select(this.element.parentNode),this.list=this.element.select(".vzb-show-list"),this.input_search=this.parentElement.select(".vzb-find-search"),this.deselect_all=this.parentElement.select(".vzb-show-deselect"),this.apply=this.parentElement.select(".vzb-show-apply");var n=this;this.deselect_all.on("click",function(){n.resetShow()}),this.apply.on("click",function(){n.applyShowChanges()}),this.root.on("ready",function(){n.ready()})},ready:function(){var t=this;this._super(),this.KEYS=r.unique(this.model.state.marker._getAllDimensions({exceptType:"time"})),this.labelNames=this.model.state.marker.getLabelHookNames();var e=this.model.state.marker.getSubhooks(!0);this.previewShow={},this.checkedDifference={},r.forEach(this.labelNames,function(n){var i=e[n].getEntity(),o=t.previewShow[i._name]={};r.forEach(i.show.$and||[i.show],function(t){r.forEach(t,function(t,e){o[e]=(t.$in||[]).slice(0)})})}),this.redraw(),this.showHideButtons(),r.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},redraw:function(){var t=this,e=this;this.translator=this.model.locale.getTFunction(),this.model.state.marker.getFrame(this.model.state.time.value,function(n){if(n){var i=t.model.state.marker.getSubhooks(!0);e.list.html("");var o=[];r.forEach(t.labelNames,function(e,n){var r=i[e].getEntity(),a=r._name;o.push({dim:n,entities:a,labelName:e,key:n,category:t.root.model.dataManager.getConceptProperty(n,"name")});var s=r.getEntitySets().map(function(e){return{entities:a,key:e,dim:n,isSet:!0,category:t.root.model.dataManager.getConceptProperty(e,"name")}});o.push.apply(o,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(s))}),r.forEach(o,function(i){i.dim;var o=i.key,a=i.category,s=i.labelName,l=i.entities,u=i.isSet,c=u?t.model.state[l].getEntitySets("data")[o][0].map(function(t){var n={entities:l,category:o};return n[o]=t[o],n.label=t.name,n.isShown=e.model.state[l].isInShowFilter(t,o),n}):r.keys(n[s]).map(function(t){var i={entities:l,category:o};return i[o]=t,i.label=n[s][t],i.isShown=e.model.state[l].isInShowFilter(i,o),i});c.sort(function(t,e){return t.label<e.label?-1:1});var h=e.list.append("div").attr("class","vzb-accordion-section").classed("vzb-accordion-active","open"===t.tabsConfig[o]).datum({key:o,isSet:u});h.append("div").attr("class","vzb-accordion-section-title").on("click",function(t){var e=d3.select(this.parentNode);e.classed("vzb-fullexpand",!1).classed("vzb-accordion-active",!e.classed("vzb-accordion-active"))}).call(function(t){return t.append("span").attr("class","vzb-show-category").classed("vzb-show-category-set",function(t){return t.isSet}).text(a).attr("title",function(t){return this.offsetWidth<this.scrollWidth?a:null})}).call(function(t){return t.append("span").attr("class","vzb-show-clear-cross").text("✖").on("click",function(){d3.event.stopPropagation(),h.selectAll(".vzb-checked input").property("checked",!1).dispatch("change")})}).call(function(t){return t.append("span").attr("class","vzb-show-more vzb-dialog-button").text(e.translator("buttons/moreellipsis")).on("click",function(){d3.event.stopPropagation(),h.classed("vzb-fullexpand",!0)})});var d=h.append("div").attr("class","vzb-show-category-list"),f=d.selectAll(".vzb-show-item").data(c).enter().append("div").attr("class","vzb-show-item vzb-dialog-checkbox").classed("vzb-checked",function(t){return t.isShown});f.append("input").attr("type","checkbox").attr("class","vzb-show-item").attr("id",function(t){return"-show-"+t.category+"-"+t[o]+"-"+e._id}).property("checked",function(t){return t.isShown}).on("change",function(e,n,i){if(e.isShown!==i[n].checked?t.checkedDifference[e.category+e[o]]=!0:delete t.checkedDifference[e.category+e[o]],t.apply.classed("vzb-disabled",!Object.keys(t.checkedDifference).length),!t.previewShow[e.entities][e.category]){var r=t.model.state[e.entities].show;t.previewShow[e.entities][e.category]=((r[e.category]||(r.$and||{})[e.category]||{}).$in||[]).slice(0)}var a=t.previewShow[e.entities][e.category].indexOf(e[e.category]);-1===a?t.previewShow[e.entities][e.category].push(e[e.category]):t.previewShow[e.entities][e.category].splice(a,1)}),f.append("label").attr("for",function(t){return"-show-"+t.category+"-"+t[o]+"-"+e._id}).text(function(t){return t.label}).attr("title",function(t){return this.offsetWidth<this.scrollWidth?t.label:null});var p=d.selectAll(".vzb-checked").classed("vzb-separator",!1).lower().nodes()[0];if(p&&p.nextSibling){d3.select(p).classed("vzb-separator",!!p.nextSibling);var m=p.parentNode.offsetTop+p.offsetTop;d3.select(p.parentNode.parentNode).style("max-height",m+p.offsetHeight+25+"px").select(".vzb-show-more").style("transform","translate(0, "+m+"px)")}else h.select(".vzb-show-more").classed("vzb-hidden",!0);h.classed("vzb-filtered",!!p),h.classed("vzb-fullexpand",!!p&&"open"===t.tabsConfig[o])}),e.contentEl.node().scrollTop=0,e.input_search.attr("placeholder",e.translator("placeholder/search")+"...")}})},applyShowChanges:function(){var t=this;this.model.state.marker.clearSelected();var e={};r.forEach(this.previewShow,function(n,i){var o=[],a=[];r.forEach(n,function(t,e){var n,i,r;a.push(e),t.length&&o.push((n={},i=e,r={$in:t.slice(0)},i in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n))}),r.forEach(t.model.state[i].show.$and||[t.model.state[i].show],function(t){r.forEach(t,function(t,e){a.includes(e)||o.push(r.deepClone(t))})}),e[i]={show:o.length>1?{$and:o}:o[0]||{}}}),this.model.state.set(e)},showHideSearch:function(){if("show"===this.parent.getPanelMode()){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-show-item").classed("vzb-hidden",function(e){return-1===(e.label||"").toString().toLowerCase().indexOf(t)}),""!==t&&this.list.selectAll(".vzb-accordion-section").classed("vzb-accordion-active",!0)}},showHideButtons:function(){"show"===this.parent.getPanelMode()&&(this.deselect_all.classed("vzb-hidden",this.hideResetButton()),this.apply.classed("vzb-hidden",!1).classed("vzb-disabled",!0))},hideResetButton:function(){var t=this,e=!0,n=this.model.state.marker._space;return r.forEach(this.KEYS,function(i){return e=r.comparePlainObjects(t.resetFilter[i]||{},r.find(n,function(t){return t.dim===i}).show)}),e},resetShow:function(){var t=this,e={},n=this.model.state.marker._space;this.KEYS.forEach(function(i){var o=r.find(n,function(t){return t.dim===i})._name;e[o]={show:t.resetFilter[i]||{}}}),this.model.state.set(e)},closeClick:function(){this.applyShowChanges()}});e.default=a},function(t,e,n){t.exports=!n(8)&&!n(4)(function(){return 7!=Object.defineProperty(n(79)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){e.f=n(7)},function(t,e,n){var i=n(17),r=n(18),o=n(62)(!1),a=n(81)("IE_PROTO");t.exports=function(t,e){var n,s=r(t),l=0,u=[];for(n in s)n!=a&&i(s,n)&&u.push(n);for(;e.length>l;)i(s,n=e[l++])&&(~o(u,n)||u.push(n));return u}},function(t,e,n){var i=n(9),r=n(2),o=n(40);t.exports=n(8)?Object.defineProperties:function(t,e){r(t);for(var n,a=o(e),s=a.length,l=0;s>l;)i.f(t,n=a[l++],e[n]);return t}},function(t,e,n){var i=n(18),r=n(43).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return a&&"[object Window]"==o.call(t)?function(t){try{return r(t)}catch(t){return a.slice()}}(t):r(i(t))}},function(t,e,n){"use strict";var i=n(40),r=n(63),o=n(57),a=n(11),s=n(56),l=Object.assign;t.exports=!l||n(4)(function(){var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(t){e[t]=t}),7!=l({},t)[n]||Object.keys(l({},e)).join("")!=i})?function(t,e){for(var n=a(t),l=arguments.length,u=1,c=r.f,h=o.f;l>u;)for(var d,f=s(arguments[u++]),p=c?i(f).concat(c(f)):i(f),m=p.length,v=0;m>v;)h.call(f,d=p[v++])&&(n[d]=f[d]);return n}:l},function(t,e,n){"use strict";var i=n(13),r=n(5),o=n(120),a=[].slice,s={};t.exports=Function.bind||function(t){var e=i(this),n=a.call(arguments,1),l=function(){var i=n.concat(a.call(arguments));return this instanceof l?function(t,e,n){if(!(e in s)){for(var i=[],r=0;r<e;r++)i[r]="a["+r+"]";s[e]=Function("F,a","return new F("+i.join(",")+")")}return s[e](t,n)}(e,i.length,i):o(e,i,t)};return r(e.prototype)&&(l.prototype=e.prototype),l}},function(t,e){t.exports=function(t,e,n){var i=void 0===n;switch(e.length){case 0:return i?t():t.call(n);case 1:return i?t(e[0]):t.call(n,e[0]);case 2:return i?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return i?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return i?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},function(t,e,n){var i=n(3).parseInt,r=n(52).trim,o=n(85),a=/^[-+]?0[xX]/;t.exports=8!==i(o+"08")||22!==i(o+"0x16")?function(t,e){var n=r(String(t),3);return i(n,e>>>0||(a.test(n)?16:10))}:i},function(t,e,n){var i=n(3).parseFloat,r=n(52).trim;t.exports=1/i(n(85)+"-0")!=-1/0?function(t){var e=r(String(t),3),n=i(e);return 0===n&&"-"==e.charAt(0)?-0:n}:i},function(t,e,n){var i=n(24);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=i(t))throw TypeError(e);return+t}},function(t,e,n){var i=n(5),r=Math.floor;t.exports=function(t){return!i(t)&&isFinite(t)&&r(t)===t}},function(t,e){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,e,n){var i=n(88),r=Math.pow,o=r(2,-52),a=r(2,-23),s=r(2,127)*(2-a),l=r(2,-126);t.exports=Math.fround||function(t){var e,n,r=Math.abs(t),u=i(t);return r<l?u*(r/l/a+1/o-1/o)*l*a:(n=(e=(1+a/o)*r)-(e-r))>s||n!=n?u*(1/0):u*n}},function(t,e,n){var i=n(2);t.exports=function(t,e,n,r){try{return r?e(i(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&i(o.call(t)),e}}},function(t,e,n){var i=n(13),r=n(11),o=n(56),a=n(10);t.exports=function(t,e,n,s,l){i(e);var u=r(t),c=o(u),h=a(u.length),d=l?h-1:0,f=l?-1:1;if(n<2)for(;;){if(d in c){s=c[d],d+=f;break}if(d+=f,l?d<0:h<=d)throw TypeError("Reduce of empty array with no initial value")}for(;l?d>=0:h>d;d+=f)d in c&&(s=e(s,c[d],d,u));return s}},function(t,e,n){"use strict";var i=n(11),r=n(41),o=n(10);t.exports=[].copyWithin||function(t,e){var n=i(this),a=o(n.length),s=r(t,a),l=r(e,a),u=arguments.length>2?arguments[2]:void 0,c=Math.min((void 0===u?a:r(u,a))-l,a-s),h=1;for(l<s&&s<l+c&&(h=-1,l+=c-1,s+=c-1);c-- >0;)l in n?n[s]=n[l]:delete n[s],s+=h,l+=h;return n}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,n){n(8)&&"g"!=/./g.flags&&n(9).f(RegExp.prototype,"flags",{configurable:!0,get:n(67)})},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,n){var i=n(2),r=n(5),o=n(103);t.exports=function(t,e){if(i(t),r(e)&&e.constructor===t)return e;var n=o.f(t);return(0,n.resolve)(e),n.promise}},function(t,e,n){"use strict";var i=n(135),r=n(54);t.exports=n(71)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=i.getEntry(r(this,"Map"),t);return e&&e.v},set:function(t,e){return i.def(r(this,"Map"),0===t?0:t,e)}},i,!0)},function(t,e,n){"use strict";var i=n(9).f,r=n(42),o=n(47),a=n(23),s=n(45),l=n(46),u=n(91),c=n(130),h=n(44),d=n(8),f=n(35).fastKey,p=n(54),m=d?"_s":"size",v=function(t,e){var n,i=f(e);if("F"!==i)return t._i[i];for(n=t._f;n;n=n.n)if(n.k==e)return n};t.exports={getConstructor:function(t,e,n,u){var c=t(function(t,i){s(t,c,e,"_i"),t._t=e,t._i=r(null),t._f=void 0,t._l=void 0,t[m]=0,void 0!=i&&l(i,n,t[u],t)});return o(c.prototype,{clear:function(){for(var t=p(this,e),n=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete n[i.i];t._f=t._l=void 0,t[m]=0},delete:function(t){var n=p(this,e),i=v(n,t);if(i){var r=i.n,o=i.p;delete n._i[i.i],i.r=!0,o&&(o.n=r),r&&(r.p=o),n._f==i&&(n._f=r),n._l==i&&(n._l=o),n[m]--}return!!i},forEach:function(t){p(this,e);for(var n,i=a(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(i(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!v(p(this,e),t)}}),d&&i(c.prototype,"size",{get:function(){return p(this,e)[m]}}),c},def:function(t,e,n){var i,r,o=v(t,e);return o?o.v=n:(t._l=o={i:r=f(e,!0),k:e,v:n,p:i=t._l,n:void 0,r:!1},t._f||(t._f=o),i&&(i.n=o),t[m]++,"F"!==r&&(t._i[r]=o)),t},getEntry:v,setStrong:function(t,e,n){u(t,e,function(t,n){this._t=p(t,e),this._k=n,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?c(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,c(1))},n?"entries":"values",!n,!0),h(e)}}},function(t,e,n){"use strict";var i=n(135),r=n(54);t.exports=n(71)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return i.def(r(this,"Set"),t=0===t?0:t,t)}},i)},function(t,e,n){"use strict";var i,r=n(30)(0),o=n(15),a=n(35),s=n(118),l=n(138),u=n(5),c=n(4),h=n(54),d=a.getWeak,f=Object.isExtensible,p=l.ufstore,m={},v=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},g={get:function(t){if(u(t)){var e=d(t);return!0===e?p(h(this,"WeakMap")).get(t):e?e[this._i]:void 0}},set:function(t,e){return l.def(h(this,"WeakMap"),t,e)}},y=t.exports=n(71)("WeakMap",v,g,l,!0,!0);c(function(){return 7!=(new y).set((Object.freeze||Object)(m),7).get(m)})&&(s((i=l.getConstructor(v,"WeakMap")).prototype,g),a.NEED=!0,r(["delete","has","get","set"],function(t){var e=y.prototype,n=e[t];o(e,t,function(e,r){if(u(e)&&!f(e)){this._f||(this._f=new i);var o=this._f[t](e,r);return"set"==t?this:o}return n.call(this,e,r)})}))},function(t,e,n){"use strict";var i=n(47),r=n(35).getWeak,o=n(2),a=n(5),s=n(45),l=n(46),u=n(30),c=n(17),h=n(54),d=u(5),f=u(6),p=0,m=function(t){return t._l||(t._l=new v)},v=function(){this.a=[]},g=function(t,e){return d(t.a,function(t){return t[0]===e})};v.prototype={get:function(t){var e=g(this,t);if(e)return e[1]},has:function(t){return!!g(this,t)},set:function(t,e){var n=g(this,t);n?n[1]=e:this.a.push([t,e])},delete:function(t){var e=f(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,n,o){var u=t(function(t,i){s(t,u,e,"_i"),t._t=e,t._i=p++,t._l=void 0,void 0!=i&&l(i,n,t[o],t)});return i(u.prototype,{delete:function(t){if(!a(t))return!1;var n=r(t);return!0===n?m(h(this,e)).delete(t):n&&c(n,this._i)&&delete n[this._i]},has:function(t){if(!a(t))return!1;var n=r(t);return!0===n?m(h(this,e)).has(t):n&&c(n,this._i)}}),u},def:function(t,e,n){var i=r(o(e),!0);return!0===i?m(t).set(e,n):i[t._i]=n,t},ufstore:m}},function(t,e,n){var i=n(28),r=n(10);t.exports=function(t){if(void 0===t)return 0;var e=i(t),n=r(e);if(e!==n)throw RangeError("Wrong length!");return n}},function(t,e,n){var i=n(43),r=n(63),o=n(2),a=n(3).Reflect;t.exports=a&&a.ownKeys||function(t){var e=i.f(o(t)),n=r.f;return n?e.concat(n(t)):e}},function(t,e,n){"use strict";var i=n(64),r=n(5),o=n(10),a=n(23),s=n(7)("isConcatSpreadable");t.exports=function t(e,n,l,u,c,h,d,f){for(var p,m,v=c,g=0,y=!!d&&a(d,f,3);g<u;){if(g in l){if(p=y?y(l[g],g,n):l[g],m=!1,r(p)&&(m=void 0!==(m=p[s])?!!m:i(p)),m&&h>0)v=t(e,n,p,o(p.length),v,h-1)-1;else{if(v>=9007199254740991)throw TypeError();e[v]=p}v++}g++}return v}},function(t,e,n){var i=n(10),r=n(87),o=n(27);t.exports=function(t,e,n,a){var s=String(o(t)),l=s.length,u=void 0===n?" ":String(n),c=i(e);if(c<=l||""==u)return s;var h=c-l,d=r.call(u,Math.ceil(h/u.length));return d.length>h&&(d=d.slice(0,h)),a?d+s:s+d}},function(t,e,n){var i=n(40),r=n(18),o=n(57).f;t.exports=function(t){return function(e){for(var n,a=r(e),s=i(a),l=s.length,u=0,c=[];l>u;)o.call(a,n=s[u++])&&c.push(t?[n,a[n]]:a[n]);return c}}},function(t,e,n){var i=n(58),r=n(145);t.exports=function(t){return function(){if(i(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,n){var i=n(46);t.exports=function(t,e){var n=[];return i(t,!1,n.push,n,e),n}},function(t,e){t.exports=Math.scale||function(t,e,n,i,r){return 0===arguments.length||t!=t||e!=e||n!=n||i!=i||r!=r?NaN:t===1/0||t===-1/0?t:(t-e)*(r-i)/(n-e)+i}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=c(n(48)),a=c(n(6)),s=n(49),l=(c(s),c(n(394))),u=c(n(395));function c(t){return t&&t.__esModule?t:{default:t}}var h=o.default.extend({init:function(t,e){this._id=r.uniqueId("tm"),this._type="tool",this._component=t,this.dimensionManager=(0,l.default)(this),this.dataManager=(0,u.default)(this),this.getClassDefaults=function(){return t.default_model};var n=r.extend(t.getToolListeners(),e.bind);delete e.bind,this._super(t.name,e,null,n)},getDefaults:function(){return r.deepExtend({},this.getSubmodelDefaults(),this.getClassDefaults())},validate:function(){var t=10,e=this;!function n(i){var o=JSON.stringify(e.getPlainObject());e._component.validate(e);var a=JSON.stringify(e.getPlainObject());i>=t?r.error("Max validation loop."):o!==a&&n(i++)}(0)}}),d=a.default.extend({init:function(t,e){this._id=r.uniqueId("t"),this.template=this.getToolTemplate(),this._super({placeholder:t,model:e}),this.prerender(),this.setCSSClasses(),this.setResizeHandler(),this.postrender()},createModel:function(t){(t=t||{}).bind=t.bind||{},this.model=new h(this,t),this.model.setInterModelListeners()},getToolTemplate:function(){return this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-time-speed-sliders"><div class="vzb-tool-timeslider"></div><div class="vzb-tool-stepped-speed-slider"></div></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>'},getToolListeners:function(){var t=this,e=this;return r.extend(this.model_binds,{readyOnce:function(){return t.setResizeHandler()},change:function(t,n){e._ready&&(e.model.validate(),t.source.persistent&&e.model.trigger(new s.DefaultEvent(t.source,"persistentChange")))},hook_change:function(){e.model.state.time.splash||e.beforeLoading()},"resize:ui":function(){e._ready&&e.triggerResize()},"translate:locale":function(){e.translateStrings(),e.model.ui.setRTL(e.model.locale.isRTL())},load_error1:function(e,n){t.renderError(n)}})},setResizeHandler:function(){this.model.ui.setContainer(this.element)},getVizWidthHeight:function(){var t=0,e=0;return this.element?(t=d3.select(this.element).select(".vzb-tool-viz").node().clientWidth,e=d3.select(this.element).select(".vzb-tool-viz").node().clientHeight):r.warn("Tool getVizWidthHeight(): missing this.element"),{width:t,height:e}},triggerResize:r.throttle(function(){this.trigger("resize")},100),startLoading:function(){var t=this;this._super(),Promise.all([this.model.startPreload(),this.startPreload()]).then(this.afterPreload.bind(this)).then(this.loadSplashScreen.bind(this)).then(function(){return r.delay(300)}).then(this.model.startLoading.bind(this.model)).then(this.finishLoading.bind(this)).catch(function(e){r.error("error in tool promise chain"),t.model.triggerLoadError(e)})},loadSplashScreen:function(){return this.model.ui.splash?(this.model.state.time.splash=!0,this.model.startLoading({splashScreen:!0})):Promise.resolve()},finishLoading:function(){this.model.state.time.splash=!1},getPersistentModel:function(){var t=this.model.getPlainObject(!0);return function t(e){for(var n in e)"function"==typeof e[n]?(delete e[n],r.warn("minModel validation. Function found in enumerable properties of "+n+". This key is deleted from minModel")):"object"===i(e[n])&&t(e[n])}(t),t},getPersistentMinimalModel:function(t){var e=this.model.getDefaults(),n=this.getPersistentModel(),i=r.deepExtend(e,t);return r.diffObject(n,i)},clear:function(){this.model.ui.clear(),this.setModel=this.getModel=function(){},this._super()},setModel:function(t,e){e?this.model.reset(t):this.model.set(t),this.setCSSClasses()},getModel:function(){return this.model.getPlainObject()||{}},beforeLoading:function(){r.addClass(this.placeholder,"vzb-loading-data")},validate:function(t){if(!(t=this.model||t)||!t.state)return r.warn("tool validation aborted: model.state looks wrong: "+t)},setCSSClasses:function(){r.addClass(this.placeholder,"vzb-placeholder"),this.model.ui&&this.model.ui.buttons&&this.model.ui.buttons.length?r.removeClass(this.element,"vzb-buttonlist-off"):r.addClass(this.element,"vzb-buttonlist-off")}});e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(32);var a={_continuous:{_default:"#ffb600",0:"hsl(270, 80%, 55%)",25:"hsl(202.5, 80%, 55%)",50:"hsl(135, 80%, 55%)",75:"hsl(48, 70%, 62%)",100:"hsl(0, 80%, 55%)"},_discrete:{_default:"#ffb600",0:"#4cd843",1:"#e83739",2:"#ff7f00",3:"#c027d4",4:"#d66425",5:"#0ab8d8",6:"#bcfa83",7:"#ff8684",8:"#ffb04b",9:"#f599f5",10:"#f4f459",11:"#7fb5ed"},_default:{_default:"#ffb600"}},s=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,scaleType:null,syncModels:[],palette:{},paletteLabels:null,allow:{scales:["linear","log","genericLog","time","pow","ordinal"]}})},init:function(t,e,n,i){var r=this;this._type="color",this._super(t,e,n,i),this._syncModelReferences={},this._hasDefaultColor=!1,this.on("hook_change",function(){if(!r._readyOnce&&!r._loadCall&&(r._setSyncModels(),r.palette&&0!==Object.keys(r.palette._data).length)){var t=r.getDefaultPalette(),e=r.getPalette(),n={};Object.keys(t).forEach(function(i){e[i]&&t[i]!=e[i]||(n[i]=t[i])}),r.set("palette",n,!1,!1)}})},afterPreload:function(){this._super(),this._setSyncModels()},getColorShade:function(t){var e=this.getPalette();if(!t)return r.warn("getColorShade() is missing arguments");if(!r.isArray(e[t.colorID]))return"shade"==t.shadeID?d3.rgb(e[t.colorID]||this.scale(t.colorID)).darker(.5).toString():e[t.colorID];var n=this.getConceptprops().color,i=t.shadeID&&n&&n.shades&&n.shades[t.shadeID]?n.shades[t.shadeID]:0;return e[t.colorID][i]},isUserSelectable:function(){var t=this.getConceptprops().color;return null==t||null==t.selectable||t.selectable},setWhich:function(t){this.palette&&(this.palette._data={}),this._super(t),this._setSyncModels()},_setSyncModels:function(){var t=this;this.syncModels.forEach(function(e){var n=t.getClosestModel(e),i=n.isHook()?n._parent:n,r=i.getClosestModel(i.space[0]);t._syncModelReferences[e]={model:n,marker:i,entities:r},t.isDiscrete()&&"constant"!==t.use&&t._setSyncModel(n,i,r)})},_setSyncModel:function(t,e,n){if(t==e){var i={dim:this.which,show:{}};e.setDataSourceForAllSubhooks(this.data),n.set(i,!1,!1)}else t.isDiscrete()&&t.set({which:this.which,data:this.data,spaceRef:this.spaceRef},!1,!1)},getColorlegendMarker:function(){return(this._syncModelReferences.marker_colorlegend||{}).marker},getColorlegendEntities:function(){return(this._syncModelReferences.marker_colorlegend||{}).entities},setColor:function(t,e,n){var i=void 0,o=this.getPalette();this.isDiscrete()?(i=this.scale.range())[this.scale.domain().indexOf(e)]=t:(o[e]=t,i=r.values(o)),this.scale.range(i),this.palette.set(e,t,n,n)},mapValue:function(t){return null!=this.scale&&this.isDiscrete()&&this._hasDefaultColor&&-1==this.scale.domain().indexOf(t)&&(t="_default"),this._super(t)},getDefaultPalette:function(){var t=this.getConceptprops().color,e=void 0;return this.discreteDefaultPalette=!1,t&&t.palette?e=r.clone(t.palette):a[this.which]?e=r.clone(a[this.which]):"constant"===this.use?e=/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(this.which)?{_default:this.which}:r.clone(a._default):(e=r.clone(a[this.isDiscrete()?"_discrete":"_continuous"]),this.discreteDefaultPalette=!0),e},_getPaletteLabels:function(){var t=this.getConceptprops().color,e=null;return t&&t.paletteLabels&&(e=r.clone(t.paletteLabels)),e},getPaletteLabels:function(){return this.paletteLabels.getPlainObject()},getPalette:function(){if(!this.palette||0===Object.keys(this.palette._data).length){var t=this.getDefaultPalette();this.set("palette",t,!1,!1);var e=this._getPaletteLabels();this.set("paletteLabels",e,!1,!1)}var n=this.palette.getPlainObject();return"ordinal"!==this.scaleType&&delete n._default,n},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=this.getPalette(),n=Object.keys(e),i=r.values(e);if(this._hasDefaultColor=n.indexOf("_default")>-1,"time"==t){var o=this._space.time,s=o.splash?{min:o.parse(o.startOrigin),max:o.parse(o.endOrigin)}:{min:o.start,max:o.end},l=s.max-s.min==0;i=(n=n.sort(function(t,e){return t-e})).map(function(t){return l?e[n[0]]:e[t]}),n=n.map(function(t){return s.min.valueOf()+t/100*(s.max.valueOf()-s.min.valueOf())}),this.scale=d3.scaleUtc().domain(n).range(i).interpolate(d3.interpolateCubehelix)}else if(this.isDiscrete()){if(i=i.map(function(t){return r.isArray(t)?t[0]:t}),t="ordinal",this.discreteDefaultPalette){var u=r.extend({},a._discrete);delete u._default;var c=Object.keys(u);i=(n=[].concat(this.getUnique(this.which))).map(function(t,n){return e[t]||u[c[n%c.length]]}),n.push("_default"),i.push(e._default)}this.scale=d3["scale"+r.capitalize(t)]().domain(n).range(i)}else{var h=this.getLimits(this.which),d=(h=[h.min,h.max])[1]-h[0]==0;if(i=(n=n.sort(function(t,e){return t-e})).map(function(t){return d?e[n[0]]:e[t]}),n=n.map(function(t){return h[0]+t/100*(h[1]-h[0])}),d3.min(n)<=0&&d3.max(n)>=0&&"log"===t&&(t="genericLog"),"log"===t||"genericLog"===t){var f=d3.scaleGenericlog().domain(h).range(h);n=n.map(function(t){return f.invert(t)})}this.scale=d3["scale"+r.capitalize(t)]().domain(n).range(i).interpolate(d3.interpolateCubehelix)}this.scaleType=t}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(32);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,merge:!1,manualSorting:null,spaceRef:null,scaleType:"ordinal"})},init:function(t,e,n,i){this._type="model",this._super(t,e,n,i)},validate:function(){this.scale&&(this.scale=null),"property"!=this.use&&"constant"!=this.use&&(r.warn("group model: use must be 'property' or 'constant'. Resetting to property..."),this.use="property")}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(32);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null})},init:function(t,e,n,i){this._type="label",this._super(t,e,n,i)},autoconfigureModel:function(t){!this.which&&this.autoconfig&&(t=this._parent.getAvailableConcept(this.autoconfig)||this._parent.getAvailableConcept({type:"entity_domain"})),this._super(t)}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(55);var a=["ar","ar-SA","he","he-IL"],s=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{id:"en",filePath:"assets/translation/"})},dataConnectedChildren:["id"],strings:{},init:function(t,e,n,i){this._type="locale",this._super(t,e,n,i)},_isLoading:function(){return!this._loadedOnce||this._loadCall},preloadData:function(){return this.loadData()},loadData:function(t){var e=this;this.setReady(!1),this._loadCall=!0;var n=[];return t&&t.dataConnectedChange&&r.forEach(this._root._data,function(t){"data"===t._type&&n.push(t.loadConceptProps())}),this.strings[this.id]||n.push(new Promise(function(t,n){r.d3json(e.filePath+e.id+".json",function(i,r){if(i)return n(i);e._handleNewStrings(r),t()})})),Promise.all(n).then(function(){return e.trigger("translate")}).catch(function(t){return e.handleLoadError(t)})},_handleNewStrings:function(t){this.strings[this.id]=this.strings[this.id]?r.extend(this.strings[this.id],t):t},getUIString:function(t){return this.strings&&this.strings[this.id]&&(this.strings[this.id][t]||""===this.strings[this.id][t])?this.strings[this.id][t]:(this.strings&&this.strings[this.id]||r.warn("Strings are not loaded for the "+this.id+" locale. Check if translation JSON is valid"),t)},getTFunction:function(){var t=this;return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(n).reduce(function(t,e){var i=new RegExp("{{"+e+"}}","g");return t.replace(i,n[e])},t.getUIString(e))}},isRTL:function(){return-1!==a.indexOf(this.id)}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(32);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null})},init:function(t,e,n,i){this._type="side",i.readyOnce=this.readyOnce,this.state={left:{},right:{}},this._super(t,e,n,i)},readyOnce:function(){if(this.spaceRef){var t=this._space[this.spaceRef].dataConnectedChildren.slice(0);t.splice(t.indexOf("show"),1),this._space[this.spaceRef].dataConnectedChildren=t}},switchSideState:function(){var t=this.state.left;this.state.left=this.state.right,this.state.right=t},clearSideState:function(){this.state={left:{},right:{}}}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(106),o=(i=r)&&i.__esModule?i:{default:i},a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1));var s=o.default.extend({getClassDefaults:function(){return a.deepExtend(this._super(),{use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,fixBaseline:0,extent:[0,.85],scaleType:null,allow:{scales:["ordinal","linear","log","genericLog","pow"]}})},_type:"size",buildScale:function(){this._super(),"ordinal"!==this.scaleType&&this.scale.clamp(!0)}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(32);var a={ALL:"all",_default:"none"},s=((i=o)&&i.__esModule?i:{default:i}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,merge:!1,spaceRef:null})},init:function(t,e,n,i){this._type="model",this._super(t,e,n,i)},validate:function(){this.scale&&(this.scale=null),"indicator"===this.use&&(r.warn("stack model: use must not be 'indicator'. Resetting use to 'constant' and which to '"+a._default),this.use="constant",this.which=a._default),"constant"===this.use&&-1==r.values(a).indexOf(this.which)&&(r.warn("stack model: the requested value '"+this.which+"' is not allowed. resetting to '"+a._default),this.which=a._default,this.spaceRef=null)},getPalettes:function(){return a},buildScale:function(){}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(55),a=(i=o)&&i.__esModule?i:{default:i};function s(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Date.prototype.utc=Date.prototype.toUTCString;var l={year:{data:d3.time.format.utc("%Y"),ui:d3.time.format.utc("%Y")},month:{data:d3.time.format.utc("%Y-%m"),ui:d3.time.format.utc("%b %Y")},day:{data:d3.time.format.utc("%Y%m%d"),ui:d3.time.format.utc("%c")},hour:{data:d3.time.format.utc("%Y%m%dT%H"),ui:d3.time.format.utc("%b %d %Y, %H")},minute:{data:d3.time.format.utc("%Y%m%dT%H%M"),ui:d3.time.format.utc("%b %d %Y, %H:%M")},second:{data:d3.time.format.utc("%Y%m%dT%H%M%S"),ui:d3.time.format.utc("%b %d %Y, %H:%M:%S")},week:{data:c(),ui:c()},quarter:{data:h(),ui:h()}},u=a.default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{dim:null,value:null,start:null,end:null,startOrigin:null,endOrigin:null,startSelected:null,endSelected:null,playable:!0,playing:!1,loop:!1,round:"round",delay:150,delayThresholdX2:90,delayThresholdX4:45,unit:"year",format:{data:null,ui:null},step:1,immediatePlay:!0,record:!1,offset:0})},objectLeafs:["autoconfig"],dataConnectedChildren:["startOrigin","endOrigin","dim"],init:function(t,e,n,i){this._type="time",this.hooksToListen=new Set([]),this._super(t,e,n,i);var r=this;this.initFormatters(),this.dragging=!1,this.postponePause=!1,this.allSteps={},this.delayAnimations=this.delay,this.on({"change:playing":function(){!0===r.playing?r._startPlaying():r._stopPlaying()},"change:format":function(){r.initFormatters()}})},initFormatters:function(){l[this.unit]&&(this.formatters=l[this.unit]),"string"==typeof this.format?this.formatters.data=this.formatters.ui=d3.time.format.utc(this.format):(this.format.data&&(this.formatters.data=d3.time.format.utc(this.format.data)),this.format.ui&&(this.formatters.ui=d3.time.format.utc(this.format.ui))),this.validateFormatting()},preloadData:function(){return this.dataSource=this.getClosestModel(this.data||"data"),this._super()},afterPreload:function(){this.autoconfigureModel()},_isLoading:function(){return![].concat(s(this.hooksToListen)).every(function(t){return t._ready})},autoconfigureModel:function(){if(!this.dim&&this.autoconfig){var t=this.dataSource.getConcept(this.autoconfig);t&&(this.dim=t.concept),r.printAutoconfigResult(this)}},setLinkWith:function(t){var e=this;this.hooksToListen.add(t),t.on("startLoading",function(){return e.setReady(!1)}),t.on("ready",this.checkTimeLimits.bind(this))},unsetLinkWith:function(t){var e=this;this.hooksToListen.delete(t),t.off("startLoading",function(){return e.setReady(!1)}),t.off("ready",this.checkTimeLimits.bind(this))},checkTimeLimits:function(){var t=this;if([].concat(s(this.hooksToListen)).every(function(t){return t._ready})){var e=[this.startOrigin],n=[this.endOrigin];this.hooksToListen.forEach(function(t){var i=t.getTimespan();if(i&&i.min&&i.max){if(!r.isDate(i.min)||!r.isDate(i.max))return r.warn("checkTimeLimits(): min-max for hook "+t._name+" look wrong: "+i.min+" "+i.max+". Expecting Date objects. Ensure that time is properly parsed in the data from reader");e.push(i.min),n.push(i.max)}});var i=d3.max(e),o=d3.min(n);i>o&&(r.warn("checkTimeLimits(): Availability of the indicator's data has no intersection. I give up and just return some valid time range where you'll find no data points. Enjoy!"),i=d3.min(e),o=d3.max(n));var a={};this.start-i==0&&(this.start||this.startOrigin)||(a.start=i),this.end-o==0&&(this.end||this.endOrigin)||(a.end=o),null==this.startSelected&&(a.startSelected=i),null==this.endSelected&&(a.endSelected=o),null==this.value&&(a.value=this.parse(this.formatDate(new Date))),this.setTreeFreezer(!0),this.set(a,!1,!1),(a.start||a.end)&&this.hooksToListen.forEach(function(e){e.which==t.dim&&e.buildScale()}),this.setTreeFreezer(!1),this.setReady()}},_formatToDates:function(){for(var t=["value"],e=["value","start","end","startSelected","endSelected"],n=0;n<e.length;n++){var i=e[n];if(!r.isDate(this[i])){var o=this.parse(this[i]);this.set(i,o,null,-1!==t.indexOf(i))}}},formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return-1===["data","ui"].indexOf(e)&&(r.warn("Time.formatDate type parameter ("+e+') invalid. Using "data".'),e=data),null==t?null:this.formatters[e](t)},parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return null==t?null:this.formatters[e].parse(t.toString())},findFormat:function(t){for(var e=Object.keys(l),n=0;n<e.length;n++){var i=l[e[n]].data.parse(t);if(i)return{unit:e[n],time:i,type:"data"};if(i=l[e[n]].ui.parse(t))return{unit:e[n],time:i,type:"ui"}}return null},validate:function(){null==this.start&&this.startOrigin&&this.set("start",this.startOrigin,null,!1),null==this.end&&this.endOrigin&&this.set("end",this.endOrigin,null,!1),this.formatters&&this.validateFormatting(),l[this.unit]||(r.warn(this.unit+' is not a valid time unit, using "year" instead.'),this.unit="year"),this.step<1&&(this.step=1),this.end<this.start&&null!=this.start&&this.set("end",new Date(this.start),null,!1),this.value<this.startSelected&&null!=this.value&&null!=this.startSelected&&(this.value=new Date(this.startSelected)),this.value>this.endSelected&&null!=this.value&&null!=this.endSelected&&(this.value=new Date(this.endSelected)),!1===this.splash&&((!this.startSelected||this.startSelected<this.start)&&null!=this.start&&this.set({startSelected:new Date(this.start)},null,!1),(!this.endSelected||this.endSelected>this.end)&&null!=this.end&&this.set({endSelected:new Date(this.end)},null,!1)),this.value<this.start&&null!=this.value&&null!=this.start?this.value=new Date(this.start):this.value>this.end&&null!=this.value&&null!=this.end&&(this.value=new Date(this.end)),!1===this.playable&&!0===this.playing&&this.set("playing",!1,null,!1)},validateFormatting:function(){r.isDate(this.start)&&r.isDate(this.end)&&r.isDate(this.value)&&r.isDate(this.startSelected)&&r.isDate(this.endSelected)||this._formatToDates()},play:function(){this._startPlaying()},pause:function(t){t?this.postponePause=!0:this.playing&&(this.set("playing",!1,null,!1),this.set("value",this.value,!0,!0))},dragStart:function(){this.dragging=!0},dragStop:function(){this.dragging=!1},getRange:function(){var t=this.getIntervalAndStep();return d3["utc"+t.interval].range(this.start,this.end,t.step)},getIntervalAndStep:function(){var t=void 0,e=void 0;switch(this.unit){case"week":t="monday",e=this.step;break;case"quarter":t="month",e=3*this.step;break;default:t=this.unit,e=this.step}return{interval:r.capitalize(t),step:e}},getFilter:function(t){var e=t.splash,n=this.parse(this.startOrigin),i=this.parse(this.endOrigin),r=this.getDimension(),o=null;if(e)null!=this.value&&((o={})[r]=this.formatters.data(this.value));else{var a=void 0,s=void 0;null!=n&&(a=this.formatters.data(n)),null!=i&&(s=this.formatters.data(i)),(a||s)&&((o={})[r]={},a&&(o[r].$gte=a),s&&(o[r].$lte=s))}return o},getParser:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t].parse},getFormatter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t]},getAllSteps:function(){if(!this.start||!this.end)return r.warn("getAllSteps(): invalid start/end time is detected: "+this.start+", "+this.end),[];var t=""+this.offset+this.start+this.end+this.step;if(this.allSteps[t])return this.allSteps[t];this.allSteps[t]=[];for(var e=this.getIntervalAndStep(),n=d3["utc"+e.interval].count(this.start,this.end)<this.offset?new Date(this.start):d3["utc"+e.interval].offset(this.start,this.offset);+n<=+this.end;){var i=this.getIntervalAndStep();this.allSteps[t].push(n),n=d3["utc"+i.interval].offset(n,i.step)}return this.allSteps[t]},snap:function(t){if(this.round){null==t&&(t="value");var e="round";"ceil"===this.round&&(e="ceil"),"floor"===this.round&&(e="floor");var n=this.getIntervalAndStep(),i=d3["utc"+n.interval][e](this[t]);this.value-i==0&&this.value-this.start!=0&&this.value-this.end!=0||this.set(t,i,!0)}},_startPlaying:function(){if(this.playable){this.value>=this.endSelected&&this.getModelObject("value").set(this.startSelected,null,!1),this.set("playing",!0,null,!1),this.playInterval(this.immediatePlay),this.trigger("play")}},playInterval:function(t){if(this.playing){var e=this;this.delayAnimations=this.delay,this.delay<this.delayThresholdX2&&(this.delayAnimations*=2),this.delay<this.delayThresholdX4&&(this.delayAnimations*=2);var n=t?1:this.delayAnimations;this._intervals.setInterval("playInterval_"+this._id,function(){if(e.value>=e.endSelected)e.loop?e.getModelObject("value").set(e.startSelected,null,!1):e.set("playing",!1,null,!1);else if(e._intervals.clearInterval("playInterval_"+e._id),e.postponePause||!e.playing)e.set("playing",!1,null,!1),e.postponePause=!1,e.getModelObject("value").set(e.value,!0,!0);else{var t=e.getIntervalAndStep();e.delay<e.delayThresholdX2&&(t.step*=2),e.delay<e.delayThresholdX4&&(t.step*=2);var n=d3["utc"+t.interval].offset(e.value,t.step);n>=e.endSelected?e.getModelObject("value").set(e.endSelected,null,!0):e.getModelObject("value").set(n,null,!1),e.playInterval()}},n)}},incrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,e.step)},decrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,-e.step)},_stopPlaying:function(){this._intervals.clearInterval("playInterval_"+this._id),this.trigger("pause")}});function c(){var t=function(t){return e(t)+"w"+n(t)};t.parse=function(t){var e=t.match(/^(\d{4})w(\d{2})$/);return e?i(e[1],e[2]):null};var e=function(t){return t instanceof Date||(t=new Date(+t)),new Date(+t+864e5*(4-(t.getUTCDay()||7))).getUTCFullYear()},n=function(t){t instanceof Date||(t=new Date(+t));var e=new Date(+t+864e5*(4-(t.getUTCDay()||7))),n=Math.ceil(((e.getTime()-e.setUTCMonth(0,1))/864e5+1)/7);return n<10?"0"+n:n},i=function(t,e){var n=parseInt(e),i=t,r=new Date;r.setUTCFullYear(i),r.setUTCMonth(0),r.setUTCDate(4);var o=7*n+1-((r.getUTCDay()||7)+4),a=l.year.data.parse(i);return a=new Date(a.getTime()+24*o*60*60*1e3)};return t}function h(){var t=function(t){return l.year.data(t)+"q"+e(t)};t.parse=function(t){var e=t.match(/^(\d{4})q(\d)$/);return e?n(e[1],e[2]):null};var e=function(t){return t instanceof Date||(t=new Date(+t)),1+(t.getUTCMonth()/3|0)},n=function(t,e){var n=3*parseInt(e)-2,i=t;return l.month.data.parse([i,(n<9?"0":"")+n].join("-"))};return t}e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(48);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({screen_profiles:{small:{min_width:0,min_height:0},medium:{min_width:600,min_height:400},large:{min_width:900,min_height:520}},getClassDefaults:function(){return r.deepExtend(this._super(),{presentation:!1,buttons:[],dialogs:{dialog:{find:{enableSelectShowSwitch:!1}},popup:[],sidebar:[],moreoptions:[]},splash:!1})},init:function(t,e,n,i){this._type="ui",this._container=null,this._curr_profile="small",this._prev_size={},this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler),i["change:presentation"]=this.updatePresentation.bind(this),this._super(t,e,n,i);var o;(o=/(?:iPad|iPhone|iPod).+OS\s+(\d+)_(\d+)/.exec(navigator.userAgent))&&+o[1]>=10&&+o[2]>2&&!window.MSStream&&(this.setSize=r.debounce(this.setSize,500))},resizeHandler:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._container&&this.setSize(t.force||!1)},setSize:function(t){var e=this,n=this._container.clientWidth,i=this._container.clientHeight;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this._container.style.top=0,this._container.clientWidth>this._container.clientHeight&&this._container.clientWidth<700)){var o=this._container.clientHeight,a=window.innerHeight;2<o-a&&o-a<=45&&(this._container.style.top="44px",document.body.scrollTop=44)}(t||!this._prev_size||this._prev_size.width!==n||this._prev_size.height!==i)&&n&&i&&(r.forEach(this.screen_profiles,function(t,o){r.removeClass(e._container,"vzb-"+o),n>=t.min_width&&i>=t.min_height&&(e._curr_profile=o)}),r.addClass(this._container,"vzb-"+this._curr_profile),r.classed(this._container,"vzb-portrait",n<i),r.classed(this._container,"vzb-landscape",!(n<i)),this._prev_size.width=n,this._prev_size.height=i,this.trigger("resize"))},setContainer:function(t){t.clientWidth&&t.clientHeight||r.warn("Vizabi is being initialised with a container of incorrect width or height. While this may be handled without a crash, it's not considered a healthy behavior. You should call Vizabi(placeholder,...) function when placeholder is not display:none and has some >0 !=auto width and height"),this._container=t,this.setSize(),this.updatePresentation()},updatePresentation:function(){r.classed(this._container,"vzb-presentation",this.presentation),this.trigger("resize")},getPresentationMode:function(){return this.presentation},setRTL:function(t){r.classed(this._container,"vzb-rtl",t)},currentProfile:function(){return this._curr_profile},clear:function(){window.removeEventListener("resize",this.resizeHandler)}});e.default=a},function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return function t(e){var n=[],r=[],o=.1,a=5,s=e.domain(),l=e.range(),u=null,c=void 0,h=void 0,d=function(t){return t instanceof Array?t.map(function(t){return Math.abs(t)}):Math.abs(t)},f=function(t,e){return{domain:t,sign:1,range:e,scale:d3.scaleLinear().domain(t).range(e)}},p=function(t,e,n){var i=t;return n&&(i=d(t)),{domain:t,sign:n?-1:1,range:e,scale:d3.scaleLog().domain(i).range(e)}},m=function(){var t=(c=l[0]<l[l.length-1])?1:-1;if(n=[],1==r.length)n=r[0][0]<=0&&r[0][1]>=0?[f(r[0],l)]:[p(r[0],l,r[0][0]<=0)];else{var i=d3.max(d(s)),u=d(d3.max(l)-d3.min(l)),m=1,v=0,g=0,y=0,_=0;e.domain([o,i]).range([0,u]);var b=a;0!=s[0]&&d(s[0])>o&&(v=e(d(s[0]))),0!=s[s.length-1]&&d(s.length-1)>o&&(g=e(d(s[s.length-1]))),d(s[0])>o&&(y=b),d(s[s.length-1])>o&&(_=b),u=u-y-_,0!=g&&(m=d(v/g));var x=void 0,w=void 0;2==r.length?0==s[0]||d(s[0])<=o?(x=l[0]+v*m*t+_*t,n=[f(r[0],[l[0],x]),p(r[1],[x,l[l.length-1]],!h)]):(0==s[s.length-1]||d(s[s.length-1])<=o)&&(x=l[l.length-1]-(y+_)*m*t,n=[p(r[0],[l[0],x],h),f(r[1],[x,l[l.length-1]])]):(x=l[0]+u/(1/m+1)*t,w=l[0]+(u/(1/m+1)+y+_)*t,n=[p(r[0],[l[0],x],h),f(r[1],[x,w]),p(r[2],[w,l[l.length-1]],!h)])}},v=function(t){if(h){if(t<s[0])return n[0];if(t>s[s.length-1])return n[n.length-1];for(var e=0;e<n.length;e++)if(t>=n[e].domain[0]&&t<=n[e].domain[n[e].domain.length-1])return n[e]}else{if(t>s[0])return n[0];if(t<s[s.length-1])return n[n.length-1];for(var i=0;i<n.length;i++)if(t<=n[i].domain[0]&&t>=n[i].domain[n[i].domain.length-1])return n[i]}};function g(t){var e=v(t);return u?u(e.scale(t*e.sign)):e.scale(t*e.sign)}return Math.sign=Math.sign||function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1},g.eps=function(t){return arguments.length?(o=t,g.domain(s),g):o},g.delta=function(t){return arguments.length?(a=t,g.range(l),g):a},g.domain=function(t){if(!arguments.length)return s;switch(t.length){case 0:t=s;break;case 1:t=[t[0]/2,2*t[0]]}t[0]==t[t.length-1]&&(t[0]/=2,t[t.length-1]=2*t[t.length-1]),s=t;var e=d3.min(d(s).filter(function(t){return!!t}));return e&&(o=Math.min(o,e/100)),function(){if(h=s[0]<s[s.length-1],r=[],d3.min(s)>0&&d3.max(s)>0||d3.min(s)<0&&d3.max(s)<0)r=[s];else{var t=void 0,e=void 0;h?(t=s[0],e=s[s.length-1]):(t=s[s.length-1],e=s[0]);for(var n=function(t,e){h?r.push([t,e]):r.unshift([e,t])};t!=e;)e<=-o||t>=-o&&e<=o||t>=o?(n(t,e),t=e):t<-o&&e>=-o?(n(t,-o),t=-o):t>=-o&&e>=o?(n(t,o),t=o):(console.warn("Something wrong while build subdomains: "+t+" "+e),t=e)}m()}(),g},g.range=function(t,e){if(!arguments.length)return u?u.range():l;switch(t.length){case 0:t=l;break;case 1:t=[t[0]-100,t[0]+100]}if(u&&!e)u.range(t);else{l=t;var n=d3.min(d(l).filter(function(t){return!!t}));n&&(a=Math.min(a,n/100)),m()}return g},g.interpolate=function(t){var e=s;if(r.length>1){var n=s,i=l,o=[s[0],s[s.length-1]];g.domain(o).range(o),e=n.map(function(t){return g(t)}),g.domain(n).range(i)}return u=d3.scaleLinear().domain(e).range(l).interpolate(t),g.range(u.domain(),!0),g},g.invert=function(t){var e=function(t){if(c){if(t<l[0])return n[0];if(t>l[l.length-1])return n[n.length-1];for(var e=0;e<n.length;e++)if(t>=n[e].range[0]&&t<=n[e].range[n[e].range.length-1])return n[e]}else{if(t>l[0])return n[0];if(t<l[l.length-1])return n[n.length-1];for(var i=0;i<n.length;i++)if(t<=n[i].range[0]&&t>=n[i].range[1])return n[i]}}(t);return e.scale.invert(t)*e.sign},g.ticks=function(t){for(var e=void 0,r=[],o=0;o<n.length;o++)e=-1==n[o].sign?n[o].scale.ticks().reverse().map(function(t){return-1*t}):n[o].scale.ticks(),r.length>0&&e.length>0&&r[r.length-1]==e[0]&&e.splice(0,1),r.push.apply(r,i(e));return r},g.copy=function(){return t(e).domain(s).range(l).delta(a).eps(o)},d3.rebind(g,e,"base","rangeRound","clamp","nice","tickFormat")}(d3.scaleLog().domain([.1,200]).range([0,1e3]))}},function(t,e,n){"use strict";function i(t,e,n){var i,r,o,a=e?".onTap":".onLongTap";d3.select(t).on("touchstart"+a,function(t,e){i=d3.event.timeStamp,r=d3.event.changedTouches[0].screenX,o=d3.event.changedTouches[0].screenY}).on("touchend"+a,function(t,a){return r=Math.abs(r-d3.event.changedTouches[0].screenX),o=Math.abs(o-d3.event.changedTouches[0].screenY),r<5&&o<5?d3.event.timeStamp-i<500?e?e(t,a):void 0:n?n(t,a):void 0:void 0})}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return this.each(function(){i(this,t)})},o=function(t){return this.each(function(){i(this,null,t)})};e.default={onTap:r,onLongTap:o},e.onTap=r,e.onLongTap=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(77);var a={TEXT_PARAMS:{TOP:11,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},THUMB_STROKE_WIDTH:4},s={small:{minRadiusPx:.5,maxRadiusEm:.05},medium:{minRadiusPx:1,maxRadiusEm:.05},large:{minRadiusPx:1,maxRadiusEm:.05}},l=((i=o)&&i.__esModule?i:{default:i}).default.extend({init:function(t,e){this.name="bubblesize";var n=r.extend({},a);this.options=r.extend(n,this.options||{});var i=r.extend({},s);this.profiles=r.extend(i,this.profiles||{}),this.model_expects=[{name:"submodel",type:"size"},{name:"locale",type:"locale"}];this.changeHandler=this.changeHandler.bind(this),this.readyHandler=this.readyHandler.bind(this),this.model_binds={"change:submodel.domainMin":this.changeHandler,"change:submodel.domainMax":this.changeHandler},this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var n=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._updateLabels(n),this._super(t,e)},readyHandler:function(t){this._super(t),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this._setLabelsText()},readyOnce:function(){this._super(),this.showArcs=!1!==this.model.submodel.showArcs,this.padding.bottom=this.options.BAR_WIDTH+this.options.TEXT_PARAMS.MAX_HEIGHT,this.showArcs&&this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc").data([0,0]).enter().append("path").attr("class","vzb-bs-slider-thumb-arc"),this.sliderArcsEl=this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc"),this.sliderLabelsWrapperEl=this.sliderEl.append("g"),this.sliderLabelsWrapperEl.selectAll("text").data([0,0]).enter().append("text").attr("class","vzb-bs-slider-thumb-label").attr("text-anchor",function(t,e){return e?"start":"end"}).attr("dy",function(t,e){return e?"-0.7em":"1.4em"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-bs-slider-thumb-label"),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sizeScaleMinMax&&this._setLabelsText()},ready:function(){this._super(),this._updateLabels()},getMinMaxBubbleRadius:function(){var t=this.root.getVizWidthHeight(),e=r.hypotenuse(t.width,t.height),n=this.profiles[this.getLayoutProfile()].minRadiusPx,i=this.profiles[this.getLayoutProfile()].maxRadiusEm*e;return n>i&&(i=n),{min:n,max:i}},_updateSize:function(){var t=this;this._super(),this.sliderLabelsWrapperEl.attr("transform",this.isRTL?"scale(-1,1)":null),this.sliderLabelsEl.attr("text-anchor",function(e,n){return(t.isRTL?!n:n)?"start":"end"})},_resize:function(){var t=this.getMinMaxBubbleRadius(),e=this.element.node().offsetWidth-2*t.max;this.padding.top=t.max+this.options.BAR_WIDTH,this.padding.left=.5*e,this.padding.right=.5*e,this.rescaler.range([2*t.min,2*t.max]),this._super()},_getComponentWidth:function(){return 2*this.getMinMaxBubbleRadius().max},_updateThumbs:function(t){this._updateArcs(t),this._updateLabels(t)},_updateArcs:function(t){if(this.showArcs){var e=this,n=d3.arc().outerRadius(function(t){return.5*e.rescaler(t)}).innerRadius(function(t){return.5*e.rescaler(t)}).startAngle(.5*-Math.PI).endAngle(.5*Math.PI);this.sliderArcsEl.data(t).attr("d",n).attr("transform",function(t){return"translate("+.5*e.rescaler(t)+",0)"})}},_updateLabels:function(t){var e=this,n=this;t&&this.sliderLabelsEl.data(t),this.sliderLabelsEl.attr("transform",function(t,i){e.options.TEXT_PARAMS.TOP;var r=e.options.TEXT_PARAMS.LEFT*(i?.5:-1)+n.rescaler(t);return"translate("+(n.isRTL?-1:1)*r+",0)"})},_setLabelsText:function(){var t=[this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[0]),this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[1])];this.sliderLabelsEl.text(function(e,n){return t[n]})}});e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(77);var a={},s={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20}},l=((i=o)&&i.__esModule?i:{default:i}).default.extend({init:function(t,e){this.name="sizeslider";var n=r.extend({},a);this.options=r.extend(n,this.options||{});var i=r.extend({},s);this.profiles=r.extend(i,this.profiles||{}),this.propertyName=t.propertyname,this.model_expects=[{name:"submodel",type:"size"},{name:"locale",type:"locale"}];this.changeHandler=this.changeHandler.bind(this),this.readyHandler=this.readyHandler.bind(this),this.model_binds={"change:submodel.domainMin":this.changeHandler,"change:submodel.domainMax":this.changeHandler},this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var n=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._updateLabels(n),this._super(t,e)},readyHandler:function(t){this.modelUse=this.model.submodel.use;var e=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];if("constant"!=this.modelUse)this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sliderEl.selectAll(".w").classed("vzb-hidden",!1),this.sliderEl.select(".selection").classed("vzb-hidden",!1),this.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!1),this._setLabelsText();else if(this.sliderEl.selectAll(".w").classed("vzb-hidden",!0),this.sliderEl.select(".selection").classed("vzb-hidden",!0),this.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!0),!this.model.submodel.which){var n=this.propertyActiveProfile;e[1]=(n.default-n.min)/(n.max-n.min),this.model.submodel.which="_default"}this._moveBrush(e)},readyOnce:function(){this._super();var t=this.options,e=t.BAR_WIDTH;this.propertyActiveProfile=this.getPropertyActiveProfile(),this.propertyScale=d3.scaleLinear().domain([t.EXTENT_MIN,t.EXTENT_MAX]).range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]).clamp(!0),this.padding.top=this.propertyActiveProfile.max+1.25*e,this.translator=this.model.locale.getTFunction(),this.sliderLabelsWrapperEl=this.sliderEl.append("g"),this.sliderLabelsWrapperEl.selectAll("text").data([0,0]).enter().append("text").attr("class",function(t,e){return"vzb-szs-slider-thumb-label "+(e?"e":"w")}).attr("dy",1.25*-e+"px"),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-szs-slider-thumb-label"),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sizeScaleMinMax&&this._setLabelsText(),this.model._ready&&this.readyHandler()},ready:function(){this._super(),this._updateLabels()},getPropertyActiveProfile:function(){var t=this.profiles[this.getLayoutProfile()];return{min:t["min"+this.propertyName],max:t["max"+this.propertyName],default:t["default"+this.propertyName]}},_updateSize:function(){var t=this;this._super(),this.sliderLabelsWrapperEl.attr("transform",this.isRTL?"scale(-1,1)":null),this.sliderLabelsEl.attr("text-anchor",function(e,n){return(t.isRTL?n:!n)?"start":"end"})},_resize:function(){this.propertyActiveProfile=this.getPropertyActiveProfile(),this.propertyScale.range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]),this.padding.top=this.propertyActiveProfile.max+1.25*this.options.BAR_WIDTH,this._super()},_updateThumbs:function(t){this._updateLabels(t)},_updateLabels:function(t){var e=this;t&&this.sliderLabelsEl.data(t),this.sliderLabelsEl.attr("transform",function(t,n){var i=e.rescaler(n);return"translate("+(e.isRTL?-1:1)*i+",0)"}).attr("font-size",function(t,n){return e.propertyScale(t)}),"constant"===e.model.submodel.use&&this.sliderLabelsEl.text(function(t){return~~e.propertyScale(t)+(e.translator(e.ui.constantUnit)||"")})},_setLabelsText:function(){var t=[this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[0]),this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[1])];this.sliderLabelsEl.text(function(e,n){return t[n]})}});e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=l(n(1)),o=n(6),a=(i=o)&&i.__esModule?i:{default:i},s=l(n(21));function l(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var u=a.default.extend({init:function(t,e){var n=this;this.name=this.name||"gapminder-buttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={find:{title:"buttons/find",icon:"search",required:!1},show:{title:"buttons/show",icon:"asterisk",required:!1},moreoptions:{title:"buttons/more_options",icon:"gear",required:!0},colors:{title:"buttons/colors",icon:"paintbrush",required:!1},mapcolors:{title:"buttons/mapcolors",icon:"paintbrush",required:!1},size:{title:"buttons/size",icon:"circle",required:!1},zoom:{title:"buttons/zoom",icon:"cursorPlus",required:!1},fullscreen:{title:"buttons/expand",icon:"expand",func:this.toggleFullScreen.bind(this),required:!0},trails:{title:"buttons/trails",icon:"trails",func:this.toggleBubbleTrails.bind(this),required:!1,statebind:"ui.chart.trails",statebindfunc:this.setBubbleTrails.bind(this)},lock:{title:"buttons/lock",icon:"lock",func:this.toggleBubbleLock.bind(this),required:!1,statebind:"ui.chart.lockNonSelected",statebindfunc:this.setBubbleLock.bind(this)},inpercent:{title:"buttons/inpercent",icon:"percent",func:this.toggleInpercent.bind(this),required:!1,statebind:"ui.chart.inpercent",statebindfunc:this.setInpercent.bind(this)},presentation:{title:"buttons/presentation",icon:"presentation",func:this.togglePresentationMode.bind(this),required:!1,statebind:"ui.presentation",statebindfunc:this.setPresentationMode.bind(this)},about:{title:"buttons/about",icon:"about",required:!1},axes:{title:"buttons/axes",icon:"axes",required:!1},axesmc:{title:"buttons/axesmc",icon:"axes",required:!1},stack:{title:"buttons/stack",icon:"stack",required:!1},side:{title:"buttons/side",icon:"side",required:!1},_default:{title:"Button",icon:"asterisk",required:!1}},this._active_comp=!1,this.model_binds={"change:state.marker.select":function(t){n._readyOnce&&(n.setBubbleTrails(),n.setBubbleLock(),n._toggleButtons())},"change:ui.chart":function(t,e){n._readyOnce&&(e.indexOf("lockActive")>-1||e.indexOf("lockUnavailable")>-1)&&n.setBubbleLock()}},t.ui.buttons.forEach(function(t){var e=n._available_buttons[t];e&&e.statebind&&(n.model_binds["change:"+e.statebind]=function(i){n._readyOnce&&e.statebindfunc(t,i.source.value)})}),this._super(t,e),this.validatePopupButtons(this.model.ui.buttons,this.model.ui.dialogs)},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.root.findChildByName("gapminder-dialogs").on("close",function(e,n){t.setButtonActive(n.id,!1)});var e=(this.model.ui.dialogs||{}).sidebar||[],n=[].concat(this.model.ui.buttons);this.model.ui.buttons=n,this._addButtons(n,e),this._prev_body_overflow=document.body.style.overflow,this.setBubbleTrails(),this.setBubbleLock(),this.setInpercent(),this.setPresentationMode(),this._toggleButtons()},proceedClick:function(t){var e=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=e.attr("class"),i=this._available_buttons[t];if(i&&i.func)i.func(t);else{var r=-1===n.indexOf("vzb-active");e.classed("vzb-active",r);var o={};o.id=t,o.active=r,this.trigger("click",o)}},validatePopupButtons:function(t,e){for(var n=this,i=e.popup,o=t.filter(function(t){return n._available_buttons[t]&&!n._available_buttons[t].func}),a=0,s=o.length;a<s;a++)if(-1==i.indexOf(o[a]))return r.error('Buttonlist: bad buttons config: "'+o[a]+'" is missing in popups list');return!1},_showAllButtons:function(){this.element.selectAll(".vzb-buttonlist-btn").each(function(t,e){d3.select(this).style("display","")})},_toggleButtons:function(){var t=this,e=this.parent.element.node?this.parent.element:d3.select(this.parent.element),n=(this.model.ui.dialogs||{}).sidebar||[];t._showAllButtons();var i=this.element.selectAll(".vzb-buttonlist-btn"),r=(this.element.node().getBoundingClientRect(),[]),o=[],a=80,s=80,l=this.element.node().getBoundingClientRect().width,u=this.element.node().getBoundingClientRect().height,c=0,h=0;i.each(function(e,i){var l=e,u=d3.select(this),d=-1!==n.indexOf(l.id),f=parseInt(u.style("margin-top")),p=parseInt(u.style("margin-right")),m=parseInt(u.style("margin-left")),v=parseInt(u.style("margin-bottom"));a=u.node().getBoundingClientRect().width+p+m,s=u.node().getBoundingClientRect().height+f+v,u.classed("vzb-hidden")||(d&&"large"===t.getLayoutProfile()?u.style("display","none"):(c+=a,h+=s,l.required?o.push(u):r.push(u)))});var d=c-l,f=h-u,p=1;e.classed("vzb-large")&&e.classed("vzb-dialog-expand-true")||e.classed("vzb-small")&&e.classed("vzb-portrait")?(d>0&&d<=10&&(l+=d),(p=Math.floor(l/a)-o.length)<0&&(p=0)):(f>0&&f<=10&&(u+=f),(p=Math.floor(u/s)-o.length)<0&&(p=0)),r.reverse();for(var m=[],v=0,g=r.length-p;v<g;v++)r[v].style("display","none"),m.push(r[v].attr("data-btn"));var y={};y.hiddenButtons=m,t.trigger("toggle",y)},_addButtons:function(t,e){var n=this;this._components_config=[];var i=[];if(t.length){for(var o=0;o<t.length;o++){var a=t[o],l=this._available_buttons[a]?a:"_default",u=r.clone(this._available_buttons[l]);"_default"==l&&(u.title="buttons/"+a),u.id=a,u.icon=s[u.icon],i.push(u)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(i).enter().append("button").attr("class",function(t){var n="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(n+=" vzb-dialog-side-btn"),n}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"}),this.element.selectAll(".vzb-buttonlist-btn").on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");n.proceedClick(t)})}},scrollToEnd:function(){var t=0,e=d3.select(".vzb-tool");e.classed("vzb-portrait")&&e.classed("vzb-small")?(this.model.state.marker.select.length>0&&(t=this.element.node().scrollWidth),this.element.node().scrollLeft=t):(this.model.state.marker.select.length>0&&(t=this.element.node().scrollHeight),this.element.node().scrollTop=t)},resize:function(){if(!this.element.selectAll)return r.warn("buttonlist resize() aborted because element is not yet defined");"small"===this.getLayoutProfile()&&this.model.ui.presentation&&this.togglePresentationMode(),this._toggleButtons()},setButtonActive:function(t,e){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").classed("vzb-active",e)},toggleBubbleTrails:function(){this.model.ui.chart.trails=!this.model.ui.chart.trails,this.setBubbleTrails()},setBubbleTrails:function(){var t=(this.model.ui.chart||{}).trails;if(t||!1===t){var e=this.element.selectAll(".vzb-buttonlist-btn[data-btn='trails']");if(!e.node())return r.warn("setBubbleTrails: no button 'trails' found in DOM. doing nothing");e.classed("vzb-active-locked",t),e.classed("vzb-hidden",0==this.model.state.marker.select.length)}},toggleBubbleLock:function(t){var e=(this.model.ui.chart||{}).lockActive;if(0!=this.model.state.marker.select.length||e){var n=this.model.ui.chart.lockNonSelected,i=this.model.state.time;n=n?0:i.formatDate(i.value),this.model.ui.chart.lockNonSelected=n,this.setBubbleLock()}},setBubbleLock:function(){var t=(this.model.ui.chart||{}).lockNonSelected,e=(this.model.ui.chart||{}).lockActive,n=(this.model.ui.chart||{}).lockUnavailable||!1;if(t||0===t){0===t||0!==this.model.state.marker.select.length||e||(t=this.model.ui.chart.lockNonSelected=0);var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='lock']");if(!i.node())return r.warn("setBubbleLock: no button 'lock' found in DOM. doing nothing");var o=this.model.locale.getTFunction();i.classed("vzb-unavailable",n),void 0===e?i.classed("vzb-hidden",0==this.model.state.marker.select.length):i.classed("vzb-hidden",!e),i.classed("vzb-active-locked",t),i.select(".vzb-buttonlist-btn-icon").html(s[t?"lock":"unlock"]),i.select(".vzb-buttonlist-btn-title>span").text(t||o("buttons/lock")).attr("data-vzb-translate",t?null:"buttons/lock")}},toggleInpercent:function(){this.model.ui.chart.inpercent=!this.model.ui.chart.inpercent,this.setInpercent()},setInpercent:function(){if(void 0!==(this.model.ui.chart||{}).inpercent){this.model.locale.getTFunction();this.element.selectAll(".vzb-buttonlist-btn[data-btn='inpercent']").classed("vzb-active-locked",this.model.ui.chart.inpercent)}},togglePresentationMode:function(){this.model.ui.presentation=!this.model.ui.presentation,this.setPresentationMode()},setPresentationMode:function(){this.model.locale.getTFunction();this.element.selectAll(".vzb-buttonlist-btn[data-btn='presentation']").classed("vzb-active-locked",this.model.ui.presentation)},toggleFullScreen:function(t,e){if(window){for(var n,i=this,o=i.placeholder,a=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),l=!this.model.ui.fullscreen,u=l?"hidden":this._prev_body_overflow;!r.hasClass(o,"vzb-placeholder");)o=(i=i.parent).placeholder;l?(this.resizeInExitHandler=!1,(n=o).requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&h()&&n.webkitRequestFullscreen(),function(t){if(!window)return;var e=window.document;this.exitFullscreenHandler=function(t){window&&(void 0!==window.document.webkitIsFullScreen?window.document.webkitIsFullScreen:void 0!==window.document.mozFullScreen?window.document.mozFullScreen:void 0!==window.document.msFullscreenElement&&window.document.msFullscreenElement)||(c.call(this),this.resizeInExitHandler?this.root.ui.resizeHandler():t())}.bind(this,t),e.addEventListener("webkitfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("mozfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("fullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("MSFullscreenChange",this.exitFullscreenHandler,!1)}.call(this,this.toggleFullScreen.bind(this,t,!0))):(this.resizeInExitHandler=!e,function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&h()?document.webkitExitFullscreen():(c.call(this),this.resizeInExitHandler=!1)}.call(this)),r.classed(o,"vzb-force-fullscreen",l),"undefined"!=typeof container&&r.classed(container,"vzb-container-fullscreen",l),this.model.ui.fullscreen=l;var d=this.model.locale.getTFunction();a.classed("vzb-active-locked",l),a.select(".vzb-buttonlist-btn-icon").html(s[l?"unexpand":"expand"]),a.select(".vzb-buttonlist-btn-title>span").text(d("buttons/"+(l?"unexpand":"expand"))).attr("data-vzb-translate","buttons/"+(l?"unexpand":"expand")),document.body.style.overflow=u,this.resizeInExitHandler||this.root.ui.resizeHandler()}}});function c(){var t=window.document;t.removeEventListener("webkitfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("mozfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("fullscreenchange",this.exitFullscreenHandler),t.removeEventListener("MSFullscreenChange",this.exitFullscreenHandler)}function h(){return!(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"))}e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a(n(1));var i,r=n(161),o=(i=r)&&i.__esModule?i:{default:i};a(n(21));function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var s=o.default.extend({init:function(t,e){this.name="gapminder-optionsbuttonlist",this._super(t,e)},readyOnce:function(){var t=this;Object.keys(this._available_buttons).forEach(function(e){var n=t._available_buttons[e];n.required=!n.required}),this.buttonListComp=this.root.findChildByName("gapminder-buttonlist"),this.buttonListComp.on("click",function(e,n){t.element.selectAll(".vzb-buttonlist-btn[data-btn='"+n.id+"']").classed("vzb-active",n.active)}),this.buttonListComp.on("toggle",function(e,n){t.element.selectAll(".vzb-buttonlist-btn").each(function(t){var e=d3.select(this),i=-1==n.hiddenButtons.indexOf(t.id);e.style("display",i?"none":""),i||0})}),this._super()},proceedClick:function(t){var e=this;this.buttonListComp.proceedClick(t),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").datum().func&&setTimeout(function(){e.root.findChildByName("gapminder-dialogs").closeAllDialogs()},200)},_toggleButtons:function(){}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=u(n(6)),a=u(n(164)),s=u(n(111)),l=n(21);function u(t){return t&&t.__esModule?t:{default:t}}function c(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var h=o.default.extend({init:function(t,e){var n=this;this.template='<div class="vzb-cl-outer"></div>',this.name="colorlegend",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"marker"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:color.scaleType":function(t,e){n._readyOnce&&!n.colorModel.isDiscrete()&&n.updateView()},"change:color.palette":function(t,e){!n._readyOnce||n.colorModel.isDiscrete()&&!n.frame||n.updateView()},"change:marker.highlight":function(t,e){n.colorModel.isDiscrete()&&n.model.marker.getFrame(n.model.time.value,function(t){if(t){var e=n.model.marker.getHighlighted(n.KEY);n.updateGroupsOpacity(e.map(function(e){return t[n.colorModel._name][e]}))}else n.updateGroupsOpacity()})},"change:time.start":function(t,e){n._readyOnce&&!n.model.time.splash&&n.colorModel.which==n.model.time.dim&&n.ready()},"change:time.end":function(t,e){n._readyOnce&&!n.model.time.splash&&n.colorModel.which==n.model.time.dim&&n.ready()},"translate:locale":function(){n._translateSelectDialog(n.model.locale.getTFunction()),n.colorPicker.translate(n.model.locale.getTFunction())}},this._super(t,e)},readyOnce:function(){var t=this;this.element=d3.select(this.element),d3.select(this.placeholder.parentNode).classed("vzb-dialog-scrollable",!0),this.colorModel=this.model.color,this.colorlegendMarker=this.colorModel.getColorlegendMarker(),this.colorlegendMarker&&this.colorlegendMarker.on("ready",function(){t.ready()}),this.listColorsEl=this.element.append("div").attr("class","vzb-cl-holder").append("div").attr("class","vzb-cl-colorlist"),this.rainbowEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow"),this.rainbowCanvasEl=this.rainbowEl.append("canvas"),this.minimapEl=this.listColorsEl.append("div").attr("class","vzb-cl-minimap"),this.rainbowLegendEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow-legend"),this.rainbowLegendSVG=this.rainbowLegendEl.append("svg"),this.rainbowLegendG=this.rainbowLegendSVG.append("g"),this.rainbowLegend=null,this.labelScaleEl=this.listColorsEl.append("div").attr("class","vzb-cl-labelscale"),this.labelScaleSVG=this.labelScaleEl.append("svg"),this.labelScaleG=this.labelScaleSVG.append("g"),this.subtitleDiv=this.listColorsEl.append("div").attr("class","vzb-cl-subtitle"),this.subtitleText=this.subtitleDiv.append("span").attr("class","vzb-cl-subtitle-text"),this.minimapSVG=this.minimapEl.append("svg"),this.minimapG=this.minimapSVG.append("g"),this.colorPicker=new a.default(r.isArray(this.root.element)?this.root.element:d3.select(this.root.element)),this.colorPicker.translate(this.model.locale.getTFunction()),this._initSelectDialog()},_initSelectDialog:function(){this.moreOptionsHint=this.listColorsEl.append("span").classed("vzb-cl-more-hint vzb-hidden",!0),this.selectDialog=this.listColorsEl.append("div").classed("vzb-cl-select-dialog vzb-hidden",!0),this._initSelectDialogItems(),this._translateSelectDialog(this.model.locale.getTFunction())},_initSelectDialogItems:function(){var t=this;this.selectDialogTitle=this.selectDialog.append("div").classed("vzb-cl-select-dialog-title",!0),this.selectDialog.append("div").classed("vzb-cl-select-dialog-close",!0).html(l.close).on("click",function(){return t._closeSelectDialog()}),this.selectAllButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item",!0),this.removeElseButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item",!0),this.editColorButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item vzb-cl-select-dialog-item-moreoptions",!0),this.editColorButtonTooltip=this.editColorButton.append("div").classed("vzb-cl-select-dialog-item-tooltip",!0)},_translateSelectDialog:function(t){this.moreOptionsHint.text(t("hints/color/more")),this.selectAllButton.text("✅ "+t("dialogs/color/select-all")),this.removeElseButton.text("🗑️ "+t("dialogs/color/remove-else")),this.editColorButton.text("🎨 "+t("dialogs/color/edit-color")),this.editColorButtonTooltip.text("Dataset author doesn't want you to change this")},_closeSelectDialog:function(){this.selectDialog.classed("vzb-hidden",!0)},_bindSelectDialogItems:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=i(n,3),a=o[1],s=o[2];this.selectDialogTitle.text(s[a].textContent),this.selectAllButton.on("click",function(){var e;(e=t._interact()).clickToSelect.apply(e,c(n)),t._closeSelectDialog()}),this.removeElseButton.on("click",function(){var e;(e=t._interact()).clickToShow.apply(e,c(n)),t._closeSelectDialog()}),this.editColorButton.on("click",function(){var e;(e=t._interact()).clickToChangeColor.apply(e,c(n)),t._closeSelectDialog()})},ready:function(){var t=this;if(this.KEYS=r.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.colorlegendDim=this.KEY,this.canShowMap=!1,this.colorModel.isDiscrete()&&"constant"!==this.colorModel.use&&this.colorlegendMarker){if(!this.colorlegendMarker._ready)return;return this.markerKeys=t.model.marker.getKeys(),this.KEY=t.colorModel.getDataKeys()[0],this.colorlegendDim=this.colorModel.getColorlegendEntities().getDimension(),void this.colorlegendMarker.getFrame(this.model.time.value,function(e){if(!e)return r.warn("colorlegend received empty frame in ready()");t.frame=e,t.canShowMap=r.keys((t.frame||{}).hook_geoshape||{}).length,t.colorlegendKeys=t.colorlegendMarker.getKeys(t.colorlegendDim),t.colorlegendKeys.forEach(function(e){((t.frame||{}).hook_geoshape||{})[e[t.colorlegendDim]]||(t.canShowMap=!1)}),t.updateView(),t.updateGroupsOpacity()})}t.updateView(),t.updateGroupsOpacity()},updateView:function(){var t=this;if(!this.element.selectAll)return r.warn("colorlegend resize() aborted because element is not yet defined");var e=this,n=this.KEY,i=this.colorModel.getPalette(),o=this.canShowMap,a=this.colorlegendKeys||[],l=this.listColorsEl.selectAll(".vzb-cl-option"),u=o||"_default"==this.colorModel.which||this.colorlegendMarker&&this.colorlegendDim==this.KEY&&a.length>10&&r.comparePlainObjects(this.colorModel.getColorlegendEntities().getFilter(),this.model.entities.getFilter());l.classed("vzb-hidden",u),this._updateSelectDialog(),this.rainbowEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.labelScaleEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.rainbowLegendEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.minimapEl.classed("vzb-hidden",!o||!this.colorModel.isDiscrete()),this.subtitleDiv.classed("vzb-hidden",!0);var c=this.colorModel.getScale();if(this.colorModel.isDiscrete())if(o){var h=this.minimapEl.append("div").attr("class","vzb-temp");this.minimapSVG.attr("viewBox",null),this.minimapSVG.selectAll("g").remove(),this.minimapG=this.minimapSVG.append("g"),this.minimapG.selectAll("path").data(a,function(t){return t[e.colorlegendDim]}).enter().append("path").on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}).each(function(t){var n=e.frame.hook_geoshape[t[e.colorlegendDim]].trim();"<svg"==n.slice(0,4)&&(h.html(n),n=h.select("svg").select("path").attr("d")),d3.select(this).attr("d",n).style("fill",c(t[e.colorlegendDim])).append("title").text(e.frame.label[t[e.colorlegendDim]]),h.html("")});var d=this.minimapG.node().getBBox();this.minimapSVG.attr("viewBox","0 0 "+1.05*d.width+" "+1.05*d.height),h.remove()}else(l="_default"==this.colorModel.which?l.data([]):l.data(u?[]:a.length?e.colorlegendDim==n?r.unique(e.markerKeys,function(t){return t[n]}):a:Object.keys(this.colorModel.getPalette()).map(function(t){var n={};return n[e.colorlegendDim]=t,n}),function(t){return t[e.colorlegendDim]})).exit().remove(),(l=l.enter().append("div").attr("class","vzb-cl-option").each(function(){var t=this;d3.select(this).append("div").attr("class","vzb-cl-color-sample").on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}),d3.select(this).append("div").attr("class","vzb-cl-color-legend")}).on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}).merge(l)).each(function(t,n){d3.select(this).select(".vzb-cl-color-sample").style("background-color",c(t[e.colorlegendDim])).style("border","1px solid "+c(t[e.colorlegendDim]));var i=e.colorlegendMarker?e.frame.label[t[e.colorlegendDim]]:null;i||0===i||(i=t[e.colorlegendDim]),d3.select(this).select(".vzb-cl-color-legend").text(i)});else{var f=this.rainbowEl.node().getBoundingClientRect().width,p=Object.keys(i).map(parseFloat),m=void 0,v=void 0,g=this.colorModel.getTickFormatter(),y=null,_=this.colorModel.paletteLabels;if(_){y="optimistic",m=_.map(function(t){return parseFloat(t)});var b=d3.max(m);v=m.map(function(t){return t/b*f})}else{m=c.domain();var x=d3.max(p);v=p.map(function(t){return t/x*f})}var w=d3.min(m)<=0&&d3.max(m)>=0&&"log"===this.colorModel.scaleType?"genericLog":this.colorModel.scaleType,S=d3["scale"+r.capitalize("time"===w?"linear":w)]().domain(m).range(v),M=parseInt(this.rainbowEl.style("left"),10)||0,E=parseInt(this.rainbowEl.style("right"),10)||M;this.labelScaleSVG.style("width",M+f+E+"px"),this.labelScaleG.attr("transform","translate("+M+",0)"),this.rainbowLegendSVG.style("width",M+f+E+"px"),this.rainbowLegendG.attr("transform","translate("+M+", 7)");var z=(0,s.default)("bottom");z.scale(S).tickSizeOuter(0).tickPadding(6).tickSizeMinor(3,0).labelerOptions({scaleType:this.colorModel.scaleType,toolMargin:{right:E,left:M},showOuter:!0,formatter:g,bump:M,cssFontSize:"11px",fitIntoScale:y}),this.labelScaleG.call(z);var k=c.range(),T=v.map(function(t,e){return{val:t,color:k[e],paletteKey:p[e]}});this.rainbowLegend=this.rainbowLegendG.selectAll("circle").data(T),this.rainbowLegend.exit().remove(),this.rainbowLegend=this.rainbowLegend.enter().append("circle").attr("r","6px").attr("stroke","#000").on("click",e._interact().clickToChangeColor).merge(this.rainbowLegend),this.rainbowLegend.each(function(t,e){d3.select(this).attr("fill",t.color),d3.select(this).attr("cx",t.val)}),this.rainbowCanvasEl.attr("width",f).attr("height",1).style("width",f+"px").style("height","100%");for(var O,P=this.rainbowCanvasEl.node().getContext("2d"),C=P.createImageData(f,1),A=0,I=-1;A<f;++A)O=d3.rgb(c(S.invert(A))),C.data[++I]=O.r,C.data[++I]=O.g,C.data[++I]=O.b,C.data[++I]=255;P.putImageData(C,0,0);var L=this.colorModel.getConceptprops(),j=r.getSubtitle(L.name,L.name_short);this.subtitleDiv.classed("vzb-hidden",""==j),this.subtitleText.text(j),l.classed("vzb-hidden",!0)}},_updateSelectDialog:function(){var t=this.colorModel.isUserSelectable();this.editColorButtonTooltip.classed("vzb-hidden",t),this.editColorButton.classed("vzb-cl-select-dialog-item-disabled",!t),this.selectDialog.classed("vzb-hidden",!0)},_highlight:function(t){r.getProp(this,["model","ui","chart","superhighlightOnMinimapHover"])?this.model.marker.setSuperHighlight(t):this.model.marker.setHighlight(t)},_unhighlight:function(){r.getProp(this,["model","ui","chart","superhighlightOnMinimapHover"])?this.model.marker.clearSuperHighlighted():this.model.marker.clearHighlighted()},_interact:function(){var t=this,e=this.KEYS,n=this.KEY,i=this.colorlegendDim;return{mouseover:function(e,r){if(t.moreOptionsHint.classed("vzb-hidden",!1),t.colorModel.isDiscrete()){d3.select(this);var o=e[i],a=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==o}).reduce(function(t,e){return t[e[n]]=!0,t},{});t._highlight(t.markerKeys.filter(function(t){return a[t[n]]}))}},mouseout:function(e,n){t.moreOptionsHint.classed("vzb-hidden",!0),t.colorModel.isDiscrete()&&t._unhighlight()},clickToChangeColor:function(e,n){if(t.colorModel.isUserSelectable()){var r=t.colorModel.getPalette(),o=t.colorModel.getDefaultPalette(),a=(d3.select(this),t.colorModel.isDiscrete()?e[i]:e.paletteKey);t.colorPicker.colorOld(r[a]).colorDef(o[a]).callback(function(e,n){return t.colorModel.setColor(e,a,n)}).fitToScreen([d3.event.pageX,d3.event.pageY]).show(!0)}},clickToShow:function(e,n){if(t.colorModel.isDiscrete()){d3.select(this),e[i];var o=t.model.entities.show[i]&&t.model.entities.show[i].$in?r.clone(t.model.entities.show[i].$in):[],a=o.indexOf(e[i]);-1!==a?o.splice(a,1):o.push(e[i]);var s={};o.length>0&&(s[i]={$in:o}),t.model.entities.set({show:s})}},clickToSelect:function(o,a){if(t.colorModel.isDiscrete()){d3.select(this);var s=o[i],l=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==s}).reduce(function(t,e){return t[e[n]]=!0,t},{}),u=t.markerKeys.filter(function(t){return l[t[n]]}).map(function(t){return r.clone(t,e)});u.filter(function(e){return t.model.marker.isSelected(e)}).length==u.length?t.model.marker.clearSelected():t.model.marker.setSelect(u)}}}},resize:function(){this.frame&&this.updateView(),this.colorPicker.resize(d3.select(".vzb-colorpicker-svg"))},updateGroupsOpacity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this,n=this.colorModel.getColorlegendMarker()||{},i=n.opacityRegular||.8,r=n.opacityHighlightDim||.5,o=e.canShowMap?".vzb-cl-minimap path":".vzb-cl-option .vzb-cl-color-sample";this.listColorsEl.selectAll(o).style("opacity",function(n){return t.length?t.indexOf(n[e.colorlegendDim])>-1?1:r:i})}});e.default=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=n(1);var o={INVISIBLE:"vzb-invisible",COLOR_POINTER:"vzb-colorpicker-pointer",COLOR_BUTTON:"vzb-colorpicker-cell",COLOR_DEFAULT:"vzb-colorpicker-default",COLOR_SAMPLE:"vzb-colorpicker-sample",COLOR_PICKER:"vzb-colorpicker-svg",COLOR_CIRCLE:"vzb-colorpicker-circle",COLOR_CIRCLES:"vzb-colorpicker-circles",COLOR_SEGMENT:"vzb-colorpicker-segment",COLOR_BACKGR:"vzb-colorpicker-background"},a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e,this._wrapper=this._container.select("."+o.COLOR_PICKER),this._init()}return i(t,[{key:"_init",value:function(){this._initVariables(),this._initCircles(),this._style(),this.resize(this._svg)}},{key:"_initVariables",value:function(){this._maxWidth=280,this._maxHeight=323,this._colorOld="#000",this._colorDef="#000",this._colorWhite="#f8f8f8",this._colorBlack="#444",this._margin={top:.1,bottom:.1,left:.1,right:.1},this._initSvg();var t=getComputedStyle(this._svg.node()),e=t.width,n=t.height;this._width=this.constructor.px2num(e),this._height=this.constructor.px2num(n),this._maxRadius=this._width/2*(1-this._margin.left-this._margin.right),this._nCellsH=30,this._minH=0,this._nCellsL=8,this._minL=.4,this._satConstant=.8,this._outerL=.3,this._firstAngleSat=0,this._minRadius=12,this._arc=d3.arc(),this._pie=d3.pie().sort(null).value(function(t){return 1}),this._colorPointer=null,this._showColorPicker=!1,this._sampleRect=null,this._sampleText=null,this._callback=function(t){return console.info("Color picker callback example. Setting color to "+t)},this._colorData=this._generateColorData()}},{key:"_generateColorData",value:function(){for(var t=this._minL,e=this._minH,n=this._nCellsL,i=this._nCellsH,r=this._firstAngleSat,o=this._satConstant,a=this._outerL,s=this._colorWhite,l=this._colorBlack,u=[],c=0;c<n;c++){var h=t+(1-t)/n*c;u.push([]);for(var d=0;d<=i;d++){var f=e+(1-e)/i*d;u[c].push({fill:this.constructor.hsl2rgb(f,0===d?r:o,0===c?a:h),stroke:0===c?s:l})}}return u}},{key:"_initSvg",value:function(){var t=this;this._wrapper=this._container.append("div").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("max-width",this._maxWidth+"px").style("height","100%").style("max-height",this._maxHeight+"px").style("z-index",9999).attr("class",o.COLOR_PICKER+" vzb-dialog-shadow").classed(o.INVISIBLE,!this._showColorPicker).on("mouseout",function(){return t._cellHover(t._colorOld)}),this._svg=this._wrapper.append("svg").style("width","100%").style("height","100%")}},{key:"_initCircles",value:function(){var t=this,e=this._svg,n=this._maxHeight,i=this._width,r=this._height,a=this._margin,s=this._colorData,l=this._nCellsL,u=this._minRadius,c=this._maxRadius,h=this._colorWhite,d=this._colorBlack;e.append("rect").attr("width",i).attr("height",n).attr("class",o.COLOR_BACKGR).on("mouseover",function(){return t._cellHover(t._colorOld)}).on("click",function(){d3.event.stopPropagation(),t._changeColor(t._colorOld),t.show(!1)});var f=c+i*a.left,p=c+r*a.top,m=e.append("g").attr("class",o.COLOR_CIRCLES).attr("transform","translate("+f+", "+p+")");e.append("rect").attr("class",o.COLOR_SAMPLE).attr("width",i/2).attr("height",r*a.top/2),this._sampleRect=e.append("rect").attr("class",o.COLOR_SAMPLE).attr("width",i/2).attr("x",i/2).attr("height",r*a.top/2),e.append("text").attr("x",i*a.left).attr("y",r*a.top/2).attr("dy","1.3em").attr("class",o.COLOR_SAMPLE).style("text-anchor","start"),this._sampleText=e.append("text").attr("x",i*(1-a.right)).attr("y",r*a.top/2).attr("dy","1.3em").attr("class",o.COLOR_SAMPLE).style("text-anchor","end"),e.append("text").attr("x",.1*i).attr("y",r*(1-a.bottom)).attr("dy","1.2em").attr("class","vzb-default-label").style("text-anchor","start").text("default"),e.append("circle").attr("class",o.COLOR_DEFAULT+" "+o.COLOR_BUTTON).attr("r",i*a.left/2).attr("cx",i*a.left*1.5).attr("cy",r*(1-1.5*a.bottom)).on("mouseover",function(){d3.select(this).style("stroke",d),v._cellHover(v._colorDef)}).on("mouseout",function(){d3.select(this).style("stroke","none")});var v=this;m.selectAll("."+o.COLOR_CIRCLE).data(s).enter().append("g").attr("class",o.COLOR_CIRCLE).each(function(t,e){v._arc.outerRadius(u+(c-u)/l*(l-e)).innerRadius(u+(c-u)/l*(l-e-1)),d3.select(this).selectAll("."+o.COLOR_SEGMENT).data(v._pie(t)).enter().append("g").attr("class",o.COLOR_SEGMENT).append("path").attr("class",o.COLOR_BUTTON).attr("d",v._arc).style("fill",function(t){return t.data.fill}).style("stroke",function(t){return t.data.fill}).on("mouseover",function(t){v._cellHover(t.data.fill,this)}).on("mouseout",function(){return v._cellUnhover()})}),m.append("circle").datum({data:{fill:h,stroke:d}}).attr("r",u).attr("fill",h).attr("class",o.COLOR_BUTTON).on("mouseover",function(){d3.select(this).style("stroke",d),v._cellHover(h)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),this._colorPointer=m.append("path").attr("class",o.COLOR_POINTER+" "+o.INVISIBLE),e.selectAll("."+o.COLOR_BUTTON).on("click",function(e){d3.event.stopPropagation(),t._changeColor(e?e.data.fill:t._colorDef,!0),t.show(!1)})}},{key:"_style",value:function(){var t=this._svg,e=this._colorWhite;t.select("."+o.COLOR_BACKGR).style("fill","white"),t.select("."+o.COLOR_POINTER).style("stroke-width",2).style("stroke",e).style("pointer-events","none").style("fill","none"),t.selectAll("."+o.COLOR_BUTTON).style("cursor","pointer"),t.selectAll("text").style("pointer-events","none").style("fill","#D9D9D9").style("font-size","0.7em").style("text-transform","uppercase"),t.selectAll("circle."+o.COLOR_BUTTON).style("stroke-width",2),t.selectAll("rect."+o.COLOR_SAMPLE).style("pointer-events","none")}},{key:"_cellHover",value:function(t,e){null!=e&&this._colorPointer.classed(o.INVISIBLE,!1).attr("d",d3.select(e).attr("d")).style("stroke",d3.select(e).datum().data.stroke||_colorWhite),this._sampleRect.style("fill",t),this._sampleText.text(t);var n=(0,r.isTouchDevice)();this._changeColor(t,n),n&&this.show(!1)}},{key:"_changeColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._callback(t,e)}},{key:"_cellUnhover",value:function(){this._colorPointer.classed(o.INVISIBLE,!0)}},{key:"resize",value:function(t){if(arguments.length){if(void 0!==t){var e=this._margin,n=t,i=getComputedStyle(n.node()),r=i.width,a=i.height,s=this.constructor.px2num(r),l=this.constructor.px2num(a),u=s/2*(1-e.left-e.right),c=n.select("."+o.COLOR_DEFAULT),h=n.select(".vzb-default-label"),d=n.select("."+o.COLOR_CIRCLES),f=u+l*e.top,p=(1+.5*e.top)*l*.5,m=u+s*e.left,v=f>p?p:f;d.attr("transform","translate("+m+", "+v+")"),c.attr("cx",s*e.left*1.5).attr("cy",l*(1-1.5*e.bottom)),h.attr("x",.1*s).attr("y",l*(1-e.bottom))}return this.fitToScreen()}}},{key:"fitToScreen",value:function(t){var e=this._container.node().getBoundingClientRect(),n=void 0,i=void 0,r=getComputedStyle(this._wrapper.node()),o=r.width,a=r.height,s=r.right,l=r.top,u=this.constructor.px2num(o),c=this.constructor.px2num(a);t?(n=t[0]-e.left,i=t[1]-e.top):(n=e.width-this.constructor.px2num(s)-u,i=this.constructor.px2num(l));var h={left:""};return.8*e.width<=u?h.right=.5*(e.width-u)+"px":n+u>e.width?h.right=Math.min(.1*e.width,20)+"px":h.right=e.width-n-u+"px",h.right&&this._wrapper.style("right",h.right),.8*e.height<=c?h.top=.5*(e.height-c)+"px":i+1.2*c>e.height?h.top=.9*e.height-c+"px":h.top=i+"px",h.top&&this._wrapper.style("top",h.top),this._wrapper.style("left",h.left),this}},{key:"show",value:function(t){if(!arguments.length)return this._showColorPicker;null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._showColorPicker="toggle"==t?!this._showColorPicker:t,this._showColorPicker||(this._callback=function(){}),this._wrapper.classed(o.INVISIBLE,!this._showColorPicker)}},{key:"_getOrSet",value:function(t,e){return t="_"+t,arguments.length>1?(this[t]=e,this):this[t]}},{key:"nCellsH",value:function(){return this._getOrSet.apply(this,["nCellsH"].concat(Array.prototype.slice.call(arguments)))}},{key:"minH",value:function(){return this._getOrSet.apply(this,["minH"].concat(Array.prototype.slice.call(arguments)))}},{key:"nCellsL",value:function(){return this._getOrSet.apply(this,["nCellsL"].concat(Array.prototype.slice.call(arguments)))}},{key:"minL",value:function(){return this._getOrSet.apply(this,["minL"].concat(Array.prototype.slice.call(arguments)))}},{key:"outerL",value:function(){return this._getOrSet.apply(this,["outerL"].concat(Array.prototype.slice.call(arguments)))}},{key:"satConstant",value:function(){return this._getOrSet.apply(this,["satConstant"].concat(Array.prototype.slice.call(arguments)))}},{key:"firstAngleSat",value:function(){return this._getOrSet.apply(this,["firstAngleSat"].concat(Array.prototype.slice.call(arguments)))}},{key:"minRadius",value:function(){return this._getOrSet.apply(this,["minRadius"].concat(Array.prototype.slice.call(arguments)))}},{key:"margin",value:function(){return this._getOrSet.apply(this,["margin"].concat(Array.prototype.slice.call(arguments)))}},{key:"callback",value:function(){return this._getOrSet.apply(this,["callback"].concat(Array.prototype.slice.call(arguments)))}},{key:"colorDef",value:function(t){return arguments.length?(void 0!==t&&(this._colorDef=t),null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._svg.select("."+o.COLOR_DEFAULT).style("fill",this._colorDef),this):this._colorDef}},{key:"translate",value:function(t){return"function"==typeof t&&this._svg.select(".vzb-default-label").text(t("colorpicker/default")),this}},{key:"colorOld",value:function(t){return arguments.length?(this._colorOld=t,null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._svg.select("rect."+o.COLOR_SAMPLE).style("fill",this._colorOld),this._svg.select("text."+o.COLOR_SAMPLE).text(this._colorOld),this):this._colorOld}}],[{key:"hsl2rgb",value:function(t,e,n){var i=void 0,r=void 0,o=void 0;if(0==e)i=r=o=n;else{var a=n<.5?n*(1+e):n+e-n*e,s=2*n-a;i=this.hue2rgb(s,a,t+1/3),r=this.hue2rgb(s,a,t),o=this.hue2rgb(s,a,t-1/3)}var l={r:Math.round(255*i).toString(16),g:Math.round(255*r).toString(16),b:Math.round(255*o).toString(16)};return 1===l.r.length&&(l.r="0"+l.r),1===l.g.length&&(l.g="0"+l.g),1===l.b.length&&(l.b="0"+l.b),"#"+l.r+l.g+l.b}},{key:"hue2rgb",value:function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}},{key:"px2num",value:function(t){return parseFloat(t)||0}}]),t}();e.default=a},function(t,e){t.exports='<div class="vzb-show-list vzb-accordion">\n  \x3c!-- list will be placed here --\x3e\n</div>\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t}(n(1));var i=a(n(12)),r=a(n(110)),o=(a(n(147)),a(n(107)));function a(t){return t&&t.__esModule?t:{default:t}}var s=i.default.extend("about",{init:function(t,e){this.name="about",this._super(t,e)},readyOnce:function(){var t=r.default.version,e=new Date(parseInt(r.default.build));this.element=d3.select(this.element),this.element.select(".vzb-about-text0").html("This chart is made with Vizabi,"),this.element.select(".vzb-about-text1").html("a project by <a href='http://gapminder.org' target='_blank'>Gapminder Foundation</a>"),this.element.select(".vzb-about-version").html("<a href='https://github.com/Gapminder/vizabi/releases/tag/v"+t+"' target='_blank'>Version: "+t+"</a>"),this.element.select(".vzb-about-updated").html("Build: "+d3.time.format("%Y-%m-%d at %H:%M")(e)),this.element.select(".vzb-about-report").html("<a href='https://getsatisfaction.com/gapminder/' target='_blank'>Report a problem</a>"),this.element.select(".vzb-about-credits").html("<a href='https://github.com/Gapminder/vizabi/graphs/contributors' target='_blank'>Contributors</a>");var n=o.default,i={},a=this.root.versionInfo;i.version=a?a.version:"N/A",i.build=a?d3.time.format("%Y-%m-%d at %H:%M")(new Date(parseInt(a.build))):"N/A",i.name=this.root.name;var s=this.element.select(".vzb-about-tool");s.html(""),s.append("p").text("Tool: "+i.name),s.append("p").text("-version: "+i.version),s.append("p").text("-build: "+i.build);var l=n.instances.map(function(t){var e={},n=t.readerObject.versionInfo;return e.version=n?n.version:"N/A",e.build=n?d3.time.format("%Y-%m-%d at %H:%M")(new Date(parseInt(n.build))):"N/A",e.name=t.readerObject._name,e}),u=this.element.select(".vzb-about-readers").selectAll(".vzb-about-reader").data(l);u.exit().remove(),(u=u.enter().append("p").attr("class","vzb-about-reader")).append("p").text(function(t){return t.name}),u.append("p").text(function(t){return"-version: "+t.version}),u.append("p").text(function(t){return"-build: "+t.build});var c=n.instances.map(function(t){return t.getDatasetName()}),h=this.element.select(".vzb-about-datasets").selectAll(".vzb-about-dataset").data(c);h.exit().remove(),(h=h.enter().append("p").attr("class","vzb-about-dataset")).append("p").text(function(t){return t})}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),a(n(6));var i=a(n(12)),r=a(n(50)),o=a(n(168));function a(t){return t&&t.__esModule?t:{default:t}}var s=i.default.extend("axes",{init:function(t,e){this.name="axes";this.components=[{component:r.default,placeholder:".vzb-xaxis-selector",model:["state.time","state.marker.axis_x","locale"]},{component:o.default,placeholder:".vzb-xaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}},{component:r.default,placeholder:".vzb-yaxis-selector",model:["state.time","state.marker.axis_y","locale"]},{component:o.default,placeholder:".vzb-yaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_y",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(6);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=((i=o)&&i.__esModule?i:{default:i}).default.extend({init:function(t,e){var i,o=this;this.name="gapminder-minmaxinputs",this.template=n(418),this.model_expects=[{name:"marker",type:"marker"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.markerID=t.markerID,t.markerID||r.warn("minmaxinputs.js complains on 'markerID' property: "+t.markerID),this.model_binds=(a(i={"translate:locale":function(){o.updateView()}},"change:marker."+this.markerID,function(){o.updateView()}),a(i,"ready",function(){o.updateView()}),i),this._super(t,e),this.ui=r.extend({selectDomainMinMax:!1,selectZoomedMinMax:!1},this.ui.getPlainObject())},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.el_domain_labelMin=this.element.select(".vzb-mmi-domainmin-label"),this.el_domain_labelMax=this.element.select(".vzb-mmi-domainmax-label"),this.el_domain_fieldMin=this.element.select(".vzb-mmi-domainmin"),this.el_domain_fieldMax=this.element.select(".vzb-mmi-domainmax"),this.el_break=this.element.select(".vzb-mmi-break"),this.el_zoomed_labelMin=this.element.select(".vzb-mmi-zoomedmin-label"),this.el_zoomed_labelMax=this.element.select(".vzb-mmi-zoomedmax-label"),this.el_zoomed_fieldMin=this.element.select(".vzb-mmi-zoomedmin"),this.el_zoomed_fieldMax=this.element.select(".vzb-mmi-zoomedmax"),t.el_domain_fieldMin.on("change",function(){t._setModel("domainMin",this.value)}),t.el_domain_fieldMax.on("change",function(){t._setModel("domainMax",this.value)}),t.el_zoomed_fieldMin.on("change",function(){t._setModel("zoomedMin",this.value)}),t.el_zoomed_fieldMax.on("change",function(){t._setModel("zoomedMax",this.value)}),this.element.selectAll("input").on("keypress",function(){13==d3.event.which&&document.activeElement.blur()})},updateView:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.el_domain_labelMin.text(this.translator("hints/min")+":"),this.el_domain_labelMax.text(this.translator("hints/max")+":"),this.el_zoomed_labelMin.text(this.translator("hints/min")+":"),this.el_zoomed_labelMax.text(this.translator("hints/max")+":"),this.el_domain_labelMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_labelMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_break.classed("vzb-hidden",!(this.ui.selectDomainMinMax&&this.ui.selectZoomedMinMax)),this.el_zoomed_labelMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_labelMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax);var e=function(e){return e||0===e?r.isDate(e)?t.model.time.formatDate(e):d3.format(".2r")(e):e},n=this.model.marker[this.markerID],i=n.getScale().domain();this.el_domain_fieldMin.property("value",e(d3.min(i))),this.el_domain_fieldMax.property("value",e(d3.max(i))),this.el_zoomed_fieldMin.property("value",e(n.getZoomedMin())),this.el_zoomed_fieldMax.property("value",e(n.getZoomedMax()))},_setModel:function(t,e){this.model.marker[this.markerID][t]=r.strToFloat(e)}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),a(n(6));var i=a(n(12)),r=a(n(163)),o=a(n(50));function a(t){return t&&t.__esModule?t:{default:t}}var s=i.default.extend("colors",{init:function(t,e){this.name="colors",this.components=[{component:o.default,placeholder:".vzb-caxis-selector",model:["state.time","state.marker.color","locale"],showHoverValues:!0},{component:r.default,placeholder:".vzb-clegend-container",model:["state.time","state.entities","state.marker","state.marker.color","locale","ui"]}],this._super(t,e)}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(12)),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1));function o(t){return t&&t.__esModule?t:{default:t}}var a=o(n(6)).default.extend({init:function(t,e){this.name="gapminder-dialogs",this._curr_dialog_index=20,this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}];var n=i.default.getCollection();this._available_dialogs=Object.keys(n).reduce(function(t,e){var i=n[e];return i.prototype.isDialog&&!e.startsWith("_")&&(t[e]={dialog:i}),t},{}),this._super(t,e)},domReady:function(){var t=(this.model.ui.dialogs||{}).popup||[],e=(this.model.ui.dialogs||{}).sidebar||[];this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),!0===e&&(e=t,(this.model.ui.dialogs||{}).sidebar=e),0!==e.length&&this.rootEl.classed("vzb-dialog-expand-true",!0),this.dialog_popup=t,this.dialog_sidebar=e},readyOnce:function(){var t=this;if(this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),r.isTouchDevice()&&this.element.classed("vzb-no-hover",!0),this._addDialogs(this.dialog_popup,this.dialog_sidebar),r.defer(function(){t.trigger("resize")}),0!==this.dialog_popup.length){this.root.findChildByName("gapminder-buttonlist").on("click",function(e,n){t._available_dialogs[n.id]&&(n.active?t.openDialog(n.id):t.closeDialog(n.id))});var e=this.element.selectAll(".vzb-top-dialog").filter(function(e){return t.dialog_popup.indexOf(e.id)>-1});e.select(".vzb-top-dialog>.vzb-dialog-modal>.vzb-dialog-buttons>[data-click='closeDialog']").on("click",function(e,n){t.closeDialog(e.id)}),e.select(".vzb-top-dialog>.vzb-dialog-modal>[data-click='pinDialog']").on("click",function(e,n){t.pinDialog(e.id)}),this.rootEl.node().addEventListener("click",function(){t.closeAllDialogs()}),this.rootEl.on("mousedown",function(e){if(this._active_comp){for(var n=d3.event.target,i=!0;n;){if(n.classList.contains("vzb-dialog-modal")){i=!1;break}n=n.parentElement}i&&t.closeAllDialogs()}})}this.element.on("click",function(){d3.event.stopPropagation()})},resize:function(){if(!this.element.selectAll)return r.warn("dialogs resize() aborted because element is not yet defined");var t=this,e=this.getLayoutProfile();this.element.selectAll(".vzb-top-dialog").each(function(n){var i=d3.select(this),r=i.attr("class").replace(" vzb-popup","").replace(" vzb-sidebar","");"large"===e&&t.dialog_sidebar.indexOf(n.id)>-1?r+=" vzb-sidebar":t.dialog_popup.indexOf(n.id)>-1&&(r+=" vzb-popup"),i.attr("class",r)})},_addDialogs:function(t,e){this.getLayoutProfile();var n=[];n=t?n.concat(t):n,n=e?n.concat(e):n,n=r.unique(n),this._components_config=[];var i=[];if(n.length){for(var o=0;o<n.length;o++){var a=n[o],s=this._available_dialogs[a];if(s&&s.dialog){var l=this._components_config;l.push({component:s.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+a+'"]',model:["state","ui","locale"]}),s.component=l.length-1}s.id=a,i.push(s)}this.element.selectAll("div").data(i).enter().append("div").attr("data-dlg",function(t){return t.id}).attr("class","vzb-top-dialog vzb-dialogs-dialog vzb-dialog-shadow"),this.loadSubComponents();var u=this;r.forEach(this.components,function(t){t.render(),u.on("resize",function(){t.trigger("resize")}),t.on("dragstart",function(){u.bringForward(t.name)}),t.on("close",function(){this.placeholderEl.each(function(t){var e={};e.id=t.id,u.trigger("close",e)})})})}},bringForward:function(t){this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']").style("z-index",this._curr_dialog_index),this._curr_dialog_index+=10},openDialog:function(t){var e="small"===this.getLayoutProfile();this.closeAllDialogs(e);var n=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp.beforeOpen(),n.classed("vzb-active",!0),this.bringForward(t),this._active_comp.open()},pinDialog:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._available_dialogs[t].ispin?(e.classed("pinned",!1),this._available_dialogs[t].ispin=!1):(e.classed("pinned",!0),this._available_dialogs[t].ispin=!0)},closeDialog:function(t){var e=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp&&!this._active_comp.isOpen||(this._available_dialogs[t].ispin&&this.pinDialog(t),this._active_comp&&this._active_comp.beforeClose(),e.classed("vzb-active",!1),this._active_comp&&this._active_comp.close(),this._active_comp=!1)},closeAllDialogs:function(t){var e=this,n=t?".vzb-popup.vzb-dialogs-dialog.vzb-active":".vzb-popup.vzb-dialogs-dialog.vzb-active:not(.pinned)";this.element.selectAll(n).each(function(t){e.closeDialog(t.id)})}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=l(n(12)),o=l(n(112)),a=l(n(59)),s=l(n(50));function l(t){return t&&t.__esModule?t:{default:t}}var u=r.default.extend("find",{init:function(t,e){this.name="find";var n=this;this.components=[{component:o.default,placeholder:".vzb-dialog-panel-show",model:["state","locale"]},{component:a.default,placeholder:".vzb-dialog-bubbleopacity",model:["state.marker","locale"],arg:"opacitySelectDim"}],this.enableSelectShowSwitch=((t.ui.dialogs.dialog||{}).find||{}).enableSelectShowSwitch||!1,this.panelMode=((t.ui.dialogs.dialog||{}).find||{}).panelMode||"find",this.enablePicker=((t.ui.dialogs.dialog||{}).find||{}).enablePicker,this.enablePicker&&this.components.push({component:s.default,placeholder:".vzb-find-filter-selector",model:["state.time","state.marker","locale"]}),this.model_binds={"change:state.marker.select":function(t){n.items.order(),n.selectDataPoints(),n.showHideButtons()},"change:state.time.playing":function(t){n.model.state.time.playing||(n.time=n.model.state.time.value,n.model.state.marker.getFrame(n.time,function(t,e){!t||n.time-e||n.redrawDataPoints(t)}))},"change:state.time.value":function(t){(n.placeholderEl.classed("vzb-active")||n.placeholderEl.classed("vzb-sidebar"))&&(n.time=n.model.state.time.value,n.model.state.marker.getFrame(n.time,function(t){t&&n.redrawDataPoints(t)}))},"change:ui.dialogs.dialog.find.enableSelectShowSwitch":function(e){n._readyOnce&&(n.enableSelectShowSwitch=((t.ui.dialogs.dialog||{}).find||{}).enableSelectShowSwitch||!1,n.element.select(".vzb-dialog-title-switch .vzb-switch-slider").classed("vzb-hidden",!n.enableSelectShowSwitch),n.element.select(".vzb-dialog-title-switch").style("pointer-events",n.enableSelectShowSwitch?"auto":"none"))},"translate:locale":function(){n._readyOnce&&n.input_search.attr("placeholder",n.translator("placeholder/search")+"...")}},this._super(t,e)},readyOnce:function(){this._super(),this.panelComps={find:this,show:this.findChildByName("show")},this.titleSwitch=this.element.select(".vzb-dialog-title-switch input"),this.panelsEl=this.contentEl.selectAll(".vzb-dialog-content"),this.list=this.element.select(".vzb-find-list"),this.input_search=this.element.select(".vzb-find-search"),this.deselect_all=this.element.select(".vzb-find-deselect"),this.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.element.select(".vzb-dialog-title-switch .vzb-switch-slider").classed("vzb-hidden",!this.enableSelectShowSwitch),this.element.select(".vzb-dialog-title-switch").style("pointer-events",this.enableSelectShowSwitch?"auto":"none"),this.element.select(".vzb-find-filter-selector").classed("vzb-hidden",!this.enablePicker),this.element.select(".vzb-dialog-title").classed("vzb-title-two-rows",this.enablePicker),this.KEY=this.model.state.entities.getDimension();var t=this;this.titleSwitch.on("change",function(){t.panelMode=t.titleSwitch.property("checked")?"show":"find",t.panelsEl.classed("vzb-active",!1),t.contentEl.select(".vzb-dialog-panel-"+t.panelMode).classed("vzb-active",!0),t.panelComps[t.panelMode].showHideSearch(),t._buttonAdjust(),t.panelComps[t.panelMode].showHideButtons()}),this.titleSwitch.property("checked","find"!==this.panelMode),this.titleSwitch.dispatch("change"),this.input_search.on("keyup",function(){13==d3.event.keyCode&&"select all"==t.input_search.node().value&&(t.input_search.node().value="",i.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectAll())}),this.input_search.on("input",function(){t.panelComps[t.panelMode].showHideSearch()}),d3.select(this.input_search.node().parentNode).on("reset",function(){i.defer(function(){return t.panelComps[t.panelMode].showHideSearch()})}),this.deselect_all.on("click",function(){t.deselectMarkers()}),this.buttonsEl.select(".vzb-dialog-button[data-click='closeDialog']").on("click.panel",function(){return t.panelComps[t.panelMode].closeClick()}),this.translator=this.model.locale.getTFunction(),this.input_search.attr("placeholder",this.translator("placeholder/search")+"..."),this.root.on("ready",function(){t.ready()})},getPanelMode:function(){return this.panelMode},_buttonAdjust:function(){this.buttonsEl.selectAll(".vzb-dialog-buttons > :not([data-dialogtype])").classed("vzb-hidden",!0),this.buttonsEl.selectAll("[data-panel="+this.panelMode+"]").classed("vzb-hidden",!1)},open:function(){var t=this;this._super(),this.input_search.node().value="",this.showHideSearch(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){e&&t.redrawDataPoints(e)})},ready:function(){this._super();var t=this;this.KEYS=i.unique(this.model.state.marker._getAllDimensions({exceptType:"time"}));this.importantHooks=t.model.state.marker.getImportantHooks(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){if(e){var n=t.model.state.marker.getKeys().map(function(n){return n.brokenData=!1,n.name=t.model.state.marker.getCompoundLabelText(n,e),n});n.sort(function(t,e){return t.name<e.name?-1:1}),t.list.html(""),t.items=t.list.selectAll(".vzb-find-item").data(n).enter().append("div").attr("class","vzb-find-item vzb-dialog-checkbox"),t.items.append("input").attr("type","checkbox").attr("class","vzb-find-item").attr("id",function(e,n){return"-find-"+n+"-"+t._id}).on("change",function(e){i.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectMarker(e),i.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}),t.items.append("label").attr("for",function(e,n){return"-find-"+n+"-"+t._id}).text(function(t){return t.name}).attr("title",function(t){return this.offsetWidth<this.scrollWidth?t.name:null}).on("mouseover",function(e){i.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}).on("mouseout",function(e){i.isTouchDevice()||t.model.state.marker.clearHighlighted()}),i.preventAncestorScrolling(t.element.select(".vzb-dialog-scrollable")),t.redrawDataPoints(e),t.selectDataPoints(),t.showHideSearch(),t.showHideButtons()}})},redrawDataPoints:function(t){var e=this,n=this.KEYS;e.items.each(function(r){var o=d3.select(this).select("label");r.brokenData=!1,i.forEach(e.importantHooks,function(o){if("constant"!=e.model.state.marker[o].use){var a=t[o];if(a){var s=a[i.getKey(r,n)];return s||0===s?void 0:(r.brokenData=!0,!1)}}});var a=this.offsetWidth<this.scrollWidth?r.name:"";o.classed("vzb-find-item-brokendata",r.brokenData).attr("title",a+(r.brokenData?(a?" | ":"")+e.model.state.time.formatDate(e.time)+": "+e.translator("hints/nodata"):""))})},selectDataPoints:function(){this.KEY;var t=this.model.state.marker;this.items.selectAll("input").property("checked",function(e){var n=t.isSelected(e);return d3.select(this.parentNode).classed("vzb-checked",n),n});var e=this.list.selectAll(".vzb-checked").classed("vzb-separator",!1).lower().nodes()[0];d3.select(e).classed("vzb-separator",!0),this.contentEl.node().scrollTop=0},showHideSearch:function(){if("find"===this.getPanelMode()){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-find-item").classed("vzb-hidden",function(e){return-1===(e.name||"").toString().toLowerCase().indexOf(t)})}},showHideButtons:function(){if("find"===this.getPanelMode()){var t=!!this.model.state.marker.select.length;this.deselect_all.classed("vzb-hidden",!t),this.opacity_nonselected.classed("vzb-hidden",!t),t&&this.findChildByName("singlehandleslider").trigger("resize")}},deselectMarkers:function(){this.model.state.marker.clearSelected()},transitionEnd:function(t){this._super(t),i.isTouchDevice()||this.input_search.node().focus()},closeClick:function(){}});e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),o(n(6));var i=o(n(12)),r=o(n(59));function o(t){return t&&t.__esModule?t:{default:t}}var a=i.default.extend("grouping",{init:function(t,e){this.name="grouping",this.groupStops=[1,5,10,15],this.components=[{component:r.default,placeholder:".vzb-dialog-placeholder",model:["state.entities_age","locale"],arg:"grouping",properties:{snapValue:!0,suppressInput:!0,domain:this.groupStops}}],this._super(t,e)},readyOnce:function(){this._super(),this.element.select(".vzb-dialog-groups").selectAll(".vzb-dialog-groups-title").data(this.groupStops).enter().append("span").attr("class",".vzb-dialog-groups-title").text(function(t){return t})}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),s(n(6));var i=s(n(12)),r=s(n(160)),o=s(n(50)),a=s(n(60));function s(t){return t&&t.__esModule?t:{default:t}}var l=i.default.extend("label",{init:function(t,e){this.name="label",this.components=[{component:r.default,placeholder:".vzb-dialog-sizeslider",model:["state.marker.size_label","locale"],propertyname:"LabelTextSize",ui:{constantUnit:"unit/pixels"}},{component:o.default,placeholder:".vzb-saxis-selector",model:["state.time","state.marker.size_label","locale"],showHoverValues:!0},{component:a.default,placeholder:".vzb-removelabelbox-switch",model:["ui.chart","locale"],checkbox:"removeLabelBox",submodel:"labels"}],this._super(t,e)}});e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=(a(n(6)),a(n(12))),o=a(n(162));function a(t){return t&&t.__esModule?t:{default:t}}var s=r.default.extend("moreoptions",{init:function(t,e){this.name="moreoptions",this.components=[{component:o.default,placeholder:".vzb-dialog-options-buttonlist",model:["state","ui","locale"]}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.accordionEl=this.contentEl.select(".vzb-accordion"),this.on("dragend",function(){t._setMaxHeight()});var e=(this.model.ui.dialogs||{}).popup||[],n=(this.model.ui.dialogs||{}).moreoptions||[];(!0===n&&(n=e,(this.model.ui.dialogs||{}).moreoptions=n),this._addDialogs(n),this.accordionEl)&&this.accordionEl.selectAll(".vzb-accordion-section").select(".vzb-dialog-title>span:first-child").on("click",function(e){t.components[e.component].element;var n=t.components[e.component].placeholderEl,i=t.accordionEl.select(".vzb-accordion-active");i&&i.classed("vzb-accordion-active",!1),n.node()!==i.node()&&(n.classed("vzb-accordion-active",!0),t.transitionEvents.forEach(function(i){n.on(i,function(){t.transitionEvents.forEach(function(t){n.on(t,null)}),t.components[e.component].trigger("resize")})}))})},_addDialogs:function(t){this._components_config=[];var e=[];if(t.length){for(var n=0;n<t.length;n++)if("moreoptions"!==t[n]){var r=t[n],o=i.deepClone(this.parent._available_dialogs[r]);if(o&&o.dialog){var a=this._components_config;a.push({component:o.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+r+'"]',model:["state","ui","locale"]}),o.component=a.length-1,o.id=r,e.push(o)}}this.accordionEl.selectAll("div").data(e).enter().append("div").attr("class",function(t){return"vzb-dialogs-dialog vzb-moreoptions vzb-accordion-section"}).attr("data-dlg",function(t){return t.id}),this.loadSubComponents();var s=this;i.forEach(this.components,function(t){t.render(),s.on("resize",function(){t.trigger("resize")})})}}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),o(n(6));var i=o(n(12)),r=o(n(59));function o(t){return t&&t.__esModule?t:{default:t}}var a=i.default.extend("opacity",{init:function(t,e){this.name="opacity",this.components=[{component:r.default,placeholder:".vzb-dialog-bubbleopacity-regular",model:["state.marker","locale"],arg:"opacityRegular"},{component:r.default,placeholder:".vzb-dialog-bubbleopacity-selectdim",model:["state.marker","locale"],arg:"opacitySelectDim"}],this._super(t,e)}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),o(n(6));var i=o(n(12)),r=o(n(60));function o(t){return t&&t.__esModule?t:{default:t}}var a=i.default.extend("presentation",{init:function(t,e){this.name="presentation",this.components=[{component:r.default,placeholder:".vzb-presentationmode-switch",model:["ui","locale"],checkbox:"presentation"},{component:r.default,placeholder:".vzb-decorations-switch",model:["ui.chart.decorations","locale"],checkbox:"enabled"},{component:r.default,placeholder:".vzb-advancedshowandselect-switch",model:["ui.dialogs.dialog.find","locale"],checkbox:"enableSelectShowSwitch"}],this._super(t,e)}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=(a(n(6)),a(n(12))),o=a(n(50));a(n(60));function a(t){return t&&t.__esModule?t:{default:t}}var s=r.default.extend("side",{init:function(t,e){this.name="side";var n=this;this.model_binds={"change:ui.chart.flipSides":function(t){n._readyOnce&&(n.updateState(),n.redraw())}},this.components=[{component:o.default,placeholder:".vzb-side-selector",model:["state.time","state.marker.side","locale"],showHoverValues:!1}],this._super(t,e)},readyOnce:function(){this._super(),this.listLeft=this.element.select(".vzb-side-list-left"),this.listRight=this.element.select(".vzb-side-list-right"),this.switchSides=this.element.select(".vzb-side-switch-sides"),this.TIMEDIM=this.model.state.time.getDimension(),this.state={};var t=this;this.switchSides.on("click",function(){t.model.ui.chart.flipSides=!t.model.ui.chart.flipSides}),this.model.state.marker.side.getEntity().on("change:show",function(){t.updateState(),t.redraw()}),this.root.on("ready",function(){t.redraw()})},ready:function(){this._super();var t=this.model.state.marker.side.getEntity();if(this.KEY=t.getDimension(),this.labelNames=this.model.state.marker.getLabelHookNames(),"constant"!==this.model.state.marker.side.use&&!(t.show[this.KEY]||{}).$in){var e=this.model.state.marker.side.getUnique(this.model.state.marker.side.which).filter(function(t){return null!==t}).sort(d3.ascending).slice(0,2);if(e.length>0){var n=Object.assign({},t.show);n[this.KEY]={$in:e},t.set("show",n)}}this.updateState(),this.redraw(),i.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},updateState:function(){var t=this,e=this.model.state.marker.side.getEntity().getDimension(),n=this.model.state.marker.side;if(this.state.right={},this.state.left={},n.state.left[e]&&n.state.right[e])this.state.left[e]=n.state.left[e],this.state.right[e]=n.state.right[e];else{var i=this.model.state.marker.getKeys(e),r=[],o=!!this.model.state.marker.side.getEntity().show[e];if((r=i.filter(function(e){return!o||t.model.state.marker.side.getEntity().isShown(e)}).map(function(t){return t[e]})).length>2&&(r.length=2),r.length>1){var a=this.ui.chart.flipSides?d3.ascending:d3.descending;r.sort(a)}this.state.right={},this.state.right[e]=r[0],this.state.left={},this.state.left[e]=r[1]?r[1]:r[0]}var s="constant"==this.model.state.marker.side.use;this.listLeft.classed("vzb-hidden",s),this.listRight.classed("vzb-hidden",s),this.switchSides.classed("vzb-hidden",s||this.state.left[e]==this.state.right[e])},redraw:function(){var t=this,e=this.labelNames,n=this.KEY;this.translator=this.model.locale.getTFunction(),t.model.state.marker.side.getEntity().dim&&this.model.state.marker.getFrame(this.model.state.time.value,function(r){if(r){var o=[],a=t.model.state.marker.side.getConceptprops();"entity_set"==a.concept_type?o.push.apply(o,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(t.model.state.marker.side.getEntity().getEntitySets("data")[a.concept][0].map(function(t){var e={};return e[n]=t[a.concept],e.label=t.name,e}))):i.forEach(r[e[n]],function(t,e){var i={};i[n]=e,i.label=t,o.push(i)}),o.sort(function(t,e){return t.label<e.label?-1:1}),t.listLeft.html(""),t.listRight.html(""),t.createList(t.listLeft,"left",o),t.createList(t.listRight,"right",o)}})},createList:function(t,e,n){var i=this,r=this.model.state.marker.side.getEntity().getDimension(),o=t.selectAll(".vzb-side-item").data(n).enter().append("div").attr("class","vzb-side-item vzb-dialog-radio");o.append("input").attr("type","radio").attr("name",e+"-"+i._id).attr("class","vzb-side-item").attr("id",function(t){return"-side-"+e+"-"+t[r]+"-"+i._id}).property("checked",function(t){return i.state[e][r]===t[r]}).on("change",function(t,n){var r=i.model.state.marker.side.getEntity(),o=r.getDimension(),a="left"==e?"right":"left",s=i.model.state.marker.side;s.state[e][o]=t[o],s.state[a][o]=i.state[a][o];var l=[];if(r.isShown(t)||l.push(t),t[o]===i.state[a][o]||r.isShown(i.state[a])||l.push(i.state[a]),i.state[e][o]!==i.state[a][o]&&r.isShown(i.state[e])&&l.push(i.state[e]),t[o]!==i.state[a][o]){var u=[t[o],i.state[a][o]],c=i.ui.chart.flipSides?d3.ascending:d3.descending;u.sort(c),u["left"==e?0:1]==t[o]&&(i.model.state.marker.side.switchSideState(),i.ui.chart.flipSides=!i.ui.chart.flipSides)}l.length&&r.showEntity(l)}),o.append("label").attr("for",function(t){return"-side-"+e+"-"+t[i.KEY]+"-"+i._id}).text(function(t){return t.label})}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=(s(n(6)),s(n(12))),o=s(n(159)),a=s(n(50));function s(t){return t&&t.__esModule?t:{default:t}}var l=r.default.extend("size",{init:function(t,e){this.name="size";var n=this;this.model_binds={"change:state.marker.size.which":function(t){n._readyOnce&&n.updateSubtitle()},"translate:locale":function(){n._readyOnce&&n.updateSubtitle()}},this.components=[{component:a.default,placeholder:".vzb-saxis-selector",model:["state.time","state.marker.size","locale"],showHoverValues:!0}],t.ui.chart&&0===t.ui.chart.sizeSelectorActive||this.components.push({component:o.default,placeholder:".vzb-dialog-bubblesize",model:["state.marker.size","locale"],ui:{show_button:!1}}),this._super(t,e)},readyOnce:function(){this._super(),this.updateSubtitle()},updateSubtitle:function(){var t=this.model.state.marker.size.getConceptprops(),e=i.getSubtitle(t.name,t.name_short);this.element.select(".vzb-dialog-subtitle").text(e)}});e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),o(n(6));var i=o(n(12)),r=o(n(59));function o(t){return t&&t.__esModule?t:{default:t}}var a=i.default.extend("speed",{init:function(t,e){this.name="speed",this.components=[{component:r.default,placeholder:".vzb-dialog-placeholder",model:["state.time","locale"],arg:"delay",properties:{domain:[1200,900,450,200,150,100],roundDigits:0}}],this._super(t,e)}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),o(n(6));var i=o(n(12)),r=o(n(181));function o(t){return t&&t.__esModule?t:{default:t}}var a=i.default.extend("stack",{init:function(t,e){this.name="stack";var n=this;this.components=[{component:r.default,placeholder:".vzb-dialog-draggablelist",model:["state.marker.group","state.marker.color","locale","ui.chart"],groupID:"manualSorting",isEnabled:"manualSortingEnabled",dataArrFn:n.manualSorting.bind(n),lang:""}],this.model_binds={"change:state.marker.group":function(t){n._ready&&n.updateView()}},this._super(t,e)},readyOnce:function(){this._super();var t=this;this.group=this.model.state.marker.group,this.stack=this.model.state.marker.stack,this.howToStackEl=this.element.select(".vzb-howtostack").selectAll("input").on("change",function(){t.setModel("stack",d3.select(this).node().value)}),this.howToMergeEl=this.element.select(".vzb-howtomerge").selectAll("input").on("change",function(){t.setModel("merge",d3.select(this).node().value)}),this.updateView()},ready:function(){if(this._super(),!this.model.state.marker.color.isDiscrete()){if("property"==this.stack.use)return void this.setModel("stack","none");if(this.group.merge)return void this.setModel("merge","none")}this.updateView()},updateView:function(){var t=this;this.howToStackEl.property("checked",function(){return"none"===d3.select(this).node().value?"none"===t.stack.which:"bycolor"===d3.select(this).node().value?t.stack.which===t.model.state.marker.color.which:"all"===d3.select(this).node().value?"all"===t.stack.which:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"all"===d3.select(this).node().value?null:"bycolor"===d3.select(this).node().value?"property"!==t.model.state.marker.color.use||null:void 0}),t.model.ui.chart.manualSortingEnabled="all"==t.stack.which,this.howToMergeEl.property("checked",function(){return"none"===d3.select(this).node().value?!t.group.merge&&!t.stack.merge:"grouped"===d3.select(this).node().value?t.group.merge:"stacked"===d3.select(this).node().value?t.stack.merge:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"grouped"===d3.select(this).node().value?"none"===t.stack.which||"property"!==t.model.state.marker.color.use||null:"stacked"===d3.select(this).node().value?"all"!==t.stack.which||null:void 0})},manualSorting:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===arguments.length)return this.model.state.marker.group.manualSorting;this.model.state.marker.group.set({manualSorting:t},!1,e)},setModel:function(t,e){var n={stack:{},group:{}};if("merge"===t)switch(e){case"none":n.group.merge=!1,n.stack.merge=!1;break;case"grouped":n.group.merge=!0,n.stack.merge=!1;break;case"stacked":n.group.merge=!1,n.stack.merge=!0}if("stack"===t){switch(e){case"all":n.stack.use="constant",n.stack.which="all";break;case"none":n.stack.use="constant",n.stack.which="none";break;case"bycolor":n.stack.use="property",n.stack.which=this.model.state.marker.color.which,n.stack.spaceRef=this.model.state.marker.color.spaceRef}"none"===e&&this.group.merge&&(n.group.merge=!1),"all"!==e&&this.stack.merge&&(n.stack.merge=!1)}this.model.state.marker.set(n)}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(6);var a=((i=o)&&i.__esModule?i:{default:i}).default.extend({init:function(t,e){this.template='<span class="vzb-dl-holder"><ul class="vzb-draggable list vzb-dialog-scrollable"></ul></span>';var n=this;this.name="draggableList",this.dataArrFn=t.dataArrFn,this.lang=t.lang,this.model_expects=[{name:"group",type:"model"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"chart",type:"model"}],this.groupID=t.groupID,this.isEnabled=t.isEnabled,this.draggable=!0,t.groupID||r.warn("draggablelist.js complains on 'groupID' property: "+t.groupID),this.model_binds={"translate:locale":function(t){n.updateView()},"change:group.which":function(t){n.updateView()}},this.model_binds["change:group."+this.groupID]=function(t){n.updateView()},this.model_binds["change:chart."+this.isEnabled]=function(t){n.draggable=n.model.chart[n.isEnabled],n.updateView()},this._super(t,e),this.updateData=r.debounce(this.updateData,1e3),this.itemDragger=d3.drag().on("start",function(t,e){!n.dataUpdateFlag&&n.draggable&&(d3.event.sourceEvent.stopPropagation(),n.parentBoundRect=n.element.node().getBoundingClientRect(),n.element.selectAll("div").each(function(e,i){var r=this.getBoundingClientRect();e._y=r.top,e._top=0,t.data===e.data&&(e._height=r.height,n.selectedNode=this)}),d3.select(n.selectedNode).classed("dragged",!0))}).on("drag",function(t,e){if(!n.dataUpdateFlag&&n.draggable){t._top+=d3.event.dy;var i=t._y+t._top;i>n.parentBoundRect.top&&i+t._height<n.parentBoundRect.top+n.parentBoundRect.height&&n.itemsEl.style("top",function(n,r){var o=0;return r<e&&n._y+.5*t._height>i?o=t._height:r>e&&n._y-.5*t._height<i&&(o=-t._height),r!=e&&(n._top=o),n._top+"px"})}}).on("end",function(t,e){!n.dataUpdateFlag&&n.draggable&&n.getData()})},ready:function(){this.updateView(),this.itemsEl=this.element.selectAll("div"),this.itemsEl.call(this.itemDragger);this.itemsEl.select("li").on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1)}).on("touchstart",function(){d3.event.preventDefault()})},updateView:function(){var t=this,e=t.model.color.getColorlegendMarker().label.getItems(),n=r.keys(e),i=n.slice().sort(),o=(this.dataArrFn()||[]).slice().sort();!1===r.arrayEquals(i,o)&&this.dataArrFn(n),this.items=this.element.selectAll("div").data(function(){return(t.dataArrFn()||[]).map(function(t){return{data:t}})}),this.items.exit().remove(),this.items=this.items.enter().append("div").each(function(){var t=d3.select(this).append("li");t.append("span").classed("label-circle",!0),t.append("span").classed("label-text",!0)}).merge(this.items);var a=this.model.color.getScale();this.items.select("li").each(function(t){var n=t.data,i=d3.select(this);i.classed("hover",!1).attr("data",n),i.select(".label-circle").style("background",a(n)),i.select(".label-text").text(e[n])});var s=!!t.draggable||null;this.element.selectAll("div").style("top","").attr("draggable",s).classed("dragged",!1),this.dataUpdateFlag=!1},getData:function(){var t;t=this.element.selectAll("div").data().sort(function(t,e){return t._y+t._top-(e._y+e._top)}).map(function(t){return t.data}),r.arrayEquals(this.dataArrFn(),t)?this.updateView():(this.dataUpdateFlag=!0,this.updateData(t,!0))},updateData:function(t,e){this.dataArrFn(t,e)},readyOnce:function(){this.element=d3.select(this.element).select(".list")}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(12)),r=o(n(183));function o(t){return t&&t.__esModule?t:{default:t}}var a=i.default.extend("timedisplay",{init:function(t,e){var n=this;this.name="timedisplay",this.model_binds={"change:state.time.value":function(){n.updateTime()}},this._super(t,e)},ready:function(){this.updateTime()},readyOnce:function(){this._super(),this.timeLabel=new r.default(this.element.select(".vzb-timedisplay")),this.timeLabel.setConditions({widthRatio:1,heightRatio:1}),this.resize()},resize:function(){this.timeLabel&&this.timeLabel.resize(this.contentEl.style("width"),this.contentEl.style("height"))},updateTime:function(){var t=this.model.state.time;this.time_1=null==this.time?t.value:this.time,this.time=t.value;var e=t.playing&&this.time-this.time_1>0?t.delayAnimations:0;this.timeLabel.setText(t.formatDate(this.time,"ui"),e)}});e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(31),o=(i=r)&&i.__esModule?i:{default:i};e.default=o.default.extend({init:function(t,e){this.context=t,this.context.classed("vzb-dynamic-background",!0),this.width=0,this.height=0,this.topOffset=0,this.leftOffset=0,this.bottomOffset=0,this.rightOffset=0,this.textWidth=0,this.textHeight=0,this.widthRatio=.9,this.heightRatio=.9,this.xAlign="center",this.yAlign="center",this.element=this.context.append("text").style("font-size","20px"),this._sample=this.context.append("text").style("font-size","20px").style("opacity",0),e&&this.setConditions(e)},setConditions:function(t){return!isNaN(parseFloat(t.rightOffset))&&isFinite(t.rightOffset)&&(this.rightOffset=t.rightOffset),!isNaN(parseFloat(t.leftOffset))&&isFinite(t.leftOffset)&&(this.leftOffset=t.leftOffset),!isNaN(parseFloat(t.topOffset))&&isFinite(t.topOffset)&&(this.topOffset=t.topOffset),!isNaN(parseFloat(t.bottomOffset))&&isFinite(t.bottomOffset)&&(this.bottomOffset=t.bottomOffset),t.xAlign&&(this.xAlign=t.xAlign),t.yAlign&&(this.yAlign=t.yAlign),!isNaN(parseFloat(t.widthRatio))&&t.widthRatio>0&&t.widthRatio<=1&&(this.widthRatio=t.widthRatio),!isNaN(parseFloat(t.heightRatio))&&t.heightRatio>0&&t.heightRatio<=1&&(this.heightRatio=t.heightRatio),this},resize:function(t,e,n,i){this.width=parseInt(t,10)||0,this.height=parseInt(e,10)||0,n&&(this.topOffset=n),i&&(this.leftOffset=i),this._resizeText()},setText:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=function(){e._sample.text(t),e._resizeText(),e.element.text(t)},r=function(){clearTimeout(e._text.timeout),delete e._text};return n?(this._text&&(this._text.callback(),r()),this._text={callback:i,timeout:setTimeout(function(){i(),r()},n)}):(this._text&&r(),i()),this},_resizeText:function(){var t=this._sample.node().getBBox();if(!(t.width&&t.height&&this.width&&this.height))return this;var e=this.width*this.widthRatio/t.width,n=this.height*this.heightRatio/t.height;switch(this.scalar=Math.min(e,n),this.element.attr("transform","scale("+this.scalar+")"),this.textHeight=t.height*this.scalar,this.textWidth=t.width*this.scalar,this.yAlign){case"bottom":case"center":this.context.select("text").attr("dy",".325em");break;case"top":this.context.select("text").attr("dy","0")}return this.context.attr("transform","translate("+this._getLeftOffset()+","+this._getTopOffset()+")"),this},_getLeftOffset:function(){switch(this.xAlign){case"right":return this.width-this.textWidth/2-this.rightOffset;case"left":return this.textWidth/2+this.leftOffset;default:return this.width/2}},_getTopOffset:function(){switch(this.yAlign){case"top":return this.textHeight/2+this.topOffset;case"bottom":return this.height-this.textHeight/2-this.bottomOffset;default:return this.height/2}}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t})(n(1)),a(n(6));var i=a(n(12)),r=a(n(185)),o=a(n(60));function a(t){return t&&t.__esModule?t:{default:t}}var s=i.default.extend("zoom",{init:function(t,e){this.name="zoom",this.components=[{component:r.default,placeholder:".vzb-dialog-zoom-buttonlist",model:["state","ui","locale"]},{component:o.default,placeholder:".vzb-panwitharrow-switch",model:["ui","locale"],checkbox:"panWithArrow"},{component:o.default,placeholder:".vzb-zoomonscrolling-switch",model:["ui","locale"],checkbox:"zoomOnScrolling"},{component:o.default,placeholder:".vzb-adaptminmaxzoom-switch",model:["ui","locale"],checkbox:"adaptMinMaxZoom"}],this._super(t,e)}});e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=l(n(1)),o=n(6),a=(i=o)&&i.__esModule?i:{default:i},s=l(n(21));function l(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var u=a.default.extend({init:function(t,e){var n=this;this.name="gapminder-zoombuttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={arrow:{title:"buttons/cursorarrow",icon:"cursorArrow",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},plus:{title:"buttons/cursorplus",icon:"cursorPlus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},minus:{title:"buttons/cursorminus",icon:"cursorMinus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hand:{title:"buttons/cursorhand",icon:"cursorHand",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hundredpercent:{title:"buttons/hundredpercent",icon:"hundredPercent",func:this.toggleHundredPercent.bind(this),required:!0}},this.model_binds={},Object.keys(this._available_buttons).forEach(function(t){var e=n._available_buttons[t];e&&e.statebind&&(n.model_binds["change:"+e.statebind]=function(n){e.statebindfunc(t,n.source.value)})}),this._super(t,e)},readyOnce:function(){this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addButtons(Object.keys(this._available_buttons),[]),this.setCursorMode("arrow")},_addButtons:function(t,e){var n=this;this._components_config=[];var i=[];if(t.length){for(var o=0;o<t.length;o++){var a=t[o],l=this._available_buttons[a]?a:"_default",u=r.clone(this._available_buttons[l]);u.id=a,u.icon=s[u.icon],i.push(u)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(i).enter().append("button").attr("class",function(t){var n="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(n+=" vzb-dialog-side-btn"),n}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"}),this.element.selectAll(".vzb-buttonlist-btn").on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");n.proceedClick(t)})}},proceedClick:function(t){var e=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=e.attr("class"),i=this._available_buttons[t];if(i&&i.func)i.func(t);else{var r=-1===n.indexOf("vzb-active");e.classed("vzb-active",r);var o={};o.id=t,o.active=r,this.trigger("click",o)}},setButtonActive:function(t,e){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").classed("vzb-active",e)},toggleCursorMode:function(t){var e=t;this.model.ui.set("cursorMode",e,!1,!1)},setCursorMode:function(t){var e=this.model.ui.cursorMode?this.model.ui.cursorMode:"arrow";this.element.selectAll(".vzb-buttonlist-btn").classed("vzb-active",function(t){return t.id==e})},toggleHundredPercent:function(t){this.root.trigger("resetZoom")}});e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(187);var i,r=n(389),o=(i=r)&&i.__esModule?i:{default:i};n(433),e.default=o.default,t.exports=o.default},function(t,e,n){"use strict";(function(t){if(n(188),n(385),n(386),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";function i(t,n,i){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:i})}i(String.prototype,"padLeft","".padStart),i(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&i(Array,t,Function.call.bind([][t]))})}).call(e,n(78))},function(t,e,n){n(189),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(205),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(269),n(270),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(100),n(293),n(294),n(131),n(295),n(296),n(297),n(298),n(299),n(134),n(136),n(137),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),t.exports=n(22)},function(t,e,n){"use strict";var i=n(3),r=n(17),o=n(8),a=n(0),s=n(15),l=n(35).KEY,u=n(4),c=n(61),h=n(51),d=n(39),f=n(7),p=n(114),m=n(80),v=n(190),g=n(64),y=n(2),_=n(5),b=n(18),x=n(26),w=n(38),S=n(42),M=n(117),E=n(19),z=n(9),k=n(40),T=E.f,O=z.f,P=M.f,C=i.Symbol,A=i.JSON,I=A&&A.stringify,L=f("_hidden"),j=f("toPrimitive"),D={}.propertyIsEnumerable,R=c("symbol-registry"),F=c("symbols"),B=c("op-symbols"),N=Object.prototype,q="function"==typeof C,V=i.QObject,U=!V||!V.prototype||!V.prototype.findChild,H=o&&u(function(){return 7!=S(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(t,e,n){var i=T(N,e);i&&delete N[e],O(t,e,n),i&&t!==N&&O(N,e,i)}:O,W=function(t){var e=F[t]=S(C.prototype);return e._k=t,e},K=q&&"symbol"==typeof C.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof C},Y=function(t,e,n){return t===N&&Y(B,e,n),y(t),e=x(e,!0),y(n),r(F,e)?(n.enumerable?(r(t,L)&&t[L][e]&&(t[L][e]=!1),n=S(n,{enumerable:w(0,!1)})):(r(t,L)||O(t,L,w(1,{})),t[L][e]=!0),H(t,e,n)):O(t,e,n)},G=function(t,e){y(t);for(var n,i=v(e=b(e)),r=0,o=i.length;o>r;)Y(t,n=i[r++],e[n]);return t},X=function(t){var e=D.call(this,t=x(t,!0));return!(this===N&&r(F,t)&&!r(B,t))&&(!(e||!r(this,t)||!r(F,t)||r(this,L)&&this[L][t])||e)},$=function(t,e){if(t=b(t),e=x(e,!0),t!==N||!r(F,e)||r(B,e)){var n=T(t,e);return!n||!r(F,e)||r(t,L)&&t[L][e]||(n.enumerable=!0),n}},Z=function(t){for(var e,n=P(b(t)),i=[],o=0;n.length>o;)r(F,e=n[o++])||e==L||e==l||i.push(e);return i},Q=function(t){for(var e,n=t===N,i=P(n?B:b(t)),o=[],a=0;i.length>a;)!r(F,e=i[a++])||n&&!r(N,e)||o.push(F[e]);return o};q||(s((C=function(){if(this instanceof C)throw TypeError("Symbol is not a constructor!");var t=d(arguments.length>0?arguments[0]:void 0),e=function(n){this===N&&e.call(B,n),r(this,L)&&r(this[L],t)&&(this[L][t]=!1),H(this,t,w(1,n))};return o&&U&&H(N,t,{configurable:!0,set:e}),W(t)}).prototype,"toString",function(){return this._k}),E.f=$,z.f=Y,n(43).f=M.f=Z,n(57).f=X,n(63).f=Q,o&&!n(36)&&s(N,"propertyIsEnumerable",X,!0),p.f=function(t){return W(f(t))}),a(a.G+a.W+a.F*!q,{Symbol:C});for(var J="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),tt=0;J.length>tt;)f(J[tt++]);for(var et=k(f.store),nt=0;et.length>nt;)m(et[nt++]);a(a.S+a.F*!q,"Symbol",{for:function(t){return r(R,t+="")?R[t]:R[t]=C(t)},keyFor:function(t){if(!K(t))throw TypeError(t+" is not a symbol!");for(var e in R)if(R[e]===t)return e},useSetter:function(){U=!0},useSimple:function(){U=!1}}),a(a.S+a.F*!q,"Object",{create:function(t,e){return void 0===e?S(t):G(S(t),e)},defineProperty:Y,defineProperties:G,getOwnPropertyDescriptor:$,getOwnPropertyNames:Z,getOwnPropertySymbols:Q}),A&&a(a.S+a.F*(!q||u(function(){var t=C();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){for(var e,n,i=[t],r=1;arguments.length>r;)i.push(arguments[r++]);if(n=e=i[1],(_(e)||void 0!==t)&&!K(t))return g(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!K(e))return e}),i[1]=e,I.apply(A,i)}}),C.prototype[j]||n(14)(C.prototype,j,C.prototype.valueOf),h(C,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},function(t,e,n){var i=n(40),r=n(63),o=n(57);t.exports=function(t){var e=i(t),n=r.f;if(n)for(var a,s=n(t),l=o.f,u=0;s.length>u;)l.call(t,a=s[u++])&&e.push(a);return e}},function(t,e,n){var i=n(0);i(i.S,"Object",{create:n(42)})},function(t,e,n){var i=n(0);i(i.S+i.F*!n(8),"Object",{defineProperty:n(9).f})},function(t,e,n){var i=n(0);i(i.S+i.F*!n(8),"Object",{defineProperties:n(116)})},function(t,e,n){var i=n(18),r=n(19).f;n(29)("getOwnPropertyDescriptor",function(){return function(t,e){return r(i(t),e)}})},function(t,e,n){var i=n(11),r=n(20);n(29)("getPrototypeOf",function(){return function(t){return r(i(t))}})},function(t,e,n){var i=n(11),r=n(40);n(29)("keys",function(){return function(t){return r(i(t))}})},function(t,e,n){n(29)("getOwnPropertyNames",function(){return n(117).f})},function(t,e,n){var i=n(5),r=n(35).onFreeze;n(29)("freeze",function(t){return function(e){return t&&i(e)?t(r(e)):e}})},function(t,e,n){var i=n(5),r=n(35).onFreeze;n(29)("seal",function(t){return function(e){return t&&i(e)?t(r(e)):e}})},function(t,e,n){var i=n(5),r=n(35).onFreeze;n(29)("preventExtensions",function(t){return function(e){return t&&i(e)?t(r(e)):e}})},function(t,e,n){var i=n(5);n(29)("isFrozen",function(t){return function(e){return!i(e)||!!t&&t(e)}})},function(t,e,n){var i=n(5);n(29)("isSealed",function(t){return function(e){return!i(e)||!!t&&t(e)}})},function(t,e,n){var i=n(5);n(29)("isExtensible",function(t){return function(e){return!!i(e)&&(!t||t(e))}})},function(t,e,n){var i=n(0);i(i.S+i.F,"Object",{assign:n(118)})},function(t,e,n){var i=n(0);i(i.S,"Object",{is:n(206)})},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,n){var i=n(0);i(i.S,"Object",{setPrototypeOf:n(84).set})},function(t,e,n){"use strict";var i=n(58),r={};r[n(7)("toStringTag")]="z",r+""!="[object z]"&&n(15)(Object.prototype,"toString",function(){return"[object "+i(this)+"]"},!0)},function(t,e,n){var i=n(0);i(i.P,"Function",{bind:n(119)})},function(t,e,n){var i=n(9).f,r=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in r||n(8)&&i(r,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},function(t,e,n){"use strict";var i=n(5),r=n(20),o=n(7)("hasInstance"),a=Function.prototype;o in a||n(9).f(a,o,{value:function(t){if("function"!=typeof this||!i(t))return!1;if(!i(this.prototype))return t instanceof this;for(;t=r(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,n){var i=n(0),r=n(121);i(i.G+i.F*(parseInt!=r),{parseInt:r})},function(t,e,n){var i=n(0),r=n(122);i(i.G+i.F*(parseFloat!=r),{parseFloat:r})},function(t,e,n){"use strict";var i=n(3),r=n(17),o=n(24),a=n(86),s=n(26),l=n(4),u=n(43).f,c=n(19).f,h=n(9).f,d=n(52).trim,f=i.Number,p=f,m=f.prototype,v="Number"==o(n(42)(m)),g="trim"in String.prototype,y=function(t){var e=s(t,!1);if("string"==typeof e&&e.length>2){var n,i,r,o=(e=g?e.trim():d(e,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=e.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(e.charCodeAt(1)){case 66:case 98:i=2,r=49;break;case 79:case 111:i=8,r=55;break;default:return+e}for(var a,l=e.slice(2),u=0,c=l.length;u<c;u++)if((a=l.charCodeAt(u))<48||a>r)return NaN;return parseInt(l,i)}}return+e};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof f&&(v?l(function(){m.valueOf.call(n)}):"Number"!=o(n))?a(new p(y(e)),n,f):y(e)};for(var _,b=n(8)?u(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;b.length>x;x++)r(p,_=b[x])&&!r(f,_)&&h(f,_,c(p,_));f.prototype=m,m.constructor=f,n(15)(i,"Number",f)}},function(t,e,n){"use strict";var i=n(0),r=n(28),o=n(123),a=n(87),s=1..toFixed,l=Math.floor,u=[0,0,0,0,0,0],c="Number.toFixed: incorrect invocation!",h=function(t,e){for(var n=-1,i=e;++n<6;)i+=t*u[n],u[n]=i%1e7,i=l(i/1e7)},d=function(t){for(var e=6,n=0;--e>=0;)n+=u[e],u[e]=l(n/t),n=n%t*1e7},f=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==u[t]){var n=String(u[t]);e=""===e?n:e+a.call("0",7-n.length)+n}return e},p=function(t,e,n){return 0===e?n:e%2==1?p(t,e-1,n*t):p(t*t,e/2,n)};i(i.P+i.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(4)(function(){s.call({})})),"Number",{toFixed:function(t){var e,n,i,s,l=o(this,c),u=r(t),m="",v="0";if(u<0||u>20)throw RangeError(c);if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(m="-",l=-l),l>1e-21)if(n=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(l*p(2,69,1))-69)<0?l*p(2,-e,1):l/p(2,e,1),n*=4503599627370496,(e=52-e)>0){for(h(0,n),i=u;i>=7;)h(1e7,0),i-=7;for(h(p(10,i,1),0),i=e-1;i>=23;)d(1<<23),i-=23;d(1<<i),h(1,1),d(2),v=f()}else h(0,n),h(1<<-e,0),v=f()+a.call("0",u);return v=u>0?m+((s=v.length)<=u?"0."+a.call("0",u-s)+v:v.slice(0,s-u)+"."+v.slice(s-u)):m+v}})},function(t,e,n){"use strict";var i=n(0),r=n(4),o=n(123),a=1..toPrecision;i(i.P+i.F*(r(function(){return"1"!==a.call(1,void 0)})||!r(function(){a.call({})})),"Number",{toPrecision:function(t){var e=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?a.call(e):a.call(e,t)}})},function(t,e,n){var i=n(0);i(i.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,e,n){var i=n(0),r=n(3).isFinite;i(i.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},function(t,e,n){var i=n(0);i(i.S,"Number",{isInteger:n(124)})},function(t,e,n){var i=n(0);i(i.S,"Number",{isNaN:function(t){return t!=t}})},function(t,e,n){var i=n(0),r=n(124),o=Math.abs;i(i.S,"Number",{isSafeInteger:function(t){return r(t)&&o(t)<=9007199254740991}})},function(t,e,n){var i=n(0);i(i.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,e,n){var i=n(0);i(i.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,e,n){var i=n(0),r=n(122);i(i.S+i.F*(Number.parseFloat!=r),"Number",{parseFloat:r})},function(t,e,n){var i=n(0),r=n(121);i(i.S+i.F*(Number.parseInt!=r),"Number",{parseInt:r})},function(t,e,n){var i=n(0),r=n(125),o=Math.sqrt,a=Math.acosh;i(i.S+i.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:r(t-1+o(t-1)*o(t+1))}})},function(t,e,n){var i=n(0),r=Math.asinh;i(i.S+i.F*!(r&&1/r(0)>0),"Math",{asinh:function t(e){return isFinite(e=+e)&&0!=e?e<0?-t(-e):Math.log(e+Math.sqrt(e*e+1)):e}})},function(t,e,n){var i=n(0),r=Math.atanh;i(i.S+i.F*!(r&&1/r(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,e,n){var i=n(0),r=n(88);i(i.S,"Math",{cbrt:function(t){return r(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,e,n){var i=n(0);i(i.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,e,n){var i=n(0),r=Math.exp;i(i.S,"Math",{cosh:function(t){return(r(t=+t)+r(-t))/2}})},function(t,e,n){var i=n(0),r=n(89);i(i.S+i.F*(r!=Math.expm1),"Math",{expm1:r})},function(t,e,n){var i=n(0);i(i.S,"Math",{fround:n(126)})},function(t,e,n){var i=n(0),r=Math.abs;i(i.S,"Math",{hypot:function(t,e){for(var n,i,o=0,a=0,s=arguments.length,l=0;a<s;)l<(n=r(arguments[a++]))?(o=o*(i=l/n)*i+1,l=n):o+=n>0?(i=n/l)*i:n;return l===1/0?1/0:l*Math.sqrt(o)}})},function(t,e,n){var i=n(0),r=Math.imul;i(i.S+i.F*n(4)(function(){return-5!=r(4294967295,5)||2!=r.length}),"Math",{imul:function(t,e){var n=+t,i=+e,r=65535&n,o=65535&i;return 0|r*o+((65535&n>>>16)*o+r*(65535&i>>>16)<<16>>>0)}})},function(t,e,n){var i=n(0);i(i.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,e,n){var i=n(0);i(i.S,"Math",{log1p:n(125)})},function(t,e,n){var i=n(0);i(i.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,e,n){var i=n(0);i(i.S,"Math",{sign:n(88)})},function(t,e,n){var i=n(0),r=n(89),o=Math.exp;i(i.S+i.F*n(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(r(t)-r(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,e,n){var i=n(0),r=n(89),o=Math.exp;i(i.S,"Math",{tanh:function(t){var e=r(t=+t),n=r(-t);return e==1/0?1:n==1/0?-1:(e-n)/(o(t)+o(-t))}})},function(t,e,n){var i=n(0);i(i.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,e,n){var i=n(0),r=n(41),o=String.fromCharCode,a=String.fromCodePoint;i(i.S+i.F*(!!a&&1!=a.length),"String",{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,a=0;i>a;){if(e=+arguments[a++],r(e,1114111)!==e)throw RangeError(e+" is not a valid code point");n.push(e<65536?o(e):o(55296+((e-=65536)>>10),e%1024+56320))}return n.join("")}})},function(t,e,n){var i=n(0),r=n(18),o=n(10);i(i.S,"String",{raw:function(t){for(var e=r(t.raw),n=o(e.length),i=arguments.length,a=[],s=0;n>s;)a.push(String(e[s++])),s<i&&a.push(String(arguments[s]));return a.join("")}})},function(t,e,n){"use strict";n(52)("trim",function(t){return function(){return t(this,3)}})},function(t,e,n){"use strict";var i=n(90)(!0);n(91)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=i(e,n),this._i+=t.length,{value:t,done:!1})})},function(t,e,n){"use strict";var i=n(0),r=n(90)(!1);i(i.P,"String",{codePointAt:function(t){return r(this,t)}})},function(t,e,n){"use strict";var i=n(0),r=n(10),o=n(93),a="".endsWith;i(i.P+i.F*n(94)("endsWith"),"String",{endsWith:function(t){var e=o(this,t,"endsWith"),n=arguments.length>1?arguments[1]:void 0,i=r(e.length),s=void 0===n?i:Math.min(r(n),i),l=String(t);return a?a.call(e,l,s):e.slice(s-l.length,s)===l}})},function(t,e,n){"use strict";var i=n(0),r=n(93);i(i.P+i.F*n(94)("includes"),"String",{includes:function(t){return!!~r(this,t,"includes").indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var i=n(0);i(i.P,"String",{repeat:n(87)})},function(t,e,n){"use strict";var i=n(0),r=n(10),o=n(93),a="".startsWith;i(i.P+i.F*n(94)("startsWith"),"String",{startsWith:function(t){var e=o(this,t,"startsWith"),n=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),i=String(t);return a?a.call(e,i,n):e.slice(n,n+i.length)===i}})},function(t,e,n){"use strict";n(16)("anchor",function(t){return function(e){return t(this,"a","name",e)}})},function(t,e,n){"use strict";n(16)("big",function(t){return function(){return t(this,"big","","")}})},function(t,e,n){"use strict";n(16)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,e,n){"use strict";n(16)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,e,n){"use strict";n(16)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,e,n){"use strict";n(16)("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},function(t,e,n){"use strict";n(16)("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},function(t,e,n){"use strict";n(16)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,e,n){"use strict";n(16)("link",function(t){return function(e){return t(this,"a","href",e)}})},function(t,e,n){"use strict";n(16)("small",function(t){return function(){return t(this,"small","","")}})},function(t,e,n){"use strict";n(16)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,e,n){"use strict";n(16)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,e,n){"use strict";n(16)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,e,n){var i=n(0);i(i.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,e,n){"use strict";var i=n(0),r=n(11),o=n(26);i(i.P+i.F*n(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=r(this),n=o(e);return"number"!=typeof n||isFinite(n)?e.toISOString():null}})},function(t,e,n){var i=n(0),r=n(268);i(i.P+i.F*(Date.prototype.toISOString!==r),"Date",{toISOString:r})},function(t,e,n){"use strict";var i=n(4),r=Date.prototype.getTime,o=Date.prototype.toISOString,a=function(t){return t>9?t:"0"+t};t.exports=i(function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))})||!i(function(){o.call(new Date(NaN))})?function(){if(!isFinite(r.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),n=t.getUTCMilliseconds(),i=e<0?"-":e>9999?"+":"";return i+("00000"+Math.abs(e)).slice(i?-6:-4)+"-"+a(t.getUTCMonth()+1)+"-"+a(t.getUTCDate())+"T"+a(t.getUTCHours())+":"+a(t.getUTCMinutes())+":"+a(t.getUTCSeconds())+"."+(n>99?n:"0"+a(n))+"Z"}:o},function(t,e,n){var i=Date.prototype,r=i.toString,o=i.getTime;new Date(NaN)+""!="Invalid Date"&&n(15)(i,"toString",function(){var t=o.call(this);return t==t?r.call(this):"Invalid Date"})},function(t,e,n){var i=n(7)("toPrimitive"),r=Date.prototype;i in r||n(14)(r,i,n(271))},function(t,e,n){"use strict";var i=n(2),r=n(26);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return r(i(this),"number"!=t)}},function(t,e,n){var i=n(0);i(i.S,"Array",{isArray:n(64)})},function(t,e,n){"use strict";var i=n(23),r=n(0),o=n(11),a=n(127),s=n(95),l=n(10),u=n(96),c=n(97);r(r.S+r.F*!n(66)(function(t){Array.from(t)}),"Array",{from:function(t){var e,n,r,h,d=o(t),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,v=void 0!==m,g=0,y=c(d);if(v&&(m=i(m,p>2?arguments[2]:void 0,2)),void 0==y||f==Array&&s(y))for(n=new f(e=l(d.length));e>g;g++)u(n,g,v?m(d[g],g):d[g]);else for(h=y.call(d),n=new f;!(r=h.next()).done;g++)u(n,g,v?a(h,m,[r.value,g],!0):r.value);return n.length=g,n}})},function(t,e,n){"use strict";var i=n(0),r=n(96);i(i.S+i.F*n(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,e=arguments.length,n=new("function"==typeof this?this:Array)(e);e>t;)r(n,t,arguments[t++]);return n.length=e,n}})},function(t,e,n){"use strict";var i=n(0),r=n(18),o=[].join;i(i.P+i.F*(n(56)!=Object||!n(25)(o)),"Array",{join:function(t){return o.call(r(this),void 0===t?",":t)}})},function(t,e,n){"use strict";var i=n(0),r=n(83),o=n(24),a=n(41),s=n(10),l=[].slice;i(i.P+i.F*n(4)(function(){r&&l.call(r)}),"Array",{slice:function(t,e){var n=s(this.length),i=o(this);if(e=void 0===e?n:e,"Array"==i)return l.call(this,t,e);for(var r=a(t,n),u=a(e,n),c=s(u-r),h=new Array(c),d=0;d<c;d++)h[d]="String"==i?this.charAt(r+d):this[r+d];return h}})},function(t,e,n){"use strict";var i=n(0),r=n(13),o=n(11),a=n(4),s=[].sort,l=[1,2,3];i(i.P+i.F*(a(function(){l.sort(void 0)})||!a(function(){l.sort(null)})||!n(25)(s)),"Array",{sort:function(t){return void 0===t?s.call(o(this)):s.call(o(this),r(t))}})},function(t,e,n){"use strict";var i=n(0),r=n(30)(0),o=n(25)([].forEach,!0);i(i.P+i.F*!o,"Array",{forEach:function(t){return r(this,t,arguments[1])}})},function(t,e,n){var i=n(5),r=n(64),o=n(7)("species");t.exports=function(t){var e;return r(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!r(e.prototype)||(e=void 0),i(e)&&null===(e=e[o])&&(e=void 0)),void 0===e?Array:e}},function(t,e,n){"use strict";var i=n(0),r=n(30)(1);i(i.P+i.F*!n(25)([].map,!0),"Array",{map:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(30)(2);i(i.P+i.F*!n(25)([].filter,!0),"Array",{filter:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(30)(3);i(i.P+i.F*!n(25)([].some,!0),"Array",{some:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(30)(4);i(i.P+i.F*!n(25)([].every,!0),"Array",{every:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(128);i(i.P+i.F*!n(25)([].reduce,!0),"Array",{reduce:function(t){return r(this,t,arguments.length,arguments[1],!1)}})},function(t,e,n){"use strict";var i=n(0),r=n(128);i(i.P+i.F*!n(25)([].reduceRight,!0),"Array",{reduceRight:function(t){return r(this,t,arguments.length,arguments[1],!0)}})},function(t,e,n){"use strict";var i=n(0),r=n(62)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;i(i.P+i.F*(a||!n(25)(o)),"Array",{indexOf:function(t){return a?o.apply(this,arguments)||0:r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(18),o=n(28),a=n(10),s=[].lastIndexOf,l=!!s&&1/[1].lastIndexOf(1,-0)<0;i(i.P+i.F*(l||!n(25)(s)),"Array",{lastIndexOf:function(t){if(l)return s.apply(this,arguments)||0;var e=r(this),n=a(e.length),i=n-1;for(arguments.length>1&&(i=Math.min(i,o(arguments[1]))),i<0&&(i=n+i);i>=0;i--)if(i in e&&e[i]===t)return i||0;return-1}})},function(t,e,n){var i=n(0);i(i.P,"Array",{copyWithin:n(129)}),n(37)("copyWithin")},function(t,e,n){var i=n(0);i(i.P,"Array",{fill:n(99)}),n(37)("fill")},function(t,e,n){"use strict";var i=n(0),r=n(30)(5),o=!0;"find"in[]&&Array(1).find(function(){o=!1}),i(i.P+i.F*o,"Array",{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(37)("find")},function(t,e,n){"use strict";var i=n(0),r=n(30)(6),o="findIndex",a=!0;o in[]&&Array(1)[o](function(){a=!1}),i(i.P+i.F*a,"Array",{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(37)(o)},function(t,e,n){n(44)("Array")},function(t,e,n){var i=n(3),r=n(86),o=n(9).f,a=n(43).f,s=n(65),l=n(67),u=i.RegExp,c=u,h=u.prototype,d=/a/g,f=/a/g,p=new u(d)!==d;if(n(8)&&(!p||n(4)(function(){return f[n(7)("match")]=!1,u(d)!=d||u(f)==f||"/a/i"!=u(d,"i")}))){u=function(t,e){var n=this instanceof u,i=s(t),o=void 0===e;return!n&&i&&t.constructor===u&&o?t:r(p?new c(i&&!o?t.source:t,e):c((i=t instanceof u)?t.source:t,i&&o?l.call(t):e),n?this:h,u)};for(var m=function(t){t in u||o(u,t,{configurable:!0,get:function(){return c[t]},set:function(e){c[t]=e}})},v=a(c),g=0;v.length>g;)m(v[g++]);h.constructor=u,u.prototype=h,n(15)(i,"RegExp",u)}n(44)("RegExp")},function(t,e,n){"use strict";n(131);var i=n(2),r=n(67),o=n(8),a=/./.toString,s=function(t){n(15)(RegExp.prototype,"toString",t,!0)};n(4)(function(){return"/a/b"!=a.call({source:"a",flags:"b"})})?s(function(){var t=i(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?r.call(t):void 0)}):"toString"!=a.name&&s(function(){return a.call(this)})},function(t,e,n){n(68)("match",1,function(t,e,n){return[function(n){"use strict";var i=t(this),r=void 0==n?void 0:n[e];return void 0!==r?r.call(n,i):new RegExp(n)[e](String(i))},n]})},function(t,e,n){n(68)("replace",2,function(t,e,n){return[function(i,r){"use strict";var o=t(this),a=void 0==i?void 0:i[e];return void 0!==a?a.call(i,o,r):n.call(String(o),i,r)},n]})},function(t,e,n){n(68)("search",1,function(t,e,n){return[function(n){"use strict";var i=t(this),r=void 0==n?void 0:n[e];return void 0!==r?r.call(n,i):new RegExp(n)[e](String(i))},n]})},function(t,e,n){n(68)("split",2,function(t,e,i){"use strict";var r=n(65),o=i,a=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var s=void 0===/()??/.exec("")[1];i=function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!r(t))return o.call(n,t,e);var i,l,u,c,h,d=[],f=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),p=0,m=void 0===e?4294967295:e>>>0,v=new RegExp(t.source,f+"g");for(s||(i=new RegExp("^"+v.source+"$(?!\\s)",f));(l=v.exec(n))&&!((u=l.index+l[0].length)>p&&(d.push(n.slice(p,l.index)),!s&&l.length>1&&l[0].replace(i,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(l[h]=void 0)}),l.length>1&&l.index<n.length&&a.apply(d,l.slice(1)),c=l[0].length,p=u,d.length>=m));)v.lastIndex===l.index&&v.lastIndex++;return p===n.length?!c&&v.test("")||d.push(""):d.push(n.slice(p)),d.length>m?d.slice(0,m):d}}else"0".split(void 0,0).length&&(i=function(t,e){return void 0===t&&0===e?[]:o.call(this,t,e)});return[function(n,r){var o=t(this),a=void 0==n?void 0:n[e];return void 0!==a?a.call(n,o,r):i.call(String(o),n,r)},i]})},function(t,e,n){"use strict";var i,r,o,a,s=n(36),l=n(3),u=n(23),c=n(58),h=n(0),d=n(5),f=n(13),p=n(45),m=n(46),v=n(69),g=n(101).set,y=n(102)(),_=n(103),b=n(132),x=n(70),w=n(133),S=l.TypeError,M=l.process,E=M&&M.versions,z=E&&E.v8||"",k=l.Promise,T="process"==c(M),O=function(){},P=r=_.f,C=!!function(){try{var t=k.resolve(1),e=(t.constructor={})[n(7)("species")]=function(t){t(O,O)};return(T||"function"==typeof PromiseRejectionEvent)&&t.then(O)instanceof e&&0!==z.indexOf("6.6")&&-1===x.indexOf("Chrome/66")}catch(t){}}(),A=function(t){var e;return!(!d(t)||"function"!=typeof(e=t.then))&&e},I=function(t,e){if(!t._n){t._n=!0;var n=t._c;y(function(){for(var i=t._v,r=1==t._s,o=0,a=function(e){var n,o,a,s=r?e.ok:e.fail,l=e.resolve,u=e.reject,c=e.domain;try{s?(r||(2==t._h&&D(t),t._h=1),!0===s?n=i:(c&&c.enter(),n=s(i),c&&(c.exit(),a=!0)),n===e.promise?u(S("Promise-chain cycle")):(o=A(n))?o.call(n,l,u):l(n)):u(i)}catch(t){c&&!a&&c.exit(),u(t)}};n.length>o;)a(n[o++]);t._c=[],t._n=!1,e&&!t._h&&L(t)})}},L=function(t){g.call(l,function(){var e,n,i,r=t._v,o=j(t);if(o&&(e=b(function(){T?M.emit("unhandledRejection",r,t):(n=l.onunhandledrejection)?n({promise:t,reason:r}):(i=l.console)&&i.error&&i.error("Unhandled promise rejection",r)}),t._h=T||j(t)?2:1),t._a=void 0,o&&e.e)throw e.v})},j=function(t){return 1!==t._h&&0===(t._a||t._c).length},D=function(t){g.call(l,function(){var e;T?M.emit("rejectionHandled",t):(e=l.onrejectionhandled)&&e({promise:t,reason:t._v})})},R=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),I(e,!0))},F=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw S("Promise can't be resolved itself");(e=A(t))?y(function(){var i={_w:n,_d:!1};try{e.call(t,u(F,i,1),u(R,i,1))}catch(t){R.call(i,t)}}):(n._v=t,n._s=1,I(n,!1))}catch(t){R.call({_w:n,_d:!1},t)}}};C||(k=function(t){p(this,k,"Promise","_h"),f(t),i.call(this);try{t(u(F,this,1),u(R,this,1))}catch(t){R.call(this,t)}},(i=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(47)(k.prototype,{then:function(t,e){var n=P(v(this,k));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=T?M.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&I(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new i;this.promise=t,this.resolve=u(F,t,1),this.reject=u(R,t,1)},_.f=P=function(t){return t===k||t===a?new o(t):r(t)}),h(h.G+h.W+h.F*!C,{Promise:k}),n(51)(k,"Promise"),n(44)("Promise"),a=n(22).Promise,h(h.S+h.F*!C,"Promise",{reject:function(t){var e=P(this);return(0,e.reject)(t),e.promise}}),h(h.S+h.F*(s||!C),"Promise",{resolve:function(t){return w(s&&this===a?k:this,t)}}),h(h.S+h.F*!(C&&n(66)(function(t){k.all(t).catch(O)})),"Promise",{all:function(t){var e=this,n=P(e),i=n.resolve,r=n.reject,o=b(function(){var n=[],o=0,a=1;m(t,!1,function(t){var s=o++,l=!1;n.push(void 0),a++,e.resolve(t).then(function(t){l||(l=!0,n[s]=t,--a||i(n))},r)}),--a||i(n)});return o.e&&r(o.v),n.promise},race:function(t){var e=this,n=P(e),i=n.reject,r=b(function(){m(t,!1,function(t){e.resolve(t).then(n.resolve,i)})});return r.e&&i(r.v),n.promise}})},function(t,e,n){"use strict";var i=n(138),r=n(54);n(71)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return i.def(r(this,"WeakSet"),t,!0)}},i,!1,!0)},function(t,e,n){"use strict";var i=n(0),r=n(72),o=n(104),a=n(2),s=n(41),l=n(10),u=n(5),c=n(3).ArrayBuffer,h=n(69),d=o.ArrayBuffer,f=o.DataView,p=r.ABV&&c.isView,m=d.prototype.slice,v=r.VIEW;i(i.G+i.W+i.F*(c!==d),{ArrayBuffer:d}),i(i.S+i.F*!r.CONSTR,"ArrayBuffer",{isView:function(t){return p&&p(t)||u(t)&&v in t}}),i(i.P+i.U+i.F*n(4)(function(){return!new d(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(t,e){if(void 0!==m&&void 0===e)return m.call(a(this),t);for(var n=a(this).byteLength,i=s(t,n),r=s(void 0===e?n:e,n),o=new(h(this,d))(l(r-i)),u=new f(this),c=new f(o),p=0;i<r;)c.setUint8(p++,u.getUint8(i++));return o}}),n(44)("ArrayBuffer")},function(t,e,n){var i=n(0);i(i.G+i.W+i.F*!n(72).ABV,{DataView:n(104).DataView})},function(t,e,n){n(33)("Int8",1,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){n(33)("Uint8",1,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){n(33)("Uint8",1,function(t){return function(e,n,i){return t(this,e,n,i)}},!0)},function(t,e,n){n(33)("Int16",2,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){n(33)("Uint16",2,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){n(33)("Int32",4,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){n(33)("Uint32",4,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){n(33)("Float32",4,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){n(33)("Float64",8,function(t){return function(e,n,i){return t(this,e,n,i)}})},function(t,e,n){var i=n(0),r=n(13),o=n(2),a=(n(3).Reflect||{}).apply,s=Function.apply;i(i.S+i.F*!n(4)(function(){a(function(){})}),"Reflect",{apply:function(t,e,n){var i=r(t),l=o(n);return a?a(i,e,l):s.call(i,e,l)}})},function(t,e,n){var i=n(0),r=n(42),o=n(13),a=n(2),s=n(5),l=n(4),u=n(119),c=(n(3).Reflect||{}).construct,h=l(function(){function t(){}return!(c(function(){},[],t)instanceof t)}),d=!l(function(){c(function(){})});i(i.S+i.F*(h||d),"Reflect",{construct:function(t,e){o(t),a(e);var n=arguments.length<3?t:o(arguments[2]);if(d&&!h)return c(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var i=[null];return i.push.apply(i,e),new(u.apply(t,i))}var l=n.prototype,f=r(s(l)?l:Object.prototype),p=Function.apply.call(t,f,e);return s(p)?p:f}})},function(t,e,n){var i=n(9),r=n(0),o=n(2),a=n(26);r(r.S+r.F*n(4)(function(){Reflect.defineProperty(i.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,n){o(t),e=a(e,!0),o(n);try{return i.f(t,e,n),!0}catch(t){return!1}}})},function(t,e,n){var i=n(0),r=n(19).f,o=n(2);i(i.S,"Reflect",{deleteProperty:function(t,e){var n=r(o(t),e);return!(n&&!n.configurable)&&delete t[e]}})},function(t,e,n){"use strict";var i=n(0),r=n(2),o=function(t){this._t=r(t),this._i=0;var e,n=this._k=[];for(e in t)n.push(e)};n(92)(o,"Object",function(){var t,e=this._k;do{if(this._i>=e.length)return{value:void 0,done:!0}}while(!((t=e[this._i++])in this._t));return{value:t,done:!1}}),i(i.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,e,n){var i=n(19),r=n(20),o=n(17),a=n(0),s=n(5),l=n(2);a(a.S,"Reflect",{get:function t(e,n){var a,u,c=arguments.length<3?e:arguments[2];return l(e)===c?e[n]:(a=i.f(e,n))?o(a,"value")?a.value:void 0!==a.get?a.get.call(c):void 0:s(u=r(e))?t(u,n,c):void 0}})},function(t,e,n){var i=n(19),r=n(0),o=n(2);r(r.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return i.f(o(t),e)}})},function(t,e,n){var i=n(0),r=n(20),o=n(2);i(i.S,"Reflect",{getPrototypeOf:function(t){return r(o(t))}})},function(t,e,n){var i=n(0);i(i.S,"Reflect",{has:function(t,e){return e in t}})},function(t,e,n){var i=n(0),r=n(2),o=Object.isExtensible;i(i.S,"Reflect",{isExtensible:function(t){return r(t),!o||o(t)}})},function(t,e,n){var i=n(0);i(i.S,"Reflect",{ownKeys:n(140)})},function(t,e,n){var i=n(0),r=n(2),o=Object.preventExtensions;i(i.S,"Reflect",{preventExtensions:function(t){r(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,e,n){var i=n(9),r=n(19),o=n(20),a=n(17),s=n(0),l=n(38),u=n(2),c=n(5);s(s.S,"Reflect",{set:function t(e,n,s){var h,d,f=arguments.length<4?e:arguments[3],p=r.f(u(e),n);if(!p){if(c(d=o(e)))return t(d,n,s,f);p=l(0)}if(a(p,"value")){if(!1===p.writable||!c(f))return!1;if(h=r.f(f,n)){if(h.get||h.set||!1===h.writable)return!1;h.value=s,i.f(f,n,h)}else i.f(f,n,l(0,s));return!0}return void 0!==p.set&&(p.set.call(f,s),!0)}})},function(t,e,n){var i=n(0),r=n(84);r&&i(i.S,"Reflect",{setPrototypeOf:function(t,e){r.check(t,e);try{return r.set(t,e),!0}catch(t){return!1}}})},function(t,e,n){"use strict";var i=n(0),r=n(62)(!0);i(i.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(37)("includes")},function(t,e,n){"use strict";var i=n(0),r=n(141),o=n(11),a=n(10),s=n(13),l=n(98);i(i.P,"Array",{flatMap:function(t){var e,n,i=o(this);return s(t),e=a(i.length),n=l(i,0),r(n,i,i,e,0,1,t,arguments[1]),n}}),n(37)("flatMap")},function(t,e,n){"use strict";var i=n(0),r=n(141),o=n(11),a=n(10),s=n(28),l=n(98);i(i.P,"Array",{flatten:function(){var t=arguments[0],e=o(this),n=a(e.length),i=l(e,0);return r(i,e,e,n,0,void 0===t?1:s(t)),i}}),n(37)("flatten")},function(t,e,n){"use strict";var i=n(0),r=n(90)(!0);i(i.P,"String",{at:function(t){return r(this,t)}})},function(t,e,n){"use strict";var i=n(0),r=n(142),o=n(70);i(i.P+i.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(o),"String",{padStart:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,e,n){"use strict";var i=n(0),r=n(142),o=n(70);i(i.P+i.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(o),"String",{padEnd:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,e,n){"use strict";n(52)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,e,n){"use strict";n(52)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,e,n){"use strict";var i=n(0),r=n(27),o=n(10),a=n(65),s=n(67),l=RegExp.prototype,u=function(t,e){this._r=t,this._s=e};n(92)(u,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),i(i.P,"String",{matchAll:function(t){if(r(this),!a(t))throw TypeError(t+" is not a regexp!");var e=String(this),n="flags"in l?String(t.flags):s.call(t),i=new RegExp(t.source,~n.indexOf("g")?n:"g"+n);return i.lastIndex=o(t.lastIndex),new u(i,e)}})},function(t,e,n){n(80)("asyncIterator")},function(t,e,n){n(80)("observable")},function(t,e,n){var i=n(0),r=n(140),o=n(18),a=n(19),s=n(96);i(i.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,n,i=o(t),l=a.f,u=r(i),c={},h=0;u.length>h;)void 0!==(n=l(i,e=u[h++]))&&s(c,e,n);return c}})},function(t,e,n){var i=n(0),r=n(143)(!1);i(i.S,"Object",{values:function(t){return r(t)}})},function(t,e,n){var i=n(0),r=n(143)(!0);i(i.S,"Object",{entries:function(t){return r(t)}})},function(t,e,n){"use strict";var i=n(0),r=n(11),o=n(13),a=n(9);n(8)&&i(i.P+n(73),"Object",{__defineGetter__:function(t,e){a.f(r(this),t,{get:o(e),enumerable:!0,configurable:!0})}})},function(t,e,n){"use strict";var i=n(0),r=n(11),o=n(13),a=n(9);n(8)&&i(i.P+n(73),"Object",{__defineSetter__:function(t,e){a.f(r(this),t,{set:o(e),enumerable:!0,configurable:!0})}})},function(t,e,n){"use strict";var i=n(0),r=n(11),o=n(26),a=n(20),s=n(19).f;n(8)&&i(i.P+n(73),"Object",{__lookupGetter__:function(t){var e,n=r(this),i=o(t,!0);do{if(e=s(n,i))return e.get}while(n=a(n))}})},function(t,e,n){"use strict";var i=n(0),r=n(11),o=n(26),a=n(20),s=n(19).f;n(8)&&i(i.P+n(73),"Object",{__lookupSetter__:function(t){var e,n=r(this),i=o(t,!0);do{if(e=s(n,i))return e.set}while(n=a(n))}})},function(t,e,n){var i=n(0);i(i.P+i.R,"Map",{toJSON:n(144)("Map")})},function(t,e,n){var i=n(0);i(i.P+i.R,"Set",{toJSON:n(144)("Set")})},function(t,e,n){n(74)("Map")},function(t,e,n){n(74)("Set")},function(t,e,n){n(74)("WeakMap")},function(t,e,n){n(74)("WeakSet")},function(t,e,n){n(75)("Map")},function(t,e,n){n(75)("Set")},function(t,e,n){n(75)("WeakMap")},function(t,e,n){n(75)("WeakSet")},function(t,e,n){var i=n(0);i(i.G,{global:n(3)})},function(t,e,n){var i=n(0);i(i.S,"System",{global:n(3)})},function(t,e,n){var i=n(0),r=n(24);i(i.S,"Error",{isError:function(t){return"Error"===r(t)}})},function(t,e,n){var i=n(0);i(i.S,"Math",{clamp:function(t,e,n){return Math.min(n,Math.max(e,t))}})},function(t,e,n){var i=n(0);i(i.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,e,n){var i=n(0),r=180/Math.PI;i(i.S,"Math",{degrees:function(t){return t*r}})},function(t,e,n){var i=n(0),r=n(146),o=n(126);i(i.S,"Math",{fscale:function(t,e,n,i,a){return o(r(t,e,n,i,a))}})},function(t,e,n){var i=n(0);i(i.S,"Math",{iaddh:function(t,e,n,i){var r=t>>>0,o=n>>>0;return(e>>>0)+(i>>>0)+((r&o|(r|o)&~(r+o>>>0))>>>31)|0}})},function(t,e,n){var i=n(0);i(i.S,"Math",{isubh:function(t,e,n,i){var r=t>>>0,o=n>>>0;return(e>>>0)-(i>>>0)-((~r&o|~(r^o)&r-o>>>0)>>>31)|0}})},function(t,e,n){var i=n(0);i(i.S,"Math",{imulh:function(t,e){var n=+t,i=+e,r=65535&n,o=65535&i,a=n>>16,s=i>>16,l=(a*o>>>0)+(r*o>>>16);return a*s+(l>>16)+((r*s>>>0)+(65535&l)>>16)}})},function(t,e,n){var i=n(0);i(i.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,e,n){var i=n(0),r=Math.PI/180;i(i.S,"Math",{radians:function(t){return t*r}})},function(t,e,n){var i=n(0);i(i.S,"Math",{scale:n(146)})},function(t,e,n){var i=n(0);i(i.S,"Math",{umulh:function(t,e){var n=+t,i=+e,r=65535&n,o=65535&i,a=n>>>16,s=i>>>16,l=(a*o>>>0)+(r*o>>>16);return a*s+(l>>>16)+((r*s>>>0)+(65535&l)>>>16)}})},function(t,e,n){var i=n(0);i(i.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:t>0}})},function(t,e,n){"use strict";var i=n(0),r=n(22),o=n(3),a=n(69),s=n(133);i(i.P+i.R,"Promise",{finally:function(t){var e=a(this,r.Promise||o.Promise),n="function"==typeof t;return this.then(n?function(n){return s(e,t()).then(function(){return n})}:t,n?function(n){return s(e,t()).then(function(){throw n})}:t)}})},function(t,e,n){"use strict";var i=n(0),r=n(103),o=n(132);i(i.S,"Promise",{try:function(t){var e=r.f(this),n=o(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}})},function(t,e,n){var i=n(34),r=n(2),o=i.key,a=i.set;i.exp({defineMetadata:function(t,e,n,i){a(t,e,r(n),o(i))}})},function(t,e,n){var i=n(34),r=n(2),o=i.key,a=i.map,s=i.store;i.exp({deleteMetadata:function(t,e){var n=arguments.length<3?void 0:o(arguments[2]),i=a(r(e),n,!1);if(void 0===i||!i.delete(t))return!1;if(i.size)return!0;var l=s.get(e);return l.delete(n),!!l.size||s.delete(e)}})},function(t,e,n){var i=n(34),r=n(2),o=n(20),a=i.has,s=i.get,l=i.key,u=function(t,e,n){if(a(t,e,n))return s(t,e,n);var i=o(e);return null!==i?u(t,i,n):void 0};i.exp({getMetadata:function(t,e){return u(t,r(e),arguments.length<3?void 0:l(arguments[2]))}})},function(t,e,n){var i=n(136),r=n(145),o=n(34),a=n(2),s=n(20),l=o.keys,u=o.key,c=function(t,e){var n=l(t,e),o=s(t);if(null===o)return n;var a=c(o,e);return a.length?n.length?r(new i(n.concat(a))):a:n};o.exp({getMetadataKeys:function(t){return c(a(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,e,n){var i=n(34),r=n(2),o=i.get,a=i.key;i.exp({getOwnMetadata:function(t,e){return o(t,r(e),arguments.length<3?void 0:a(arguments[2]))}})},function(t,e,n){var i=n(34),r=n(2),o=i.keys,a=i.key;i.exp({getOwnMetadataKeys:function(t){return o(r(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,e,n){var i=n(34),r=n(2),o=n(20),a=i.has,s=i.key,l=function(t,e,n){if(a(t,e,n))return!0;var i=o(e);return null!==i&&l(t,i,n)};i.exp({hasMetadata:function(t,e){return l(t,r(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,n){var i=n(34),r=n(2),o=i.has,a=i.key;i.exp({hasOwnMetadata:function(t,e){return o(t,r(e),arguments.length<3?void 0:a(arguments[2]))}})},function(t,e,n){var i=n(34),r=n(2),o=n(13),a=i.key,s=i.set;i.exp({metadata:function(t,e){return function(n,i){s(t,e,(void 0!==i?r:o)(n),a(i))}}})},function(t,e,n){var i=n(0),r=n(102)(),o=n(3).process,a="process"==n(24)(o);i(i.G,{asap:function(t){var e=a&&o.domain;r(e?e.bind(t):t)}})},function(t,e,n){"use strict";var i=n(0),r=n(3),o=n(22),a=n(102)(),s=n(7)("observable"),l=n(13),u=n(2),c=n(45),h=n(47),d=n(14),f=n(46),p=f.RETURN,m=function(t){return null==t?void 0:l(t)},v=function(t){var e=t._c;e&&(t._c=void 0,e())},g=function(t){return void 0===t._o},y=function(t){g(t)||(t._o=void 0,v(t))},_=function(t,e){u(t),this._c=void 0,this._o=t,t=new b(this);try{var n=e(t),i=n;null!=n&&("function"==typeof n.unsubscribe?n=function(){i.unsubscribe()}:l(n),this._c=n)}catch(e){return void t.error(e)}g(this)&&v(this)};_.prototype=h({},{unsubscribe:function(){y(this)}});var b=function(t){this._s=t};b.prototype=h({},{next:function(t){var e=this._s;if(!g(e)){var n=e._o;try{var i=m(n.next);if(i)return i.call(n,t)}catch(t){try{y(e)}finally{throw t}}}},error:function(t){var e=this._s;if(g(e))throw t;var n=e._o;e._o=void 0;try{var i=m(n.error);if(!i)throw t;t=i.call(n,t)}catch(t){try{v(e)}finally{throw t}}return v(e),t},complete:function(t){var e=this._s;if(!g(e)){var n=e._o;e._o=void 0;try{var i=m(n.complete);t=i?i.call(n,t):void 0}catch(t){try{v(e)}finally{throw t}}return v(e),t}}});var x=function(t){c(this,x,"Observable","_f")._f=l(t)};h(x.prototype,{subscribe:function(t){return new _(t,this._f)},forEach:function(t){var e=this;return new(o.Promise||r.Promise)(function(n,i){l(t);var r=e.subscribe({next:function(e){try{return t(e)}catch(t){i(t),r.unsubscribe()}},error:i,complete:n})})}}),h(x,{from:function(t){var e="function"==typeof this?this:x,n=m(u(t)[s]);if(n){var i=u(n.call(t));return i.constructor===e?i:new e(function(t){return i.subscribe(t)})}return new e(function(e){var n=!1;return a(function(){if(!n){try{if(f(t,!1,function(t){if(e.next(t),n)return p})===p)return}catch(t){if(n)throw t;return void e.error(t)}e.complete()}}),function(){n=!0}})},of:function(){for(var t=0,e=arguments.length,n=new Array(e);t<e;)n[t]=arguments[t++];return new("function"==typeof this?this:x)(function(t){var e=!1;return a(function(){if(!e){for(var i=0;i<n.length;++i)if(t.next(n[i]),e)return;t.complete()}}),function(){e=!0}})}}),d(x.prototype,s,function(){return this}),i(i.G,{Observable:x}),n(44)("Observable")},function(t,e,n){var i=n(3),r=n(0),o=n(70),a=[].slice,s=/MSIE .\./.test(o),l=function(t){return function(e,n){var i=arguments.length>2,r=!!i&&a.call(arguments,2);return t(i?function(){("function"==typeof e?e:Function(e)).apply(this,r)}:e,n)}};r(r.G+r.B+r.F*s,{setTimeout:l(i.setTimeout),setInterval:l(i.setInterval)})},function(t,e,n){var i=n(0),r=n(101);i(i.G+i.B,{setImmediate:r.set,clearImmediate:r.clear})},function(t,e,n){for(var i=n(100),r=n(40),o=n(15),a=n(3),s=n(14),l=n(53),u=n(7),c=u("iterator"),h=u("toStringTag"),d=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(f),m=0;m<p.length;m++){var v,g=p[m],y=f[g],_=a[g],b=_&&_.prototype;if(b&&(b[c]||s(b,c,d),b[h]||s(b,h,g),l[g]=d,y))for(v in i)b[v]||o(b,v,i[v],!0)}},function(t,e,n){(function(e){!function(e){"use strict";var n,i=Object.prototype,r=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag",u="object"==typeof t,c=e.regeneratorRuntime;if(c)u&&(t.exports=c);else{(c=e.regeneratorRuntime=u?t.exports:{}).wrap=b;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",m={},v={};v[a]=function(){return this};var g=Object.getPrototypeOf,y=g&&g(g(C([])));y&&y!==i&&r.call(y,a)&&(v=y);var _=M.prototype=w.prototype=Object.create(v);S.prototype=_.constructor=M,M.constructor=S,M[l]=S.displayName="GeneratorFunction",c.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===S||"GeneratorFunction"===(e.displayName||e.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,M):(t.__proto__=M,l in t||(t[l]="GeneratorFunction")),t.prototype=Object.create(_),t},c.awrap=function(t){return{__await:t}},E(z.prototype),z.prototype[s]=function(){return this},c.AsyncIterator=z,c.async=function(t,e,n,i){var r=new z(b(t,e,n,i));return c.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},E(_),_[l]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},c.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},c.values=C,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,r){return s.type="throw",s.arg=t,e.next=i,r&&(e.method="next",e.arg=n),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;O(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:C(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=n),m}}}function b(t,e,n,i){var r=e&&e.prototype instanceof w?e:w,o=Object.create(r.prototype),a=new P(i||[]);return o._invoke=function(t,e,n){var i=h;return function(r,o){if(i===f)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw o;return A()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=k(a,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var l=x(t,e,n);if("normal"===l.type){if(i=n.done?p:d,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=p,n.method="throw",n.arg=l.arg)}}}(t,n,a),o}function x(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function w(){}function S(){}function M(){}function E(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function z(t){function n(e,i,o,a){var s=x(t[e],t,i);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?Promise.resolve(u.__await).then(function(t){n("next",t,o,a)},function(t){n("throw",t,o,a)}):Promise.resolve(u).then(function(t){l.value=t,o(l)},a)}a(s.arg)}var i;"object"==typeof e.process&&e.process.domain&&(n=e.process.domain.bind(n)),this._invoke=function(t,e){function r(){return new Promise(function(i,r){n(t,e,i,r)})}return i=i?i.then(r,r):r()}}function k(t,e){var i=t.iterator[e.method];if(i===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,k(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=x(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,m;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,m):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function C(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=n,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:n,done:!0}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,n(78))},function(t,e,n){n(387),t.exports=n(22).RegExp.escape},function(t,e,n){var i=n(0),r=n(388)(/[\\^$*+?.()|[\]{}]/g,"\\$&");i(i.S,"RegExp",{escape:function(t){return r(t)}})},function(t,e){t.exports=function(t,e){var n=e===Object(e)?function(t){return e[t]}:e;return function(e){return String(e).replace(t,n)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=v(n(105)),r=m(n(1)),o=v(n(147)),a=v(n(31)),s=v(n(6)),l=v(n(48)),u=v(n(108)),c=v(n(49)),h=v(n(110)),d=m(n(21)),f=v(n(157)),p=n(158);function m(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function v(t){return t&&t.__esModule?t:{default:t}}var g=function t(e,n,i){var a=o.default.get(e);if(a){var s=new a(n,i);return t._instances[s._id]=s,s}r.error('Tool "'+e+'" was not found.')};g._instances={},g._globals=h.default,g.clearInstances=function(t){if(t)g._instances[t]=void 0;else{for(var e in g._instances)g._instances[e].clear();g._instances={}}};var y=(0,i.default)(n(396));r.forEach(y,function(t,e){u.default.register(e,t)});var _=(0,i.default)(n(398),1);function b(t,e,n){return function(){var i=n.apply(e,arguments);return i===e?t:i}}r.forEach(_,function(t,e){s.default.register(e,t)}),(0,i.default)(n(424)),g.helpers=(0,i.default)(n(425)),g.iconset=d,d3.rebind=function(t,e){for(var n=1,i=void 0,r=arguments.length;++n<r;)t[i=arguments[n]]=b(t,e,e[i]);return t},d3.time={},d3.time.scale=d3.scaleTime,d3.time.scale.utc=d3.scaleUtc,d3.time.format=function(t){var e=d3.timeFormat(t);return e.parse=d3.timeParse(t),e},d3.time.format.utc=function(t){var e=d3.utcFormat(t);return e.parse=d3.utcParse(t),e},d3.time.format.iso=function(t){var e=d3.isoFormat(t);return e.parse=d3.isoParse(t),e},d3.scaleGenericlog=f.default,d3.selection.prototype.onTap=p.onTap,d3.selection.prototype.onLongTap=p.onLongTap,g.Class=a.default,g.Tool=o.default,g.Component=s.default,g.Model=l.default,g.Reader=u.default,g.Events=c.default,g.utils=r,e.default=g},function(t,e){t.exports={linear:function(t,e,n,i,r){return+n+(r-t)/(e-t)*(i-n)},exp:function(t,e,n,i,r){return Math.exp((Math.log(n)*(e-r)-Math.log(i)*(t-r))/(e-t))},stepBefore:function(t,e,n,i,r){return i},stepAfter:function(t,e,n,i,r){return n},stepMiddle:function(t,e,n,i,r){return r<(t+e)/2?n:i}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(31);var o=((i=r)&&i.__esModule?i:{default:i}).default.extend({init:function(){this.intervals={}},setInterval:function(t){function e(e,n,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e,n){this.clearInterval(t),this.intervals[t]=setInterval(e,n)}),clearInterval:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){t?this.intervals[t]&&(clearInterval(this.intervals[t]),delete this.intervals[t]):this.clearAllIntervals()}),clearAllIntervals:function(){for(var t in this.intervals)this.clearInterval(t)}});e.default=o},function(t,e,n){var i={"./axis":106,"./axis.js":106,"./color":148,"./color.js":148,"./data":107,"./data.js":107,"./dataconnected":55,"./dataconnected.js":55,"./entities":109,"./entities.js":109,"./group":149,"./group.js":149,"./hook":32,"./hook.js":32,"./label":150,"./label.js":150,"./locale":151,"./locale.js":151,"./marker":76,"./marker.js":76,"./side":152,"./side.js":152,"./size":153,"./size.js":153,"./stack":154,"./stack.js":154,"./time":155,"./time.js":155,"./ui":156,"./ui.js":156};function r(t){return n(o(t))}function o(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=392},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataStorage=e.Storage=void 0;var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),s=n(31);(i=s)&&i.__esModule;function l(t,e,n,i){return a.hashCode([t.select.key,t.where,t.from,t.join,t.dataset,t.version,t.language,e,n,i])}function u(t,e,n){var i=e[0]+" - "+e[e.length-1]+" ("+e.length+")";return n&&(i=i+"_"+n.join()),i}var c=e.Storage=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.queryIds={},this.queries={},this._collection={},this._collectionPromises={}}return o(t,[{key:"loadFromReader",value:function(t,e,n){var i=l(t,n._basepath,n._lastModified,n._name);return this.queries[i]||(this.queries[i]=this.queryQueue(n,i)),this.queries[i].getPromise(t,e)}},{key:"getDataId",value:function(t,e,n){var i=l(t,e._basepath,e._lastModified,e._name);return!!this.queries[i]&&this.queries[i].getDataId(t,n)}},{key:"queryQueue",value:function(t,e){var n=this,i=function(t,e){return 0==Object.keys(e).filter(function(n){return e[n]!==t[n]}).length&&(0==Object.keys(t).length||0!=Object.keys(e).length)};return new function(){this.readerObject=t,this.queries=[],this.query=null,this.parsers=null,this.defer={},this.getPromise=function(t,e){var n=this,o=function(n){if(0==t.select.value.filter(function(t){return-1==n.query.select.value.indexOf(t)}).length&&i(n.parsers,e))return{v:n.defer.promise}},s=!0,l=!1,u=void 0;try{for(var c,h=this.queries[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=o(c.value);if("object"===(void 0===d?"undefined":r(d)))return d.v}}catch(t){l=!0,u=t}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}return this.query?(this.query.select.value=this.query.select.value?a.unique(this.query.select.value.concat(t.select.value)):[],a.extend(this.parsers,e)):(this.query=t,this.parsers=e),a.debounce(function(){n.runQuery()},10)(),this.defer.promise&&this.defer.promise instanceof Promise||(this.defer.promise=new Promise(function(t,e){n.defer.resolve=t,n.defer.reject=e})),this.defer.promise},this.runQuery=function(){this.query&&(this.queries.push(this.reader(this.query,this.parsers,this.defer)),this.query=null,this.parsers=null,this.defer={})},this.getDataId=function(t,e){var n=function(n){if((!t.select.value||0==t.select.value.filter(function(t){return-1==n.query.select.value.indexOf(t)}).length)&&i(n.parsers,e)&&n.dataId)return{v:n.dataId}},o=!0,a=!1,s=void 0;try{for(var l,u=this.queries[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=n(l.value);if("object"===(void 0===c?"undefined":r(c)))return c.v}}catch(t){a=!0,s=t}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}return!1},this.reader=function(t,e,i){var r=this,o=t.grouping?a.clone(t,null,["grouping"]):t;return new function(){var s=this;this.defer=i,this.query=t,this.parsers=e,this.dataId=null;(t.select.key.includes(null)?Promise.resolve([]):r.readerObject.read(o,this.parsers)).then(function(e){s.checkQueryResponse(t,e),s.dataId=a.hashCode([o,r.readerObject._basepath]),n._collection[s.dataId]={},n._collectionPromises[s.dataId]={};var i=n._collection[s.dataId];i.data=e,i.valid={},i.nested={},i.unique={},i.timespan={},i.limits={},i.frames={},i.haveNoDataPointsPerKey={},i.query=t,s.defer.resolve(s.dataId)}).catch(function(t){s.defer.reject(t)}),this.checkQueryResponse=function(t,e){var n=this;if(0==e.length&&a.warn("Reader for data source '"+this._name+"' returned empty array for query:",JSON.stringify(t,null,2)),e.length>0){for(var i=(t.select.key||[]).concat(t.select.value||[]),r=e.length-1;r>=0;r--){for(var o=i.length-1;o>=0;o--)(e[r][i[o]]||0===e[r][i[o]])&&i.splice(o,1);if(!i.length)break}i.forEach(function(i){if(-1==t.select.key.indexOf(i))a.warn("Reader result: Column '"+i+"' is missing from '"+t.from+"' data, but it might be ok");else{a.error("Reader result: Key column '"+i+"' is missing from '"+t.from+"' response",JSON.stringify(t));var r=new Error;r.name="reader/error/keyColumnMissingInReaderResult",r.message="Reader result: Key column '"+i+"' is missing from '"+t.from+"' response",r.details=i,r.ddfql=t,n.defer.reject(r),console.log(e)}})}}}}}}},{key:"aggregateData",value:function(t,e,n,i){if(Object.keys(e.grouping).every(function(t){return 1===e.grouping[t].grouping}))return Promise.resolve(t);var r=l(e,n._basepath,n._lastModified,n._name),o=a.hashCode([e,n._basepath]);if(!this._collection[o]||this._collection[o]._queryMergeId!==r){for(var s=e.grouping=e.grouping,u=e.select.key,c=e.select.value.filter(function(t){return"measure"===i[t].concept_type}),h="datapoints"===e.from?u.concat(e.animatable):u.slice(0),d=Object.keys(s||{}).filter(function(t){return-1!==h.indexOf(t)&&-1!==u.indexOf(t)&&s[t].grouping>1}),f=d.reduce(function(t,e){return n=s[e].grouping,t[e]=function(t){return~~(+t/n)*n},t;var n},{}),p=d3.nest(),m=0;m<h.length;m++)p=p.key(function(t,e){return e?function(n){return e(n[t])}:function(e){return e[t]}}(h[m],f[h[m]]));d.length&&(p=p.rollup(function(t){var e=Object.assign({},t[0]);return d.forEach(function(t){return e[t]=f[t](e[t])}),c.forEach(function(n){return e[n]=d3.sum(t,function(t){return+t[n]})}),[e]})),this._collection[o]={},this._collectionPromises[o]={};var v=this._collection[o];v.data=a.nestArrayToValues(p.entries(this._collection[t].data)),v.valid={},v.nested={},v.unique={},v.timespan={},v.limits={},v.frames={},v.haveNoDataPointsPerKey={},v.query=e,v._queryMergeId=r}return Promise.resolve(o)}},{key:"getData",value:function(t,e,n,i){if(!e||"data"==e)return this._collection[t].data;if("query"==e)return this._collection[t].query;if(!n)return this._collection[t][e];var r="string"==typeof n?n:JSON.stringify(n);if(this._collection[t][e][r])return this._collection[t][e][r];switch(e){case"unique":this._collection[t][e][r]=this._getUnique(t,n);break;case"valid":this._collection[t][e][r]=this._getValid(t,n);break;case"timespan":this._collection[t][e][r]=this._getTimespan(t,n);break;case"limits":this._collection[t][e][r]=this._getLimits(t,n);break;case"nested":this._collection[t][e][r]=this._getNested(t,n)}return this._collection[t][e][r]}},{key:"_getTimespan",value:function(t,e){var n=this._collection[t].query.animatable,i=this._collection[t].data.filter(function(t){return t[e]||0===t[e]}).map(function(t){return t[n]});return 0==i.length&&a.warn("_getTimespan() was unable to work with an empty array of valid datapoints"),{min:d3.min(i),max:d3.max(i)}}},{key:"_getValid",value:function(t,e){return this._collection[t].data.filter(function(t){return t[e]||0===t[e]})}},{key:"_getLimits",value:function(t,e){for(var n=this._collection[t].data.reduce(function(t,n){var i=a.isDate(n[e])?n[e]:parseFloat(n[e]);return isNaN(i)||t.push(i),t},[]),i=void 0,r=void 0,o={},s=0;s<n.length;s+=1){var l=n[s];(void 0===i||l<i)&&(i=l),(void 0===r||l>r)&&(r=l)}return o.min=i||0,o.max=r||100,o}},{key:"_getUnique",value:function(t,e){var n=void 0,i=this._collection[t].data;if(a.isArray(e)){var r=i.map(function(t){return a.clone(t,e)});n=a.unique(r,function(t){return JSON.stringify(t)})}else{var o=i.map(function(t){return t[e]});n=a.unique(o)}return n}},{key:"_getNested",value:function(t,e){for(var n=d3.nest(),i=0;i<e.length;i++)n=n.key(function(t){return function(e){return e[t]}}(e[i]));return a.nestArrayToObjWithFlatKeys(n.entries(this._collection[t].data))}},{key:"getFrames",value:function(t,e,n,i){var r=this,o=u(0,e,n);return this._collectionPromises[t][o]||(this._collectionPromises[t][o]={queue:this.framesQueue(e,o),promise:null}),this._collectionPromises[t][o]&&this._collectionPromises[t][o].promise instanceof Promise?this._collectionPromises[t][o].promise:(this._collectionPromises[t][o].promise=new Promise(function(s,l){t||l(a.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)),r._getFrames(t,o,e,n,i).then(function(e){r._collection[t].frames[o]=e,s(r._collection[t].frames[o])})}),this._collectionPromises[t][o].promise)}},{key:"getFrame",value:function(t,e,n,i){var r=this,o=u(0,e,i);return new Promise(function(e,i){r._collection[t].frames[o]&&r._collection[t].frames[o][n]?e(r._collection[t].frames[o]):r._collectionPromises[t][o].queue.forceFrame(n,function(){e(r._collection[t].frames[o])})})}},{key:"listenFrame",value:function(t,e,n,i){var r=u(0,e,n);this._collectionPromises[t][r].queue.defaultCallbacks.push(function(e){i(t,e)}),this._collection[t].frames[r]&&a.forEach(this._collection[t].frames[r],function(e,n){i(t,new Date(n))})}},{key:"_muteAllQueues",value:function(t){a.forEach(this._collectionPromises,function(e,n){a.forEach(e,function(e,n){1==e.queue.isActive&&e.queue.whatId!=t&&e.queue.mute()})})}},{key:"_checkForcedQueuesExists",value:function(){a.forEach(this._collectionPromises,function(t,e){a.forEach(t,function(t,e){t.queue.forcedQueue.length>0&&t.queue.unMute()})})}},{key:"_unmuteQueue",value:function(){a.forEach(this._collectionPromises,function(t,e){a.forEach(t,function(t,e){0==t.queue.isActive&&t.queue.unMute()})})}},{key:"framesQueue",value:function(t,e){var n=this;return new function(){this.defaultCallbacks=[],this.callbacks={},this.forcedQueue=[],this.isActive=!0,this.delayedAction=null,this.whatId=e,this.queue=t.slice(0);var i=this;this.queue.splice(0,0,this.queue.splice(this.queue.length-1,1)[0]),this.key=0,this.mute=function(){this.isActive=!1,this.delayedAction=Promise.resolve.bind(Promise)},this.unMute=function(){this.isActive=!0,"function"==typeof this.delayedAction&&this.delayedAction(),this.delayedAction=null,0==this.forcedQueue.length&&0==this.queue.length&&n._unmuteQueue()},this.frameComplete=function(t){var e=void 0;if(i.defaultCallbacks.length>0)for(e=0;e<i.defaultCallbacks.length;e++)i.defaultCallbacks[e](t);if(i.callbacks[t]&&i.callbacks[t].length>0)for(e=0;e<i.callbacks[t].length;e++)i.callbacks[t][e]()},this._waitingForActivation=function(){var t=this;return new Promise(function(e,n){if(t.isActive)return e();t.delayedAction=e})},this._getNextFrameName=function(){var t=null;return this.forcedQueue.length>0||this.queue.length>0?this.forcedQueue.length>0?t=this.forcedQueue.shift():(0==this.forcedQueue.length&&this.key>=this.queue.length-1&&(this.key=0),t=this.queue.splice(this.key,1).pop()):n._unmuteQueue(),t},this.checkForcedFrames=function(){this.forcedQueue.length>0||n._checkForcedQueuesExists()},this.getNext=function(){var t=this;return new Promise(function(e,n){t.checkForcedFrames(),t.isActive?e(t._getNextFrameName()):t._waitingForActivation().then(function(){e(t._getNextFrameName())})})},this.forceFrame=function(t,e){if(this.callbacks[t])this.callbacks[t].push(e);else{var i=function(t,e){for(var n=e.toString(),i=-1,r=0,o=t.length;r<o;r++)if(t[r].toString()==n){i=r;break}return i}(this.queue,t);-1!==i?(this.forcedQueue.unshift(this.queue.splice(i,1).pop()),n._muteAllQueues(this.whatId),this.unMute(),"function"==typeof e&&("object"!==r(this.callbacks[t])&&(this.callbacks[t]=[]),this.callbacks[t].push(e)),this.key=i):"object"===r(this.callbacks[t])?this.callbacks[t].push(e):this.callbacks[t]=[e]}}}}},{key:"_getFrames",value:function(t,e,n,i,r){var o=this;return o._collection[t].frames[e]||(o._collection[t].frames[e]={}),new Promise(function(s,l){r||a.warn("_getFrames in data.js is missing indicatorsDB, it's needed for gap filling"),n||a.warn("_getFrames in data.js is missing framesArray, it's needed so much");var u=o._collection[t].query.animatable,c=o._collection[t].query.select.key.slice(0);u&&-1!=c.indexOf(u)&&c.splice(c.indexOf(u),1);var h={},d=void 0,f=void 0,p=void 0,m=void 0,v=void 0,g=o.getData(t,"nested",c.concat([u]),r),y=Object.keys(g);i=i||y.map(function(t){return JSON.parse(t).join(",")});var _=o._collection[t].query,b=_.select.value.filter(function(t){return"_default"!==t}),x=b.length,w=void 0,S=void 0,M=void 0,E=void 0,z=void 0;for(M=0;M<i.length;M++)for(h[i[M]]={},z=0;z<x;z++)h[i[M]][b[z]]=null;for(z=0;z<x;z++)o._collection[t].haveNoDataPointsPerKey[b[z]]={};o._collectionPromises[t][e].queue.getNext().then(function(n){n&&function t(n,i,l,k){var T={};if("datapoints"!==_.from){var O=o._collection[l].data;for(z=0;z<x;z++)T[b[z]]={};for(var P=0;P<O.length;P++){var C=O[P];for(z=0;z<x;z++)T[b[z]][C[c[0]]]=C[b[z]],null==C[b[z]]&&(o._collection[l].haveNoDataPointsPerKey[b[z]][JSON.stringify([C[c[0]]])]=O.length)}}else{for(z=0;z<x;z++)T[b[z]]={};for(M=0;M<i.length;M++)for(w=i[M],S=y[M],z=0;z<x;z++)if(E=b[z],m=r[E]?r[E].interpolation:null,g[S]&&g[S][n]&&(g[S][n][0][E]||0===g[S][n][0][E]))T[E][w]=g[S][n][0][E];else if("none"===m||!1===_.gapfill)T[E][w]=null;else{if(null===(d=h[w][E])){var A=Object.keys(g[S]);d=new Array(A.length),f=0;for(var I=0,L=A.length;I<L;I++)((p=g[S][A[I]])[0][E]||0===p[0][E])&&(d[f++]=p[0]);d.length=f,h[w][E]=0===f?[]:d,0==d.length&&(o._collection[l].haveNoDataPointsPerKey[E][S]=d.length)}d&&d.length>0&&(v=null,T[E][w]=a.interpolatePoint(d,void 0,E,v,u,n,m))}}o._collection[l].frames[e][n]=T,"function"==typeof k&&k(n),o._collectionPromises[l][e].queue.getNext().then(function(n){n?a.defer(function(){t(n,i,l,o._collectionPromises[l][e].queue.frameComplete)}):s(o._collection[l].frames[e])})}(n,i,t,o._collectionPromises[t][e].queue.frameComplete)})})}}]),t}();e.DataStorage=new c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1));function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var o={model:null,dimensionModels:new Map,updateDimensionModels:function(){var t=this;this.dimensionModels.clear(),i.forEach(this.model.state._data,function(e,n){void 0!==e.dim&&t.dimensionModels.set(n,e)})},getDimensionModelsForSpace:function(t,e){var n=this;this.updateDimensionModels();var i=[],o=Object.keys(t).reduce(function(n,r){return"entities"==t[r]._type&&(e.includes(t[r].dim)?n[t[r].dim]=r:i.push(r)),n},{});return e.map(function(e,a){var s=void 0;if(n.model.dataManager.isConceptType(e,"time"))t[s="time"].dim=e;else{if(o[e])return o[e];if(void 0!==(s=i.shift()))t[s].setDimension(e);else{var l=r({},s="entities_"+e,{dim:e});n.model.state.set(l)}}return s})}};e.default=function(t){var e=Object.create(o);return e.model=t,e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1));var r={model:null,dataModels:new Map,getDataModels:function(){return this.updateDataModels(),this.dataModels},updateDataModels:function(){var t=this;this.dataModels.clear(),i.forEach(this.model._data,function(e,n){"data"==e._type&&t.dataModels.set(n,e)})},isConceptType:function(t,e){this.updateDataModels();var n=!0,i=!1,r=void 0;try{for(var o,a=this.dataModels.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.conceptDictionary[t]&&s.conceptDictionary[t].concept_type==e)return!0}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}return!1},getConceptProperty:function(t,e){this.updateDataModels();var n=!0,i=!1,r=void 0;try{for(var o,a=this.dataModels.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value.getConceptprops(t);if(s&&s[e])return s[e]}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}return"Concept not found"},getAvailableDataForKey:function(t,e,n){this.updateDataModels();var i=[],r=!0,o=!1,a=void 0;try{for(var s,l=this.dataModels.values()[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value,c=!0,h=!1,d=void 0;try{for(var f,p=((u.dataAvailability||{})[n]||[])[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var m=f.value,v=m.key,g=m.value;!v.has(t)||e&&g!==e||i.push({data:u._name,key:t,value:g})}}catch(t){h=!0,d=t}finally{try{!c&&p.return&&p.return()}finally{if(h)throw d}}}}catch(t){o=!0,a=t}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}return i},getDimensionValues:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.assign({select:{key:[t],value:e},from:"entities"},n);return Promise.all([].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(this.getDataModels().values())).filter(function(e){return e.getConceptprops(t)}).map(function(t){return t.load(i,void 0,!0).then(function(e){return t.getData(e).map(function(e){return e.dataSourceName=t._name,e})})}))},getTags:function(){var t=this;return this.getDimensionValues("tag",["name","parent"]).then(function(e){return t.mergeResults(e,["tag"])})},concatResults:function(t){return t.reduce(function(t,e){return t.concat(e)})},mergeResults:function(t,e){var n=new Map;return t.forEach(function(t){t.forEach(function(t){var i=e.map(function(e){return t[e]}).join(",");n.has(i)||n.set(i,t)})}),Array.from(n.values())}};e.default=function(t){var e=Object.create(r);return e.model=t,e}},function(t,e,n){var i={"./inline/inline.js":397};function r(t){return n(o(t))}function o(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=396},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(108);var o=((i=r)&&i.__esModule?i:{default:i}).default.extend({_name:"inline",init:function(t){this._data=t.data||[{}]},load:function(){return Promise.resolve({columns:Object.keys(this._data[0]),rows:this._data})},versionInfo:{version:"0.35.1",build:1539165482304}});e.default=o},function(t,e,n){var i={"./brushslider/brushslider.js":77,"./brushslider/bubblesize/bubblesize.js":159,"./brushslider/singlehandleslider/singlehandleslider.js":59,"./brushslider/sizeslider/sizeslider.js":160,"./buttonlist/buttonlist.js":161,"./buttonlist/optionsbuttonlist/optionsbuttonlist.js":162,"./colorlegend/colorlegend.js":163,"./datanotes/datanotes.js":400,"./datawarning/datawarning.js":401,"./dialogs/_dialog.js":12,"./dialogs/about/about.js":166,"./dialogs/axes/axes.js":167,"./dialogs/colors/colors.js":169,"./dialogs/dialogs.js":170,"./dialogs/find/find.js":171,"./dialogs/find/show.js":112,"./dialogs/grouping/grouping.js":172,"./dialogs/label/label.js":173,"./dialogs/moreoptions/moreoptions.js":174,"./dialogs/opacity/opacity.js":175,"./dialogs/presentation/presentation.js":176,"./dialogs/side/side.js":177,"./dialogs/size/size.js":178,"./dialogs/speed/speed.js":179,"./dialogs/stack/stack.js":180,"./dialogs/timedisplay/timedisplay.js":182,"./dialogs/zoom/zoom.js":184,"./draggablelist/draggablelist.js":181,"./indicatorpicker/indicatorpicker.js":50,"./minmaxinputs/minmaxinputs.js":168,"./simplecheckbox/simplecheckbox.js":60,"./steppedspeedslider/steppedspeedslider.js":419,"./timeslider/timeslider.js":421,"./treemenu/treemenu.js":423,"./zoombuttonlist/zoombuttonlist.js":185};function r(t){return n(o(t))}function o(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=398},function(t,e){t.exports='<div class="vzb-slider-holder">\n\t<svg class="vzb-slider-svg">\n\t\t<g class="vzb-slider-wrap">\n\t\t\t<g class="vzb-slider">\n\t\t\t</g>\n\t\t</g>\n\t</svg>\n</div>\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),o=n(6),a=(i=o)&&i.__esModule?i:{default:i},s=n(21);var l=a.default.extend({init:function(t,e){var n=this;this.name="gapminder-datanotes",this.model_expects=[{name:"marker",type:"marker"},{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){n._ready&&n._readyOnce&&n.ready()}},this._super(t,e),this.close=this.close.bind(this),this.hidden=!0,this.showNotes=!1,this.pinned=!1,this.left=0,this.top=0,this.hookName=null,this.newHookName=null},ready:function(){this.setValues()},readyOnce:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.element=d3.select(this.placeholder),this.element.selectAll("div").remove();var e=this.element;e.append("div").html(s.close).on("click",function(){d3.event.stopPropagation(),t.close()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-notes-close").classed("vzb-hidden",!0),e.append("div").attr("class","vzb-data-notes-body vzb-dialog-scrollable"),e.append("div").attr("class","vzb-data-notes-link")},resize:function(){this.close()},close:function(){this.hidden||this.pin(!1).hide()},setHook:function(t){return this._readyOnce?this.pinned?(this.newHookName=t,this):(this.hookName&&this.model.marker[this.hookName].off("change:which",this.close),this.hookName=this.newHookName=t,this.model.marker[this.hookName].on("change:which",this.close),this.setValues(),this):this},setValues:function(){if(this.hookName){var t=this.model.marker[this.hookName].getConceptprops();if(this.element.select(".vzb-data-notes-body").classed("vzb-hidden",!t.description).text(r.replaceNumberSpacesToNonBreak(t.description)||""),this.element.select(".vzb-data-notes-link").classed("vzb-hidden",!t.sourceLink),t.sourceLink){var e=this.translator("hints/source"),n=t.sourceName||"";this.element.select(".vzb-data-notes-link").html("<span>"+(n?e+": ":"")+'<a href="'+r.normaliseLink(t.sourceLink)+'" target="_blank">'+(n||e)+"</a></span>")}this.showNotes=t.sourceLink||t.description}},setPos:function(t,e,n){if(this.left=t,this.top=e,this.pinned&&!n)return this;var i=this.parent.element.offsetHeight,r=this.element.node().offsetWidth,o=this.element.node().offsetHeight,a=void 0,s=void 0,l=this.left-r,u=this.top;return l<10&&(l=10,a=!0),u+o+10>i&&(u=i-o-10,s=!0),a&&s&&(u=this.top-o-30),this.element.style("top",u+"px"),this.element.style("left",l+"px"),this},pin:function(t){return this.hidden?this:(this.pinned=!this.pinned,null!=t&&(this.pinned=t),this.element.select(".vzb-data-notes-close").classed("vzb-hidden",!this.pinned),this.element.classed("vzb-data-notes-pinned",this.pinned),this.hookName!=this.newHookName&&this.setHook(this.newHookName),this.element.select(".vzb-data-notes-body").node().scrollTop=0,this.showNotes?this.setPos(this.left,this.top,!0):this.hide())},toggle:function(t){return this.pinned||!this.hookName?this:(null==t&&(t=!this.hidden),this.hidden=t,this.element.classed("vzb-hidden",this.hidden||!this.showNotes),this)},show:function(){return this.toggle(!1)},hide:function(){return this.toggle(!0)}});e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t}(n(1));var i,r=n(6),o=(i=r)&&i.__esModule?i:{default:i},a=n(21);var s=!0,l=o.default.extend({init:function(t,e){var n=this;this.name="gapminder-datawarning",this.model_expects=[{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){n._ready&&n.redraw()}},this._super(t,e)},ready:function(){this.redraw()},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.element.append("div").attr("class","vzb-data-warning-background").on("click",function(){t.toggle(!0)}),this.container=this.element.append("div").attr("class","vzb-data-warning-box"),this.container.append("div").html(a.close).on("click",function(){t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-warning-close"),this.container.append("div").attr("class","vzb-data-warning-link").html(a.warn).append("div"),this.container.append("div").attr("class","vzb-data-warning-title"),this.container.append("div").attr("class","vzb-data-warning-body vzb-dialog-scrollable")},redraw:function(){this.translator=this.model.locale.getTFunction(),this.container.select(".vzb-data-warning-link div").text(this.translator("hints/dataWarning"));var t=this.translator("datawarning/title/"+this.parent.name);this.container.select(".vzb-data-warning-title").html(t).classed("vzb-hidden",!t||t=="datawarning/title/"+this.parent.name),this.container.select(".vzb-data-warning-body").html(this.translator("datawarning/body/"+this.parent.name))},toggle:function(t){null==t&&(t=!s),s=t,this.element.classed("vzb-hidden",s);var e=this;this.parent.components.forEach(function(t){t.element.classed("vzb-blur",t!=e&&!s)})}});e.default=l},function(t,e,n){var i={"./about/about.html":403,"./axes/axes.html":404,"./colors/colors.html":405,"./find/find.html":406,"./find/show.html":165,"./grouping/grouping.html":407,"./label/label.html":408,"./moreoptions/moreoptions.html":409,"./opacity/opacity.html":410,"./presentation/presentation.html":411,"./side/side.html":412,"./size/size.html":413,"./speed/speed.html":414,"./stack/stack.html":415,"./timedisplay/timedisplay.html":416,"./zoom/zoom.html":417};function r(t){return n(o(t))}function o(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=402},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/about") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-about-text0"></p>\n      <p class="vzb-about-text1"></p>\n      <br/>\n      <p class="vzb-about-version"></p>\n      <p class="vzb-about-updated"></p>\n      <br/>\n      <p class="vzb-about-report"></p>\n      <br/>\n      <p class="vzb-about-credits"></p>\n      <br/>\n      <p class="vzb-about-tool"></p>\n      <br/>\n      <p class="vzb-about-datasets"><span>Datasets:</span></p>\n      <br/>\n      <p class="vzb-about-readers"><span>Readers:</span></p>\n  </div>\n      \n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n      \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axes" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axes" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/axes") %></div>\n    <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_x") %> <span class="vzb-xaxis-selector"></span> </p>\n      <div class="vzb-xaxis-minmax vzb-dialog-paragraph"></div>\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_y") %> <span class="vzb-yaxis-selector"></span> </p>\n      <div class="vzb-yaxis-minmax vzb-dialog-paragraph"></div>\n    </div>\n    <div class="vzb-dialog-buttons">\n      <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ( "buttons/ok") %></div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span>\n  \n  <div class="vzb-dialog-title">\n      <%=t ("buttons/colors") %>\n      <span class="vzb-caxis-selector"></span>\n  </div>\n  \n  \n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-clegend-container"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="find" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="find" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <label class="vzb-dialog-title-switch">\n      <input type="checkbox">\n      <span class="vzb-switch-slider round"></span>\n      <span class="vzb-switch-off"><%=t ("dialogs/find") %></span>\n      <span class="vzb-switch-on"><%=t ("buttons/show") %></span>\n    </label>\n    <span class="vzb-dialog-content vzb-find-filter">\n      <form>\n        <input class="vzb-find-search" type="search" required/>\n        <button class="vzb-cancel-button" type="reset"></button>\n      </form>\n    </span>\n    <span class="vzb-find-filter-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n      <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-find vzb-active">\n        <div class="vzb-find-list">\n          \x3c!-- list will be placed here --\x3e\n        </div>\n      </div>\n\n      <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-show">\n      </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-bubbleopacity vzb-dialog-control" data-panel="find"></div>\n    <div class="vzb-dialog-button vzb-find-deselect" data-panel="find">\n      <%=t ("buttons/deselect") %>\n    </div>\n    <div class="vzb-dialog-button vzb-show-deselect" data-panel="show">\n      <%=t ("buttons/reset") %>\n    </div>\n    <div class="vzb-dialog-button vzb-show-apply" data-panel="show">\n      <%=t ("buttons/apply") %>\n    </div>\n      \n    <div data-dialogtype="find" data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>  \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/grouping") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-groups"></div>\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/label") %>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <span class="vzb-saxis-selector"></span>\n    <div class="vzb-dialog-sizeslider"></div>\n    <div class="vzb-removelabelbox-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="moreoptions" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="moreoptions" data-click="dragDialog"></span>\n\n\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/more_options") %>\n  </div>\n\n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class=\'vzb-dialog-options-buttonlist\'>\n    </div>\n    <div class="vzb-accordion">\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/opacity") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityRegular") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-regular"></div>\n\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityNonselect") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-selectdim"></div>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("dialogs/presentation") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <div class="vzb-presentationmode-switch"></div>\n      <div class="vzb-decorations-switch"></div>\n      <div class="vzb-advancedshowandselect-switch"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="side" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="side" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/side") %>\n    <span class="vzb-side-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-side-list vzb-side-list-left">\n      \x3c!-- list will be placed here --\x3e\n    </div>\n    <div class="vzb-side-list vzb-side-list-right">\n      \x3c!-- list will be placed here --\x3e\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-button vzb-label-primary vzb-side-switch-sides">\n      <%=t ("buttons/leftright") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="size" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="size" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/size") %>\n      <span class="vzb-saxis-selector"></span>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-bubblesize"></div>\n    <span class="vzb-dialog-subtitle">teststs</span>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/speed") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="stack" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="stack" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/stack") %></div>\n        \n    <div class="vzb-dialog-content vzb-dialog-scrollable">\n        \n        \x3c!--p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/howtostack") %></p--\x3e\n        <form class="vzb-howtostack vzb-dialog-paragraph">\n            <label> <input type="radio" name="stack" value="none"> <%=t ("mount/stacking/none") %> </label>\n            <label> <input type="radio" name="stack" value="bycolor"> <%=t ("mount/stacking/color") %> </label>\n            <label> <input type="radio" name="stack" value="all"> <%=t ("mount/stacking/world") %> </label>\n        </form>\n        \n        <form class="vzb-howtomerge vzb-dialog-paragraph">\n            <p class="vzb-dialog-sublabel"> <%=t ("hints/mount/howtomerge") %> </p>\n            <label> <input type="radio" name="merge" value="none"> <%=t ("mount/merging/none") %> </label>\n            <label> <input type="radio" name="merge" value="grouped"> <%=t ("mount/merging/color") %> </label>\n            <label> <input type="radio" name="merge" value="stacked"> <%=t ("mount/merging/world") %> </label>\n        </form>\n        \n        <form class="vzb-manual-sorting">\n            <p class="vzb-dialog-sublabel"> <%=t ("mount/manualSorting") %> </p>\n            <div class="vzb-dialog-draggablelist vzb-dialog-control"></div>\n        </form>\n                \n    </div>\n\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ("buttons/ok") %></div>\n    </div>\n\n</div>'},function(t,e){t.exports='<div class="vzb-dialog-modal">\n  <div class="vzb-dialog-content vzb-dialog-content-fixed">\n    <svg>\n      <g class="vzb-timedisplay"></g>\n    </svg>\n  </div>\n  <div class="vzb-dialog-buttons"></div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n    <%=t ("buttons/zoom") %>\n    <div class="vzb-dialog-zoom-buttonlist"></div>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-panwitharrow-switch"></div>\n    <div class="vzb-zoomonscrolling-switch"></div>\n    <div class="vzb-adaptminmaxzoom-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class="vzb-mmi-holder">\n\n    <span class="vzb-mmi-domainmin-label"></span>\n    <input type="text" class="vzb-mmi-domainmin" name="min">\n    <span class="vzb-mmi-domainmax-label"></span>\n    <input type="text" class="vzb-mmi-domainmax" name="max">\n\n    <br class="vzb-mmi-break"/>\n\n    <span class="vzb-mmi-zoomedmin-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmin" name="min">\n    <span class="vzb-mmi-zoomedmax-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmax" name="max">\n    \n</div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(6),o=(i=r)&&i.__esModule?i:{default:i},a=n(1);var s=o.default.extend({init:function(t,e){var i=this;this.name="steppedSpeedSlider",this.template=n(420),this.config=Object.assign({triangleWidth:10,triangleHeight:10,height:31,lineWidth:10,domain:[1,2,3,4,5,6],range:[1200,900,450,200,150,100]},t),this.config.height-=this.config.triangleHeight/2,this.model_expects=[{name:"time",type:"time"},{name:"locale",type:"locale"}],this.model_binds={"change:time.delay":function(){i.redraw()}},this.setDelay=(0,a.throttle)(this.setDelay,50),this._super(t,e)},readyOnce:function(){var t=this.config,e=t.domain,n=t.range,i=t.height;this.element=d3.select(this.element),this.svg=this.element.select("svg"),this.axisScale=d3.scaleLog().domain(d3.extent(e)).range([i,0]),this.delayScale=d3.scaleLinear().domain(e).range(n),this.initTriangle(),this.initAxis(),this.redraw()},initAxis:function(){var t=this,e=this.config,n=e.lineWidth,i=e.triangleWidth,r=e.triangleHeight,o=e.height,s=d3.axisLeft().scale(this.axisScale).tickFormat(function(){return""}).tickSizeInner(n).tickSizeOuter(0),l=i+n/2,u=r/2;this.svg.on("mousedown",function(){var e=d3.event.offsetY,n=Math.max(0,Math.min(e-u,o));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(n))),!0,!0)}).select(".vzb-stepped-speed-slider-axis").attr("transform","translate("+l+", "+u+")").call(s),this.drag=d3.drag().on("drag",function(){var e=d3.event.dy,n=(0,a.transform)(t.slide.node()).translateY,i=Math.max(0,Math.min(e+n,o));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(i)))),t.redraw(i)}).on("end",function(){t.setDelay(t.model.time.delay,!0,!0)}),this.svg.call(this.drag)},initTriangle:function(){var t=this.config;t.triangleWidth,t.triangleHeight,t.lineWidth;this.slide=this.svg.select(".vzb-stepped-speed-slider-triangle"),this.slide.append("g").append("path").attr("d",this.getTrianglePath())},getTrianglePath:function(){var t=this.config,e=t.triangleHeight;return"M "+t.triangleWidth+","+e/2+" 0,"+e+" 0,0 z"},setDelay:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.model.time.set("delay",t,e,n)},redraw:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.axisScale(this.delayScale.invert(this.model.time.delay));this.slide.attr("transform","translate(0, "+t+")")}});e.default=s},function(t,e){t.exports='<div class="vzb-stepped-speed-slider">\n  <svg>\n    <g class="vzb-stepped-speed-slider-triangle"></g>\n    <g class="vzb-stepped-speed-slider-axis"></g>\n  </svg>\n</div>\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=a(n(6)),o=a(n(111));function a(t){return t&&t.__esModule?t:{default:t}}var s={small:{margin:{top:7,right:15,bottom:10,left:60},radius:8,label_spacing:5},medium:{margin:{top:0,right:15,bottom:10,left:50},radius:9,label_spacing:5},large:{margin:{top:-5,right:15,bottom:10,left:75},radius:11,label_spacing:8}},l={medium:{margin:{top:9}},large:{margin:{}}},u=r.default.extend({init:function(t,e){this.name="gapminder-timeslider",this.template=this.template||n(422),this.prevPosition=null,this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"ui",type:"ui"}];var r=this;this.model_binds={"change:time":function(t,e){if(r.slide){if(-1!==["time.start","time.end"].indexOf(e)){if(!r.xScale)return;r.changeLimits()}r._optionClasses(),r.model.time.dragging||r._setHandle(r.model.time.playing)}},"change:time.start":function(t,e){r.slide&&(r.model.time.dragging||r._setHandle(r.model.time.playing),r.ready())},"change:time.end":function(t,e){r.slide&&(r.model.time.dragging||r._setHandle(r.model.time.playing),r.ready())},"change:time.offset":function(t,e){r.slide&&(r._updateProgressBar(),r.model.marker.listenFramesQueue(null,function(t){r._updateProgressBar(t)}))},"change:time.startSelected":function(t,e){r.slide&&r.updateSelectedStartLimiter()},"change:time.endSelected":function(t,e){r.slide&&r.updateSelectedEndLimiter()},"change:marker.select":function(t,e){r.setSelectedLimits()}},this._super(t,e),this.profiles=i.deepClone(s),this.presentationProfileChanges=i.deepClone(l),(this.model.ui.chart||{}).margin&&this.model.on("change:ui.chart.margin",function(t,e){var n=r.getLayoutProfile();"small"!==n&&(r.profiles[n].margin.left=r.model.ui.chart.margin.left);r.slide&&r.updateSize()}),this.ui=i.extend({show_ticks:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,axis_aligned:!1},t.ui.getPlainObject(),this.ui),this.width=0,this.height=0,this.availableTimeFrames=[],this.completedTimeFrames=[],this.getValueWidth=i.memoize(this.getValueWidth),this._setTime=i.throttle(this._setTime,50)},readyOnce:function(){var t=this;this.element=i.isArray(this.element)?this.element:d3.select(this.element),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.select=this.element.select(".vzb-ts-slider-select"),this.progressBar=this.element.select(".vzb-ts-slider-progress"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.element.select(".vzb-ts-slider-handle"),this.valueText=this.element.select(".vzb-ts-slider-value"),this.playButtons=this.element.select(".vzb-ts-btns"),this.element.select(".vzb-ts-btn-play").on("click",function(){t.model.time.play()}),this.element.select(".vzb-ts-btn-pause").on("click",function(){t.model.time.pause("soft")}),this.xScale=d3.scaleUtc().clamp(!0),this.xAxis=(0,o.default)("bottom"),this.valueText.classed("stroke",!0),this.slider.style("paint-order").length||(this.slider.insert("text",".vzb-ts-slider-value").attr("class","vzb-ts-slider-value stroke"),this.valueText.classed("stroke",!1)),this.valueText=this.element.selectAll(".vzb-ts-slider-value"),this.valueText.attr("text-anchor","middle").attr("dy","-0.7em");var e=t._getBrushed(),n=t._getBrushedEnd();this.brush=d3.drag().on("start drag",function(){e.call(this)}).on("end",function(){n.call(this)}),this.slide.call(this.brush),this.slider_outer.on("mousewheel",function(){if(t.model.time.dragging)return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}),this._setSelectedLimitsId=0,this.model.time.startSelected>this.model.time.start&&t.updateSelectedStartLimiter(),this.model.time.endSelected<this.model.time.end&&t.updateSelectedEndLimiter(),this.parent.on("myEvent",function(e,n){var i=t.getLayoutProfile(),r=t.profiles[i];n.profile&&n.profile.margin&&(r.margin=n.profile.margin),t.element.select(".vzb-ts-slider-wrapper").style("right",n.mRight-r.margin.right+"px"),t.updateSize([0,n.rangeMax])}),this.on("resize",function(){t.updateSize()})},ready:function(){if(!this.model.time.splash){if(!this.model.time._ready)return i.warn("TODO timeslider is fired ready event while time model is not ready yet! how come?");var t=this;this.element.classed("vzb-ts-loading",!1),this.changeLimits(),this.changeTime(),this.updateSize(),t._updateProgressBar(),t.model.marker.listenFramesQueue(null,function(e){t._updateProgressBar(e)}),t.setSelectedLimits(!0)}},changeLimits:function(){var t=this.model.time.start,e=this.model.time.end;this.xScale.domain([t,e]),this.xAxis.tickValues([t,e]).tickFormat(this.model.time.getFormatter())},changeTime:function(){this.model.time.value;this._optionClasses()},updateSize:function(t){if(!this.model.time.splash){this.model.time.pause(),this.profile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=parseInt(this.slider_outer.style("width"),10)||0,n=parseInt(this.slider_outer.style("height"),10)||0;if(!n||!e)return i.warn("time slider resize() aborted because element is too small or has display:none");this.width=e-this.profile.margin.left-this.profile.margin.right,this.height=n-this.profile.margin.bottom-this.profile.margin.top;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),this.xScale.range(t||[0,this.width]),this.slide.attr("transform","translate(0,"+this.height/2+")").attr("x1",this.xScale.range()[0]).attr("x2",this.xScale.range()[1]).style("stroke-width",2*this.profile.radius+"px"),this.xAxis=this.xAxis.scale(this.xScale).tickSizeInner(0).tickSizeOuter(0).tickPadding(this.profile.label_spacing).tickSizeMinor(0,0),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.select.attr("transform","translate(0,"+this.height/2+")"),this.progressBar.attr("transform","translate(0,"+this.height/2+")"),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius),this.sliderWidth=this.slider.node().getBoundingClientRect().width,this.resizeSelectedLimiters(),this._resizeProgressBar(),this._setHandle(),this.playButtons.style("width",this.profile.margin.left+"px")}},setSelectedLimits:function(t){var e=this;this._setSelectedLimitsId++;var n=this._setSelectedLimitsId,r=e.model.marker.select;if(0!=r.length){var o=i.unique(this.model.marker._getAllDimensions({exceptType:"time"})),a=[];i.forEach(r,function(t){a.push(e.model.marker.getEntityLimits(i.getKey(t,o)))}),Promise.all(a).then(function(r){if(n==e._setSelectedLimitsId){var o=r.shift(),a=o.min,s=o.max;i.forEach(r,function(t){a-t.min>0&&(a=t.min),s-t.max<0&&(s=t.max)}),e.model.time.set({startSelected:d3.max([a,new Date(e.model.time.start)]),endSelected:d3.min([s,new Date(e.model.time.end)])},t,!1)}})}else null!=e.model.time.start&&null!=e.model.time.end&&e.model.time.set({startSelected:new Date(e.model.time.start),endSelected:new Date(e.model.time.end)},null,!1)},updateSelectedStartLimiter:function(){this.select.select("#clip-start-"+this._id).remove(),this.select.select(".selected-start").remove(),this.model.time.startSelected&&this.model.time.startSelected>this.model.time.start&&(this.select.append("clipPath").attr("id","clip-start-"+this._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-start-"+this._id+")").classed("selected-start",!0),this.resizeSelectedLimiters())},updateSelectedEndLimiter:function(){this.select.select("#clip-end-"+this._id).remove(),this.select.select(".selected-end").remove(),this.model.time.endSelected&&this.model.time.endSelected<this.model.time.end&&(this.select.append("clipPath").attr("id","clip-end-"+this._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-end-"+this._id+")").classed("selected-end",!0),this.resizeSelectedLimiters())},resizeSelectedLimiters:function(){this.select.select(".selected-start").attr("d","M0,0H"+this.xScale(this.model.time.startSelected)),this.select.select("#clip-start-"+this._id).select("rect").attr("x",-this.height/2).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.startSelected)+this.height/2),this.select.select(".selected-end").attr("d","M"+this.xScale(this.model.time.endSelected)+",0H"+this.xScale(this.model.time.end)),this.select.select("#clip-end-"+this._id).select("rect").attr("x",this.xScale(this.model.time.endSelected)).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.end)-this.xScale(this.model.time.endSelected)+this.height/2)},_resizeProgressBar:function(){var t=this;this.progressBar.selectAll("path").each(function(e){d3.select(this).attr("d","M"+t.xScale(e[0])+",0H"+t.xScale(e[1]))})},_updateProgressBar:function(t){var e=this;if(t){if(-1!=e.completedTimeFrames.indexOf(t))return;e.completedTimeFrames.push(t);var n=e.model.time.incrementTime(t),i=e.model.time.decrementTime(t);if(n>e.model.time.end){if(t-e.model.time.end!=0)return;n=t,t=i}if(0==e.availableTimeFrames.length||e.availableTimeFrames[e.availableTimeFrames.length-1][1]<t)e.availableTimeFrames.push([t,n]);else if(n<e.availableTimeFrames[0][0])e.availableTimeFrames.unshift([t,n]);else for(var r=0;r<e.availableTimeFrames.length;r++){if(t-e.availableTimeFrames[r][1]==0){r+1<e.availableTimeFrames.length&&n-e.availableTimeFrames[r+1][0]==0?(e.availableTimeFrames[r][1]=e.availableTimeFrames[r+1][1],e.availableTimeFrames.splice(r+1,1)):e.availableTimeFrames[r][1]=n;break}if(n-e.availableTimeFrames[r][0]==0){e.availableTimeFrames[r][0]=t;break}if(t-e.availableTimeFrames[r][1]>0&&n-e.availableTimeFrames[r+1][0]<0){e.availableTimeFrames.splice(r+1,0,[t,n]);break}}}else e.availableTimeFrames=[],e.completedTimeFrames=[];var o=this.progressBar.selectAll("path").data(e.availableTimeFrames);o.exit().remove(),o.enter().append("path").attr("class","domain").merge(o).each(function(t){d3.select(this).attr("d","M"+e.xScale(t[0])+",0H"+e.xScale(t[1])).classed("rounded",1==e.availableTimeFrames.length)})},getValueWidth:function(t,e){return this.valueText.node().getBoundingClientRect().width},_getBrushed:function(){var t=this;return function(){t.model.time.playing&&t.model.time.set("playing",!1,null,!1),t._optionClasses(),t.element.classed("vzb-ts-dragging",!0);var e=void 0;if(d3.event.sourceEvent){d3.event.sourceEvent.preventDefault(),t.model.time.dragStart();var n=i.roundStep(Math.round(d3.mouse(this)[0]),1);e=t.xScale.invert(n);var r=t.width;n>r?n=r:n<0&&(n=0),t.handle.attr("cx",n),t.valueText.attr("transform","translate("+n+","+t.height/2+")"),t.valueText.text(t.model.time.formatDate(e,"ui"))}e-t.model.time.value!=0&&t._setTime(e)}},_getBrushedEnd:function(){var t=this;return function(){t._setTime.recallLast(),t.element.classed("vzb-ts-dragging",!1),t.model.time.dragStop(),t.model.time.snap()}},_setHandle:function(t){var e=this.model.time.value,n=this.xScale(e);this.element.classed("vzb-ts-disabled",this.model.time.end<=this.model.time.start),null==this.prevPosition&&(this.prevPosition=n);var i=n>this.prevPosition?this.model.time.delayAnimations:0;t?(this.handle.attr("cx",this.prevPosition).transition().duration(i).ease(d3.easeLinear).attr("cx",n),this.valueText.attr("transform","translate("+this.prevPosition+","+this.height/2+")").transition("text").delay(i).text(this.model.time.formatDate(e,"ui")),this.valueText.transition().duration(i).ease(d3.easeLinear).attr("transform","translate("+n+","+this.height/2+")")):(this.handle.interrupt().attr("cx",n),this.valueText.interrupt().interrupt("text").transition("text"),this.valueText.attr("transform","translate("+n+","+this.height/2+")").text(this.model.time.formatDate(e,"ui"))),this.prevPosition=n},_setTime:function(t){var e=!this.model.time.dragging&&!this.model.time.playing;this.model.time.getModelObject("value").set(t,!1,e)},_optionClasses:function(){var t=this.ui.show_ticks,e=this.ui.show_value,n=this.ui.show_value_when_drag_play,i=this.ui.axis_aligned,r=this.ui.show_button&&this.model.time.playable;this.xAxis.labelerOptions({scaleType:"time",removeAllLabels:!t,limitMaxTickNumber:3,showOuter:!1,toolMargin:{left:10,right:10,top:0,bottom:30},fitIntoScale:"optimistic"}),this.element.classed("vzb-ts-hide-play-button",!r),this.element.classed("vzb-playing",this.model.time.playing),this.element.classed("vzb-ts-show-value",e),this.element.classed("vzb-ts-show-value-when-drag-play",n),this.element.classed("vzb-ts-axis-aligned",i)}});e.default=u},function(t,e){t.exports='<div class="vzb-timeslider vzb-ts-loading">\n  <div class="vzb-ts-slider-wrapper">\n    <svg class="vzb-ts-slider">\n      <g>\n        <g class="vzb-ts-slider-axis"></g>\n        <g class="vzb-ts-slider-progress"></g>\n        <g class="vzb-ts-slider-select"></g>\n        <circle class="vzb-ts-slider-handle"></circle>\n        <text class="vzb-ts-slider-value"></text>\n        <line class="vzb-ts-slider-slide"></line>\n      </g>\n      </svg>\n  </div>\n\n  \x3c!-- SVG VIZABI ICONS\n       source: https://github.com/encharm/Font-Awesome-SVG-PNG/ --\x3e\n  <div class="vzb-ts-btns">\n    <button class="vzb-ts-btn-loading vzb-ts-btn">\n      <div class=\'vzb-loader\'></div>\n    </button>\n    <button class="vzb-ts-btn-play vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-play" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-4 29V15l12 9-12 9z"/>\n      </svg>\n    </button>\n    <button class="vzb-ts-btn-pause vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-pause" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 28h-4V16h4v16zm8 0h-4V16h4v16z"/>\n      </svg>\n    </button>\n  </div>\n</div>\n'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=l(n(6)),o=l(n(31)),a=(l(n(32)),l(n(76))),s=n(21);function l(t){return t&&t.__esModule?t:{default:t}}var u={wrapper:"vzb-treemenu-wrap",wrapper_outer:"vzb-treemenu-wrap-outer",background:"vzb-treemenu-background",close:"vzb-treemenu-close",search:"vzb-treemenu-search",list:"vzb-treemenu-list",list_outer:"vzb-treemenu-list-outer",list_item:"vzb-treemenu-list-item",list_item_leaf:"vzb-treemenu-list-item-leaf",leaf:"vzb-treemenu-leaf",leaf_content:"vzb-treemenu-leaf-content",leaf_content_item:"vzb-treemenu-leaf-content-item",leaf_content_item_title:"vzb-treemenu-leaf-content-item-title",leaf_content_item_descr:"vzb-treemenu-leaf-content-item-descr",hasChild:"vzb-treemenu-list-item-children",list_item_label:"vzb-treemenu-list-item-label",list_top_level:"vzb-treemenu-list-top",search_wrap:"vzb-treemenu-search-wrap",isSpecial:"vzb-treemenu-list-item-special",hidden:"vzb-hidden",title:"vzb-treemenu-title",scaletypes:"vzb-treemenu-scaletypes",scaletypesDisabled:"vzb-treemenu-scaletypes-disabled",scaletypesActive:"vzb-treemenu-scaletypes-active",alignYt:"vzb-align-y-top",alignYb:"vzb-align-y-bottom",alignXl:"vzb-align-x-left",alignXr:"vzb-align-x-right",alignXc:"vzb-align-x-center",menuHorizontal:"vzb-treemenu-horizontal",menuVertical:"vzb-treemenu-vertical",absPosVert:"vzb-treemenu-abs-pos-vert",absPosHoriz:"vzb-treemenu-abs-pos-horiz",menuOpenLeftSide:"vzb-treemenu-open-left-side",noTransition:"notransition"},c={MOUSE_LOCS:[],MOUSE_LOCS_TRACKED:3,DELAY:200,TOLERANCE:150,LAST_DELAY_LOC:null,TIMEOUT:null,SEARCH_PROPERTY:"id",SUBMENUS:"children",SEARCH_MIN_STR:1,RESIZE_TIMEOUT:null,MOBILE_BREAKPOINT:400,CURRENT_PATH:[],MIN_COL_WIDTH:60,MENU_DIRECTION:1,MAX_MENU_WIDTH:320,MENU_OPEN_LEFTSIDE:!1},h=o.default.extend({init:function(t,e,n){var i=this;this.parent=t,this.entity=e,this.OPTIONS=n,this.width=this.OPTIONS.MIN_COL_WIDTH,this.direction=this.OPTIONS.MENU_DIRECTION,this._setDirectionClass(),this.menuItems=[];var r=void 0;return this.entity.empty()?this:(this.entity.each(function(){r=d3.selectAll(this.childNodes).filter(function(){return d3.select(this).classed(u.list)})}),r.empty()&&(r=this.entity),e.selectAll("."+u.list_item).filter(function(){return this.parentNode==r.node()}).each(function(){i.addSubmenu(d3.select(this))}),!this.menuItems.length&&this.isActive()&&this.buildLeaf(),this)},setWidth:function(t,e,n){if(this.width!=t&&this.entity.node()){if(this.width=t,(this.entity.classed(u.list_top_level)||this.entity.classed("active"))&&1==this.direction&&(n?this.entity.style("width",this.width+"px"):this.entity.transition().delay(0).duration(100).style("width",this.width+"px")),this.entity.classed(u.list_top_level)&&this.entity.selectAll("."+u.leaf).style("width",this.width-1+"px"),e)for(var i=0;i<this.menuItems.length;i++)this.menuItems[i].setWidth(this.width,e,n);return this}},setDirection:function(t,e){if(this.direction=t,this.entity.style("width","").style("height",""),e)for(var n=0;n<this.menuItems.length;n++)this.menuItems[n].setDirection(this.direction,e);return this._setDirectionClass(),this},_setDirectionClass:function(){1==this.direction?(this.entity.classed(u.menuVertical,!1),this.entity.classed(u.menuHorizontal,!0)):(this.entity.classed(u.menuHorizontal,!1),this.entity.classed(u.menuVertical,!0))},addSubmenu:function(t){this.menuItems.push(new d(this,t,this.OPTIONS))},open:function(){var t=this,e=this;return this.isActive()||(e.parent.parentMenu.openSubmenuNow=!0,this.closeNeighbors(function(){1==e.direction?(t.menuItems.length||e.buildLeaf(),e._openHorizontal(),e.calculateMissingWidth(0)):e._openVertical()}),e.parent.parentMenu.openSubmenuNow=!1),this},calculateMissingWidth:function(t,e){var n=this;this.entity.classed(u.list_top_level)?t>this.OPTIONS.MAX_MENU_WIDTH&&"function"==typeof e&&e(t-this.OPTIONS.MAX_MENU_WIDTH):this.parent.parentMenu.calculateMissingWidth(t+this.width,function(t){t>0?n.reduceWidth(t,function(t){"function"==typeof e&&e(t)}):"function"==typeof e&&e(t)})},restoreWidth:function(t,e,n){if(e)this.parent.parentMenu.restoreWidth(t,!1,n);else if(t<=0)"function"==typeof n&&n();else if(this.entity.classed(u.list_top_level))"function"==typeof n&&n();else{var i=this.entity.node().offsetWidth,r=Math.min(t,this.width);if(i<r){var o=i/r*250;this.entity.transition().delay(0).duration(o).style("width",r+"px").on("end",function(){}),this.parent.parentMenu.restoreWidth(t-r,!1,n)}else this.parent.parentMenu.restoreWidth(t,!1,n)}},reduceWidth:function(t,e){var n=this,i=this.entity.node().offsetWidth;if(i<=this.OPTIONS.MIN_COL_WIDTH)e(t-n.width+i);else{var r=Math.max(this.OPTIONS.MIN_COL_WIDTH,n.width-t),o=250/(n.width/r);this.entity.transition().delay(0).duration(o).style("width",r+"px").on("end",function(){e(t-n.width+r)})}},_openHorizontal:function(){var t=this;t.entity.classed("active",!0).transition().delay(0).duration(250).style("width",t.width+"px").on("end",function(){t.marqueeToggle(!0)})},_openVertical:function(){var t=this;t.entity.style("height","0px"),t.entity.transition().delay(0).duration(250).style("height",36*t.menuItems.length+"px").on("end",function(){t.entity.style("height","auto"),t.marqueeToggle(!0),t.scrollToFitView()}),t.entity.classed("active",!0)},closeAllChildren:function(t){for(var e=0,n=0;n<this.menuItems.length;n++)this.menuItems[n].isActive()&&(++e,this.menuItems[n].submenu.close(function(){0==--e&&"function"==typeof t&&t()}));0==e&&"function"==typeof t&&t()},closeNeighbors:function(t){this.parent?this.parent.closeNeighbors(t):t()},close:function(t){var e=this;this.closeAllChildren(function(){1==e.direction?e._closeHorizontal(t):e._closeVertical(t)})},_closeHorizontal:function(t){this.entity.node().offsetWidth;var e=this,n=e.parent.parentMenu.openSubmenuNow;e.entity.transition().delay(0).duration(20).style("width","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),n?"function"==typeof t&&t():e.restoreWidth(e.OPTIONS.MAX_MENU_WIDTH,!0,function(){"function"==typeof t&&t()})})},_closeVertical:function(t){var e=this;e.entity.transition().delay(0).duration(100).style("height","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),"function"==typeof t&&t()})},isActive:function(){return this.entity.classed("active")},hasActiveParentNeighbour:function(){return this.menuItems.filter(function(t){return t.isActive()}).some(function(t){return!!d3.select(t.entity).node().classed(u.hasChild)})},marqueeToggle:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggle(t)},marqueeToggleAll:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggleAll(t)},findItemById:function(t){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].entity.data().id==t)return this.menuItems[e];if(this.menuItems[e].submenu){var n=this.menuItems[e].submenu.findItemById(t);if(n)return n}}return null},getTopMenu:function(){return this.parent?this.parent.parentMenu.getTopMenu():this},scrollToFitView:function(){var t,e=this.getTopMenu().entity.node().parentNode,n=this.entity.node().parentNode,i=e.getBoundingClientRect(),r=n.getBoundingClientRect(),o=r.top-i.top;if(o+r.height>i.height){var a=r.height>i.height?i.height-10:r.height+10,s=e.scrollTop+a-i.height+o;d3.select(e).transition().duration(100).tween("scrolltoptween",(t=s,function(){var n=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=n(t)}}))}},buildLeaf:function(){var t=this.entity.datum();this.entity.selectAll("div").data([t]).enter().append("div").classed(u.leaf+" "+u.leaf_content+" vzb-dialog-scrollable",!0).style("width",this.width+"px").each(function(t){var e=d3.select(this);e.append("span").classed(u.leaf_content_item+" "+u.leaf_content_item_title,!0).text(i.replaceNumberSpacesToNonBreak(t.name)||""),e.append("span").classed(u.leaf_content_item+" "+u.leaf_content_item_descr,!0).text(i.replaceNumberSpacesToNonBreak(t.description)||"")})}}),d=o.default.extend({init:function(t,e,n){var r=this;this.parentMenu=t,this.entity=e;var o=e.select("."+u.list_outer);return o.node()&&(this.submenu=new h(this,o,n)),this.entity.select("."+u.list_item_label).on("mouseenter",function(){i.isTouchDevice()||(1!=r.parentMenu.direction||d3.select(this).attr("children")?r.parentMenu.hasActiveParentNeighbour()||r.closeNeighbors():r.openSubmenu(),r.marqueeToggle(!0))}).on("click.item",function(){if(!i.isTouchDevice())if(d3.event.stopPropagation(),1==r.parentMenu.direction)r.openSubmenu();else{if(!d3.select(this).attr("children"))return;r.toggleSubmenu()}}).onTap(function(t){if((d3.event.stopPropagation(),2==r.parentMenu.direction)&&!r.entity.select("."+u.list_item_label).attr("children"))return;r.toggleSubmenu()}),this},setWidth:function(t,e,n){return this.submenu&&e&&this.submenu.setWidth(t,e,n),this},setDirection:function(t,e){return this.submenu&&e&&this.submenu.setDirection(t,e),this},toggleSubmenu:function(){this.submenu&&(this.submenu.isActive()?this.submenu.close():this.submenu.open())},openSubmenu:function(){this.submenu?this.submenu.open():this.closeNeighbors()},closeNeighbors:function(t){this.parentMenu.closeAllChildren(t)},isActive:function(){return this.submenu&&this.submenu.isActive()},marqueeToggleAll:function(t){this.entity.selectAll("."+u.list_item_label).each(function(){var e=d3.select(this).select("span"),n=d3.select(this.parentNode);if(n.classed("marquee",!1),e.style("width",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var i=30+e.node().scrollWidth;e.style("width",i+"px"),n.classed("marquee",!0)}})},marqueeToggle:function(t){var e=this.entity.select("."+u.list_item_label).select("span");if(this.entity.classed("marquee",!1),e.style("width",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var n=30+e.node().scrollWidth;e.style("width",n+"px"),this.entity.classed("marquee",!0)}}}),f=r.default.extend({indicatorsTree:function(t){return arguments.length?(this._indicatorsTree=t,this):this._indicatorsTree},callback:function(t){return arguments.length?(this._callback=t,this):this._callback},markerID:function(t){return arguments.length?(this._markerID=t,this.targetModel(this.model.marker[this._markerID]),this):this._markerID},showWhenReady:function(t){return arguments.length?(this._showWhenReady=t,this):this._showWhenReady},scaletypeSelectorDisabled:function(t){return arguments.length?(this._scaletypeSelectorDisabled=t,this):this._scaletypeSelectorDisabled},title:function(t){return arguments.length?(this._title=t,this):this._title},targetModel:function(t){return arguments.length?(this._targetModel&&this._targetModel.off("change",this.change),this._targetModel=t,this._targetModel.on("change",this.change),this._targetModel.isHook()&&(this._targetProp="which"),this._targetModel instanceof a.default&&(this._targetProp="space"),this):this._targetModel},targetProp:function(t){return arguments.length?(this._targetProp=t,this):this._targetProp},alignX:function(t){return arguments.length?(this._alignX=t,this):this._alignX},alignY:function(t){return arguments.length?(this._alignY=t,this):this._alignY},top:function(t){return arguments.length?(this._top=t,this):this._top},left:function(t){return arguments.length?(this._left=t,this):this._left},init:function(t,e){this.name="gapminder-treemenu",this.model_expects=[{name:"marker",type:"marker"},{name:"time",type:"time"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.context=e,this.menuEntity=null,this._super(t,e),this._callback=function(t){console.log("Indicator selector: stub callback fired. New indicator is ",t)},this._alignX="center",this._alignY="center",this.OPTIONS=i.deepClone(c),this.change=this.change.bind(this)},change:function(t,e){(-1!=e.indexOf("."+this._targetProp)||this._targetModel.isHook()&&-1!=e.indexOf(".scaleType"))&&this.updateView()},ready:function(){this.model.marker._root.dataManager.getTags().then(this._buildIndicatorsTree.bind(this)).then(this.updateView.bind(this))},readyOnce:function(){this.element=d3.select(this.placeholder);var t=this;this.element.selectAll("div").remove(),this.element.append("div").attr("class",u.background).on("click",function(){d3.event.stopPropagation(),t.toggle()}),this.wrapperOuter=this.element.append("div").classed(u.wrapper_outer,!0).classed(u.noTransition,!0),this.wrapper=this.wrapperOuter.append("div").classed(u.wrapper,!0).classed(u.noTransition,!0).classed("vzb-dialog-scrollable",!0),this.wrapper.on("click",function(){d3.event.stopPropagation()}),this.wrapper.append("div").attr("class",u.close).html(s.close).on("click",function(){d3.event.stopPropagation(),t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class",u.close+"-icon"),this.wrapper.append("div").classed(u.scaletypes,!0).append("span"),this.wrapper.append("div").classed(u.title,!0).append("span"),this.wrapper.append("div").classed(u.search_wrap,!0).append("input").classed(u.search,!0).attr("type","search").attr("id",u.search),d3.select("body").on("mousemove",t._mousemoveDocument),this.wrapper.on("mouseleave",function(){}),this.translator=this.model.locale.getTFunction(),t._enableSearch(),t.resize()},_buildIndicatorsTree:function(t){var e=this;!0!==t&&t||(t=[]);var n=this,r="_root",o=n.model.marker._root.dataManager.getDataModels(),a=1==o.size?"spread":"root",s={};s._root={id:r,children:[]},s.advanced={id:"advanced",name:this.translator("treemenu/advanced"),type:"folder",children:[]},s._root.children.push(s.advanced),s.other_datasets={id:"other_datasets",name:this.translator("treemenu/other_datasets"),type:"folder",children:[]},s._root.children.push(s.other_datasets),t.forEach(function(t){s[t.tag]={id:t.tag,name:t.name,type:"folder",children:[]}});var l={};o.forEach(function(t){var n=i.getProp(e.model.ui,["treemenu","folderStrategyByDataset",t._name]),r=null;n||(n=a),n.includes(":")&&(r=n.split(":")[1],n=n.split(":")[0]),s[t._name]={id:t._name,name:t.getDatasetName(),type:"dataset",children:[]},"folder"==n&&s[r]?s[r].children.push(s[t._name]):"spread"==n?s[t._name]=s._root:s._root.children.push(s[t._name]),l[t._name]=n});var u=s._root;t.forEach(function(t){t.parent&&s[t.parent]?s[t.parent].children.push(s[t.tag]):"spread"==l[t.dataSourceName]?s._root.children.push(s[t.tag]):s[t.dataSourceName].children.push(s[t.tag])});var c=this.model.marker.space.length>1;return this.model.marker.getAvailableData().forEach(function(t){var e=t.value;if(e&&"_none"!=e.tags){e.tags||(e.tags=t.dataSource._name||r);var o="_default"==e.concept?"constant":t.key.size>1||"time"===e.concept_type?"indicator":"property",a={id:e.concept,key:t.key,name:e.name,name_catalog:e.name_catalog,description:e.description,dataSource:t.dataSource._name,use:o};if(c&&1==t.key.length&&"_default"!=e.concept&&"time"!=e.concept_type){var l=t.key[0].concept+"_properties";if(!s[l]){var u=t.key[0];s[l]={id:l,name:u.name+" properties",type:"folder",children:[]},s._root.children.push(s[l])}s[l].children.push(a)}else e.tags.split(",").forEach(function(t){t=t.trim(),s[t]?s["_root"===t&&"_default"!=e.concept&&"time"!=e.concept_type?a.dataSource:t].children.push(a):(n.consoleGroupOpen||(console.groupCollapsed("Some tags were not found, so indicators went under menu root"),n.consoleGroupOpen=!0),i.warn("tag '"+t+"' for indicator '"+a.id+"'"),s._root.children.push(a))})}}),this.model.marker.getAvailableSpaces().forEach(function(t,e){u.children.push({id:e,name:t.map(function(t){return t.name}).join(", "),name_catalog:t.map(function(t){return t.name}).join(", "),description:"no description",dataSource:"All data sources",type:"space"})}),n.consoleGroupOpen&&(console.groupEnd(),delete n.consoleGroupOpen),this._sortChildren(u),this.indicatorsTree(u),Promise.resolve()},_sortChildren:function(t,e){var n=this;t.children&&(t.children.sort(i.firstBy()(function(t,e){return t="dataset"===t.type?1:0,(e="dataset"===e.type?1:0)-t}).thenBy(function(t,e){return(t=t.children?1:0)-(e=e.children?1:0)}).thenBy(function(t,n){if(!e){if("time"==t.id)return-1;if("time"==n.id)return 1;if("other_datasets"==t.id)return 1;if("other_datasets"==n.id)return-1;if("advanced"==t.id)return 1;if("advanced"==n.id)return-1;if("_default"==t.id)return 1;if("_default"==n.id)return-1}return(t.name_catalog||t.name)>(n.name_catalog||n.name)?1:-1})),t.children.forEach(function(t){n._sortChildren(t,!0)}))},resize:function(){this.profiles={small:{col_width:200},medium:{col_width:200},large:{col_width:200}};var t=this._top,e=this._left;if(!this.wrapper)return i.warn("treemenu resize() abort because container is undefined");this.wrapper.classed(u.noTransition,!0),this.wrapper.node().scrollTop=0,this.activeProfile=this.profiles[this.getLayoutProfile()],this.OPTIONS.IS_MOBILE="small"===this.getLayoutProfile(),this.menuEntity&&(this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.OPTIONS.IS_MOBILE?2!=this.menuEntity.direction&&(this.menuEntity.setDirection(2,!0),this.OPTIONS.MENU_DIRECTION=2):1!=this.menuEntity.direction&&(this.menuEntity.setDirection(1,!0),this.OPTIONS.MENU_DIRECTION=1)),this.width=this.element.node().offsetWidth,this.height=this.element.node().offsetHeight;var n=this.wrapperOuter.node().getBoundingClientRect(),r=n.width,o=n.height;if(r)if(this.OPTIONS.IS_MOBILE)this.clearPos();else{(t||e)&&(this.wrapperOuter.node().offsetTop<10&&this.wrapperOuter.style("top","10px"),this.height-this.wrapperOuter.node().offsetTop-o<0&&(o>this.height&&(o=this.height-20),this.wrapperOuter.style("top",this.height-o-10+"px"),this.wrapperOuter.style("bottom","auto")),t&&(t=this.wrapperOuter.node().offsetTop));var a=void 0;a=this.wrapperOuter.classed(u.alignYb)?this.wrapperOuter.node().offsetTop+this.wrapperOuter.node().offsetHeight:this.height-this.wrapperOuter.node().offsetTop,this.wrapper.style("max-height",a-10+"px"),this.wrapperOuter.classed(u.alignXc,"center"===this._alignX),this.wrapperOuter.style("margin-left","center"===this._alignX?"-"+r/2+"px":null),"center"===this._alignX?this.OPTIONS.MAX_MENU_WIDTH=this.width/2-.5*r-10:this.OPTIONS.MAX_MENU_WIDTH=this.width-this.wrapperOuter.node().offsetLeft-r-10;var s=this.activeProfile.col_width+2*this.OPTIONS.MIN_COL_WIDTH,l=this.wrapperOuter.node().offsetLeft;this.OPTIONS.MENU_OPEN_LEFTSIDE=this.OPTIONS.MAX_MENU_WIDTH<s&&l>this.OPTIONS.MAX_MENU_WIDTH+10,this.OPTIONS.MENU_OPEN_LEFTSIDE?(l<s+10&&(l=s+10),this.OPTIONS.MAX_MENU_WIDTH=l-10):this.OPTIONS.MAX_MENU_WIDTH<s&&(l-=s-this.OPTIONS.MAX_MENU_WIDTH,this.OPTIONS.MAX_MENU_WIDTH=s),e?e=l:l!=this.wrapperOuter.node().offsetLeft&&(this.wrapperOuter.style("left","auto"),this.wrapperOuter.style("right",this.width-l-n.width+"px")),this._top=t,this._left=e,(e||t)&&this.setPos(),this.wrapperOuter.classed("vzb-treemenu-open-left-side",!this.OPTIONS.IS_MOBILE&&this.OPTIONS.MENU_OPEN_LEFTSIDE)}return this.wrapper.node().offsetHeight,this.wrapper.classed(u.noTransition,!1),this.setHorizontalMenuHeight(),this},toggle:function(){this.setHiddenOrVisible(!this.element.classed(u.hidden))},setHiddenOrVisible:function(t){var e=this;return this.element.classed(u.hidden,t),this.wrapper.classed(u.noTransition,t),t?(this.clearPos(),this.menuEntity.marqueeToggle(!1)):(this.setPos(),!i.isTouchDevice()&&this.focusSearch(),this.resize(),this.scrollToSelected()),this.parent.components.forEach(function(n){"gapminder-dialogs"==n.name?d3.select(n.placeholder.parentNode).classed("vzb-blur",!t):n.element.classed?n.element.classed("vzb-blur",n!=e&&!t):d3.select(n.element).classed("vzb-blur",n!=e&&!t)}),this.width=e.element.node().offsetWidth,this},scrollToSelected:function(){if(this.selectedNode){var t=this,e=function(t,e){t.scrollTop=0;var n=t.getBoundingClientRect(),i=e.getBoundingClientRect().bottom-n.top-t.offsetHeight+10;t.scrollTop=i};if(2==this.menuEntity.direction)e(this.wrapper.node(),this.selectedNode),t.menuEntity.marqueeToggleAll(!0);else{this.menuEntity.findItemById(d3.select(this.selectedNode).data().id).submenu.calculateMissingWidth(0,function(){t.menuEntity.marqueeToggleAll(!0)});for(var n=this.selectedNode;!i.hasClass(n,u.list_top_level);)"LI"==n.tagName&&e(i.hasClass(n.parentNode,u.list_top_level)?n.parentNode.parentNode:n.parentNode,n),n=n.parentNode}}},setPos:function(){var t=this._top,e=this._left,n=this.wrapperOuter.node().getBoundingClientRect();if(t&&(this.wrapperOuter.style("top",t+"px"),this.wrapperOuter.style("bottom","auto"),this.wrapperOuter.classed(u.absPosVert,t)),e){var i=this.element.node().offsetWidth-e-n.width;i=i<10?10:i,this.wrapperOuter.style("right",i+"px"),this.wrapperOuter.style("left","auto"),this.wrapperOuter.classed(u.absPosHoriz,i)}},clearPos:function(){this._top="",this._left="",this.wrapperOuter.attr("style",""),this.wrapperOuter.classed(u.absPosVert,""),this.wrapperOuter.classed(u.absPosHoriz,""),this.wrapperOuter.classed(u.menuOpenLeftSide,""),this.wrapper.style("max-height","")},setHorizontalMenuHeight:function(){var t=null;if(this.menuEntity&&1==this.OPTIONS.MENU_DIRECTION&&this.menuEntity.menuItems.length){var e=parseInt(this.menuEntity.menuItems[0].entity.style("height"),10)||0,n=e*this._maxChildCount,i=Math.max(this.menuEntity.menuItems.length,3)*e+this.menuEntity.entity.node().offsetTop+parseInt(this.wrapper.style("padding-bottom"),10);t=Math.max(n,i)+"px"}this.wrapper.classed(u.noTransition,!0),this.wrapper.node().offsetHeight,this.wrapper.style("height",t),this.wrapper.node().offsetHeight,this.wrapper.classed(u.noTransition,!1)},_enableSearch:function(){var t=this,e=this.wrapper.select("."+u.search),n=!1,r=i.debounce(function(){var r=e.node().value;(n||""!=r)&&(n=""!=r,r.length>=t.OPTIONS.SEARCH_MIN_STR?t.redraw(function(e){var n={_id:"root",children:[]},r=function(e,n,i){var r=n[i].name;return!r&&t.translator&&(r=t.translator("indicator/"+n[i][t.OPTIONS.SEARCH_PROPERTY]+"/"+t._targetModel._type)||t.translator("indicator/"+n[i][t.OPTIONS.SEARCH_PROPERTY])),r&&r.toLowerCase().indexOf(e.toLowerCase())>=0};return function i(o){for(var a=t.OPTIONS.SUBMENUS,s=0;s<o.length;s++){var l;(l=r(e,o,s))&&n.children.push(o[s]),!l&&o[s][a]&&i(o[s][a])}}(t.dataFiltered.children),n.children=i.unique(n.children,function(t){return t.id}),n}(r),!0):t.redraw())},250);e.on("input",r)},_selectIndicator:function(t){this._callback(this._targetProp,t),this.toggle()},redraw:function(t,e){var n=this,r=n._targetModel.isHook(),o=void 0,s=void 0,l={};i.forEach(this.model.marker._root._data,function(t){"data"===t._type&&i.deepExtend(l,t.getConceptprops())});var c=n._targetModel._type;e?o=t:(null==t&&(t=this._indicatorsTree),r?(s=i.keys(l).filter(function(t){if(n._targetModel.allow&&n._targetModel.allow.names){if(-1!=n._targetModel.allow.names.indexOf("!"+t))return!1;if(-1!=n._targetModel.allow.names.indexOf(t))return!0;if(n._targetModel.allow.namesOnlyThese)return!1}if(!n._targetModel.allow||!n._targetModel.allow.scales)return!0;if("*"==n._targetModel.allow.scales[0])return!0;if(!l[t].scales)return!0;for(var e=l[t].scales.length-1;e>=0;e--)if(n._targetModel.allow.scales.indexOf(l[t].scales[e])>-1)return!0;return!1}),o=i.pruneTree(t,function(t){return s.indexOf(t.id)>-1})):n._targetModel instanceof a.default?(s=t.children.map(function(t){return t.id}),o=i.pruneTree(t,function(t){return"space"==t.type})):(s=i.keys(l),o=i.pruneTree(t,function(t){return s.indexOf(t.id)>-1})),this.dataFiltered=o),this.wrapper.select("ul").remove();var d="";d=this._title||""===this._title?this._title:this.translator(n._targetModel instanceof a.default?n._targetModel._root._name+"/"+n._targetModel._name:"buttons/"+(r?n._targetModel._name:c+"/"+n._targetProp)),this.element.select("."+u.title).select("span").text(d),this.element.select("."+u.search).attr("placeholder",this.translator("placeholder/search")+"..."),this._maxChildCount=0;var f=n.translator("hints/nodescr");if(this.OPTIONS.IS_MOBILE?this.OPTIONS.MENU_DIRECTION=2:this.OPTIONS.MENU_DIRECTION=1,this.selectedNode=null,function t(e,r,o){if(r.children){n._maxChildCount=Math.max(n._maxChildCount,r.children.length);var a=(o?e:e.append("div").classed(u.list_outer,!0)).append("ul").classed(u.list,!o).classed(u.list_top_level,o).classed("vzb-dialog-scrollable",!0).selectAll("li").data(r.children,function(t){return t.id}).enter().append("li");a.append("span").classed(u.list_item_label,!0).attr("children",function(t){return t.children?"true":null}).attr("type",function(t){return t.type?t.type:null}).on("click",function(t){d3.select(this).attr("children")||(d3.event.stopPropagation(),n._selectIndicator({concept:t.id,key:t.key,dataSource:t.dataSource,use:t.use}))}).append("span").text(function(t){var e="_default"===t.id?n.translator("indicator/_default/"+c):t.name_catalog||t.name||t.id;return e||""===e||i.warn("translation missing: NAME of "+t.id),e||""}),a.classed(u.list_item,!0).classed(u.hasChild,function(t){return t.children}).classed(u.isSpecial,function(t){return t.special}).each(function(e){var r=d3.select(this);if(e.children||("_default"===e.id&&(e.name=n.translator("indicator/_default/"+c),e.description=n.translator("description/_default/"+c)),e.description||(e.description=f),r.append("div").attr("class",u.menuHorizontal+" "+u.list_outer+" "+u.list_item_leaf).on("click",function(t){n._selectIndicator({concept:t.id,key:t.key,dataSource:t.dataSource,use:t.use})})),e.id==n._targetModel[n._targetProp]){var a=void 0;if(n.selectedNode&&o)for(a=n.selectedNode.parentNode,d3.select(n.selectedNode).select("."+u.list_item_leaf).classed("active",!1);!i.hasClass(a,u.list_top_level);)"UL"==a.tagName&&d3.select(a.parentNode).classed("active",!1),a=a.parentNode;if(!n.selectedNode||o){for(a=this.parentNode,d3.select(this).classed("item-active",!0).select("."+u.list_item_leaf).classed("active",!0);!i.hasClass(a,u.list_top_level);)"UL"==a.tagName&&d3.select(a.parentNode).classed("active",!0),"LI"==a.tagName&&d3.select(a).classed("item-active",!0),a=a.parentNode;n.selectedNode=this}}t(r,e)})}}(this.wrapper,o,!0),this.menuEntity=new h(null,this.wrapper.selectAll("."+u.list_top_level),this.OPTIONS),this.menuEntity&&this.menuEntity.setDirection(this.OPTIONS.MENU_DIRECTION),this.menuEntity&&this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.setHorizontalMenuHeight(),!e){var p="_default";if(s.indexOf(this._targetModel[n._targetProp])>-1&&(p=this._targetModel[n._targetProp]),l[p]||i.error("Concept properties of "+p+" are missing from the set, or the set is empty. Put a breakpoint here and check what you have in indicatorsDB"),!l[p].scales)return this.element.select("."+u.scaletypes).classed(u.hidden,!0),!0;var m=r?l[p].scales.filter(function(t){return!n._targetModel.allow||!n._targetModel.allow.scales||("*"==n._targetModel.allow.scales[0]||n._targetModel.allow.scales.indexOf(t)>-1)}):[];if(0==m.length)this.element.select("."+u.scaletypes).classed(u.hidden,!0);else{var v=this.element.select("."+u.scaletypes).classed(u.hidden,!1).selectAll("span").data(m,function(t){return t});v.exit().remove(),v=v.enter().append("span").on("click",function(t){d3.event.stopPropagation(),n._setModel("scaleType",t)}).merge(v);var g=n._targetModel.scaleType;v.classed(u.scaletypesDisabled,m.length<2||n._scaletypeSelectorDisabled).classed(u.scaletypesActive,function(t){return(t==g||"log"===t&&"genericLog"===g)&&m.length>1}).text(function(t){return n.translator("scaletype/"+t)})}}return this},updateView:function(){if(this._targetModel){this.wrapperOuter.classed(u.absPosVert,this._top),this.wrapperOuter.classed(u.alignYt,"top"===this._alignY),this.wrapperOuter.classed(u.alignYb,"bottom"===this._alignY),this.wrapperOuter.classed(u.absPosHoriz,this._left),this.wrapperOuter.classed(u.alignXl,"left"===this._alignX),this.wrapperOuter.classed(u.alignXr,"right"===this._alignX);var t=this._setModel.bind(this);return this.callback(t).redraw(),this._ready&&this._showWhenReady&&this.setHiddenOrVisible(!1).showWhenReady(!1),this.wrapper.select("."+u.search).node().value="",this}},focusSearch:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.wrapper.select("."+u.search).node();t?e.focus():e.blur()},_setModel:function(t,e){var n=this._targetModel;"which"==t&&n.setWhich(e),"scaleType"==t&&n.setScaleType(e),"space"==t&&n.setSpace(e.concept.split(","))}});e.default=f},function(t,e,n){var i={"./_dialog.js":12,"./about/about.js":166,"./axes/axes.js":167,"./colors/colors.js":169,"./dialogs.js":170,"./find/find.js":171,"./find/show.js":112,"./grouping/grouping.js":172,"./label/label.js":173,"./moreoptions/moreoptions.js":174,"./opacity/opacity.js":175,"./presentation/presentation.js":176,"./side/side.js":177,"./size/size.js":178,"./speed/speed.js":179,"./stack/stack.js":180,"./timedisplay/timedisplay.js":182,"./zoom/zoom.js":184};function r(t){return n(o(t))}function o(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=424},function(t,e,n){var i={"./d3.axisWithLabelPicker.js":111,"./d3.collisionResolver.js":426,"./d3.colorPicker.js":164,"./d3.dynamicBackground.js":183,"./d3.genericLogScale.js":157,"./d3.geoProjection.js":427,"./d3.touchEvents.js":158,"./labels.js":428,"./requireAll.js":105,"./svgexport.js":430,"./textEllipsis.js":431,"./topojson.js":432};function r(t){return n(o(t))}function o(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=425},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return function(){var t=300,e=0;function n(n){if(null!=i)if(null!=r)if(null!=a)if(null!=h){e=.8*n.node().getBBox().height;for(var o=n.filter(function(t){return l(t,s)}).sort(function(t,e){return d3.ascending(t.valueY,e.valueY)}).data(),u={},c=0;c<o.length-1;c++){var d=o[c],f=o[c+1];if(d.shiftY||(d.shiftY=0),f.shiftY=0,!(f.valueY-d.valueY-d.shiftY>=e)){var p=0;d.valueY>e&&(0==c?p=Math.min(e,d.valueY):d.valueY-o[c-1].valueY+o[c-1].shiftY>e&&(p=Math.min(e,d.valueY-o[c-1].valueY+o[c-1].shiftY))),d.upperAvailable=p;var m=0;f.valueY<r&&(c==o.length-2?m=Math.min(e,r-f.valueY):o[c+2].valueY-f.valueY>e&&(m=Math.min(e,o[c+2].valueY-f.valueY))),f.underAvailable=m;var v=e-(f.valueY-d.valueY-d.shiftY);u[d[h]]={},u[f[h]]={},p>=v/2&&m>=v/2?(d.shiftY=-v/2,f.shiftY=v/2):p>=v/2?(f.shiftY=m,d.shiftY=-Math.min(p,v-m)):m>=v/2?(d.shiftY-=p,f.shiftY=Math.min(m,v-p)):(d.shiftY=-p,f.shiftY=m),u[d[h]].valueY=d.valueY+d.shiftY,u[f[h]].valueY=f.valueY+f.shiftY}}n.each(function(e,n){u[e[h]]&&u[e[h]].valueY&&d3.select(this).selectAll(i).transition().duration(t).attr("transform","translate(0,"+u[e[h]].valueY+")")})}else console.warn("D3 collision resolver stopped: missing a key for data. Example: key = 'geo' ");else console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' ");else console.warn("D3 collision resolver stopped: missing height of the canvas");else console.warn("D3 collision resolver stopped: missing a CSS slector")}var i=null;n.selector=function(t){return arguments.length?(i=t,n):i};var r=null;n.height=function(t){return arguments.length?(r=t,n):r};var o=d3.scaleLinear().domain([0,1]).range([0,1]);n.scale=function(t){return arguments.length?(o=t,n):o};var a=null;n.value=function(t){return arguments.length?(a=t,n):a};var s=null;n.time=function(t){return arguments.length?(s=t,n):s};var l=function(){return!0};n.filter=function(t){return arguments.length?(l=t,n):l};var u=null;n.fixed=function(t){return arguments.length?(u=t,n):u};var c=null;n.handleResult=function(t){return arguments.length?(c=t,n):c};var h=null;return n.KEY=function(t){return arguments.length?(h=t,n):h},n}()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,n){return{type:"Feature",id:t.id,properties:t.properties,geometry:e(t.geometry,n)}}function e(t,n){if(!t)return null;if("GeometryCollection"===t.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(t){return e(t,n)})};if(!l.hasOwnProperty(t.type))return null;var i=l[t.type];return d3.geoUstream(t,n(i)),i.result()}d3.geoProject=function(t,i){var r=i.stream;if(!r)throw new Error("not yet supported");return(t&&n.hasOwnProperty(t.type)?n[t.type]:e)(t,r)};var n={Feature:t,FeatureCollection:function(e,n){return{type:"FeatureCollection",features:e.features.map(function(e){return t(e,n)})}}},i=[],r=[],o={point:function(t,e){i.push([t,e])},result:function(){var t=i.length?i.length<2?{type:"Point",coordinates:i[0]}:{type:"MultiPoint",coordinates:i}:null;return i=[],t}},a={lineStart:u,point:function(t,e){i.push([t,e])},lineEnd:function(){i.length&&(r.push(i),i=[])},result:function(){var t=r.length?r.length<2?{type:"LineString",coordinates:r[0]}:{type:"MultiLineString",coordinates:r}:null;return r=[],t}},s={polygonStart:u,lineStart:u,point:function(t,e){i.push([t,e])},lineEnd:function(){var t=i.length;if(t){do{i.push(i[0].slice())}while(++t<4);r.push(i),i=[]}},polygonEnd:u,result:function(){if(!r.length)return null;var t=[],e=[];return r.forEach(function(n){!function(t){if((e=t.length)<4)return!1;var e,n=0,i=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];for(;++n<e;)i+=t[n-1][1]*t[n][0]-t[n-1][0]*t[n][1];return i<=0}(n)?e.push(n):t.push([n])}),e.forEach(function(e){var n=e[0];t.some(function(t){return!!function(t,e){for(var n=e[0],i=e[1],r=!1,o=0,a=t.length,s=a-1;o<a;s=o++){var l=t[o],u=l[0],c=l[1],h=t[s],d=h[0],f=h[1];c>i^f>i&&n<(d-u)*(i-c)/(f-c)+u&&(r=!r)}return r}(t[0],n)&&(t.push(e),!0)})||t.push([e])}),r=[],t.length?t.length>1?{type:"MultiPolygon",coordinates:t}:{type:"Polygon",coordinates:t[0]}:null}},l={Point:o,MultiPoint:o,LineString:a,MultiLineString:a,Polygon:s,MultiPolygon:s,Sphere:s};function u(){}var c=1e-6,h=c*c,d=Math.PI,f=d/2,p=Math.sqrt(d),m=d/180,v=180/d;function g(t){return t>0?1:t<0?-1:0}function y(t){return t>1?f:t<-1?-f:Math.asin(t)}function _(t){return t>1?0:t<-1?d:Math.acos(t)}function b(t){return t>0?Math.sqrt(t):0}var x=d3.geoProjection,w=d3.geoProjectionMutator;function S(t){var e=Math.tan(.5*t),n=2*Math.log(Math.cos(.5*t))/(e*e);function i(t,e){var i=Math.cos(t),r=Math.cos(e),o=Math.sin(e),a=r*i,s=-((1-a?Math.log(.5*(1+a))/(1-a):-.5)+n/(1+a));return[s*r*Math.sin(t),s*o]}return i.invert=function(e,i){var r,o=Math.sqrt(e*e+i*i),a=-.5*t,s=50;if(!o)return[0,0];do{var l=.5*a,u=Math.cos(l),h=Math.sin(l),d=Math.tan(l),f=Math.log(1/u);a-=r=(2/d*f-n*d-o)/(-f/(h*h)+1-n/(2*u*u))}while(Math.abs(r)>c&&--s>0);var p=Math.sin(a);return[Math.atan2(e*p,o*Math.cos(a)),y(i*p/o)]},i}function M(t,e){var n,i=Math.cos(e),r=(n=_(i*Math.cos(t/=2)))?n/Math.sin(n):1;return[2*i*Math.sin(t)*r,Math.sin(e)*r]}function E(t){var e=Math.sin(t),n=Math.cos(t),i=t>0?1:-1,r=Math.tan(i*t),o=(1+e-n)/2;function a(t,a){var s=Math.cos(a),l=Math.cos(t/=2);return[(1+s)*Math.sin(t),(i*a>-Math.atan2(l,r)-.001?0:10*-i)+o+Math.sin(a)*n-(1+s)*e*l]}return a.invert=function(t,a){var s=0,l=0,u=50;do{var h=Math.cos(s),d=Math.sin(s),f=Math.cos(l),p=Math.sin(l),m=1+f,v=m*d-t,g=o+p*n-m*e*h-a,y=.5*m*h,_=-d*p,b=.5*e*m*d,x=n*f+e*h*p,w=_*b-x*y,S=.5*(g*_-v*x)/w,M=(v*b-g*y)/w;s-=S,l-=M}while((Math.abs(S)>c||Math.abs(M)>c)&&--u>0);return i*l>-Math.atan2(Math.cos(s),r)-.001?[2*s,l]:null},a}function z(t){return.5*(Math.exp(t)-Math.exp(-t))}function k(t){return.5*(Math.exp(t)+Math.exp(-t))}function T(t,e){var n=Math.tan(e/2),i=b(1-n*n),r=1+i*Math.cos(t/=2),o=Math.sin(t)*i/r,a=n/r,s=o*o,l=a*a;return[4/3*o*(3+s-3*l),4/3*a*(3+3*s-l)]}d3.geoInterrupt=function(t){var e,n=[[[[-d,0],[0,f],[d,0]]],[[[-d,0],[0,-f],[d,0]]]];function i(e,i){for(var r=i<0?-1:1,o=n[+(i<0)],a=0,s=o.length-1;a<s&&e>o[a][2][0];++a);var l=t(e-o[a][1][0],i);return l[0]+=t(o[a][1][0],r*i>r*o[a][0][1]?o[a][0][1]:i)[0],l}t.invert&&(i.invert=function(r,o){for(var a=e[+(o<0)],l=n[+(o<0)],u=0,c=a.length;u<c;++u){var h=a[u];if(h[0][0]<=r&&r<h[1][0]&&h[0][1]<=o&&o<h[1][1]){var d=t.invert(r-t(l[u][1][0],0)[0],o);return d[0]+=l[u][1][0],s(i(d[0],d[1]),[r,o])?d:null}}});var r=d3.geoProjection(i),o=r.stream;function a(t,e){for(var n,i,r,o=-1,a=t.length,s=t[0],l=[];++o<a;){i=((n=t[o])[0]-s[0])/e,r=(n[1]-s[1])/e;for(var u=0;u<e;++u)l.push([s[0]+u*i,s[1]+u*r]);s=n}return l.push(n),l}function s(t,e){return Math.abs(t[0]-e[0])<c&&Math.abs(t[1]-e[1])<c}return r.stream=function(t){var e=r.rotate(),i=o(t),s=(r.rotate([0,0]),o(t));return r.rotate(e),i.sphere=function(){d3.geoStream(function(){for(var t=1e-6,e=[],i=0,r=n[0].length;i<r;++i){var o=n[0][i],s=180*o[0][0]/d,l=180*o[0][1]/d,u=180*o[1][1]/d,c=180*o[2][0]/d,h=180*o[2][1]/d;e.push(a([[s+t,l+t],[s+t,u-t],[c-t,u-t],[c-t,h+t]],30))}for(var i=n[1].length-1;i>=0;--i){var o=n[1][i],s=180*o[0][0]/d,l=180*o[0][1]/d,u=180*o[1][1]/d,c=180*o[2][0]/d,h=180*o[2][1]/d;e.push(a([[c-t,h-t],[c-t,u+t],[s+t,u+t],[s+t,l-t]],30))}return{type:"Polygon",coordinates:[d3.merge(e)]}}(),s)},i},r.lobes=function(i){return arguments.length?(n=i.map(function(t){return t.map(function(t){return[[t[0][0]*d/180,t[0][1]*d/180],[t[1][0]*d/180,t[1][1]*d/180],[t[2][0]*d/180,t[2][1]*d/180]]})}),e=n.map(function(e){return e.map(function(e){var n,i=t(e[0][0],e[0][1])[0],r=t(e[2][0],e[2][1])[0],o=t(e[1][0],e[0][1])[1],a=t(e[1][0],e[1][1])[1];return o>a&&(n=o,o=a,a=n),[[i,o],[r,a]]})}),r):n.map(function(t){return t.map(function(t){return[[180*t[0][0]/d,180*t[0][1]/d],[180*t[1][0]/d,180*t[1][1]/d],[180*t[2][0]/d,180*t[2][1]/d]]})})},r},(d3.geoAiry=function(){var t=f,e=w(S),n=e(t);return n.radius=function(n){return arguments.length?e(t=n*d/180):t/d*180},n}).raw=S,M.invert=function(t,e){if(!(t*t+4*e*e>d*d+c)){var n=t,i=e,r=25;do{var o,a=Math.sin(n),s=Math.sin(n/2),l=Math.cos(n/2),u=Math.sin(i),h=Math.cos(i),f=Math.sin(2*i),p=u*u,m=h*h,v=s*s,g=1-m*l*l,y=g?_(h*l)*Math.sqrt(o=1/g):o=0,b=2*y*h*s-t,x=y*u-e,w=o*(m*v+y*h*l*p),S=o*(.5*a*f-2*y*u*s),M=.25*o*(f*s-y*u*m*a),E=o*(p*l+y*v*h),z=S*M-E*w;if(!z)break;var k=(x*S-b*E)/z,T=(b*M-x*w)/z;n-=k,i-=T}while((Math.abs(k)>c||Math.abs(T)>c)&&--r>0);return[n,i]}},(d3.geoAitoff=function(){return x(M)}).raw=M,(d3.geoArmadillo=function(){var t=d/9,e=t>0?1:-1,n=Math.tan(e*t),i=w(E),r=i(t),o=r.stream;return r.parallel=function(r){return arguments.length?(n=Math.tan((e=(t=r*d/180)>0?1:-1)*t),i(t)):t/d*180},r.stream=function(i){var a=r.rotate(),s=o(i),l=(r.rotate([0,0]),o(i));return r.rotate(a),s.sphere=function(){l.polygonStart(),l.lineStart();for(var i=-180*e;e*i<180;i+=90*e)l.point(i,90*e);for(;e*(i-=t)>=-180;)l.point(i,e*-Math.atan2(Math.cos(i*m/2),n)*v);l.lineEnd(),l.polygonEnd()},s},r}).raw=E,T.invert=function(t,e){if(e*=3/8,!(t*=3/8)&&Math.abs(e)>1)return null;var n=1+t*t+e*e,i=Math.sqrt(.5*(n-Math.sqrt(n*n-4*e*e))),r=y(i)/3,o=i?function(t){return Math.log(t+b(t*t-1))}(Math.abs(e/i))/3:function(t){return Math.log(t+b(t*t+1))}(Math.abs(t))/3,a=Math.cos(r),s=k(o),l=s*s-a*a;return[2*g(t)*Math.atan2(z(o)*a,.25-l),2*g(e)*Math.atan2(s*Math.sin(r),.25+l)]},(d3.geoAugust=function(){return x(T)}).raw=T;var O=Math.log(1+Math.SQRT2);function P(t,e){var n=Math.abs(e);return n<d/4?[t,Math.log(Math.tan(d/4+e/2))]:[t*Math.cos(n)*(2*Math.SQRT2-1/Math.sin(n)),g(e)*(2*Math.SQRT2*(n-d/4)-Math.log(Math.tan(n/2)))]}P.invert=function(t,e){if((i=Math.abs(e))<O)return[t,2*Math.atan(Math.exp(e))-f];var n,i,r=Math.sqrt(8),o=d/4,a=25;do{var s=Math.cos(o/2),l=Math.tan(o/2);o-=n=(r*(o-d/4)-Math.log(l)-i)/(r-.5*s*s/l)}while(Math.abs(n)>h&&--a>0);return[t/(Math.cos(o)*(r-1/Math.sin(o))),g(e)*o]},(d3.geoBaker=function(){return x(P)}).raw=P;var C=d3.geoAzimuthalEquidistant.raw;function A(t){var e=2*d/t;function n(t,n){var i=C(t,n);if(Math.abs(t)>f){var r=Math.atan2(i[1],i[0]),o=Math.sqrt(i[0]*i[0]+i[1]*i[1]),a=e*Math.round((r-f)/e)+f,s=Math.atan2(Math.sin(r-=a),2-Math.cos(r));r=a+y(d/o*Math.sin(s))-s,i[0]=o*Math.cos(r),i[1]=o*Math.sin(r)}return i}return n.invert=function(t,n){var i=Math.sqrt(t*t+n*n);if(i>f){var r=Math.atan2(n,t),o=e*Math.round((r-f)/e)+f,a=r>o?-1:1,s=i*Math.cos(o-r),l=1/Math.tan(a*Math.acos((s-d)/Math.sqrt(d*(d-2*s)+i*i)));r=o+2*Math.atan((l+a*Math.sqrt(l*l-3))/3),t=i*Math.cos(r),n=i*Math.sin(r)}return C.invert(t,n)},n}function I(t){return function(e){var n,i=t*Math.sin(e),r=30;do{e-=n=(e+Math.sin(e)-i)/(1+Math.cos(e))}while(Math.abs(n)>c&&--r>0);return e/2}}function L(t,e,n){var i=I(n);function r(n,r){return[t*n*Math.cos(r=i(r)),e*Math.sin(r)]}return r.invert=function(i,r){var o=y(r/e);return[i/(t*Math.cos(o)),y((2*o+Math.sin(2*o))/n)]},r}(d3.geoBerghaus=function(){var t=5,e=w(A),n=e(t),i=n.stream,r=.01,o=-Math.cos(r*m),a=Math.sin(r*m);return n.lobes=function(n){return arguments.length?e(t=+n):t},n.stream=function(e){var s=n.rotate(),l=i(e),u=(n.rotate([0,0]),i(e));return n.rotate(s),l.sphere=function(){u.polygonStart(),u.lineStart();for(var e=0,n=360/t,i=2*d/t,s=90-180/t,l=f;e<t;++e,s-=n,l-=i)u.point(Math.atan2(a*Math.cos(l),o)*v,y(a*Math.sin(l))*v),s<-90?(u.point(-90,-180-s-r),u.point(-90,-180-s+r)):(u.point(90,s+r),u.point(90,s-r));u.lineEnd(),u.polygonEnd()},l},n}).raw=A;var j=I(d),D=L(Math.SQRT2/f,Math.SQRT2,d);function R(t,e){var n=2.00276,i=j(e);return[n*t/(1/Math.cos(e)+1.11072/Math.cos(i)),(e+Math.SQRT2*Math.sin(i))/n]}function F(t){var e=0,n=w(t),i=n(e);return i.parallel=function(t){return arguments.length?n(e=t*d/180):e/d*180},i}function B(t,e){return[t*Math.cos(e),e]}function N(t){if(!t)return B;var e=1/Math.tan(t);function n(n,i){var r=e+t-i,o=r?n*Math.cos(i)/r:r;return[r*Math.sin(o),e-r*Math.cos(o)]}return n.invert=function(n,i){var r=Math.sqrt(n*n+(i=e-i)*i),o=e+t-r;return[r/Math.cos(o)*Math.atan2(n,i),o]},n}(d3.geoMollweide=function(){return x(D)}).raw=D,R.invert=function(t,e){var n,i,r=2.00276,o=r*e,a=e<0?-d/4:d/4,s=25;do{i=o-Math.SQRT2*Math.sin(a),a-=n=(Math.sin(2*a)+2*a-d*Math.sin(i))/(2*Math.cos(2*a)+2+d*Math.cos(i)*Math.SQRT2*Math.cos(a))}while(Math.abs(n)>c&&--s>0);return i=o-Math.SQRT2*Math.sin(a),[t*(1/Math.cos(i)+1.11072/Math.cos(a))/r,i]},(d3.geoBoggs=function(){return x(R)}).raw=R,B.invert=function(t,e){return[t/Math.cos(e),e]},(d3.geoSinusoidal=function(){return x(B)}).raw=B,(d3.geoBonne=function(){return F(N).parallel(45)}).raw=N;var q=L(1,4/d,d);function V(t){for(var e,n=(t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]}))[2],i=0;i<3;++i,n=e)e=t[i],n.v=U(e[1]-n[1],n[3],n[2],e[3],e[2],e[0]-n[0]),n.point=[0,0];var r=H(t[0].v[0],t[2].v[0],t[1].v[0]),o=H(t[0].v[0],t[1].v[0],t[2].v[0]),a=d-r;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var s=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(r),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(r))];return function(e,n){for(var i=Math.sin(n),r=Math.cos(n),l=new Array(3),u=0;u<3;++u){var c=t[u];if(l[u]=U(n-c[1],c[3],c[2],r,i,e-c[0]),!l[u][0])return c.point;l[u][1]=W(l[u][1]-c.v[1])}var h=s.slice();for(u=0;u<3;++u){var d=2==u?0:u+1,f=H(t[u].v[0],l[u][0],l[d][0]);l[u][1]<0&&(f=-f),u?1==u?(f=o-f,h[0]-=l[u][0]*Math.cos(f),h[1]-=l[u][0]*Math.sin(f)):(f=a-f,h[0]+=l[u][0]*Math.cos(f),h[1]+=l[u][0]*Math.sin(f)):(h[0]+=l[u][0]*Math.cos(f),h[1]-=l[u][0]*Math.sin(f))}return h[0]/=3,h[1]/=3,h}}function U(t,e,n,i,r,o){var a,s=Math.cos(o);if(Math.abs(t)>1||Math.abs(o)>1)a=_(n*r+e*i*s);else{var l=Math.sin(.5*t),u=Math.sin(.5*o);a=2*y(Math.sqrt(l*l+e*i*u*u))}return Math.abs(a)>c?[a,Math.atan2(i*Math.sin(o),e*r-n*i*s)]:[0,0]}function H(t,e,n){return _(.5*(t*t+e*e-n*n)/(t*e))}function W(t){return t-2*d*Math.floor((t+d)/(2*d))}function K(t){return[t[0]*m,t[1]*m]}function Y(t,e){var n=b(1-Math.sin(e));return[2/p*t*n,p*(1-n)]}function G(t){var e=Math.tan(t);function n(t,n){return[t,(t?t/Math.sin(t):1)*(Math.sin(n)*Math.cos(t)-e*Math.cos(n))]}return n.invert=e?function(t,n){t&&(n*=Math.sin(t)/t);var i=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(i*i+e*e-n*n)-i,e-n)]}:function(t,e){return[t,y(t?e*Math.tan(t)/t:e)]},n}function X(t,e){var n=Math.sqrt(3);return[n*t*(2*Math.cos(2*e/3)-1)/p,n*p*Math.sin(e/3)]}function $(t){var e=Math.cos(t);function n(t,n){return[t*e,Math.sin(n)/e]}return n.invert=function(t,n){return[t/e,y(n*e)]},n}function Z(t){var e=Math.cos(t);function n(t,n){return[t*e,(1+e)*Math.tan(.5*n)]}return n.invert=function(t,n){return[t/e,2*Math.atan(n/(1+e))]},n}function Q(t,e){var n=Math.sqrt(8/(3*d));return[n*t*(1-Math.abs(e)/d),n*e]}function J(t,e){var n=Math.sqrt(4-3*Math.sin(Math.abs(e)));return[2/Math.sqrt(6*d)*t*n,g(e)*Math.sqrt(2*d/3)*(2-n)]}function tt(t,e){var n=Math.sqrt(d*(4+d));return[2/n*t*(1+Math.sqrt(1-4*e*e/(d*d))),4/n*e]}function et(t,e){var n=(2+f)*Math.sin(e);e/=2;for(var i=0,r=1/0;i<10&&Math.abs(r)>c;i++){var o=Math.cos(e);e-=r=(e+Math.sin(e)*(o+2)-n)/(2*o*(1+o))}return[2/Math.sqrt(d*(4+d))*t*(1+Math.cos(e)),2*Math.sqrt(d/(4+d))*Math.sin(e)]}function nt(t,e){return[t*(1+Math.cos(e))/Math.sqrt(2+d),2*e/Math.sqrt(2+d)]}function it(t,e){for(var n=(1+f)*Math.sin(e),i=0,r=1/0;i<10&&Math.abs(r)>c;i++)e-=r=(e+Math.sin(e)-n)/(1+Math.cos(e));return n=Math.sqrt(2+d),[t*(1+Math.cos(e))/n,2*e/n]}function rt(t,e){var n=Math.sin(t/=2),i=Math.cos(t),r=Math.sqrt(Math.cos(e)),o=Math.cos(e/=2),a=Math.sin(e)/(o+Math.SQRT2*i*r),s=Math.sqrt(2/(1+a*a)),l=Math.sqrt((Math.SQRT2*o+(i+n)*r)/(Math.SQRT2*o+(i-n)*r));return[ot*(s*(l-1/l)-2*Math.log(l)),ot*(s*a*(l+1/l)-2*Math.atan(a))]}(d3.geoBromley=function(){return x(q)}).raw=q,(d3.geoChamberlin=function(){var t=[[0,0],[0,0],[0,0]],e=w(V),n=e(t),i=n.rotate;return delete n.rotate,n.points=function(r){if(!arguments.length)return t;t=r;var o=d3.geoCentroid({type:"MultiPoint",coordinates:t}),a=[-o[0],-o[1]];return i.call(n,a),e(t.map(d3.geoRotation(a)).map(K))},n.points([[-150,55],[-35,55],[-92.5,10]])}).raw=V,Y.invert=function(t,e){var n=(n=e/p-1)*n;return[n>0?t*Math.sqrt(d/n)/2:0,y(1-n)]},(d3.geoCollignon=function(){return x(Y)}).raw=Y,(d3.geoCraig=function(){return F(G)}).raw=G,X.invert=function(t,e){var n=Math.sqrt(3),i=3*y(e/(n*p));return[p*t/(n*(2*Math.cos(2*i/3)-1)),i]},(d3.geoCraster=function(){return x(X)}).raw=X,(d3.geoCylindricalEqualArea=function(){return F($)}).raw=$,(d3.geoCylindricalStereographic=function(){return F(Z)}).raw=Z,Q.invert=function(t,e){var n=Math.sqrt(8/(3*d)),i=e/n;return[t/(n*(1-Math.abs(i)/d)),i]},(d3.geoEckert1=function(){return x(Q)}).raw=Q,J.invert=function(t,e){var n=2-Math.abs(e)/Math.sqrt(2*d/3);return[t*Math.sqrt(6*d)/(2*n),g(e)*y((4-n*n)/3)]},(d3.geoEckert2=function(){return x(J)}).raw=J,tt.invert=function(t,e){var n=Math.sqrt(d*(4+d))/2;return[t*n/(1+b(1-e*e*(4+d)/(4*d))),e*n/2]},(d3.geoEckert3=function(){return x(tt)}).raw=tt,et.invert=function(t,e){var n=.5*e*Math.sqrt((4+d)/d),i=y(n),r=Math.cos(i);return[t/(2/Math.sqrt(d*(4+d))*(1+r)),y((i+n*(r+2))/(2+f))]},(d3.geoEckert4=function(){return x(et)}).raw=et,nt.invert=function(t,e){var n=Math.sqrt(2+d),i=e*n/2;return[n*t/(1+Math.cos(i)),i]},(d3.geoEckert5=function(){return x(nt)}).raw=nt,it.invert=function(t,e){var n=1+f,i=Math.sqrt(n/2);return[2*t*i/(1+Math.cos(e*=i)),y((e+Math.sin(e))/n)]},(d3.geoEckert6=function(){return x(it)}).raw=it,rt.invert=function(t,e){var n=d3.geoAugust.raw.invert(t/1.2,1.065*e);if(!n)return null;var i=n[0],r=n[1],o=20;t/=ot,e/=ot;do{var a=i/2,s=r/2,l=Math.sin(a),u=Math.cos(a),h=Math.sin(s),d=Math.cos(s),p=Math.cos(r),m=Math.sqrt(p),v=h/(d+Math.SQRT2*u*m),g=v*v,y=Math.sqrt(2/(1+g)),_=(Math.SQRT2*d+(u+l)*m)/(Math.SQRT2*d+(u-l)*m),b=Math.sqrt(_),x=b-1/b,w=b+1/b,S=y*x-2*Math.log(b)-t,M=y*v*w-2*Math.atan(v)-e,E=h&&Math.SQRT1_2*m*l*g/h,z=(Math.SQRT2*u*d+m)/(2*(d+Math.SQRT2*u*m)*(d+Math.SQRT2*u*m)*m),k=-.5*v*y*y*y,T=k*E,O=k*z,P=(P=2*d+Math.SQRT2*m*(u-l))*P*b,C=(Math.SQRT2*u*d*m+p)/P,A=-Math.SQRT2*l*h/(m*P),I=x*T-2*C/b+y*(C+C/_),L=x*O-2*A/b+y*(A+A/_),j=v*w*T-2*E/(1+g)+y*w*E+y*v*(C-C/_),D=v*w*O-2*z/(1+g)+y*w*z+y*v*(A-A/_),R=L*j-D*I;if(!R)break;var F=(M*L-S*D)/R,B=(S*j-M*I)/R;i-=F,r=Math.max(-f,Math.min(f,r-B))}while((Math.abs(F)>c||Math.abs(B)>c)&&--o>0);return Math.abs(Math.abs(r)-f)<c?[0,r]:o&&[i,r]};var ot=3+2*Math.SQRT2;function at(t,e){var n=Math.tan(e/2);return[t*st*b(1-n*n),(1+st)*n]}(d3.geoEisenlohr=function(){return x(rt)}).raw=rt,at.invert=function(t,e){var n=e/(1+st);return[t?t/(st*b(1-n*n)):0,2*Math.atan(n)]};var st=Math.cos(35*m);function lt(t,e){var n=e/2,i=Math.cos(n);return[2*t/p*Math.cos(e)*i*i,p*Math.tan(n)]}(d3.geoFahey=function(){return x(at)}).raw=at,lt.invert=function(t,e){var n=Math.atan(e/p),i=Math.cos(n),r=2*n;return[t*p*.5/(Math.cos(r)*i*i),r]},(d3.geoFoucaut=function(){return x(lt)}).raw=lt,d3.geoGilbert=function(t){var e=d3.geoEquirectangular().scale(v).translate([0,0]);function n(e){return t([.5*e[0],y(Math.tan(.5*e[1]*m))*v])}return t.invert&&(n.invert=function(e){return(e=t.invert(e))[0]*=2,e[1]=2*Math.atan(Math.sin(e[1]*m))*v,e}),n.stream=function(n){n=t.stream(n);var i=e.stream({point:function(t,e){n.point(.5*t,y(Math.tan(.5*-e*m))*v)},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}});return i.sphere=function(){n.sphere()},i.valid=!1,i},n};var ut=d3.geoAzimuthalEquidistant.raw;function ct(t,e){var n=2*d/e,i=t*t;function r(e,r){var o=ut(e,r),a=o[0],s=o[1],l=a*a+s*s;if(l>i){var u=Math.sqrt(l),h=Math.atan2(s,a),p=n*Math.round(h/n),m=h-p,v=t*Math.cos(m),g=(t*Math.sin(m)-m*Math.sin(v))/(f-v),y=ht(m,g),_=(d-t)/dt(y,v,d);a=u;var b,x=50;do{a-=b=(t+dt(y,v,a)*_-u)/(y(a)*_)}while(Math.abs(b)>c&&--x>0);s=m*Math.sin(a),a<f&&(s-=g*(a-f));var w=Math.sin(p),S=Math.cos(p);o[0]=a*S-s*w,o[1]=a*w+s*S}return o}return r.invert=function(e,r){var o=e*e+r*r;if(o>i){var a=Math.sqrt(o),s=Math.atan2(r,e),l=n*Math.round(s/n),u=s-l;e=a*Math.cos(u);r=a*Math.sin(u);for(var c=e-f,p=Math.sin(e),m=r/p,v=e<f?1/0:0,g=10;;){var y=t*Math.sin(m),_=t*Math.cos(m),b=Math.sin(_),x=f-_,w=(y-m*b)/x,S=ht(m,w);if(Math.abs(v)<h||!--g)break;m-=v=(m*p-w*c-r)/(p-2*c*(x*(_+m*y*Math.cos(_)-b)-y*(y-m*b))/(x*x))}s=l+m,e=(a=t+dt(S,_,e)*(d-t)/dt(S,_,d))*Math.cos(s),r=a*Math.sin(s)}return ut.invert(e,r)},r}function ht(t,e){return function(n){var i=t*Math.cos(n);return n<f&&(i-=e),Math.sqrt(1+i*i)}}function dt(t,e,n){for(var i=(n-e)/50,r=t(e)+t(n),o=1,a=e;o<50;++o)r+=2*t(a+=i);return.5*r*i}function ft(t,e,n,i,r,o,a,s){function l(l,u){if(!u)return[t*l/d,0];var c=u*u,h=t+c*(e+c*(n+c*i)),f=u*(r-1+c*(o-s+c*a)),p=(h*h+f*f)/(2*f),m=l*Math.asin(h/p)/d;return[p*Math.sin(m),u*(1+c*s)+p*(1-Math.cos(m))]}return arguments.length<8&&(s=0),l.invert=function(l,u){var h,f,p=d*l/t,m=u,v=50;do{var g=m*m,y=t+g*(e+g*(n+g*i)),_=m*(r-1+g*(o-s+g*a)),x=y*y+_*_,w=2*_,S=x/w,M=S*S,E=Math.asin(y/S)/d,z=p*E;if(xB2=y*y,dxBdφ=(2*e+g*(4*n+6*g*i))*m,dyBdφ=r+g*(3*o+5*g*a),dpdφ=2*(y*dxBdφ+_*(dyBdφ-1)),dqdφ=2*(dyBdφ-1),dmdφ=(dpdφ*w-x*dqdφ)/(w*w),cosα=Math.cos(z),sinα=Math.sin(z),mcosα=S*cosα,msinα=S*sinα,dαdφ=p/d*(1/b(1-xB2/M))*(dxBdφ*S-y*dmdφ)/M,fx=msinα-l,fy=m*(1+g*s)+S-mcosα-u,δxδφ=dmdφ*sinα+mcosα*dαdφ,δxδλ=mcosα*E,δyδφ=1+dmdφ-(dmdφ*cosα-msinα*dαdφ),δyδλ=msinα*E,denominator=δxδφ*δyδλ-δyδφ*δxδλ,!denominator)break;p-=h=(fy*δxδφ-fx*δyδφ)/denominator,m-=f=(fx*δyδλ-fy*δxδλ)/denominator}while((Math.abs(h)>c||Math.abs(f)>c)&&--v>0);return[p,m]},l}(d3.geoGingery=function(){var t=6,e=30*m,n=Math.cos(e),i=Math.sin(e),r=w(ct),o=r(e,t),a=o.stream,s=-Math.cos(.01*m),l=Math.sin(.01*m);return o.radius=function(o){return arguments.length?(n=Math.cos(e=o*m),i=Math.sin(e),r(e,t)):e*v},o.lobes=function(n){return arguments.length?r(e,t=+n):t},o.stream=function(e){var r=o.rotate(),u=a(e),c=(o.rotate([0,0]),a(e));return o.rotate(r),u.sphere=function(){c.polygonStart(),c.lineStart();for(var e=0,r=2*d/t,o=0;e<t;++e,o-=r)c.point(Math.atan2(l*Math.cos(o),s)*v,Math.asin(l*Math.sin(o))*v),c.point(Math.atan2(i*Math.cos(o-r/2),n)*v,Math.asin(i*Math.sin(o-r/2))*v);c.lineEnd(),c.polygonEnd()},u},o}).raw=ct;var pt=ft(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geoGinzburg4=function(){return x(pt)}).raw=pt;var mt=ft(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geoGinzburg5=function(){return x(mt)}).raw=mt;var vt=ft(5/6*d,-.62636,-.0344,0,1.3493,-.05524,0,.045);function gt(t,e){var n=t*t,i=e*e;return[t*(1-.162388*i)*(.87-952426e-9*n*n),e*(1+i/12)]}(d3.geoGinzburg6=function(){return x(vt)}).raw=vt,gt.invert=function(t,e){var n,i=t,r=e,o=50;do{var a=r*r;r-=n=(r*(1+a/12)-e)/(1+a/4)}while(Math.abs(n)>c&&--o>0);o=50,t/=1-.162388*a;do{var s=(s=i*i)*s;i-=n=(i*(.87-952426e-9*s)-t)/(.87-.00476213*s)}while(Math.abs(n)>c&&--o>0);return[i,r]},(d3.geoGinzburg8=function(){return x(gt)}).raw=gt;var yt=ft(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);function _t(t){var e=t(f,0)[0]-t(-f,0)[0];function n(){var t=!1,e=w(i),n=e(t);return n.quincuncial=function(n){return arguments.length?e(t=!!n):t},n}function i(n){var i=n?function(n,i){var r=Math.abs(n)<f,o=t(r?n:n>0?n-d:n+d,i),a=(o[0]-o[1])*Math.SQRT1_2,s=(o[0]+o[1])*Math.SQRT1_2;if(r)return[a,s];var l=e*Math.SQRT1_2,u=a>0^s>0?-1:1;return[u*a-g(s)*l,u*s-g(a)*l]}:function(n,i){var r=n>0?-.5:.5,o=t(n+r*d,i);return o[0]-=r*e,o};return t.invert&&(i.invert=n?function(n,i){var r=(n+i)*Math.SQRT1_2,o=(i-n)*Math.SQRT1_2,a=Math.abs(r)<.5*e&&Math.abs(o)<.5*e;if(!a){var s=e*Math.SQRT1_2,l=r>0^o>0?-1:1,u=-l*(n+(o>0?1:-1)*s),c=-l*(i+(r>0?1:-1)*s);r=(-u-c)*Math.SQRT1_2,o=(u-c)*Math.SQRT1_2}var h=t.invert(r,o);return a||(h[0]+=r>0?d:-d),h}:function(n,i){var r=n>0?-.5:.5,o=t.invert(n+r*e,i),a=o[0]-r*d;return a<-d?a+=2*d:a>d&&(a-=2*d),o[0]=a,o}),i}return n.raw=i,n}function bt(t,e){var n=g(t),i=g(e),r=Math.cos(e),o=Math.cos(t)*r,a=Math.sin(t)*r,s=Math.sin(i*e);t=Math.abs(Math.atan2(a,s)),e=y(o),Math.abs(t-f)>c&&(t%=f);var l=function(t,e){if(e===f)return[0,0];var n=Math.sin(e),i=n*n,r=i*i,o=1+r,a=1+3*r,s=1-r,l=y(1/Math.sqrt(o)),u=s+i*o*l,h=(1-n)/u,p=Math.sqrt(h),m=h*o,v=Math.sqrt(m),g=p*s;if(0===t)return[0,-(g+i*v)];var _=Math.cos(e),x=1/_,w=2*n*_,S=(-u*_-(-3*i+l*a)*w*(1-n))/(u*u),M=-x*w,E=-x*(i*o*S+h*a*w),z=-2*x*(s*(.5*S/p)-2*i*p*w),k=4*t/d;if(t>.222*d||e<d/4&&t>.175*d){var T=(g+i*b(m*(1+r)-g*g))/(1+r);if(t>d/4)return[T,T];var O=T,P=.5*T,C=50;T=.5*(P+O);do{var A=Math.sqrt(m-T*T),I=T*(z+M*A)+E*y(T/v)-k;if(!I)break;I<0?P=T:O=T,T=.5*(P+O)}while(Math.abs(O-P)>c&&--C>0)}else{var L,T=c,C=25;do{var j=T*T,A=b(m-j),D=z+M*A,I=T*D+E*y(T/v)-k,R=D+(E-M*j)/A;T-=L=A?I/R:0}while(Math.abs(L)>c&&--C>0)}return[T,-g-i*b(m-T*T)]}(t>d/4?f-t:t,e);return t>d/4&&(s=l[0],l[0]=-l[1],l[1]=-s),l[0]*=n,l[1]*=-i,l}function xt(t,e){var n,i,r,o,a,s;if(e<c)return[(o=Math.sin(t))-(n=.25*e*(t-o*(i=Math.cos(t))))*i,i+n*o,1-.5*e*o*o,t-n];if(e>=1-c)return n=.25*(1-e),i=k(t),s=t,r=1/i,[(o=((s=Math.exp(2*s))-1)/(s+1))+n*((a=i*z(t))-t)/(i*i),r-n*o*r*(a-t),r+n*o*r*(a+t),2*Math.atan(Math.exp(t))-f+n*(a-t)/i];var l=[1,0,0,0,0,0,0,0,0],u=[Math.sqrt(e),0,0,0,0,0,0,0,0],h=0;for(i=Math.sqrt(1-e),a=1;Math.abs(u[h]/l[h])>c&&h<8;)n=l[h++],u[h]=.5*(n-i),l[h]=.5*(n+i),i=b(n*i),a*=2;r=a*l[h]*t;do{r=.5*(y(o=u[h]*Math.sin(i=r)/l[h])+r)}while(--h);return[Math.sin(r),o=Math.cos(r),o/Math.cos(r-i),r]}function wt(t,e){if(!e)return t;if(1===e)return Math.log(Math.tan(t/2+d/4));for(var n=1,i=Math.sqrt(1-e),r=Math.sqrt(e),o=0;Math.abs(r)>c;o++){if(t%d){var a=Math.atan(i*Math.tan(t)/n);a<0&&(a+=d),t+=a+~~(t/d)*d}else t+=t;r=(n+i)/2,i=Math.sqrt(n*i),r=((n=r)-i)/2}return t/(Math.pow(2,o)*n)}function St(t,e){var n=(Math.SQRT2-1)/(Math.SQRT2+1),i=Math.sqrt(1-n*n),r=wt(f,i*i),o=Math.log(Math.tan(d/4+Math.abs(e)/2)),a=Math.exp(-1*o)/Math.sqrt(n),s=function(t,e){var n=t*t,i=e+1,r=1-n-e*e;return[.5*((t>=0?f:-f)-Math.atan2(r,2*t)),-.25*Math.log(r*r+4*n)+.5*Math.log(i*i+n)]}(a*Math.cos(-1*t),a*Math.sin(-1*t)),l=function(t,e,n){var i=Math.abs(t),r=z(Math.abs(e));if(i){var o=1/Math.sin(i),a=1/(Math.tan(i)*Math.tan(i)),s=-(a+n*r*r*o*o-1+n),l=(n-1)*a,u=.5*(-s+Math.sqrt(s*s-4*l));return[wt(Math.atan(1/Math.sqrt(u)),n)*g(t),wt(Math.atan(b((u/a-1)/n)),1-n)*g(e)]}return[0,wt(Math.atan(r),1-n)*g(e)]}(s[0],s[1],i*i);return[-l[1],(e>=0?1:-1)*(.5*r-l[0])]}function Mt(t){var e=Math.sin(t),n=Math.cos(t),i=Et(t);function r(t,r){var o=i(t,r);t=o[0],r=o[1];var a=Math.sin(r),s=Math.cos(r),l=Math.cos(t),u=_(e*a+n*s*l),h=Math.sin(u),d=Math.abs(h)>c?u/h:1;return[d*n*Math.sin(t),(Math.abs(t)>f?d:-d)*(e*s-n*a*l)]}return i.invert=Et(-t),r.invert=function(t,n){var r=Math.sqrt(t*t+n*n),o=-Math.sin(r),a=Math.cos(r),s=r*a,l=-n*o,u=r*e,c=b(s*s+l*l-u*u),h=Math.atan2(s*u+l*c,l*u-s*c),d=(r>f?-1:1)*Math.atan2(t*o,r*Math.cos(h)*a+n*Math.sin(h)*o);return i.invert(d,h)},r}function Et(t){var e=Math.sin(t),n=Math.cos(t);return function(t,i){var r=Math.cos(i),o=Math.cos(t)*r,a=Math.sin(t)*r,s=Math.sin(i);return[Math.atan2(a,o*n-s*e),y(s*n+o*e)]}}(d3.geoGinzburg9=function(){return x(yt)}).raw=yt,bt.invert=function(t,e){var n=g(t),i=g(e),r=-n*t,o=-i*e,a=o/r<1,s=function(t,e){var n=0,i=1,r=.5,o=50;for(;;){var a=r*r,s=Math.sqrt(r),l=Math.asin(1/Math.sqrt(1+a)),u=1-a+r*(1+a)*l,c=(1-s)/u,f=Math.sqrt(c),p=c*(1+a),m=f*(1-a),v=p-t*t,g=Math.sqrt(v),y=e+m+r*g;if(Math.abs(i-n)<h||0==--o||0===y)break;y>0?n=r:i=r,r=.5*(n+i)}if(!o)return null;var _=Math.asin(s),b=Math.cos(_),x=1/b,w=2*s*b,S=(-u*b-(-3*r+l*(1+3*a))*w*(1-s))/(u*u);return[d/4*(t*(-2*x*(.5*S/f*(1-a)-2*r*f*w)+-x*w*g)+-x*(r*(1+a)*S+c*(1+3*a)*w)*Math.asin(t/Math.sqrt(p))),_]}(a?o:r,a?r:o),l=s[0],u=s[1];a&&(l=-f-l);var c=Math.cos(u),p=(t=Math.cos(l)*c,e=Math.sin(l)*c,Math.sin(u));return[n*(Math.atan2(e,-p)+d),i*y(t)]},d3.geoGringorten=_t(bt),St.invert=function(t,e){var n,i,r,o=(Math.SQRT2-1)/(Math.SQRT2+1),a=Math.sqrt(1-o*o),s=function(t,e,n){if(!t)return[[0,(r=xt(e,1-n))[0]/r[1]],[1/r[1],0],[r[2]/r[1],0]];var i=xt(t,n);if(!e)return[[i[0],0],[i[1],0],[i[2],0]];var r,o=(r=xt(e,1-n))[1]*r[1]+n*i[0]*i[0]*r[0]*r[0];return[[i[0]*r[2]/o,i[1]*i[2]*r[0]*r[1]/o],[i[1]*r[1]/o,-i[0]*i[2]*r[0]*r[2]/o],[i[2]*r[1]*r[2]/o,-n*i[0]*i[1]*r[0]/o]]}(.5*wt(f,a*a)-e,-t,a*a),l=(n=s[0],i=s[1],r=i[0]*i[0]+i[1]*i[1],[(n[0]*i[0]+n[1]*i[1])/r,(n[1]*i[0]-n[0]*i[1])/r]);return[Math.atan2(l[1],l[0])/-1,2*Math.atan(Math.exp(-.5*Math.log(o*l[0]*l[0]+o*l[1]*l[1])))-f]},d3.geoGuyou=_t(St),(d3.geoHammerRetroazimuthal=function(){var t=0,e=w(Mt),n=e(t),i=n.rotate,r=n.stream,o=d3.geoCircle();return n.parallel=function(i){if(!arguments.length)return t/d*180;var r=n.rotate();return e(t=i*d/180).rotate(r)},n.rotate=function(e){return arguments.length?(i.call(n,[e[0],e[1]-t/d*180]),o.center([-e[0],-e[1]]),n):((e=i.call(n))[1]+=t/d*180,e)},n.stream=function(t){return(t=r(t)).sphere=function(){t.polygonStart();var e,n=o.radius(89.99)().coordinates[0],i=n.length-1,r=-1;for(t.lineStart();++r<i;)t.point((e=n[r])[0],e[1]);for(t.lineEnd(),i=(n=o.radius(90.01)().coordinates[0]).length-1,t.lineStart();--r>=0;)t.point((e=n[r])[0],e[1]);t.lineEnd(),t.polygonEnd()},t},n}).raw=Mt;var zt=d3.geoAzimuthalEqualArea.raw;function kt(t,e){if(arguments.length<2&&(e=t),1===e)return zt;if(e===1/0)return Tt;function n(n,i){var r=zt(n/e,i);return r[0]*=t,r}return n.invert=function(n,i){var r=zt.invert(n/t,i);return r[0]*=e,r},n}function Tt(t,e){return[t*Math.cos(e)/Math.cos(e/=2),2*Math.sin(e)]}function Ot(t,e){for(var n,i=Math.sin(e)*(e<0?2.43763:2.67595),r=0;r<20&&(e-=n=(e+Math.sin(e)-i)/(1+Math.cos(e)),!(Math.abs(n)<c));r++);return[.85*t*Math.cos(e*=.5),Math.sin(e)*(e<0?1.93052:1.75859)]}Tt.invert=function(t,e){var n=2*y(e/2);return[t*Math.cos(n/2)/Math.cos(n),n]},(d3.geoHammer=function(){var t=2,e=w(kt),n=e(t);return n.coefficient=function(n){return arguments.length?e(t=+n):t},n}).raw=kt,Ot.invert=function(t,e){var n=Math.abs(n=e*(e<0?.5179951515653813:.5686373742600607))>1-c?n>0?f:-f:y(n);return[1.1764705882352942*t/Math.cos(n),Math.abs(n=((n+=n)+Math.sin(n))*(e<0?.4102345310814193:.3736990601468637))>1-c?n>0?f:-f:y(n)]},(d3.geoHatano=function(){return x(Ot)}).raw=Ot;var Pt=41+48/36+37/3600;function Ct(t){var e=d3.geoCylindricalEqualArea.raw(0),n=Pt*d/180,i=2*d,r=d3.geoCollignon.raw(d,n)[0]-d3.geoCollignon.raw(-d,n)[0],o=e(0,n)[1],a=d3.geoCollignon.raw(0,n)[1],s=d3.geoCollignon.raw(0,f)[1]-a,l=2*d/t;function u(u,c){var h,f=Math.abs(c);if(f>n){var p=Math.min(t-1,Math.max(0,Math.floor((u+d)/l)));u+=d*(t-1)/t-p*l,(h=d3.geoCollignon.raw(u,f))[0]=h[0]*i/r-i*(t-1)/(2*t)+p*i/t,h[1]=o+4*(h[1]-a)*s/i,c<0&&(h[1]=-h[1])}else h=e(u,c);return h[0]/=2,h}return u.invert=function(n,u){n*=2;var c=Math.abs(u);if(c>o){var h=Math.min(t-1,Math.max(0,Math.floor((n+d)/l)));n=(n+d*(t-1)/t-h*l)*r/i;var f=d3.geoCollignon.raw.invert(n,.25*(c-o)*i/s+a);return f[0]-=d*(t-1)/t-h*l,u<0&&(f[1]=-f[1]),f}return e.invert(n,u)},u}function At(t){var e,n=1+t,i=y(Math.sin(1/n)),r=2*Math.sqrt(d/(e=d+4*i*n)),o=.5*r*(n+Math.sqrt(t*(2+t))),a=t*t,s=n*n;function l(l,u){var c,p,m=1-Math.sin(u);if(m&&m<2){var v,g=f-u,y=25;do{var _=Math.sin(g),b=Math.cos(g),x=i+Math.atan2(_,n-b),w=1+s-2*n*b;g-=v=(g-a*i-n*_+w*x-.5*m*e)/(2*n*_*x)}while(Math.abs(v)>h&&--y>0);c=r*Math.sqrt(w),p=l*x/d}else c=r*(t+m),p=l*i/d;return[c*Math.sin(p),o-c*Math.cos(p)]}return l.invert=function(t,l){var u=t*t+(l-=o)*l,c=(1+s-u/(r*r))/(2*n),h=_(c),f=Math.sin(h),p=i+Math.atan2(f,n-c);return[y(t/Math.sqrt(u))*d/p,y(1-2*(h-a*i-n*f+(1+s-2*n*c)*p)/e)]},l}(d3.geoHealpix=function(){var t=2,e=w(Ct),n=e(t),i=n.stream;return n.lobes=function(n){return arguments.length?e(t=+n):t},n.stream=function(e){var r=n.rotate(),o=i(e),a=(n.rotate([0,0]),i(e));return n.rotate(r),o.sphere=function(){var e;d3.geoStream((e=180/t,{type:"Polygon",coordinates:[d3.range(-180,180+e/2,e).map(function(t,e){return[t,1&e?90-1e-6:Pt]}).concat(d3.range(180,-180-e/2,-e).map(function(t,e){return[t,1&e?1e-6-90:-Pt]}))]}),a)},o},n}).raw=Ct,(d3.geoHill=function(){var t=1,e=w(At),n=e(t);return n.ratio=function(n){return arguments.length?e(t=+n):t},n}).raw=At;var It=.7109889596207567,Lt=.0528035274542;function jt(t,e){return e>-It?((t=D(t,e))[1]+=Lt,t):B(t,e)}function Dt(t,e){return Math.abs(e)>It?((t=D(t,e))[1]-=e>0?Lt:-Lt,t):B(t,e)}function Rt(t,e){return[3*t/(2*d)*Math.sqrt(d*d/3-e*e),e]}function Ft(t){function e(e,n){if(Math.abs(Math.abs(n)-f)<c)return[0,n<0?-2:2];var i=Math.sin(n),r=Math.pow((1+i)/(1-i),t/2),o=.5*(r+1/r)+Math.cos(e*=t);return[2*Math.sin(e)/o,(r-1/r)/o]}return e.invert=function(e,n){var i=Math.abs(n);if(Math.abs(i-2)<c)return e?null:[0,g(n)*f];if(i>2)return null;var r=(e/=2)*e,o=(n/=2)*n,a=2*n/(1+r+o);return a=Math.pow((1+a)/(1-a),1/t),[Math.atan2(2*e,1-r-o)/t,y((a-1)/(a+1))]},e}function Bt(t,e){return[t*(1+Math.sqrt(Math.cos(e)))/2,e/(Math.cos(e/2)*Math.cos(t/6))]}function Nt(t,e){var n=t*t,i=e*e;return[t*(.975534+i*(-.0143059*n-.119161+-.0547009*i)),e*(1.00384+n*(.0802894+-.02855*i+199025e-9*n)+i*(.0998909+-.0491032*i))]}function qt(t,e){return[Math.sin(t)/Math.cos(e),Math.tan(e)*Math.cos(t)]}function Vt(t){var e=Math.cos(t),n=Math.tan(d/4+t/2);function i(i,r){var o=r-t,a=Math.abs(o)<c?i*e:Math.abs(a=d/4+r/2)<c||Math.abs(Math.abs(a)-f)<c?0:i*o/Math.log(Math.tan(a)/n);return[a,o]}return i.invert=function(i,r){var o,a=r+t;return[Math.abs(r)<c?i/e:Math.abs(o=d/4+a/2)<c||Math.abs(Math.abs(o)-f)<c?0:i*Math.log(Math.tan(o)/n)/r,a]},i}function Ut(t,e){return[t,1.25*Math.log(Math.tan(d/4+.4*e))]}function Ht(t){var e=t.length-1;function n(n,i){for(var r,o=Math.cos(i),a=2/(1+o*Math.cos(n)),s=a*o*Math.sin(n),l=a*Math.sin(i),u=e,c=t[u],h=c[0],d=c[1];--u>=0;)h=(c=t[u])[0]+s*(r=h)-l*d,d=c[1]+s*d+l*r;return[h=s*(r=h)-l*d,d=s*d+l*r]}return n.invert=function(n,i){var r=20,o=n,a=i;do{for(var s,l=e,u=t[l],h=u[0],d=u[1],f=0,p=0;--l>=0;)u=t[l],f=h+o*(s=f)-a*p,p=d+o*p+a*s,h=u[0]+o*(s=h)-a*d,d=u[1]+o*d+a*s;var m,v,g=(f=h+o*(s=f)-a*p)*f+(p=d+o*p+a*s)*p;o-=m=((h=o*(s=h)-a*d-n)*f+(d=o*d+a*s-i)*p)/g,a-=v=(d*f-h*p)/g}while(Math.abs(m)+Math.abs(v)>c*c&&--r>0);if(r){var _=Math.sqrt(o*o+a*a),b=2*Math.atan(.5*_),x=Math.sin(b);return[Math.atan2(o*x,_*Math.cos(b)),_?y(a*x/_):0]}},n}jt.invert=function(t,e){return e>-It?D.invert(t,e-Lt):B.invert(t,e)},(d3.geoSinuMollweide=function(){return x(jt).rotate([-20,-55])}).raw=jt,Dt.invert=function(t,e){return Math.abs(e)>It?D.invert(t,e+(e>0?Lt:-Lt)):B.invert(t,e)},(d3.geoHomolosine=function(){return x(Dt)}).raw=Dt,Rt.invert=function(t,e){return[2/3*d*t/Math.sqrt(d*d/3-e*e),e]},(d3.geoKavrayskiy7=function(){return x(Rt)}).raw=Rt,(d3.geoLagrange=function(){var t=.5,e=w(Ft),n=e(t);return n.spacing=function(n){return arguments.length?e(t=+n):t},n}).raw=Ft,Bt.invert=function(t,e){var n=Math.abs(t),i=Math.abs(e),r=d/Math.SQRT2,o=c,a=f;i<r?a*=i/r:o+=6*_(r/i);for(var s=0;s<25;s++){var l=Math.sin(a),u=b(Math.cos(a)),h=Math.sin(a/2),p=Math.cos(a/2),m=Math.sin(o/6),v=Math.cos(o/6),g=.5*o*(1+u)-n,y=a/(p*v)-i,x=u?-.25*o*l/u:0,w=.5*(1+u),S=(1+.5*a*h/p)/(p*v),M=a/p*(m/6)/(v*v),E=x*M-S*w,z=(g*M-y*w)/E,k=(y*x-g*S)/E;if(a-=z,o-=k,Math.abs(z)<c&&Math.abs(k)<c)break}return[t<0?-o:o,e<0?-a:a]},(d3.geoLarrivee=function(){return x(Bt)}).raw=Bt,Nt.invert=function(t,e){var n=g(t)*d,i=e/2,r=50;do{var o=n*n,a=i*i,s=n*i,l=n*(.975534+a*(-.0143059*o-.119161+-.0547009*a))-t,u=i*(1.00384+o*(.0802894+-.02855*a+199025e-9*o)+a*(.0998909+-.0491032*a))-e,h=.975534-a*(.119161+3*o*.0143059+.0547009*a),f=-s*(.238322+.2188036*a+.0286118*o),p=s*(.1605788+7961e-7*o+-.0571*a),m=1.00384+o*(.0802894+199025e-9*o)+a*(3*(.0998909-.02855*o)-.245516*a),v=f*p-m*h,y=(u*f-l*m)/v,_=(l*p-u*h)/v;n-=y,i-=_}while((Math.abs(y)>c||Math.abs(_)>c)&&--r>0);return r&&[n,i]},(d3.geoLaskowski=function(){return x(Nt)}).raw=Nt,qt.invert=function(t,e){var n=t*t,i=e*e,r=i+1,o=t?Math.SQRT1_2*Math.sqrt((r-Math.sqrt(n*n+2*n*(i-1)+r*r))/n+1):1/Math.sqrt(r);return[y(t*o),g(e)*_(o)]},(d3.geoLittrow=function(){return x(qt)}).raw=qt,(d3.geoLoximuthal=function(){return F(Vt).parallel(40)}).raw=Vt,Ut.invert=function(t,e){return[t,2.5*Math.atan(Math.exp(.8*e))-.625*d]},(d3.geoMiller=function(){return x(Ut)}).raw=Ut;var Wt={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};function Kt(t,e){var n=Math.sqrt(6),i=Math.sqrt(7),r=Math.asin(7*Math.sin(e)/(3*n));return[n*t*(2*Math.cos(2*r/3)-1)/i,9*Math.sin(r/3)/i]}function Yt(t,e){for(var n,i=(1+Math.SQRT1_2)*Math.sin(e),r=e,o=0;o<25&&(r-=n=(Math.sin(r/2)+Math.sin(r)-i)/(.5*Math.cos(r/2)+Math.cos(r)),!(Math.abs(n)<c));o++);return[t*(1+2*Math.cos(r)/Math.cos(r/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(r/2)/Math.sqrt(2+Math.SQRT2)]}function Gt(t,e){for(var n,i=Math.sqrt(6/(4+d)),r=(1+d/4)*Math.sin(e),o=e/2,a=0;a<25&&(o-=n=(o/2+Math.sin(o)-r)/(.5+Math.cos(o)),!(Math.abs(n)<c));a++);return[i*(.5+Math.cos(o))*t/1.5,i*o]}function Xt(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),e*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}function $t(t,e){return[t*(1+Math.cos(e))/2,2*(e-Math.tan(e/2))]}(d3.geoModifiedStereographic=function(){var t=Wt.miller,e=w(Ht),n=e(t);return n.coefficients=function(n){return arguments.length?e(t="string"==typeof n?Wt[n]:n):t},n}).raw=Ht,Kt.invert=function(t,e){var n=Math.sqrt(6),i=Math.sqrt(7),r=3*y(e*i/9);return[t*i/(n*(2*Math.cos(2*r/3)-1)),y(3*Math.sin(r)*n/7)]},(d3.geoMtFlatPolarParabolic=function(){return x(Kt)}).raw=Kt,Yt.invert=function(t,e){var n=e*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),i=2*y(n);return[3*Math.SQRT2*t/(1+2*Math.cos(i)/Math.cos(i/2)),y((n+Math.sin(i))/(1+Math.SQRT1_2))]},(d3.geoMtFlatPolarQuartic=function(){return x(Yt)}).raw=Yt,Gt.invert=function(t,e){var n=Math.sqrt(6/(4+d)),i=e/n;return Math.abs(Math.abs(i)-f)<c&&(i=i<0?-f:f),[1.5*t/(n*(.5+Math.cos(i))),y((i/2+Math.sin(i))/(1+d/4))]},(d3.geoMtFlatPolarSinusoidal=function(){return x(Gt)}).raw=Gt,Xt.invert=function(t,e){var n,i=e,r=25;do{var o=i*i,a=o*o;i-=n=(i*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-e)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while(Math.abs(n)>c&&--r>0);return[t/(.8707+(o=i*i)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),i]},(d3.geoNaturalEarth=function(){return x(Xt)}).raw=Xt,$t.invert=function(t,e){for(var n=e/2,i=0,r=1/0;i<10&&Math.abs(r)>c;i++){var o=Math.cos(e/2);e-=r=(e-Math.tan(e/2)-n)/(1-.5/(o*o))}return[2*t/(1+Math.cos(e)),e]},(d3.geoNellHammer=function(){return x($t)}).raw=$t;var Zt=1.0148,Qt=.23185,Jt=-.14499,te=.02406,ee=Zt,ne=5*Qt,ie=7*Jt,re=9*te;function oe(t,e){var n=e*e;return[t,e*(Zt+n*n*(Qt+n*(Jt+te*n)))]}oe.invert=function(t,e){e>1.790857183?e=1.790857183:e<-1.790857183&&(e=-1.790857183);var n,i=e;do{var r=i*i;i-=n=(i*(Zt+r*r*(Qt+r*(Jt+te*r)))-e)/(ee+r*r*(ne+r*(ie+re*r)))}while(Math.abs(n)>c);return[t,i]},(d3.geoPatterson=function(){return x(oe)}).raw=oe;var ae=_t(St);function se(t,e){if(Math.abs(e)<c)return[t,0];var n=Math.tan(e),i=t*Math.sin(e);return[Math.sin(i)/n,e+(1-Math.cos(i))/n]}function le(t){var e=Math.sin(t);function n(n,i){var r=e?Math.tan(n*e/2)/e:n/2;if(!i)return[2*r,-t];var o=2*Math.atan(r*Math.sin(i)),a=1/Math.tan(i);return[Math.sin(o)*a,i+(1-Math.cos(o))*a-t]}return n.invert=function(n,i){if(Math.abs(i+=t)<c)return[e?2*Math.atan(e*n/2)/e:n,0];var r,o=n*n+i*i,a=0,s=10;do{var l=Math.tan(a),u=1/Math.cos(a),h=o-2*i*a+a*a;a-=r=(l*h+2*(a-i))/(2+h*u*u+2*(a-i)*l)}while(Math.abs(r)>c&&--s>0);var f=n*(l=Math.tan(a)),p=Math.tan(Math.abs(i)<Math.abs(a+1/l)?.5*y(f):.5*_(f)+d/4)/Math.sin(a);return[e?2*Math.atan(e*p)/e:2*p,a]},n}(d3.geoPeirceQuincuncial=function(){return ae().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=ae.raw,se.invert=function(t,e){if(Math.abs(e)<c)return[t,0];var n,i=t*t+e*e,r=.5*e,o=10;do{var a=Math.tan(r),s=1/Math.cos(r),l=i-2*e*r+r*r;r-=n=(a*l+2*(r-e))/(2+l*s*s+2*(r-e)*a)}while(Math.abs(n)>c&&--o>0);return a=Math.tan(r),[(Math.abs(e)<Math.abs(r+1/a)?y(t*a):g(t)*(_(Math.abs(t*a))+f))/Math.sin(r),r]},(d3.geoPolyconic=function(){return x(se)}).raw=se,(d3.geoRectangularPolyconic=function(){return F(le)}).raw=le;var ue=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];function ce(t,e){var n,i=Math.min(18,36*Math.abs(e)/d),r=Math.floor(i),o=i-r,a=(n=ue[r])[0],s=n[1],l=(n=ue[++r])[0],u=n[1],c=(n=ue[Math.min(19,++r)])[0],h=n[1];return[t*(l+o*(c-a)/2+o*o*(c-2*l+a)/2),(e>0?f:-f)*(u+o*(h-s)/2+o*o*(h-2*u+s)/2)]}function he(t,e){var n=function(t){function e(e,n){var i=Math.cos(n),r=(t-1)/(t-i*Math.cos(e));return[r*i*Math.sin(e),r*Math.sin(n)]}return e.invert=function(e,n){var i=e*e+n*n,r=Math.sqrt(i),o=(t-Math.sqrt(1-i*(t+1)/(t-1)))/((t-1)/r+r/(t-1));return[Math.atan2(e*o,r*Math.sqrt(1-o*o)),r?y(n*o/r):0]},e}(t);if(!e)return n;var i=Math.cos(e),r=Math.sin(e);function o(e,o){var a=n(e,o),s=a[1],l=s*r/(t-1)+i;return[a[0]*i/l,s/l]}return o.invert=function(e,o){var a=(t-1)/(t-1-o*r);return n.invert(a*e,a*o*i)},o}function de(t,e){var n=Math.tan(e/2),i=Math.sin(d/4*n);return[t*(.74482-.34588*i*i),1.70711*n]}function fe(t){if(!t)return d3.geoAzimuthalEquidistant.raw;var e=-t/2,n=-e,i=t*t,r=Math.tan(n),o=.5/Math.sin(n);function a(r,o){var a=_(Math.cos(o)*Math.cos(r-e)),s=_(Math.cos(o)*Math.cos(r-n));return[((a*=a)-(s*=s))/(2*t),(o<0?-1:1)*b(4*i*s-(i-a+s)*(i-a+s))/(2*t)]}return a.invert=function(t,i){var a,s,l=i*i,u=Math.cos(Math.sqrt(l+(a=t+e)*a)),c=Math.cos(Math.sqrt(l+(a=t+n)*a));return[Math.atan2(s=u-c,a=(u+c)*r),(i<0?-1:1)*_(Math.sqrt(a*a+s*s)*o)]},a}function pe(t){var e=Math.cos(t);function n(t,n){var i=d3.geoGnomonic.raw(t,n);return i[0]*=e,i}return n.invert=function(t,n){return d3.geoGnomonic.raw.invert(t/e,n)},n}function me(t,e){if(Math.abs(e)<c)return[t,0];var n=Math.abs(e/f),i=y(n);if(Math.abs(t)<c||Math.abs(Math.abs(e)-f)<c)return[0,g(e)*d*Math.tan(i/2)];var r=Math.cos(i),o=Math.abs(d/t-t/d)/2,a=o*o,s=r/(n+r-1),l=s*(2/n-1),u=l*l,h=u+a,p=s-u,m=a+s;return[g(t)*d*(o*p+Math.sqrt(a*p*p-h*(s*s-u)))/h,g(e)*d*(l*m-o*Math.sqrt((a+1)*h-m*m))/h]}function ve(t,e){if(Math.abs(e)<c)return[t,0];var n=Math.abs(e/f),i=y(n);if(Math.abs(t)<c||Math.abs(Math.abs(e)-f)<c)return[0,g(e)*d*Math.tan(i/2)];var r=Math.cos(i),o=Math.abs(d/t-t/d)/2,a=o*o,s=r*(Math.sqrt(1+a)-o*r)/(1+a*n*n);return[g(t)*d*s,g(e)*d*b(1-s*(2*o+s))]}function ge(t,e){if(Math.abs(e)<c)return[t,0];var n=e/f,i=y(n);if(Math.abs(t)<c||Math.abs(Math.abs(e)-f)<c)return[0,d*Math.tan(i/2)];var r=(d/t-t/d)/2,o=n/(1+Math.cos(i));return[d*(g(t)*b(r*r+1-o*o)-r),d*o]}function ye(t,e){if(!e)return[t,0];var n=Math.abs(e);if(!t||n===f)return[0,e];var i=n/f,r=i*i,o=(8*i-r*(r+2)-5)/(2*r*(i-1)),a=o*o,s=i*o,l=r+a+2*s,u=i+3*o,c=t/f,h=c+1/c,d=g(Math.abs(t)-f)*Math.sqrt(h*h-4),p=d*d,m=(d*(l+a-1)+2*b(l*(r+a*p-1)+(1-r)*(r*(u*u+4*a)+12*s*a+4*a*a)))/(4*l+p);return[g(t)*f*m,g(e)*f*b(1+d*Math.abs(m)-m*m)]}ue.forEach(function(t){t[1]*=1.0144}),ce.invert=function(t,e){var n=e/f,i=90*n,r=Math.min(18,Math.abs(i/5)),o=Math.max(0,Math.floor(r));do{var a=ue[o][1],s=ue[o+1][1],l=ue[Math.min(19,o+2)][1],u=l-a,c=l-2*s+a,d=2*(Math.abs(n)-s)/u,p=c/u,g=d*(1-p*d*(1-2*p*d));if(g>=0||1===o){i=(e>=0?5:-5)*(g+r);var y,_=50;do{g=(r=Math.min(18,Math.abs(i)/5))-(o=Math.floor(r)),a=ue[o][1],s=ue[o+1][1],l=ue[Math.min(19,o+2)][1],i-=(y=(e>=0?f:-f)*(s+g*(l-a)/2+g*g*(l-2*s+a)/2)-e)*v}while(Math.abs(y)>h&&--_>0);break}}while(--o>=0);var b=ue[o][0],x=ue[o+1][0],w=ue[Math.min(19,o+2)][0];return[t/(x+g*(w-b)/2+g*g*(w-2*x+b)/2),i*m]},(d3.geoRobinson=function(){return x(ce)}).raw=ce,(d3.geoSatellite=function(){var t=1.4,e=0,n=w(he),i=n(t,e);return i.distance=function(i){return arguments.length?n(t=+i,e):t},i.tilt=function(i){return arguments.length?n(t,e=i*d/180):180*e/d},i}).raw=he,de.invert=function(t,e){var n=e/1.70711,i=Math.sin(d/4*n);return[t/(.74482-.34588*i*i),2*Math.atan(n)]},(d3.geoTimes=function(){return x(de)}).raw=de,(d3.geoTwoPointEquidistant=function(){var t=[[0,0],[0,0]],e=w(fe),n=e(0),i=n.rotate;return delete n.rotate,n.points=function(n){if(!arguments.length)return t;t=n;var r=d3.geoInterpolate(n[0],n[1]),o=r(.5),a=d3.geoRotation([-o[0],-o[1]])(n[0]),s=.5*r.distance,l=-y(Math.sin(a[1]*m)/Math.sin(s));return a[0]>0&&(l=d-l),i.call(a,[-o[0],-o[1],-l*v]),e(2*s)},n}).raw=fe,(d3.geoTwoPointAzimuthal=function(){var t=[[0,0],[0,0]],e=w(pe),n=e(0),i=n.rotate;return delete n.rotate,n.points=function(n){if(!arguments.length)return t;t=n;var r=d3.geoInterpolate(n[0],n[1]),o=r(.5),a=d3.geoRotation([-o[0],-o[1]])(n[0]),s=.5*r.distance,l=-y(Math.sin(a[1]*m)/Math.sin(s));return a[0]>0&&(l=d-l),i.call(a,[-o[0],-o[1],-l*v]),e(s)},n}).raw=pe,me.invert=function(t,e){if(Math.abs(e)<c)return[t,0];if(Math.abs(t)<c)return[0,f*Math.sin(2*Math.atan(e/d))];var n=(t/=d)*t,i=(e/=d)*e,r=n+i,o=r*r,a=-Math.abs(e)*(1+r),s=a-2*i+n,l=-2*a+1+2*i+o,u=i/l+(2*s*s*s/(l*l*l)-9*a*s/(l*l))/27,h=(a-s*s/(3*l))/l,p=2*Math.sqrt(-h/3),m=_(3*u/(h*p))/3;return[d*(r-1+Math.sqrt(1+2*(n-i)+o))/(2*t),g(e)*d*(-p*Math.cos(m+d/3)-s/(3*l))]},(d3.geoVanDerGrinten=function(){return x(me)}).raw=me,ve.invert=function(t,e){if(!t)return[0,f*Math.sin(2*Math.atan(e/d))];var n=Math.abs(t/d),i=(1-n*n-(e/=d)*e)/(2*n),r=i*i,o=Math.sqrt(r+1);return[g(t)*d*(o-i),g(e)*f*Math.sin(2*Math.atan2(Math.sqrt((1-2*i*n)*(i+o)-n),Math.sqrt(o+i+n)))]},(d3.geoVanDerGrinten2=function(){return x(ve)}).raw=ve,ge.invert=function(t,e){if(!e)return[t,0];var n=e/d,i=(d*d*(1-n*n)-t*t)/(2*d*t);return[t?d*(g(t)*Math.sqrt(i*i+1)-i):0,f*Math.sin(2*Math.atan(n))]},(d3.geoVanDerGrinten3=function(){return x(ge)}).raw=ge,ye.invert=function(t,e){if(!t||!e)return[t,e];e/=d;var n=g(t)*t/f,i=(n*n-1+4*e*e)/Math.abs(n),r=i*i,o=2*e,a=50;do{var s=o*o,l=(8*o-s*(s+2)-5)/(2*s*(o-1)),u=(3*o-s*o-10)/(2*s*o),h=l*l,p=o*l,m=o+l,v=m*m,y=o+3*l,_=v*(s+h*r-1)+(1-s)*(s*(y*y+4*h)+h*(12*p+4*h)),b=-2*m*(4*p*h+(1-4*s+3*s*s)*(1+u)+h*(14*s-6-r+(8*s-8-2*r)*u)+p*(12*s-8+(10*s-10-r)*u)),x=Math.sqrt(_);o-=δ=(i*(v+h-1)+2*x-n*(4*v+r))/(i*(2*l*u+2*m*(1+u))+b/x-8*m*(i*(-1+h+v)+2*x)*(1+u)/(r+4*v))}while(δ>c&&--a>0);return[g(t)*(Math.sqrt(i*i+4)+i)*d/4,f*o]},(d3.geoVanDerGrinten4=function(){return x(ye)}).raw=ye;var _e,be,xe=(_e=4*d+3*Math.sqrt(3),L((be=2*Math.sqrt(2*d*Math.sqrt(3)/_e))*Math.sqrt(3)/d,be,_e/6));function we(t,e){return[t*Math.sqrt(1-3*e*e/(d*d)),e]}function Se(t,e){var n=.90631*Math.sin(e),i=Math.sqrt(1-n*n),r=Math.sqrt(2/(1+i*Math.cos(t/=3)));return[2.66723*i*r*Math.sin(t),1.24104*n*r]}function Me(t,e){var n=Math.cos(e),i=Math.cos(t)*n,r=1-i,o=Math.cos(t=Math.atan2(Math.sin(t)*n,-Math.sin(e))),a=Math.sin(t);return[a*(n=b(1-i*i))-o*r,-o*n-a*r]}function Ee(t,e){var n=M(t,e);return[(n[0]+t/f)/2,(n[1]+e)/2]}(d3.geoWagner4=function(){return x(xe)}).raw=xe,we.invert=function(t,e){return[t/Math.sqrt(1-3*e*e/(d*d)),e]},(d3.geoWagner6=function(){return x(we)}).raw=we,Se.invert=function(t,e){var n=t/2.66723,i=e/1.24104,r=Math.sqrt(n*n+i*i),o=2*y(r/2);return[3*Math.atan2(t*Math.tan(o),2.66723*r),r&&y(e*Math.sin(o)/(1.24104*.90631*r))]},(d3.geoWagner7=function(){return x(Se)}).raw=Se,Me.invert=function(t,e){var n=-.5*(t*t+e*e),i=Math.sqrt(-n*(2+n)),r=e*n+t*i,o=t*n-e*i,a=Math.sqrt(o*o+r*r);return[Math.atan2(i*r,a*(1+n)),a?-y(i*o/a):0]},(d3.geoWiechel=function(){return x(Me)}).raw=Me,Ee.invert=function(t,e){var n=t,i=e,r=25;do{var o,a=Math.cos(i),s=Math.sin(i),l=Math.sin(2*i),u=s*s,h=a*a,d=Math.sin(n),p=Math.cos(n/2),m=Math.sin(n/2),v=m*m,g=1-h*p*p,y=g?_(a*p)*Math.sqrt(o=1/g):o=0,b=.5*(2*y*a*m+n/f)-t,x=.5*(y*s+i)-e,w=.5*o*(h*v+y*a*p*u)+.5/f,S=o*(d*l/4-y*s*m),M=.125*o*(l*m-y*s*h*d),E=.5*o*(u*p+y*v*a)+.5,z=S*M-E*w,k=(x*S-b*E)/z,T=(b*M-x*w)/z;n-=k,i-=T}while((Math.abs(k)>c||Math.abs(T)>c)&&--r>0);return[n,i]},(d3.geoWinkel3=function(){return x(Ee)}).raw=Ee}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),r=s(n(31)),o=s(n(429)),a=n(21);function s(t){return t&&t.__esModule?t:{default:t}}var l=function(t){return function(){var e=t,n=void 0;o.setCssPrefix=function(t){return n=t,o};var r=d3.drag().on("start",function(t,n){d3.event.sourceEvent.stopPropagation();e.KEY}).on("drag",function(t,n){var i=e.KEY;if(e.model.ui.chart.labels.dragging){this.druging||(e.druging=t[i]);var r=e.cached[t[i]];r.labelFixed=!0;var a=e.context.width,s=e.context.height;r.labelX_+=d3.event.dx/a,r.labelY_+=d3.event.dy/s;var l=e.xScale(r.labelX0)+r.labelX_*a,u=e.yScale(r.labelY0)+r.labelY_*s,c=e.xScale(r.labelX0),h=e.yScale(r.labelY0),d=e.entityLines.filter(function(e){return e[i]==t[i]});o._repositionLabels(t,n,null,this,l,u,c,h,0,null,d)}}).on("end",function(t,n){var i=e.KEY;if(e.druging){var r=e.cached[t[i]];e.druging=null,r.labelOffset[0]=r.labelX_,r.labelOffset[1]=r.labelY_,e.model.marker.setLabelOffset(t,[r.labelX_,r.labelY_])}});function o(t,s){return t.each(function(t,r){var o=d3.select(this);o.append("rect").attr("class","vzb-label-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),o.append("rect").attr("class","vzb-label-fill vzb-tooltip-border");var l=o.append("text").attr("class",n+"-label-content stroke");if(o.style("paint-order").length||(o.insert("text","."+n+"-label-content").attr("class",n+"-label-content "+n+"-label-shadow vzb-noexport"),l.classed("stroke",!1)),!s){var u=o.append("g").attr("class",n+"-label-x vzb-transparent");i.setIcon(u,a.close),u.insert("circle","svg"),u.select("svg").attr("class",n+"-label-x-icon").attr("width","0px").attr("height","0px"),u.on("click",function(){d3.event.defaultPrevented||(d3.event.stopPropagation(),e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t))})}}),s||t.call(r).on("mouseover",function(t){if(!i.isTouchDevice()){e.model.marker.highlightMarker(t);var r=e.KEY||e.context.KEY;e.entityLabels.sort(function(e,n){return e[r]!=t[r]?-1:1}),d3.select(this).selectAll("."+n+"-label-x").classed("vzb-transparent",!1)}}).on("mouseout",function(t){i.isTouchDevice()||(e.model.marker.clearHighlighted(),d3.select(this).selectAll("."+n+"-label-x").classed("vzb-transparent",!0))}).on("click",function(t){if(i.isTouchDevice()){var r=d3.select(this).selectAll("."+n+"-label-x"),o=e.KEY||e.context.KEY,a=r.classed("vzb-transparent");a&&(e.entityLabels.sort(function(e,n){return e[o]!=t[o]?-1:1}),e.showCloseCross(null,!1)),r.classed("vzb-transparent",!a),e.options.SUPPRESS_HIGHLIGHT_DURING_PLAY&&e.model.time.playing||(a?e.model.marker.setHighlight(t):e.model.marker.clearHighlighted())}}),o}return o.line=function(t){t.append("line").attr("class",n+"-label-line")},o._repositionLabels=function(t,n,i,r,o,a,s,l,u,c,h){var d=i||e.cached[t[e.KEY]],f=d3.select(r),p=!o&&0!==o||!a&&0!==a||!s&&0!==s||!l&&0!==l;if(p)return f.classed("vzb-invisible",p),void h.classed("vzb-invisible",p);var m=e.context.width,v=e.context.height,g=d.rectBBox,y=g.height,_=d.rectOffsetX,b=d.rectOffsetY;o+g.x<=0?(o=-g.x,d.labelX_=(o-e.xScale(d.labelX0))/m):o+_>m&&(o=m-_,d.labelX_=(o-e.xScale(d.labelX0))/m);a+g.y<=0?(a=-g.y,d.labelY_=(a-e.yScale(d.labelY0))/v):a+b>v&&(a=v-b,d.labelY_=(a-e.yScale(d.labelY0))/v);null==u&&(u=e.context.duration);d._new&&(u=0,delete d._new);u?c&&!t.hidden?(f.classed("vzb-invisible",t.hidden),f.attr("transform","translate("+o+","+a+")").style("opacity",0).transition().duration(u).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){f.style("opacity",1)}),h.classed("vzb-invisible",t.hidden),h.attr("transform","translate("+o+","+a+")").style("opacity",0).transition().duration(u).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){h.style("opacity",1)})):c&&t.hidden?(f.style("opacity",1).transition().duration(u).ease(d3.easeExp).style("opacity",0).on("end",function(){f.style("opacity",1).classed("vzb-invisible",t.hidden)}),h.style("opacity",1).transition().duration(u).ease(d3.easeExp).style("opacity",0).on("end",function(){h.style("opacity",1).classed("vzb-invisible",t.hidden)})):(f.transition().duration(u).ease(d3.easeLinear).attr("transform","translate("+o+","+a+")"),h.transition().duration(u).ease(d3.easeLinear).attr("transform","translate("+o+","+a+")")):(f.interrupt().attr("transform","translate("+o+","+a+")").transition(),h.interrupt().attr("transform","translate("+o+","+a+")").transition(),c&&f.classed("vzb-invisible",t.hidden),c&&h.classed("vzb-invisible",t.hidden));var x=s-o,w=l-a,S=f.select("text").node().getBBox(),M=.5*-S.width,E=.2*-y,z=e.model.ui.chart.labels,k=z.removeLabelBox?S:g,T=e.activeProfile.labelLeashCoeff||0,O=function(t,e){var n=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y),r=.5*e.width,o=.5*e.height;if(n>r+t.r)return!1;if(i>o+t.r)return!1;if(n<=r)return!0;if(i<=o)return!0;return Math.pow(n-r,2)+Math.pow(i-o,2)<=Math.pow(t.r,2)}({x:x,y:w,r:d.scaledS0},{x:M,y:E,width:2*k.height*T+k.width,height:k.height*(2*T+1)});if(h.select("line").classed("vzb-invisible",O),O)return;if(z.removeLabelBox){var P=180*Math.atan2(x-M,w-E)/Math.PI,C=P>=0&&P<=180?.5*k.width:.5*-k.width,A=Math.abs(P)<=90?.55*k.height:.45*-k.height;M+=Math.abs(x-M)>.5*S.width?C:0,E+=Math.abs(w-E)>.5*S.height?A:.05*S.height}var I=Math.abs(x)>Math.abs(w)?Math.abs(x):Math.abs(w);h.select("line").style("stroke-dasharray","0 "+d.scaledS0+" "+2*~~I),h.selectAll("line").attr("x1",x).attr("y1",w).attr("x2",M).attr("y2",E)},o}()},u={LABELS_CONTAINER_CLASS:"",LINES_CONTAINER_CLASS:"",LINES_CONTAINER_SELECTOR:"",CSS_PREFIX:"",SUPPRESS_HIGHLIGHT_DURING_PLAY:!0},c=r.default.extend({init:function(t,e){this.context=t,this.options=i.extend({},u),this.label=l(this),this._xScale=null,this._yScale=null,this._closeCrossHeight=0,this.labelSizeTextScale=null},ready:function(){this.KEYS=this.context.KEYS,this.KEY=this.context.KEY,this.updateIndicators(),this.updateLabelSizeLimits()},readyOnce:function(){var t=this;this.model=this.context.model,this.model.on("change:marker.select",function(){t.context._readyOnce&&t.selectDataPoints()}),this.model.marker.size_label&&this.model.on("change:marker.size_label.extent",function(e,n){t.context._readyOnce&&(t.updateLabelSizeLimits(),t.model.time.splash||t.updateLabelsOnlyTextSize())}),this.model.ui.chart.labels.hasOwnProperty("removeLabelBox")&&this.model.on("change:ui.chart.labels.removeLabelBox",function(e,n){t.context._readyOnce&&t.updateLabelsOnlyTextSize()}),this.KEYS=this.context.KEYS,this.KEY=this.context.KEY,this.cached={},this.label.setCssPrefix(this.options.CSS_PREFIX),this.rootEl=this.context.root.element instanceof Array?this.context.root.element:d3.select(this.context.root.element),this.labelsContainer=this.rootEl.select("."+this.options.LABELS_CONTAINER_CLASS),this.linesContainer=this.rootEl.select("."+this.options.LINES_CONTAINER_CLASS),this.updateIndicators(),this.updateSize(),this.selectDataPoints(),this._initLabelTooltip()},config:function(t){i.extend(this.options,t)},updateLabelSizeLimits:function(){if(this.model.marker.size_label){var t=this.model.marker.size_label.extent||[0,1],e=this.activeProfile.minLabelTextSize,n=this.activeProfile.maxLabelTextSize-e;this.minLabelTextSize=Math.max(e+n*t[0],e),this.maxLabelTextSize=Math.max(e+n*t[1],e),"constant"==this.model.marker.size_label.use&&(this.minLabelTextSize=this.maxLabelTextSize),"ordinal"!==this.model.marker.size_label.scaleType||"constant"==this.model.marker.size_label.use?this.labelSizeTextScale.range([this.minLabelTextSize,this.maxLabelTextSize]):this.labelSizeTextScale.rangePoints([this.minLabelTextSize,this.maxLabelTextSize],0).range()}},updateIndicators:function(){this.model.marker.size_label&&(this.labelSizeTextScale=this.model.marker.size_label.getScale())},setScales:function(t,e){this._xScale=t,this._yScale=e},setCloseCrossHeight:function(t){this._closeCrossHeight!=t&&(this._closeCrossHeight=t,this.updateLabelCloseGroupSize(this.entityLabels.selectAll("."+this.options.CSS_PREFIX+"-label-x"),this._closeCrossHeight))},xScale:function(t){return this._xScale?this._xScale(t):t*this.context.width},yScale:function(t){return this._yScale?this._yScale(t):t*this.context.height},selectDataPoints:function(){var t=this,e=this.KEYS,n=this.KEY,r=this.options.CSS_PREFIX,a=t.model.marker.select.map(function(t){var r=i.clone(t,e);return r[n]=i.getKey(t,e),r});this.entityLabels=this.labelsContainer.selectAll("."+r+"-entity").data(a,function(t){return t[n]}),this.entityLines=this.linesContainer.selectAll("g.entity-line."+r+"-entity").data(a,function(t){return t[n]}),this.entityLabels.exit().each(function(e){null!=t.cached[e[n]]&&(t.cached[e[n]]=void 0)}).remove(),this.entityLines.exit().remove(),this.entityLines=this.entityLines.enter().insert("g",function(e){return this.querySelector("."+t.options.LINES_CONTAINER_SELECTOR_PREFIX+(0,o.default)(e[n]))}).attr("class",function(t,e){return r+"-entity entity-line line-"+t[n]}).each(function(e,n){t.label.line(d3.select(this))}).merge(this.entityLines),this.entityLabels=this.entityLabels.enter().append("g").attr("class",function(t,e){return r+"-entity label-"+t[n]}).each(function(e,i){t.cached[e[n]]={_new:!0},t.label(d3.select(this))}).merge(this.entityLabels)},showCloseCross:function(t,e){var n=this.KEY;this.entityLabels.filter(function(e){return!t||e[n]==t[n]}).select("."+this.options.CSS_PREFIX+"-label-x").classed("vzb-transparent",!e)},highlight:function(t,e){var n=this.KEY,i=this.entityLabels;t&&(i=i.filter(function(e){return!t||e[n]==t[n]})),i.classed("vzb-highlighted",e)},updateLabel:function(t,e,n,r,o,a,s,l,u,c,h){var d=this,f=this.KEYS,p=this.KEY;if(t[p]!=d.druging){var m=this.options.CSS_PREFIX;if(d.model.marker.isSelected(t)&&null!=d.entityLabels){null==d.cached[t[p]]&&this.selectDataPoints();var v=d.cached[t[p]];if(n&&i.extend(v,n),null!=v.scaledS0&&null!=v.labelX0&&null!=v.labelY0||this._initNewCache(v,r,o,a,s,u),null==v.labelX_||null==v.labelY_){var g=i.find(d.model.marker.select,function(e){return i.getKey(e,f)==t[p]});v.labelOffset=g.labelOffset||[0,0]}var y=!v.labelX0&&0!==v.labelX0||!v.labelY0&&0!==v.labelY0||!v.scaledS0&&0!==v.scaledS0,_=d.entityLines.filter(function(e){return e[p]==t[p]});d.entityLabels.filter(function(e){return e[p]==t[p]}).each(function(n){var i=d3.select(this);if(y)return i.classed("vzb-invisible",y),void _.classed("vzb-invisible",y);var r=i.selectAll("."+m+"-label-content").text(l);d._updateLabelSize(t,e,null,i,u,r),d.positionLabel(t,e,null,this,c,h,_)})}}},_initNewCache:function(t,e,n,r,o,a){(r||0===r)&&(t.scaledS0=i.areaToRadius(this.context.sScale(r))),t.labelX0=e,t.labelY0=n,t.valueLST=a,t.scaledC0=null!=o?this.context.cScale(o):this.context.COLOR_WHITEISH},_initLabelTooltip:function(){this.tooltipEl=this.labelsContainer.append("g").attr("class",this.options.CSS_PREFIX+"-tooltip")},setTooltip:function(t,e,n,i){if(e){var r=0,o=this.options.CSS_PREFIX;if(this.tooltipEl.raise().text(null),this.label(this.tooltipEl,!0),t){var a={};this._initNewCache(a,i.valueX,i.valueY,i.valueS,i.valueC,i.valueLST),this.tooltipEl.classed(this.options.CSS_PREFIX+"-tooltip",!1).classed(this.options.CSS_PREFIX+"-entity",!0).selectAll("."+o+"-label-content").text(i.labelText),this._updateLabelSize(t,null,a,this.tooltipEl,i.valueLST),r=this.positionLabel(t,null,a,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"))}this.tooltipEl.classed(this.options.CSS_PREFIX+"-entity",!1).classed(this.options.CSS_PREFIX+"-tooltip",!0).selectAll("."+o+"-label-content").text(e),this._updateLabelSize(t,null,n,this.tooltipEl,null),this.positionLabel(t,null,n,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"),r)}else this.tooltipEl.text(null)},setTooltipFontSize:function(t){this.tooltipEl.style("font-size",t)},_updateLabelSize:function(t,e,n,i,r,o){var a=this.KEY,s=n||this.cached[t[a]],l=this.options.CSS_PREFIX,u=this.model.ui.chart.labels||{};i.classed("vzb-label-boxremoved",u.removeLabelBox);var c=o||i.selectAll("."+l+"-label-content");if(this.labelSizeTextScale)if(null!=r){var h=this.labelSizeTextScale.range(),d=h[0]+Math.sqrt((this.labelSizeTextScale(r)-h[0])*(h[1]-h[0]));c.attr("font-size",d+"px")}else c.attr("font-size","");var f=c.node().getBBox(),p=i.selectAll("rect");if(!s.textWidth||s.textWidth!=f.width){s.textWidth=f.width;var m=this._closeCrossHeight||f.height,v=this.model.locale.isRTL(),g=i.select("."+l+"-label-x").attr("transform","translate("+(v?-f.width-4:4)+","+.85*-f.height+")");this.updateLabelCloseGroupSize(g,m),p.attr("width",f.width+8).attr("height",1.2*f.height).attr("x",-f.width-4).attr("y",.85*-f.height).attr("rx",.2*f.height).attr("ry",.2*f.height),s.rectBBox=p.node().getBBox(),s.rectOffsetX=s.rectBBox.width+s.rectBBox.x,s.rectOffsetY=s.rectBBox.height+s.rectBBox.y}var y=i.select(".vzb-label-glow");y.attr("stroke")!==s.scaledC0&&y.attr("stroke",s.scaledC0)},updateLabelCloseGroupSize:function(t,e){t.select("circle").attr("cx",0).attr("cy",0).attr("r",.5*e),t.select("svg").attr("x",.5*-e).attr("y",-.5*e).attr("width",e).attr("height",e)},updateLabelsOnlyTextSize:function(){var t=this,e=this.KEYS,n=this.KEY;this.entityLabels.each(function(r,o){t.cached[r[n]];t._updateLabelSize(r,o,null,d3.select(this),t.context.frame.size_label[i.getKey(r,e)]);var a=t.entityLines.filter(function(t){return t[n]==r[n]});t.positionLabel(r,o,null,this,0,null,a)})},updateLabelOnlyPosition:function(t,e,n){var r=this,o=this.KEY,a=this.cached[t[o]];n&&i.extend(a,n);var s=r.entityLines.filter(function(e){return e[o]==t[o]});this.entityLabels.filter(function(e){return e[o]==t[o]}).each(function(n){r.positionLabel(t,e,null,this,0,null,s)})},updateLabelOnlyColor:function(t,e,n){var r=this.KEY,o=this.cached[t[r]];n&&i.extend(o,n);var a=this.entityLabels.filter(function(e){return e[r]==t[r]});this._updateLabelSize(t,e,null,a,null)},positionLabel:function(t,e,n,r,o,a,s,l){var u=this.KEY,c=n||this.cached[t[u]],h=l||0===l,d=1&(l||0),f=(2&(l||0))>>1,p=0,m=0,v=this.context.width,g=this.context.height,y=this.xScale(c.labelX0),_=this.yScale(c.labelY0),b=c.rectOffsetX,x=c.rectOffsetY;c.labelOffset||(c.labelOffset=[0,0]),c.labelX_=c.labelOffset[0]||(.75*-c.scaledS0-b)/v,c.labelY_=c.labelOffset[1]||(.75*-c.scaledS0-x)/g;var w=y+c.labelX_*v,S=_+c.labelY_*g;if(c.labelOffset[0]+c.labelOffset[1]==0&&((!h&&S-c.rectBBox.height+x<=0||f)&&(m=1,c.labelY_=(.75*c.scaledS0+c.rectBBox.height-x)/g,S=_+c.labelY_*g),(!h&&w-c.rectBBox.width+b<=0||d)&&(p=1,c.labelX_=(.75*c.scaledS0+c.rectBBox.width-b)/v,(w=y+c.labelX_*v)>v&&(p=0,m=0==m&&_-.5*x-c.scaledS0<c.rectBBox.height?1:m,c.labelY_=m?.5*-x+c.rectBBox.height+c.scaledS0:1.5*-x-c.scaledS0,c.labelY_/=g,S=_+c.labelY_*g,c.labelX_=(c.rectBBox.width-b-y)/v,w=y+c.labelX_*v))),h){var M=!1;if(w-c.rectBBox.width+b<=0){var E=y-c.rectBBox.width,z=E>0?i.cathetus(c.scaledS0,E):c.scaledS0;(S=m?_+c.rectBBox.height-.5*x+z:_-1.5*x-z)-c.rectBBox.height<0&&(M=!0)}if(S-c.rectBBox.height+x<=0){var k=_-c.rectBBox.height,T=k>0?i.cathetus(c.scaledS0,k):c.scaledS0;((w=p?y+c.rectBBox.width+T:y-2*b-T)-c.rectBBox.width<0||w>v)&&(M=!0)}if(M){m++;var O=y-c.rectBBox.width;S=_+c.rectBBox.height-.5*x+(O>0?i.cathetus(c.scaledS0,O):c.scaledS0)}}return this.label._repositionLabels(t,e,n,r,w,S,y,_,o,a,s),2*m+p},updateSize:function(){this.activeProfile=this.context.getActiveProfile({small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,labelLeashCoeff:.4},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,labelLeashCoeff:.2}},{medium:{minLabelTextSize:15,maxLabelTextSize:35,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:20,maxLabelTextSize:55,defaultLabelTextSize:20,labelLeashCoeff:.2}}),this.updateLabelSizeLimits()}});e.default=c},function(t,e,n){(function(e){var n,i;n=void 0!==e?e:this,i=function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,n=String(t),i=n.length,r=-1,o="",a=n.charCodeAt(0);++r<i;)0!=(e=n.charCodeAt(r))?o+=e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==a?"\\"+e.toString(16)+" ":(0!=r||1!=i||45!=e)&&(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?n.charAt(r):"\\"+n.charAt(r):o+="�";return o};return t.CSS||(t.CSS={}),t.CSS.escape=e,e},t.exports=i(n)}).call(e,n(78))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(31),o=(i=r)&&i.__esModule?i:{default:i};var a="",s=[];e.default=o.default.extend({init:function(t){this.context=t,this.shapes=[],this.groups=[],this.counter=0,this.name="",this.label=""},reset:function(){this.container.remove(),this.context.element.selectAll(".vzb-export-redball").remove(),this.context.element.selectAll(".vzb-export-counter").remove(),this.counter=0},prefix:function(t){return arguments.length?(a=t,this):a},deleteClasses:function(t){return arguments.length?(s=t,this):s},open:function(t,e){var n=this;this.svg&&this.reset(),t||(t=this.context.element),e||(e=this.context.name),this.name=e;var i=parseInt(t.style("width"),10)||0,r=parseInt(t.style("height"),10)||0;this.container=t.append("div").attr("class","vzb-svg-export"),this.svg=this.container.node().appendChild(t.select("svg").node().cloneNode(!0)),this.svg=d3.select(this.svg),this.svg.attr("viewBox","0 0 "+i+" "+r).attr("version","1.1").attr("param1","http://www.w3.org/2000/svg").attr("param2","http://www.w3.org/1999/xlink").attr("x","0px").attr("y","0px").attr("style","enable-background:new 0 0 "+i+" "+r).attr("xml:space","preserve"),this.redBall=t.append("div").attr("class","vzb-export-redball").style("position","absolute").style("top","20px").style("right","20px").style("width","20px").style("height","20px").style("background","red").style("color","white").style("text-align","center").style("border-radius","10px").style("font-size","14px").style("line-height","20px").style("opacity",.8).style("cursor","pointer").on("mouseover",function(){d3.select(this).style("opacity",1).text("▼"),n.counterEl.text("Download")}).on("mouseout",function(){d3.select(this).style("opacity",.8).text(""),n.counterEl.text(n.label)}).on("click",function(){n.close()}),this.counterEl=t.append("div").attr("class","vzb-export-counter").style("position","absolute").style("top","20px").style("right","45px").style("color","red").style("opacity",.8).style("line-height","20px").style("font-size","14px").style("text-align","center"),this.root=this.svg.select("."+a+"graph"),this.root.selectAll("g, text, svg, line, rect").filter(function(){var t=d3.select(this),e=!1;return s.forEach(function(n){e=e||t.classed(n)}),e}).remove(),this.svg.selectAll(".tick line").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+a+"axis-x path").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+a+"axis-y path").attr("fill","none").attr("stroke","#999")},write:function(t){if(this.root||this.open(),!(this.shapes.indexOf(t.id+"_"+t.time)>-1)){this.shapes.push(t.id+"_"+t.time),-1==this.groups.indexOf(t.time)&&(this.root.append("g").attr("id","g_"+t.time),this.groups.push(t.time)),null==t.opacity&&(t.opacity=.5),null==t.fill&&(t.fill="#ff80dd");var e=this.root.select("#g_"+t.time).append(t.type).attr("id",t.id+"_"+t.time).style("fill",t.fill).style("opacity",t.opacity);switch(t.type){case"path":e.attr("d",t.d);break;case"circle":e.attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}this.counter++,this.redBall.style("opacity",this.counter%10/12+.2),this.label=t.type+" shapes: "+this.counter,this.counterEl.text(this.label)}},close:function(){var t='<?xml version="1.0" encoding="utf-8"?> '+this.container.node().innerHTML.replace("param1","xmlns").replace("param2","xmlns:xlink").replace(/\d+(\.\d+)/g,function(t){return Math.round(100*+t)/100+""});if(t.length/1024/1024>2)alert("The file size is "+Math.round(t.length/1024)+"kB, which is too large to download. Will try to print it in the console instead..."),console.log(t);else{var e=document.createElement("a");e.download=this.name+" "+this.counter+" shapes.svg",e.href="data:,"+t,e.click()}}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(31);var o=((i=r)&&i.__esModule?i:{default:i}).default.extend({init:function(t){this.context=t,this.interact=this._createInteract()},setTooltip:function(t){this.tooltip=t},_createInteract:function(){var t=this;return{mouseOver:function(){var e=d3.event,n=d3.mouse(t.context.element.node());t._setTooltip(d3.select(e.target).attr("data-text"),n[0],n[1])},mouseOut:function(){t._setTooltip()},tap:function(){}}},_setTooltip:function(t,e,n){if(t){this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(t);var i=this.tooltip.select("text").node().getBBox();e-i.width<0?e+=i.width+5:e-=5,n-i.height<0?n+=i.height:n-=11,this.tooltip.attr("transform","translate("+e+","+n+")"),this.tooltip.selectAll("rect").attr("width",i.width+8).attr("height",1.2*i.height).attr("x",-i.width-4).attr("y",.85*-i.height).attr("rx",.2*i.height).attr("ry",.2*i.height)}else this.tooltip.classed("vzb-hidden",!0)},clear:function(t){t.attr("data-text",null)},wrap:function(t,e){var n=d3.select(t),i=Math.abs,r=n.attr("data-text");r||(r=n.text(),n.attr("data-text",r)),n.text(r);for(var o=r,a=o.length,s=n.node().getComputedTextLength();e-s<=0&&""!==o;)o=s>=e?o.slice(0,-i(.5*a)):r.slice(0,i(.5*a)),n.text(o+"…"),s=n.node().getComputedTextLength(),a=o.length;o!==r?(""===o&&n.text(r[0]),n.on("mouseover.tooltip",this.interact.mouseOver).on("mouseout.tooltip",this.interact.mouseOut).style("pointer-events","all")):n.on("mouseover.tooltip",null).on("mouseout.tooltip",null).style("pointer-events",null)}});e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,e){var n={},i={},r={},o=[],a=-1;function s(t,e){for(var i in t){var r=t[i];delete e[r.start],delete r.start,delete r.end,r.forEach(function(t){n[t<0?~t:t]=1}),o.push(r)}}return e.forEach(function(n,i){var r,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(r=e[++a],e[a]=n,e[i]=r)}),e.forEach(function(e){var n,o,a=function(e){var n,i=t.arcs[e<0?~e:e],r=i[0];t.transform?(n=[0,0],i.forEach(function(t){n[0]+=t[0],n[1]+=t[1]})):n=i[i.length-1];return e<0?[n,r]:[r,n]}(e),s=a[0],l=a[1];if(n=r[s])if(delete r[n.end],n.push(e),n.end=l,o=i[l]){delete i[o.start];var u=o===n?n:n.concat(o);i[u.start=n.start]=r[u.end=o.end]=u}else i[n.start]=r[n.end]=n;else if(n=i[l])if(delete i[n.start],n.unshift(e),n.start=s,o=r[s]){delete r[o.end];var c=o===n?n:o.concat(n);i[c.start=o.start]=r[c.end=n.end]=c}else i[n.start]=r[n.end]=n;else i[(n=[e]).start=s]=r[n.end=l]=n}),s(r,i),s(i,r),e.forEach(function(t){n[t<0?~t:t]||o.push([t])}),o}function e(e,n,i){var r=[];function o(t){var e=t<0?~t:t;(u[e]||(u[e]=[])).push({i:t,g:l})}function a(t){t.forEach(o)}function s(t){t.forEach(a)}if(arguments.length>1){var l,u=[],c={LineString:a,MultiLineString:s,Polygon:s,MultiPolygon:function(t){t.forEach(s)}};!function t(e){"GeometryCollection"===e.type?e.geometries.forEach(t):e.type in c&&(l=e,c[e.type](e.arcs))}(n),u.forEach(arguments.length<3?function(t){r.push(t[0].i)}:function(t){i(t[0].g,t[t.length-1].g)&&r.push(t[0].i)})}else for(var h=0,d=e.arcs.length;h<d;++h)r.push(h);return{type:"MultiLineString",arcs:t(e,r)}}function i(e,i){var r={},a=[],s=[];function l(t){t.forEach(function(e){e.forEach(function(e){(r[e=e<0?~e:e]||(r[e]=[])).push(t)})}),a.push(t)}function u(t){return function(t){var e,n=-1,i=t.length,r=t[i-1],o=0;for(;++n<i;)e=r,r=t[n],o+=e[0]*r[1]-e[1]*r[0];return.5*o}(o(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}return i.forEach(function(t){"Polygon"===t.type?l(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(l)}),a.forEach(function(t){if(!t._){var e=[],n=[t];for(t._=1,s.push(e);t=n.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].forEach(function(t){t._||(t._=1,n.push(t))})})})}}),a.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:s.map(function(i){var o=[];if(i.forEach(function(t){t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].length<2&&o.push(t)})})}),o=t(e,o),(n=o.length)>1)for(var a,s=u(i[0][0]),l=0;l<n;++l)if(s===u(o[l])){a=o[0],o[0]=o[l],o[l]=a;break}return o})}}function r(t,e){var n={type:"Feature",id:e.id,properties:e.properties||{},geometry:o(t,e)};return null==e.id&&delete n.id,n}function o(t,e){var n=u(t.transform),i=t.arcs;function r(t,e){e.length&&e.pop();for(var r,o=i[t<0?~t:t],a=0,s=o.length;a<s;++a)e.push(r=o[a].slice()),n(r,a);t<0&&function(t,e){var n,i=t.length,r=i-e;for(;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}(e,s)}function o(t){return t=t.slice(),n(t,0),t}function a(t){for(var e=[],n=0,i=t.length;n<i;++n)r(t[n],e);return e.length<2&&e.push(e[0].slice()),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0].slice());return e}function l(t){return t.map(s)}var c={Point:function(t){return o(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(o)},LineString:function(t){return a(t.arcs)},MultiLineString:function(t){return t.arcs.map(a)},Polygon:function(t){return l(t.arcs)},MultiPolygon:function(t){return t.arcs.map(l)}};return function t(e){var n=e.type;return"GeometryCollection"===n?{type:n,geometries:e.geometries.map(t)}:n in c?{type:n,coordinates:c[n](e)}:null}(e)}function a(t,e){for(var n=0,i=t.length;n<i;){var r=n+i>>>1;t[r]<e?n=r+1:i=r}return n}function s(t){var e=t[0],n=t[1],i=t[2];return Math.abs((e[0]-i[0])*(n[1]-e[1])-(e[0]-n[0])*(i[1]-e[1]))}function l(t,e){return t[1][2]-e[1][2]}function u(t){if(!t)return c;var e,n,i=t.scale[0],r=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0),t[0]=(e+=t[0])*i+o,t[1]=(n+=t[1])*r+a}}function c(){}return{version:"1.6.19",mesh:function(t){return o(t,e.apply(this,arguments))},meshArcs:e,merge:function(t){return o(t,i.apply(this,arguments))},mergeArcs:i,feature:function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return r(t,e)})}:r(t,e)},neighbors:function(t){var e={},n=t.map(function(){return[]});function i(t,n){t.forEach(function(t){t<0&&(t=~t);var i=e[t];i?i.push(n):e[t]=[n]})}function r(t,e){t.forEach(function(t){i(t,e)})}var o={LineString:i,MultiLineString:r,Polygon:r,MultiPolygon:function(t,e){t.forEach(function(t){r(t,e)})}};for(var s in t.forEach(function t(e,n){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,n)}):e.type in o&&o[e.type](e.arcs,n)}),e)for(var l=e[s],u=l.length,c=0;c<u;++c)for(var h=c+1;h<u;++h){var d,f=l[c],p=l[h];(d=n[f])[s=a(d,p)]!==p&&d.splice(s,0,p),(d=n[p])[s=a(d,f)]!==f&&d.splice(s,0,f)}return n},presimplify:function(t,e){var n=u(t.transform),i=function(t){if(!t)return c;var e,n,i=t.scale[0],r=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var l=(t[0]-o)/i|0,u=(t[1]-a)/r|0;t[0]=l-e,t[1]=u-n,e=l,n=u}}(t.transform),r=function(){var t={},e=[],n=0;function i(t,n){for(;n>0;){var i=(n+1>>1)-1,r=e[i];if(l(t,r)>=0)break;e[r._=n]=r,e[t._=n=i]=t}}function r(t,i){for(;;){var r=i+1<<1,o=r-1,a=i,s=e[a];if(o<n&&l(e[o],s)<0&&(s=e[a=o]),r<n&&l(e[r],s)<0&&(s=e[a=r]),a===i)break;e[s._=i]=s,e[t._=i=a]=t}}return t.push=function(t){return i(e[t._=n]=t,n++),n},t.pop=function(){if(!(n<=0)){var t,i=e[0];return--n>0&&(t=e[n],r(e[t._=0]=t,0)),i}},t.remove=function(t){var o,a=t._;if(e[a]===t)return a!==--n&&(l(o=e[n],t)<0?i:r)(e[o._=a]=o,a),a},t}();e||(e=s);function o(t){r.remove(t),t[1][2]=e(t),r.push(t)}return t.arcs.forEach(function(t){for(var a,s,l=[],u=0,c=0,h=t.length;c<h;++c)s=t[c],n(t[c]=[s[0],s[1],1/0],c);for(c=1,h=t.length-1;c<h;++c)(a=t.slice(c-1,c+2))[1][2]=e(a),l.push(a),r.push(a);for(c=0,h=l.length;c<h;++c)(a=l[c]).previous=l[c-1],a.next=l[c+1];for(;a=r.pop();){var d=a.previous,f=a.next;a[1][2]<u?a[1][2]=u:u=a[1][2],d&&(d.next=f,d[2]=a[2],o(d)),f&&(f.previous=d,f[0]=a[0],o(f))}t.forEach(i)}),t}}}()},function(t,e){}])},"object"==typeof e&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define("Vizabi",[],r):"object"==typeof e?e.Vizabi=r():i.Vizabi=r()}}]);
//# sourceMappingURL=tools.js.map