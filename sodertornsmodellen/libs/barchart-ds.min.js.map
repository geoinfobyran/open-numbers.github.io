{"version":3,"sources":["webpack:///barchart-ds.min.js","webpack:///webpack/bootstrap f58c412da383836e7a47?7468","webpack:///./src/index.js?9552","webpack:///./src/component.js?a623","webpack:///./src/template.html?60fe"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_component","_component2","obj","default","VERSION_INFO","version","build","BarChartDS","Vizabi","Tool","extend","init","placeholder","external_model","this","components","component","model","Component","_super","validate","entities","state","keys","show","length","dim","entities_geodomain","skipFilter","entities_side","default_model","marker_tags","ui","chart","stacked","inpercent","flipSides","buttons","dialogs","popup","sidebar","moreoptions","presentation","locale","versionInfo","_toConsumableArray","arr","Array","isArray","arr2","from","_Vizabi","utils","axisSmart","helpers","iconQuestion","iconset","question","config","context","template","model_expects","type","_this","model_binds","change:time.value","evt","_readyOnce","time","step","snapped","playing","dragging","next","d3","bisectLeft","timeSteps","prev","snapTime","Date","marker","getFrame","frame","frameAxisX","axis_x","marker_order","frameOrder","hook_order","_reorderBars","_updateEntities","updateBarsOpacity","change:marker","path","indexOf","ready","change:marker.select","someSelected","select","nonSelectedOpacityZero","change:marker.highlight","_highlightBars","change:marker.opacitySelectDim","change:marker.opacityRegular","change:marker.color.palette","change:marker.color.scaleType","change:marker.color.which","which","color","change:marker.side.which","sideDim","entitiesSideProps","side","use","sideConcept","getConceptprops","concept_type","domain","clearSideState","skipFilterSide","geoDomainDimension","set","STACKDIM","Boolean","getFilteredEntities","change:entities.show","isEmpty","showEntities","filter","isShown","showEntity","SIDEDIM","change:entities_side.show","doReturn","_entitiesSameDimWithSide","forEach","_space","h","_name","_updateIndicators","_updateLimits","resize","change:ui.chart.inpercent","change:ui.chart.flipSides","switchSideState","xScale","yScale","cScale","xAxis","xAxisLeft","yAxis","xScales","totalFieldName","checkDimensions","stackDim","colorUseNotProperty","TIME","stackSkip","geoLess","sideSkip","readyOnce","el","element","interaction","_interaction","graph","yAxisEl","xAxisEl","xAxisLeftEl","xTitleEl","xInfoEl","yTitleEl","barsCrop","labelsCrop","bars","labels","attr","title","titleRight","year","getDimension","geoDomainDefaultValue","on","_attributeUpdaters","_newWidth","width","getKey","KEYS","total","PREFIXEDSIDEDIM","width_","_newX","prevSbl","previousSibling","prevSblDatum","datum","x_","_newColor","COLORKEYS","_this2","_ready","getAllSteps","_getFirstDimension","unique","_getAllDimensions","exceptType","label_side","getEntity","stack","axis_y","PREFIXEDSTACKDIM","TIMEDIM","updateUIStrings","items","getKeys","_createLimits","markers","translator","getTFunction","xTitle","selectAll","data","enter","append","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","toggle","conceptPropsX","setIcon","style","Number","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","root","getBoundingClientRect","chartRect","node","setHook","setPos","left","hide","_this3","duration","delayAnimations","getScale","tickFormat","getTickFormatter","stacks","stackKeys","map","sideItems","getItems","sideKeys","sideFiltered","f","sortFunc","ascending","descending","sort","push","twoSided","classed","xScaleLeft","copy","text","a","b","result","axisX","sideKeysNF","getNestedItems","limits","getLimitsByDimensions","concat","timeKeys","getUnique","totals","inpercentMaxLimits","maxLimits","key","stackSum","sideMaxLimits","val","max","maxSideLimit","Math","apply","zero","scaleType","domainMin","domainMax","_interpolateBetweenTotals","nextStep","fraction","reorder","prefixedSideDim","stackBars","slice","entityBars","exit","remove","barHeight","firstBarOffsetY","merge","sideBars","r","sideSel","highlighted","mouseover","mouseout","click","onTap","tap","activeProfile","centerWidth","transition","ease","easeLinear","interrupt","_setYear","formatDate","timeValue","formattedTime","isTouchDevice","highlightMarker","clearHighlighted","selectMarker","event","stopPropagation","someHighlighted","highlight","_showLabel","formatter","format","label","bar","textData","label_stack","stackItems","presentationProfileChanges","medium","margin","right","bottom","infoElHeight","large","top","profiles","small","titlesSpacing","getActiveProfile","parseInt","warn","abs","range","maxRange","scale","tickValues","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","limitMaxTickNumber","translateX","rangePoints","zeroTickEl","empty","zeroTickWidth","tickNodes","nodes","titleBBox","t","transform","hTranslate","translateY","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","isHighlighted","isSelected"],"mappings":"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","file":"barchart-ds.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 4);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n__webpack_require__(2);\n\nvar _component = __webpack_require__(1);\n\nvar _component2 = _interopRequireDefault(_component);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar VERSION_INFO = { version: \"2.0.0\", build: 1516906861908 };\n\n//BAR CHART TOOL\nvar BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init: function init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component: _component2.default,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n  validate: function validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      var entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        var show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      var entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim || model.state.entities_side.dim === entities_geodomain.dim;\n    }\n  },\n\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: {}\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils,\n    Component = _Vizabi.Component,\n    axisSmart = _Vizabi.helpers[\"d3.axisWithLabelPicker\"],\n    iconQuestion = _Vizabi.iconset.question;\n\n// BARCHARTDS  CHART COMPONENT\n\nvar BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init: function init(config, context) {\n    this.name = \"barchartds\";\n    this.template = __webpack_require__(3);\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"marker\"\n    }, {\n      name: \"marker_order\",\n      type: \"marker\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    var _this = this;\n    this.model_binds = {\n      \"change:time.value\": function changeTimeValue(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          var next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && _this.timeSteps[next] - _this.model.time.value) {\n            _this.snapped = true;\n            var time = _this.model.time.value;\n            var prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            var snapTime = time - prev < next - time ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n          //          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n          _this.model.marker.getFrame(_this.model.time.value, function (frame) {\n            _this.frame = frame;\n            _this.frameAxisX = frame.axis_x;\n            _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n              _this.frameOrder = frameOrder.hook_order;\n\n              _this._reorderBars();\n              _this._updateEntities(true);\n              _this.updateBarsOpacity();\n            });\n          });\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function changeMarker(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function changeMarkerSelect(evt) {\n        _this.someSelected = _this.model.marker.select.length > 0;\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function changeMarkerHighlight(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function changeMarkerOpacitySelectDim() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function changeMarkerOpacityRegular() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function changeMarkerColorPalette(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function changeMarkerColorScaleType(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function changeMarkerColorWhich(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker_order.hook_order.which = _this.model.marker.color.which;\n      },\n      \"change:marker.side.which\": function changeMarkerSideWhich(evt) {\n        if (!_this._readyOnce) return;\n        var sideDim = void 0;\n        var show = {};\n        var entitiesSideProps = {};\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          var sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n        //        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.marker.side.clearSideState();\n        var skipFilterSide = sideDim !== _this.geoDomainDimension;\n        if (!skipFilterSide) {\n          show[\"is--\" + _this.model.marker.side.which] = true;\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        entitiesSideProps[\"show\"] = show;\n        entitiesSideProps[\"dim\"] = sideDim;\n        _this.model.entities_side.set(entitiesSideProps);\n        _this.model.entities_geodomain.skipFilter = (sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) && (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n      },\n      \"change:entities.show\": function changeEntitiesShow(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim && !utils.isEmpty(_this.model.entities_side.show)) {\n          var showEntities = _this.model.entities_side.getFilteredEntities().filter(function (s) {\n            return !_this.model.entities.isShown(s);\n          });\n          if (showEntities.length) {\n            _this.model.marker.side.clearSideState();\n            _this.model.entities_side.showEntity(showEntities);\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = (_this.SIDEDIM === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) && (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n      },\n      \"change:entities_side.show\": function changeEntities_sideShow(evt) {\n        if (!_this._readyOnce) return;\n        var doReturn = false;\n        var _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, function (h) {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide) {\n          _this.model.entities.getFilteredEntities();\n          var showEntities = _this.model.entities_side.getFilteredEntities().filter(function (s) {\n            return !_entitiesSameDimWithSide.isShown(s);\n          });\n          if (showEntities.length) {\n            _entitiesSameDimWithSide.showEntity(showEntities);\n            doReturn = true;\n          }\n        }\n        if (_this.SIDEDIM !== _this.model.entities_side.dim) {\n          doReturn = true;\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities(true);\n      },\n      \"change:ui.chart.inpercent\": function changeUiChartInpercent(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function changeUiChartFlipSides(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities(true);\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n\n    this.totalFieldName = \"Total\";\n  },\n  checkDimensions: function checkDimensions() {\n    var stackDim = this.model.entities.dim;\n    var sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.which == this.TIME;\n    this.stackSkip = stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n\n  /**\n   * DOM is ready\n   */\n  readyOnce: function readyOnce() {\n    var _this = this;\n    this.el = this.el ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-stack\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = ((this.model.entities_geodomain.show[this.geoDomainDimension] || {})[\"$in\"] || {})[0];\n\n    _this.someSelected = _this.model.marker.select.length > 0;\n    _this.nonSelectedOpacityZero = false;\n\n    this.on(\"resize\", function () {\n      _this._updateEntities();\n    });\n\n    this._attributeUpdaters = {\n      _newWidth: function _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        var width = _this.frameAxisX[utils.getKey(d, _this.KEYS)];\n        // let width;\n        // if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.geoLess && _this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        // } else if (_this.geoLess && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        // } else if (_this.sideSkip) {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        // } else {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        // }\n\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX: function _newX(d, i) {\n        var prevSbl = this.previousSibling;\n        if (prevSbl) {\n          var prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      },\n      _newColor: function _newColor(d, i) {\n        return _this.cScale(!_this.colorUseNotProperty ? _this.frame.color[utils.getKey(d, _this.COLORKEYS)] : _this.frame.color[d[_this.STACKDIM]]);\n      }\n    };\n  },\n\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready: function ready() {\n    var _this2 = this;\n\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    var _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.TIME = this.model.marker._getFirstDimension({ type: \"time\" });\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.axis_y.getEntity();\n    this.STACKDIM = this.stack.getDimension();\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.TIMEDIM = this.model.time.getDimension();\n    this.COLORKEYS = [this.STACKDIM, this.PREFIXEDSIDEDIM];\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, function (frame) {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n        _this.frameOrder = frameOrder.hook_order;\n        _this.items = _this.model.marker.getKeys();\n        _this._createLimits();\n        _this._updateLimits();\n\n        _this._reorderBars();\n        _this.markers = _this2.model.marker.getKeys(_this.STACKDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n  updateUIStrings: function updateUIStrings() {\n    var _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    var xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-treemenu\").markerID(\"axis_x\").alignX(_this.model.locale.isRTL() ? \"right\" : \"left\").alignY(\"top\").updateView().toggle();\n    });\n\n    var conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\").style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function () {\n      if (_this.model.time.dragging) return;\n      var rect = this.getBBox();\n      var coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      var toolRect = _this.root.element.getBoundingClientRect();\n      var chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", function () {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators: function _updateIndicators() {\n    var _this3 = this;\n\n    var _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    var sideDim = this.SIDEDIM;\n    var stackDim = this.STACKDIM;\n\n    var stacks = this.model.marker.getKeys(stackDim);\n    var stackKeys = [];\n    stackKeys = stacks.map(function (m) {\n      return m[stackDim];\n    });\n    this.stackKeys = stackKeys;\n\n    var sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    var sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      var sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      var sides = this.model.marker.getKeys(sideDim).filter(function (f) {\n        return !sideFiltered || _this3.model.marker.side.getEntity().isShown(f);\n      });\n      sideKeys = sides.map(function (m) {\n        return m[sideDim];\n      });\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        var sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      var title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n  _reorderBars: function _reorderBars() {\n    var _this = this;\n    var domain = this.yScale.domain();\n    var sideKeys = this.sideKeys;\n    domain.sort(function (a, b) {\n      var result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending((_this.frameAxisX[a] || {})[sideKeys[0]] || 0, (_this.frameAxisX[b] || {})[sideKeys[0]] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n  _createLimits: function _createLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    var sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    var keys = this.sideSkip ? [] : [this.SIDEDIM];\n    var limits = axisX.getLimitsByDimensions(keys.concat([this.STACKDIM, this.TIMEDIM]));\n    var timeKeys = axisX.getUnique();\n    var totals = {};\n    var inpercentMaxLimits = {};\n    var maxLimits = {};\n    var key = void 0;\n    sideKeysNF.forEach(function (s) {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.sideSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        var stackSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.stackKeys, function (stack) {\n          if (limits[stack] && limits[stack][time]) {\n            var val = limits[stack][time].max;\n            stackSum += val;\n            sideMaxLimits.push(val);\n          }\n        });\n        totals[time][sideKeysNF[0]] = stackSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / stackSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var stackSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.stackKeys, function (stack) {\n            key = side + \",\" + stack;\n            if (limits[key] && limits[key][time]) {\n              var val = limits[key][time].max;\n              stackSum += val;\n              sideMaxLimits.push(val);\n            }\n          });\n          totals[time][side] = stackSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / stackSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(function (s) {\n      _this.maxLimits[s] = Math.max.apply(Math, _toConsumableArray(maxLimits[s]));\n      _this.inpercentMaxLimits[s] = Math.max.apply(Math, _toConsumableArray(inpercentMaxLimits[s]));\n    });\n    this.totals = totals;\n  },\n  _updateLimits: function _updateLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n    var zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    var domain = void 0;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.inpercentMaxLimits[s];\n      })))];\n    } else {\n      domain = axisX.domainMin != null && axisX.domainMax != null ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.maxLimits[s];\n      })))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n  _interpolateBetweenTotals: function _interpolateBetweenTotals(timeSteps, totals, time) {\n    var nextStep = d3.bisectLeft(timeSteps, time);\n    var fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    var total = {};\n    utils.forEach(this.sideKeys, function (side) {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n    });\n    return total;\n  },\n\n\n  /**\n   * Updates entities\n   */\n  _updateEntities: function _updateEntities(reorder) {\n    var _this = this;\n    var time = this.model.time;\n    var sideDim = this.SIDEDIM;\n    var prefixedSideDim = this.PREFIXEDSIDEDIM;\n    var stackDim = this.STACKDIM;\n    var prefixedStackDim = this.PREFIXEDSTACKDIM;\n    var timeDim = this.TIMEDIM;\n    var duration = time.playing ? time.delayAnimations : 0;\n    var total = void 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    var domain = this.yScale.domain();\n\n    var stackBars = this.markers.slice(0);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\").data(stackBars, function (d) {\n      return d[stackDim];\n    });\n    //exit selection\n    this.entityBars.exit().remove();\n\n    var barHeight = this.barHeight;\n    var firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\").attr(\"class\", function (d) {\n      return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[stackDim];\n    }).attr(\"transform\", function (d, i) {\n      return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\";\n    }).merge(this.entityBars);\n\n    var _attributeUpdaters = this._attributeUpdaters;\n\n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(function (d) {\n      return _this.sideKeys.map(function (m) {\n        var r = {};\n        r[stackDim] = d[stackDim];\n        r[prefixedSideDim] = m;\n        r[sideDim] = m;\n        return r;\n      });\n    }, function (d) {\n      return d[prefixedSideDim];\n    });\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\");\n    }).call(function (sideSel) {\n      sideSel.append(\"rect\").attr(\"class\", function (d, i) {\n        return \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\");\n      }).attr(\"y\", 0).attr(\"height\", barHeight).attr(\"fill\", _attributeUpdaters._newColor).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX).on(\"mouseover\", _this.interaction.mouseover).on(\"mouseout\", _this.interaction.mouseout).on(\"click\", _this.interaction.click).onTap(_this.interaction.tap);\n    }).merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", function (d, i) {\n        return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n      });\n    }\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\");\n\n    if (reorder) this.stackBars.attr(\"fill\", _attributeUpdaters._newColor);\n\n    if (duration) {\n      var transition = d3.transition().duration(duration).ease(d3.easeLinear);\n\n      this.entityBars\n      //.transition(transition)\n      .attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\";\n      });\n      this.stackBars.transition(transition).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt().attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\";\n      });\n      this.stackBars.interrupt().attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear).on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n  _setYear: function _setYear(timeValue) {\n    var formattedTime = this.model.time.formatDate(timeValue);\n    return function () {\n      d3.select(this).text(formattedTime);\n    };\n  },\n  _interaction: function _interaction() {\n    var _this = this;\n    return {\n      mouseover: function mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout: function mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click: function click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap: function tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n  _highlightBars: function _highlightBars(d) {\n    var _this = this;\n\n    _this.someHighlighted = _this.model.marker.highlight.length > 0;\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n  _showLabel: function _showLabel(d) {\n    if (!this.frame) return;\n\n    var _this = this;\n    var formatter = _this.ui.chart.inpercent ? d3.format(\".2%\") : _this.model.marker.axis_x.getTickFormatter();\n    var sideDim = _this.SIDEDIM;\n    var stackDim = _this.STACKDIM;\n    var KEYS = this.KEYS;\n\n    var left = _this.sideKeys.indexOf(d[sideDim]);\n    var label = _this.labels.select(\".vzb-bc-label\");\n    var bar = _this.bars.select(\".vzb-bc-bar-\" + d[stackDim]);\n    label.attr(\"transform\", bar.attr(\"transform\")).select(\".vzb-bc-stack\").text(function (textData) {\n      var text = _this.frame.label_stack[d[stackDim]];\n      text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n      var total = _this.ui.chart.inpercent ? _this.total[d[sideDim]] : 1;\n      var value = _this.frameAxisX[utils.getKey(d, KEYS)] / total;\n      return text + \": \" + formatter(value);\n    }).attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7)).classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize: function resize() {\n\n    var _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    var margin = this.activeProfile.margin;\n    var infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom || 0;\n    this.width = parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"BarchartDS resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    var domain = this.yScale.domain();\n    // height per bar is total domain height divided by the number of possible markers in the domain\n    var barHeight = this.barHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / Math.abs(domain[1] - domain[0]);\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars.attr(\"transform\", function (d, i) {\n      return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n    });\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    var maxRange = this.twoSided ? (this.width - this.activeProfile.centerWidth) * 0.5 : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale).tickValues([]).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width, 0).labelerOptions({\n      scaleType: this.model.marker.axis_y.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 1\n    });\n\n    var format = this.ui.chart.inpercent ? d3.format(\".1%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n      scaleType: this.model.marker.axis_x.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 6\n    });\n\n    var translateX = this.twoSided ? (this.width + _this.activeProfile.centerWidth) * 0.5 : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\").call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\").call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\").call(this.xAxisLeft);\n      var zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        var zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n\n      //hide left axis zero tick\n      var tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n    }\n\n    var isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title.attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0)).style(\"text-anchor\", this.twoSided ? \"end\" : \"\").attr(\"y\", margin.top * 0.7);\n    this.titleRight.attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing).attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl.style(\"font-size\", infoElHeight + \"px\").attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + margin.top * 0.4 + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      var titleBBox = this.xTitleEl.node().getBBox();\n      var t = utils.transform(this.xTitleEl.node());\n      var hTranslate = isRTL ? titleBBox.x + t.translateX - infoElHeight * 1.4 : titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4;\n\n      this.xInfoEl.select(\"svg\").attr(\"width\", infoElHeight + \"px\").attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n  },\n  updateBarsOpacity: function updateBarsOpacity(duration) {\n    var _this = this;\n    //if(!duration)duration = 0;\n\n    var OPACITY_HIGHLT = 1.0;\n    var OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    var OPACITY_SELECT = 1.0;\n    var OPACITY_REGULAR = this.model.marker.opacityRegular;\n    var OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n    .style(\"opacity\", function (d) {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n    });\n\n    this.stackBars.style(\"stroke\", function (d) {\n      return _this.model.marker.isSelected(d) ? \"#333\" : null;\n    });\n\n    var nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", function (d) {\n        return !_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d) ? \"visible\" : \"none\";\n      });\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\nmodule.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-stack\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(0);\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// barchart-ds.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f58c412da383836e7a47","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n//BAR CHART TOOL\nconst BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      const entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        const show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      const entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim ||\n        model.state.entities_side.dim === entities_geodomain.dim;\n    }\n  },\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: { }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const {\n  utils,\n  Component,\n  helpers: {\n    \"d3.axisWithLabelPicker\": axisSmart\n  },\n  iconset: {\n    question: iconQuestion\n  },\n} = Vizabi;\n\n// BARCHARTDS  CHART COMPONENT\nconst BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    this.name = \"barchartds\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"marker\"\n    }, {\n      name: \"marker_order\",\n      type: \"marker\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    const _this = this;\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          let next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && (_this.timeSteps[next] - _this.model.time.value)) {\n            _this.snapped = true;\n            const time = _this.model.time.value;\n            const prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            const snapTime = (time - prev) < (next - time) ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n//          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n            _this.model.marker.getFrame(_this.model.time.value, frame => {\n              _this.frame = frame;\n              _this.frameAxisX = frame.axis_x;\n              _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n                _this.frameOrder = frameOrder.hook_order;\n\n                _this._reorderBars();\n                _this._updateEntities(true);\n                _this.updateBarsOpacity();\n              });\n            });\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function(evt) {\n        _this.someSelected = (_this.model.marker.select.length > 0);\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker_order.hook_order.which = _this.model.marker.color.which;\n      },\n      \"change:marker.side.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let sideDim;\n        const show = {};\n        const entitiesSideProps = {}\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          const sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n//        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.marker.side.clearSideState();\n        const skipFilterSide = sideDim !== _this.geoDomainDimension;\n        if (!skipFilterSide) {\n          show[\"is--\" + _this.model.marker.side.which] = true;\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        entitiesSideProps[\"show\"] = show;\n        entitiesSideProps[\"dim\"] = sideDim;\n        _this.model.entities_side.set(entitiesSideProps);\n        _this.model.entities_geodomain.skipFilter = (sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) &&\n          (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n\n      },\n      \"change:entities.show\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim\n          && !utils.isEmpty(_this.model.entities_side.show)) {\n          const showEntities = _this.model.entities_side.getFilteredEntities().filter(s => !_this.model.entities.isShown(s));\n          if (showEntities.length) {\n            _this.model.marker.side.clearSideState();\n            _this.model.entities_side.showEntity(showEntities);\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = (_this.SIDEDIM === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) &&\n          (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n\n      },\n      \"change:entities_side.show\": function(evt) {\n        if (!_this._readyOnce) return;\n        let doReturn = false;\n        let _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, h => {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide) {\n          _this.model.entities.getFilteredEntities();\n          const showEntities = _this.model.entities_side.getFilteredEntities().filter(s => !_entitiesSameDimWithSide.isShown(s));\n          if (showEntities.length) {\n            _entitiesSameDimWithSide.showEntity(showEntities);\n            doReturn = true;\n          }\n        }\n        if (_this.SIDEDIM !== _this.model.entities_side.dim) {\n          doReturn = true;\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities(true);\n      },\n      \"change:ui.chart.inpercent\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities(true);\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n\n    this.totalFieldName = \"Total\";\n  },\n\n  checkDimensions() {\n    const stackDim = this.model.entities.dim;\n    const sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.which == this.TIME;\n    this.stackSkip = stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n  /**\n   * DOM is ready\n   */\n  readyOnce() {\n    const _this = this;\n    this.el = (this.el) ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-stack\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = ((this.model.entities_geodomain.show[this.geoDomainDimension] || {})[\"$in\"] || {})[0];\n\n    _this.someSelected = (_this.model.marker.select.length > 0);\n    _this.nonSelectedOpacityZero = false;\n\n\n    this.on(\"resize\", () => {\n      _this._updateEntities();\n  });\n\n    this._attributeUpdaters = {\n      _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        const width = _this.frameAxisX[utils.getKey(d, _this.KEYS)];\n        // let width;\n        // if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.geoLess && _this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        // } else if (_this.geoLess && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        // } else if (_this.sideSkip) {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        // } else {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        // }\n        \n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX(d, i) {\n        const prevSbl = this.previousSibling;\n        if (prevSbl) {\n          const prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      },\n      _newColor(d, i) {\n        return _this.cScale(!_this.colorUseNotProperty ? _this.frame.color[utils.getKey(d, _this.COLORKEYS)] : _this.frame.color[d[_this.STACKDIM]]);\n      }\n    };\n  },\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready() {\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    const _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.TIME = this.model.marker._getFirstDimension({ type: \"time\" });\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.axis_y.getEntity();\n    this.STACKDIM = this.stack.getDimension();\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.TIMEDIM = this.model.time.getDimension();\n    this.COLORKEYS = [this.STACKDIM, this.PREFIXEDSIDEDIM];\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, frame => {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n        _this.frameOrder = frameOrder.hook_order;\n        _this.items = _this.model.marker.getKeys();\n        _this._createLimits();\n        _this._updateLimits();\n  \n        _this._reorderBars();\n        _this.markers = this.model.marker.getKeys(_this.STACKDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_x\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    const conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators() {\n    const _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    const sideDim = this.SIDEDIM;\n    const stackDim = this.STACKDIM;\n\n    const stacks = this.model.marker.getKeys(stackDim);\n    let stackKeys = [];\n    stackKeys = stacks.map(m => m[stackDim]);\n    this.stackKeys = stackKeys;\n\n    const sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    let sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      const sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      const sides = this.model.marker.getKeys(sideDim)\n          .filter(f => !sideFiltered || this.model.marker.side.getEntity().isShown(f));\n      sideKeys = sides.map(m => m[sideDim]);\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        const sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      const title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n\n  _reorderBars() {\n    const _this = this;\n    const domain = this.yScale.domain();\n    const sideKeys = this.sideKeys;\n    domain.sort((a, b) => { \n      const result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending((_this.frameAxisX[a] || {})[sideKeys[0]] || 0, (_this.frameAxisX[b] || {})[sideKeys[0]] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n\n  _createLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    const sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    const keys = this.sideSkip ? [] : [this.SIDEDIM];\n    const limits = axisX.getLimitsByDimensions(keys.concat([this.STACKDIM, this.TIMEDIM]));\n    const timeKeys = axisX.getUnique();\n    const totals = {};\n    const inpercentMaxLimits = {};\n    const maxLimits = {};\n    let key;\n    sideKeysNF.forEach(s => {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.sideSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        let stackSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.stackKeys, stack => {\n          if (limits[stack] && limits[stack][time]) {\n            const val = limits[stack][time].max;\n            stackSum += val;\n            sideMaxLimits.push(val);\n          }\n        });\n        totals[time][sideKeysNF[0]] = stackSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / stackSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else {  \n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let stackSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.stackKeys, stack => {\n            key = side + \",\" + stack;\n            if (limits[key] && limits[key][time]) {\n              const val = limits[key][time].max;\n              stackSum += val;\n              sideMaxLimits.push(val);\n            }\n          });\n          totals[time][side] = stackSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / stackSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(s => {\n      _this.maxLimits[s] = Math.max(...maxLimits[s]);\n      _this.inpercentMaxLimits[s] = Math.max(...inpercentMaxLimits[s]);\n    });\n    this.totals = totals;\n  },\n\n  _updateLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n    const zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    let domain;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max(...this.sideKeys.map(s => _this.inpercentMaxLimits[s]))];\n    } else {\n      domain = (axisX.domainMin != null && axisX.domainMax != null) ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max(...this.sideKeys.map(s => _this.maxLimits[s]))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n\n\n  _interpolateBetweenTotals(timeSteps, totals, time) {\n    const nextStep = d3.bisectLeft(timeSteps, time);\n    const fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    const total = {};\n    utils.forEach(this.sideKeys, side => {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n  });\n    return total;\n  },\n\n  /**\n   * Updates entities\n   */\n  _updateEntities(reorder) {\n    const _this = this;\n    const time = this.model.time;\n    const sideDim = this.SIDEDIM;\n    const prefixedSideDim = this.PREFIXEDSIDEDIM;\n    const stackDim = this.STACKDIM;\n    const prefixedStackDim = this.PREFIXEDSTACKDIM;\n    const timeDim = this.TIMEDIM;\n    const duration = (time.playing) ? time.delayAnimations : 0;\n    let total;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    const domain = this.yScale.domain();\n\n    const stackBars = this.markers.slice(0);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\")\n        .data(stackBars, d => d[stackDim]);\n    //exit selection\n    this.entityBars.exit().remove();\n\n    const barHeight = this.barHeight;\n    const firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\")\n      .attr(\"class\", d => \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[stackDim])\n      .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\")\n      .merge(this.entityBars);\n\n    const _attributeUpdaters = this._attributeUpdaters;\n        \n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(d => _this.sideKeys.map(m => {\n        const r = {};\n    r[stackDim] = d[stackDim];\n    r[prefixedSideDim] = m;\n    r[sideDim] = m;\n    return r;\n  }), d => d[prefixedSideDim]);\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\")\n      .attr(\"class\", (d, i) => \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\"))\n      .call((sideSel) => {\n        sideSel.append(\"rect\")\n          .attr(\"class\", (d, i) => \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\"))\n          .attr(\"y\", 0)\n          .attr(\"height\", barHeight)\n          .attr(\"fill\", _attributeUpdaters._newColor)\n          .attr(\"width\", _attributeUpdaters._newWidth)\n          .attr(\"x\", _attributeUpdaters._newX)\n          .on(\"mouseover\", _this.interaction.mouseover)\n          .on(\"mouseout\", _this.interaction.mouseout)\n          .on(\"click\", _this.interaction.click)\n          .onTap(_this.interaction.tap);\n      })\n      .merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n    }\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\");\n\n    if (reorder) this.stackBars\n      .attr(\"fill\", _attributeUpdaters._newColor);\n\n    if (duration) {\n      const transition = d3.transition()\n        .duration(duration)\n        .ease(d3.easeLinear);\n\n      this.entityBars\n        //.transition(transition)\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\");\n      this.stackBars\n        .transition(transition)\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt()\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\");\n      this.stackBars.interrupt()\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear)\n        .on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n\n  _setYear(timeValue) {\n    const formattedTime = this.model.time.formatDate(timeValue);\n    return function() { d3.select(this).text(formattedTime); };\n  },\n\n  _interaction() {\n    const _this = this;\n    return {\n      mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n\n  _highlightBars(d) {\n    const _this = this;\n\n    _this.someHighlighted = (_this.model.marker.highlight.length > 0);\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n\n  _showLabel(d) {\n    if (!this.frame) return;\n    \n    const _this = this;\n    const formatter = _this.ui.chart.inpercent ? d3.format(\".2%\") : _this.model.marker.axis_x.getTickFormatter();\n    const sideDim = _this.SIDEDIM;\n    const stackDim = _this.STACKDIM;\n    const KEYS = this.KEYS;\n\n    const left = _this.sideKeys.indexOf(d[sideDim]);\n    const label = _this.labels.select(\".vzb-bc-label\");\n    const bar = _this.bars.select(\".vzb-bc-bar-\" + d[stackDim]);\n    label.attr(\"transform\", bar.attr(\"transform\"))\n      .select(\".vzb-bc-stack\")\n      .text(textData => {\n        let text = _this.frame.label_stack[d[stackDim]];\n        text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n        const total = _this.ui.chart.inpercent ? _this.total[d[sideDim]] : 1;\n        const value = _this.frameAxisX[utils.getKey(d, KEYS)] / total;\n        return text + \": \" + formatter(value);\n      })\n      .attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7))\n      .classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize() {\n\n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"BarchartDS resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    const domain = this.yScale.domain();\n    // height per bar is total domain height divided by the number of possible markers in the domain\n    const barHeight = this.barHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / Math.abs(domain[1] - domain[0]);\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars\n      .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    const maxRange = this.twoSided ? ((this.width - this.activeProfile.centerWidth) * 0.5) : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale)\n      .tickValues([])\n      .tickSizeInner(-this.width)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.width, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 1\n      });\n\n    const format = this.ui.chart.inpercent ? d3.format(\".1%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale)\n      .tickFormat(format)\n      .tickSizeInner(-this.height)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.height, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n    const translateX = this.twoSided ? ((this.width + _this.activeProfile.centerWidth) * 0.5) : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\")\n      .call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\")\n      .call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft)\n        .tickFormat(format)\n        .tickSizeInner(-this.height)\n        .tickSizeOuter(0)\n        .tickPadding(6)\n        .tickSizeMinor(-this.height, 0)\n        .labelerOptions({\n          scaleType: this.model.marker.axis_x.scaleType,\n          toolMargin: margin,\n          limitMaxTickNumber: 6\n        });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\")\n        .call(this.xAxisLeft);\n      const zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        const zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n   \n      //hide left axis zero tick\n      const tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n   }\n\n    const isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title\n      .attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0))\n      .style(\"text-anchor\", this.twoSided ? \"end\" : \"\")\n      .attr(\"y\", margin.top * 0.7);\n    this.titleRight\n      .attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing)\n      .attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + (margin.top * 0.4) + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n\n  },\n\n  updateBarsOpacity(duration) {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n      .style(\"opacity\", d => {\n\n        if (_this.someHighlighted) {\n          //highlight or non-highlight\n          if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n        }\n\n        if (_this.someSelected) {\n          //selected or non-selected\n          return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n        }\n\n        if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n        return OPACITY_REGULAR;\n      });\n\n    this.stackBars.style(\"stroke\", d => _this.model.marker.isSelected(d) ? \"#333\" : null);\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","module.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-stack\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 3\n// module chunks = 0 1"],"sourceRoot":""}