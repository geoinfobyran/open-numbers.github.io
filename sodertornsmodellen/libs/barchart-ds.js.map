{"version":3,"sources":["webpack:///barchart-ds.js","webpack:///webpack/bootstrap 92f8b17602a8e698094a","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/template.html"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_component","_component2","obj","default","VERSION_INFO","version","build","BarChartDS","Vizabi","Tool","extend","init","placeholder","external_model","this","components","component","model","Component","_super","validate","entities","state","keys","show","length","dim","entities_geodomain","skipFilter","entities_side","default_model","marker_tags","ui","chart","stacked","inpercent","flipSides","buttons","dialogs","popup","sidebar","moreoptions","presentation","locale","versionInfo","_toConsumableArray","arr","Array","isArray","arr2","from","_Vizabi","utils","axisSmart","helpers","iconQuestion","iconset","question","config","context","template","model_expects","type","_this","model_binds","change:time.value","evt","_readyOnce","time","step","snapped","playing","dragging","next","d3","bisectLeft","timeSteps","prev","snapTime","Date","marker","getFrame","frame","frameAxisX","axis_x","marker_order","frameOrder","hook_order","_reorderBars","_updateEntities","updateBarsOpacity","change:marker","path","indexOf","ready","change:marker.select","someSelected","select","nonSelectedOpacityZero","change:marker.highlight","_highlightBars","change:marker.opacitySelectDim","change:marker.opacityRegular","change:marker.color.palette","change:marker.color.scaleType","change:marker.color.which","which","color","change:marker.side.which","sideDim","entitiesSideProps","side","use","sideConcept","getConceptprops","concept_type","domain","clearSideState","skipFilterSide","geoDomainDimension","set","STACKDIM","Boolean","getFilteredEntities","change:entities.show","isEmpty","showEntities","filter","isShown","showEntity","SIDEDIM","change:entities_side.show","doReturn","_entitiesSameDimWithSide","forEach","_space","h","_name","_updateIndicators","_updateLimits","resize","change:ui.chart.inpercent","change:ui.chart.flipSides","switchSideState","xScale","yScale","cScale","xAxis","xAxisLeft","yAxis","xScales","totalFieldName","checkDimensions","stackDim","colorUseNotProperty","TIME","stackSkip","geoLess","sideSkip","readyOnce","el","element","interaction","_interaction","graph","yAxisEl","xAxisEl","xAxisLeftEl","xTitleEl","xInfoEl","yTitleEl","barsCrop","labelsCrop","bars","labels","attr","title","titleRight","year","getDimension","geoDomainDefaultValue","on","_attributeUpdaters","_newWidth","width","getValueMD","KEYS","total","PREFIXEDSIDEDIM","width_","_newX","prevSbl","previousSibling","prevSblDatum","datum","x_","_newColor","_this2","_ready","getAllSteps","_getFirstDimension","unique","_getAllDimensions","exceptType","label_side","getEntity","stack","axis_y","PREFIXEDSTACKDIM","TIMEDIM","updateUIStrings","_createLimits","markers","getKeys","translator","getTFunction","xTitle","selectAll","data","enter","append","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","toggle","conceptPropsX","setIcon","style","Number","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","root","getBoundingClientRect","chartRect","node","setHook","setPos","left","hide","_this3","duration","delayAnimations","getScale","tickFormat","getTickFormatter","stacks","stackKeys","map","sideItems","getItems","sideKeys","sideFiltered","f","sortFunc","ascending","descending","sort","push","twoSided","classed","xScaleLeft","copy","text","a","b","result","axisX","sideKeysNF","getNestedItems","limits","getLimitsByDimensions","concat","timeKeys","getUnique","totals","inpercentMaxLimits","maxLimits","stackSum","sideMaxLimits","val","max","maxSideLimit","Math","apply","zero","scaleType","domainMin","domainMax","_interpolateBetweenTotals","nextStep","fraction","reorder","prefixedSideDim","stackBars","slice","entityBars","exit","remove","barHeight","firstBarOffsetY","merge","sideBars","r","sideSel","highlighted","mouseover","mouseout","click","onTap","tap","activeProfile","centerWidth","transition","ease","easeLinear","interrupt","_setYear","formatDate","timeValue","formattedTime","isTouchDevice","highlightMarker","clearHighlighted","selectMarker","event","stopPropagation","someHighlighted","highlight","_showLabel","formatter","format","label","bar","textData","label_stack","stackItems","presentationProfileChanges","medium","margin","right","bottom","infoElHeight","large","top","profiles","small","titlesSpacing","getActiveProfile","parseInt","warn","abs","range","maxRange","scale","tickValues","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","limitMaxTickNumber","translateX","rangePoints","zeroTickEl","empty","zeroTickWidth","tickNodes","nodes","titleBBox","t","transform","hTranslate","translateY","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_SELECT","opacityRegular","OPACITY_REGULAR","OPACITY_SELECT_DIM","opacitySelectDim","isHighlighted","isSelected"],"mappings":"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","file":"barchart-ds.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 4);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n__webpack_require__(2);\n\nvar _component = __webpack_require__(1);\n\nvar _component2 = _interopRequireDefault(_component);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar VERSION_INFO = { version: \"1.0.8\", build: 1503749775687 };\n\n//BAR CHART TOOL\nvar BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init: function init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component: _component2.default,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n  validate: function validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      var entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        var show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      var entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim || model.state.entities_side.dim === entities_geodomain.dim;\n    }\n  },\n\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: {}\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils,\n    Component = _Vizabi.Component,\n    axisSmart = _Vizabi.helpers[\"d3.axisWithLabelPicker\"],\n    iconQuestion = _Vizabi.iconset.question;\n\n// BARCHARTDS  CHART COMPONENT\n\nvar BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init: function init(config, context) {\n    this.name = \"barchartds\";\n    this.template = __webpack_require__(3);\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"model\"\n    }, {\n      name: \"marker_order\",\n      type: \"model\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    var _this = this;\n    this.model_binds = {\n      \"change:time.value\": function changeTimeValue(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          var next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && _this.timeSteps[next] - _this.model.time.value) {\n            _this.snapped = true;\n            var time = _this.model.time.value;\n            var prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            var snapTime = time - prev < next - time ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n          //          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n          _this.model.marker.getFrame(_this.model.time.value, function (frame) {\n            _this.frame = frame;\n            _this.frameAxisX = frame.axis_x;\n            _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n              _this.frameOrder = frameOrder.hook_order;\n\n              _this._reorderBars();\n              _this._updateEntities(true);\n              _this.updateBarsOpacity();\n            });\n          });\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function changeMarker(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function changeMarkerSelect(evt) {\n        _this.someSelected = _this.model.marker.select.length > 0;\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function changeMarkerHighlight(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function changeMarkerOpacitySelectDim() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function changeMarkerOpacityRegular() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function changeMarkerColorPalette(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function changeMarkerColorScaleType(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function changeMarkerColorWhich(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker_order.hook_order.which = _this.model.marker.color.which;\n      },\n      \"change:marker.side.which\": function changeMarkerSideWhich(evt) {\n        if (!_this._readyOnce) return;\n        var sideDim = void 0;\n        var show = {};\n        var entitiesSideProps = {};\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          var sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n        //        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.marker.side.clearSideState();\n        var skipFilterSide = sideDim !== _this.geoDomainDimension;\n        if (!skipFilterSide) {\n          show[\"is--\" + _this.model.marker.side.which] = true;\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        entitiesSideProps[\"show\"] = show;\n        entitiesSideProps[\"dim\"] = sideDim;\n        _this.model.entities_side.set(entitiesSideProps);\n        _this.model.entities_geodomain.skipFilter = (sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) && (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n      },\n      \"change:entities.show\": function changeEntitiesShow(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim && !utils.isEmpty(_this.model.entities_side.show)) {\n          var showEntities = _this.model.entities_side.getFilteredEntities().filter(function (s) {\n            return !_this.model.entities.isShown(s);\n          });\n          if (showEntities.length) {\n            _this.model.marker.side.clearSideState();\n            _this.model.entities_side.showEntity(showEntities);\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = (_this.SIDEDIM === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) && (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n      },\n      \"change:entities_side.show\": function changeEntities_sideShow(evt) {\n        if (!_this._readyOnce) return;\n        var doReturn = false;\n        var _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, function (h) {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide) {\n          _this.model.entities.getFilteredEntities();\n          var showEntities = _this.model.entities_side.getFilteredEntities().filter(function (s) {\n            return !_entitiesSameDimWithSide.isShown(s);\n          });\n          if (showEntities.length) {\n            _entitiesSameDimWithSide.showEntity(showEntities);\n            doReturn = true;\n          }\n        }\n        if (_this.SIDEDIM !== _this.model.entities_side.dim) {\n          doReturn = true;\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities(true);\n      },\n      \"change:ui.chart.inpercent\": function changeUiChartInpercent(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function changeUiChartFlipSides(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities(true);\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n\n    this.totalFieldName = \"Total\";\n  },\n  checkDimensions: function checkDimensions() {\n    var stackDim = this.model.entities.dim;\n    var sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.which == this.TIME;\n    this.stackSkip = stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n\n  /**\n   * DOM is ready\n   */\n  readyOnce: function readyOnce() {\n    var _this = this;\n    this.el = this.el ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-stack\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = ((this.model.entities_geodomain.show[this.geoDomainDimension] || {})[\"$in\"] || {})[0];\n\n    _this.someSelected = _this.model.marker.select.length > 0;\n    _this.nonSelectedOpacityZero = false;\n\n    this.on(\"resize\", function () {\n      _this._updateEntities();\n    });\n\n    this._attributeUpdaters = {\n      _newWidth: function _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        var width = utils.getValueMD(d, _this.frameAxisX, _this.KEYS);\n        // let width;\n        // if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.geoLess && _this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        // } else if (_this.geoLess && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        // } else if (_this.sideSkip) {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        // } else {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        // }\n\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX: function _newX(d, i) {\n        var prevSbl = this.previousSibling;\n        if (prevSbl) {\n          var prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      },\n      _newColor: function _newColor(d, i) {\n        return _this.cScale(!_this.colorUseNotProperty ? (_this.frame.color[d[_this.STACKDIM]] || {})[d[_this.PREFIXEDSIDEDIM]] : _this.frame.color[d[_this.STACKDIM]]);\n      }\n    };\n  },\n\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready: function ready() {\n    var _this2 = this;\n\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    var _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.TIME = this.model.marker._getFirstDimension({ type: \"time\" });\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.axis_y.getEntity();\n    this.STACKDIM = this.stack.getDimension();\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.TIMEDIM = this.model.time.getDimension();\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, function (frame) {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n        _this.frameOrder = frameOrder.hook_order;\n        _this._createLimits();\n        _this._updateLimits();\n\n        _this._reorderBars();\n        _this.markers = _this2.model.marker.getKeys(_this.STACKDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n  updateUIStrings: function updateUIStrings() {\n    var _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    var xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-treemenu\").markerID(\"axis_x\").alignX(_this.model.locale.isRTL() ? \"right\" : \"left\").alignY(\"top\").updateView().toggle();\n    });\n\n    var conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\").style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function () {\n      if (_this.model.time.dragging) return;\n      var rect = this.getBBox();\n      var coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      var toolRect = _this.root.element.getBoundingClientRect();\n      var chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", function () {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators: function _updateIndicators() {\n    var _this3 = this;\n\n    var _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    var sideDim = this.SIDEDIM;\n    var stackDim = this.STACKDIM;\n\n    var stacks = this.model.marker.getKeys(stackDim);\n    var stackKeys = [];\n    stackKeys = stacks.map(function (m) {\n      return m[stackDim];\n    });\n    this.stackKeys = stackKeys;\n\n    var sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    var sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      var sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      var sides = this.model.marker.getKeys(sideDim).filter(function (f) {\n        return !sideFiltered || _this3.model.marker.side.getEntity().isShown(f);\n      });\n      sideKeys = sides.map(function (m) {\n        return m[sideDim];\n      });\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        var sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      var title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n  _reorderBars: function _reorderBars() {\n    var _this = this;\n    var domain = this.yScale.domain();\n    var sideKeys = this.sideKeys;\n    domain.sort(function (a, b) {\n      var result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending((_this.frameAxisX[a] || {})[sideKeys[0]] || 0, (_this.frameAxisX[b] || {})[sideKeys[0]] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n  _createLimits: function _createLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    var sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    var keys = this.sideSkip ? [] : [this.SIDEDIM];\n    var limits = axisX.getLimitsByDimensions(keys.concat([this.STACKDIM, this.TIMEDIM]));\n    var timeKeys = axisX.getUnique();\n    var totals = {};\n    var inpercentMaxLimits = {};\n    var maxLimits = {};\n    sideKeysNF.forEach(function (s) {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.sideSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        var stackSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.stackKeys, function (stack) {\n          if (limits[stack] && limits[stack][time]) {\n            var val = limits[stack][time].max;\n            stackSum += val;\n            sideMaxLimits.push(val);\n          }\n        });\n        totals[time][sideKeysNF[0]] = stackSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / stackSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var stackSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.stackKeys, function (stack) {\n            if (limits[side] && limits[side][stack] && limits[side][stack][time]) {\n              var val = limits[side][stack][time].max;\n              stackSum += val;\n              sideMaxLimits.push(val);\n            }\n          });\n          totals[time][side] = stackSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / stackSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(function (s) {\n      _this.maxLimits[s] = Math.max.apply(Math, _toConsumableArray(maxLimits[s]));\n      _this.inpercentMaxLimits[s] = Math.max.apply(Math, _toConsumableArray(inpercentMaxLimits[s]));\n    });\n    this.totals = totals;\n  },\n  _updateLimits: function _updateLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n    var zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    var domain = void 0;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.inpercentMaxLimits[s];\n      })))];\n    } else {\n      domain = axisX.domainMin != null && axisX.domainMax != null ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.maxLimits[s];\n      })))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n  _interpolateBetweenTotals: function _interpolateBetweenTotals(timeSteps, totals, time) {\n    var nextStep = d3.bisectLeft(timeSteps, time);\n    var fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    var total = {};\n    utils.forEach(this.sideKeys, function (side) {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n    });\n    return total;\n  },\n\n\n  /**\n   * Updates entities\n   */\n  _updateEntities: function _updateEntities(reorder) {\n    var _this = this;\n    var time = this.model.time;\n    var sideDim = this.SIDEDIM;\n    var prefixedSideDim = this.PREFIXEDSIDEDIM;\n    var stackDim = this.STACKDIM;\n    var prefixedStackDim = this.PREFIXEDSTACKDIM;\n    var timeDim = this.TIMEDIM;\n    var duration = time.playing ? time.delayAnimations : 0;\n    var total = void 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    var domain = this.yScale.domain();\n\n    var stackBars = this.markers.slice(0);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\").data(stackBars, function (d) {\n      return d[stackDim];\n    });\n    //exit selection\n    this.entityBars.exit().remove();\n\n    var barHeight = this.barHeight;\n    var firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\").attr(\"class\", function (d) {\n      return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[stackDim];\n    }).attr(\"transform\", function (d, i) {\n      return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\";\n    }).merge(this.entityBars);\n\n    var _attributeUpdaters = this._attributeUpdaters;\n\n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(function (d) {\n      return _this.sideKeys.map(function (m) {\n        var r = {};\n        r[stackDim] = d[stackDim];\n        r[prefixedSideDim] = m;\n        r[sideDim] = m;\n        return r;\n      });\n    }, function (d) {\n      return d[prefixedSideDim];\n    });\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\");\n    }).call(function (sideSel) {\n      sideSel.append(\"rect\").attr(\"class\", function (d, i) {\n        return \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\");\n      }).attr(\"y\", 0).attr(\"height\", barHeight).attr(\"fill\", _attributeUpdaters._newColor).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX).on(\"mouseover\", _this.interaction.mouseover).on(\"mouseout\", _this.interaction.mouseout).on(\"click\", _this.interaction.click).onTap(_this.interaction.tap);\n    }).merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", function (d, i) {\n        return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n      });\n    }\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\");\n\n    if (reorder) this.stackBars.attr(\"fill\", _attributeUpdaters._newColor);\n\n    if (duration) {\n      var transition = d3.transition().duration(duration).ease(d3.easeLinear);\n\n      this.entityBars\n      //.transition(transition)\n      .attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\";\n      });\n      this.stackBars.transition(transition).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt().attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\";\n      });\n      this.stackBars.interrupt().attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear).on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n  _setYear: function _setYear(timeValue) {\n    var formattedTime = this.model.time.formatDate(timeValue);\n    return function () {\n      d3.select(this).text(formattedTime);\n    };\n  },\n  _interaction: function _interaction() {\n    var _this = this;\n    return {\n      mouseover: function mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout: function mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click: function click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap: function tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n  _highlightBars: function _highlightBars(d) {\n    var _this = this;\n\n    _this.someHighlighted = _this.model.marker.highlight.length > 0;\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n  _showLabel: function _showLabel(d) {\n    if (!this.frame) return;\n\n    var _this = this;\n    var formatter = _this.ui.chart.inpercent ? d3.format(\".2%\") : _this.model.marker.axis_x.getTickFormatter();\n    var sideDim = _this.SIDEDIM;\n    var stackDim = _this.STACKDIM;\n    var KEYS = this.KEYS;\n\n    var left = _this.sideKeys.indexOf(d[sideDim]);\n    var label = _this.labels.select(\".vzb-bc-label\");\n    var bar = _this.bars.select(\".vzb-bc-bar-\" + d[stackDim]);\n    label.attr(\"transform\", bar.attr(\"transform\")).select(\".vzb-bc-stack\").text(function (textData) {\n      var text = _this.frame.label_stack[d[stackDim]];\n      text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n      var total = _this.ui.chart.inpercent ? _this.total[d[sideDim]] : 1;\n      var value = utils.getValueMD(d, _this.frameAxisX, KEYS) / total;\n      return text + \": \" + formatter(value);\n    }).attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7)).classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize: function resize() {\n\n    var _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    var margin = this.activeProfile.margin;\n    var infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom || 0;\n    this.width = parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"BarchartDS resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    var domain = this.yScale.domain();\n    // height per bar is total domain height divided by the number of possible markers in the domain\n    var barHeight = this.barHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / Math.abs(domain[1] - domain[0]);\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars.attr(\"transform\", function (d, i) {\n      return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n    });\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    var maxRange = this.twoSided ? (this.width - this.activeProfile.centerWidth) * 0.5 : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale).tickValues([]).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width, 0).labelerOptions({\n      scaleType: this.model.marker.axis_y.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 1\n    });\n\n    var format = this.ui.chart.inpercent ? d3.format(\".1%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n      scaleType: this.model.marker.axis_x.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 6\n    });\n\n    var translateX = this.twoSided ? (this.width + _this.activeProfile.centerWidth) * 0.5 : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\").call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\").call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\").call(this.xAxisLeft);\n      var zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        var zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n\n      //hide left axis zero tick\n      var tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n    }\n\n    var isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title.attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0)).style(\"text-anchor\", this.twoSided ? \"end\" : \"\").attr(\"y\", margin.top * 0.7);\n    this.titleRight.attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing).attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl.style(\"font-size\", infoElHeight + \"px\").attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + margin.top * 0.4 + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      var titleBBox = this.xTitleEl.node().getBBox();\n      var t = utils.transform(this.xTitleEl.node());\n      var hTranslate = isRTL ? titleBBox.x + t.translateX - infoElHeight * 1.4 : titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4;\n\n      this.xInfoEl.select(\"svg\").attr(\"width\", infoElHeight + \"px\").attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n  },\n  updateBarsOpacity: function updateBarsOpacity(duration) {\n    var _this = this;\n    //if(!duration)duration = 0;\n\n    var OPACITY_HIGHLT = 1.0;\n    var OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    var OPACITY_SELECT = this.model.marker.opacityRegular;\n    var OPACITY_REGULAR = this.model.marker.opacityRegular;\n    var OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n    .style(\"opacity\", function (d) {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n    });\n\n    this.stackBars.style(\"stroke\", function (d) {\n      return _this.model.marker.isSelected(d) ? \"#333\" : null;\n    });\n\n    var nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", function (d) {\n        return !_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d) ? \"visible\" : \"none\";\n      });\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\nmodule.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-stack\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(0);\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// barchart-ds.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 92f8b17602a8e698094a","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n//BAR CHART TOOL\nconst BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      const entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        const show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      const entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim ||\n        model.state.entities_side.dim === entities_geodomain.dim;\n    }\n  },\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: { }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const {\n  utils,\n  Component,\n  helpers: {\n    \"d3.axisWithLabelPicker\": axisSmart\n  },\n  iconset: {\n    question: iconQuestion\n  },\n} = Vizabi;\n\n// BARCHARTDS  CHART COMPONENT\nconst BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    this.name = \"barchartds\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"model\"\n    }, {\n      name: \"marker_order\",\n      type: \"model\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    const _this = this;\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          let next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && (_this.timeSteps[next] - _this.model.time.value)) {\n            _this.snapped = true;\n            const time = _this.model.time.value;\n            const prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            const snapTime = (time - prev) < (next - time) ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n//          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n            _this.model.marker.getFrame(_this.model.time.value, frame => {\n              _this.frame = frame;\n              _this.frameAxisX = frame.axis_x;\n              _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n                _this.frameOrder = frameOrder.hook_order;\n\n                _this._reorderBars();\n                _this._updateEntities(true);\n                _this.updateBarsOpacity();\n              });\n            });\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function(evt) {\n        _this.someSelected = (_this.model.marker.select.length > 0);\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker_order.hook_order.which = _this.model.marker.color.which;\n      },\n      \"change:marker.side.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let sideDim;\n        const show = {};\n        const entitiesSideProps = {}\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          const sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n//        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.marker.side.clearSideState();\n        const skipFilterSide = sideDim !== _this.geoDomainDimension;\n        if (!skipFilterSide) {\n          show[\"is--\" + _this.model.marker.side.which] = true;\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        entitiesSideProps[\"show\"] = show;\n        entitiesSideProps[\"dim\"] = sideDim;\n        _this.model.entities_side.set(entitiesSideProps);\n        _this.model.entities_geodomain.skipFilter = (sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) &&\n          (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n\n      },\n      \"change:entities.show\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim\n          && !utils.isEmpty(_this.model.entities_side.show)) {\n          const showEntities = _this.model.entities_side.getFilteredEntities().filter(s => !_this.model.entities.isShown(s));\n          if (showEntities.length) {\n            _this.model.marker.side.clearSideState();\n            _this.model.entities_side.showEntity(showEntities);\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = (_this.SIDEDIM === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) &&\n          (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n\n      },\n      \"change:entities_side.show\": function(evt) {\n        if (!_this._readyOnce) return;\n        let doReturn = false;\n        let _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, h => {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide) {\n          _this.model.entities.getFilteredEntities();\n          const showEntities = _this.model.entities_side.getFilteredEntities().filter(s => !_entitiesSameDimWithSide.isShown(s));\n          if (showEntities.length) {\n            _entitiesSameDimWithSide.showEntity(showEntities);\n            doReturn = true;\n          }\n        }\n        if (_this.SIDEDIM !== _this.model.entities_side.dim) {\n          doReturn = true;\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities(true);\n      },\n      \"change:ui.chart.inpercent\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities(true);\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n\n    this.totalFieldName = \"Total\";\n  },\n\n  checkDimensions() {\n    const stackDim = this.model.entities.dim;\n    const sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.which == this.TIME;\n    this.stackSkip = stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n  /**\n   * DOM is ready\n   */\n  readyOnce() {\n    const _this = this;\n    this.el = (this.el) ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-stack\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = ((this.model.entities_geodomain.show[this.geoDomainDimension] || {})[\"$in\"] || {})[0];\n\n    _this.someSelected = (_this.model.marker.select.length > 0);\n    _this.nonSelectedOpacityZero = false;\n\n\n    this.on(\"resize\", () => {\n      _this._updateEntities();\n  });\n\n    this._attributeUpdaters = {\n      _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        const width = utils.getValueMD(d, _this.frameAxisX, _this.KEYS);\n        // let width;\n        // if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.geoLess && _this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        // } else if (_this.geoLess && _this.sideSkip) {\n        //   width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        // } else if (_this.stackSkip) {\n        //   width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        // } else if (_this.sideSkip) {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        // } else {\n        //   width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        // }\n        \n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX(d, i) {\n        const prevSbl = this.previousSibling;\n        if (prevSbl) {\n          const prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      },\n      _newColor(d, i) {\n        return _this.cScale(!_this.colorUseNotProperty ? (_this.frame.color[d[_this.STACKDIM]] || {})[d[_this.PREFIXEDSIDEDIM]] : _this.frame.color[d[_this.STACKDIM]]);\n      }\n    };\n  },\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready() {\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    const _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.TIME = this.model.marker._getFirstDimension({ type: \"time\" });\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.axis_y.getEntity();\n    this.STACKDIM = this.stack.getDimension();\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.TIMEDIM = this.model.time.getDimension();\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, frame => {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n        _this.frameOrder = frameOrder.hook_order;\n        _this._createLimits();\n        _this._updateLimits();\n  \n        _this._reorderBars();\n        _this.markers = this.model.marker.getKeys(_this.STACKDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_x\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    const conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators() {\n    const _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    const sideDim = this.SIDEDIM;\n    const stackDim = this.STACKDIM;\n\n    const stacks = this.model.marker.getKeys(stackDim);\n    let stackKeys = [];\n    stackKeys = stacks.map(m => m[stackDim]);\n    this.stackKeys = stackKeys;\n\n    const sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    let sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      const sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      const sides = this.model.marker.getKeys(sideDim)\n          .filter(f => !sideFiltered || this.model.marker.side.getEntity().isShown(f));\n      sideKeys = sides.map(m => m[sideDim]);\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        const sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      const title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n\n  _reorderBars() {\n    const _this = this;\n    const domain = this.yScale.domain();\n    const sideKeys = this.sideKeys;\n    domain.sort((a, b) => { \n      const result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending((_this.frameAxisX[a] || {})[sideKeys[0]] || 0, (_this.frameAxisX[b] || {})[sideKeys[0]] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n\n  _createLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    const sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    const keys = this.sideSkip ? [] : [this.SIDEDIM];\n    const limits = axisX.getLimitsByDimensions(keys.concat([this.STACKDIM, this.TIMEDIM]));\n    const timeKeys = axisX.getUnique();\n    const totals = {};\n    const inpercentMaxLimits = {};\n    const maxLimits = {};\n    sideKeysNF.forEach(s => {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.sideSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        let stackSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.stackKeys, stack => {\n          if (limits[stack] && limits[stack][time]) {\n            const val = limits[stack][time].max;\n            stackSum += val;\n            sideMaxLimits.push(val);\n          }\n        });\n        totals[time][sideKeysNF[0]] = stackSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / stackSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else {  \n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let stackSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.stackKeys, stack => {\n            if (limits[side] && limits[side][stack] && limits[side][stack][time]) {\n              const val = limits[side][stack][time].max;\n              stackSum += val;\n              sideMaxLimits.push(val);\n            }\n          });\n          totals[time][side] = stackSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / stackSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(s => {\n      _this.maxLimits[s] = Math.max(...maxLimits[s]);\n      _this.inpercentMaxLimits[s] = Math.max(...inpercentMaxLimits[s]);\n    });\n    this.totals = totals;\n  },\n\n  _updateLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n    const zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    let domain;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max(...this.sideKeys.map(s => _this.inpercentMaxLimits[s]))];\n    } else {\n      domain = (axisX.domainMin != null && axisX.domainMax != null) ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max(...this.sideKeys.map(s => _this.maxLimits[s]))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n\n\n  _interpolateBetweenTotals(timeSteps, totals, time) {\n    const nextStep = d3.bisectLeft(timeSteps, time);\n    const fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    const total = {};\n    utils.forEach(this.sideKeys, side => {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n  });\n    return total;\n  },\n\n  /**\n   * Updates entities\n   */\n  _updateEntities(reorder) {\n    const _this = this;\n    const time = this.model.time;\n    const sideDim = this.SIDEDIM;\n    const prefixedSideDim = this.PREFIXEDSIDEDIM;\n    const stackDim = this.STACKDIM;\n    const prefixedStackDim = this.PREFIXEDSTACKDIM;\n    const timeDim = this.TIMEDIM;\n    const duration = (time.playing) ? time.delayAnimations : 0;\n    let total;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    const domain = this.yScale.domain();\n\n    const stackBars = this.markers.slice(0);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\")\n        .data(stackBars, d => d[stackDim]);\n    //exit selection\n    this.entityBars.exit().remove();\n\n    const barHeight = this.barHeight;\n    const firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\")\n      .attr(\"class\", d => \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[stackDim])\n      .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\")\n      .merge(this.entityBars);\n\n    const _attributeUpdaters = this._attributeUpdaters;\n        \n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(d => _this.sideKeys.map(m => {\n        const r = {};\n    r[stackDim] = d[stackDim];\n    r[prefixedSideDim] = m;\n    r[sideDim] = m;\n    return r;\n  }), d => d[prefixedSideDim]);\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\")\n      .attr(\"class\", (d, i) => \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\"))\n      .call((sideSel) => {\n        sideSel.append(\"rect\")\n          .attr(\"class\", (d, i) => \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\"))\n          .attr(\"y\", 0)\n          .attr(\"height\", barHeight)\n          .attr(\"fill\", _attributeUpdaters._newColor)\n          .attr(\"width\", _attributeUpdaters._newWidth)\n          .attr(\"x\", _attributeUpdaters._newX)\n          .on(\"mouseover\", _this.interaction.mouseover)\n          .on(\"mouseout\", _this.interaction.mouseout)\n          .on(\"click\", _this.interaction.click)\n          .onTap(_this.interaction.tap);\n      })\n      .merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n    }\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\");\n\n    if (reorder) this.stackBars\n      .attr(\"fill\", _attributeUpdaters._newColor);\n\n    if (duration) {\n      const transition = d3.transition()\n        .duration(duration)\n        .ease(d3.easeLinear);\n\n      this.entityBars\n        //.transition(transition)\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\");\n      this.stackBars\n        .transition(transition)\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt()\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[stackDim])) + \")\");\n      this.stackBars.interrupt()\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear)\n        .on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n\n  _setYear(timeValue) {\n    const formattedTime = this.model.time.formatDate(timeValue);\n    return function() { d3.select(this).text(formattedTime); };\n  },\n\n  _interaction() {\n    const _this = this;\n    return {\n      mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n\n  _highlightBars(d) {\n    const _this = this;\n\n    _this.someHighlighted = (_this.model.marker.highlight.length > 0);\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n\n  _showLabel(d) {\n    if (!this.frame) return;\n    \n    const _this = this;\n    const formatter = _this.ui.chart.inpercent ? d3.format(\".2%\") : _this.model.marker.axis_x.getTickFormatter();\n    const sideDim = _this.SIDEDIM;\n    const stackDim = _this.STACKDIM;\n    const KEYS = this.KEYS;\n\n    const left = _this.sideKeys.indexOf(d[sideDim]);\n    const label = _this.labels.select(\".vzb-bc-label\");\n    const bar = _this.bars.select(\".vzb-bc-bar-\" + d[stackDim]);\n    label.attr(\"transform\", bar.attr(\"transform\"))\n      .select(\".vzb-bc-stack\")\n      .text(textData => {\n        let text = _this.frame.label_stack[d[stackDim]];\n        text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n        const total = _this.ui.chart.inpercent ? _this.total[d[sideDim]] : 1;\n        const value = utils.getValueMD(d, _this.frameAxisX, KEYS) / total;\n        return text + \": \" + formatter(value);\n      })\n      .attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7))\n      .classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize() {\n\n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"BarchartDS resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    const domain = this.yScale.domain();\n    // height per bar is total domain height divided by the number of possible markers in the domain\n    const barHeight = this.barHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / Math.abs(domain[1] - domain[0]);\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars\n      .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    const maxRange = this.twoSided ? ((this.width - this.activeProfile.centerWidth) * 0.5) : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale)\n      .tickValues([])\n      .tickSizeInner(-this.width)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.width, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 1\n      });\n\n    const format = this.ui.chart.inpercent ? d3.format(\".1%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale)\n      .tickFormat(format)\n      .tickSizeInner(-this.height)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.height, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n    const translateX = this.twoSided ? ((this.width + _this.activeProfile.centerWidth) * 0.5) : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\")\n      .call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\")\n      .call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft)\n        .tickFormat(format)\n        .tickSizeInner(-this.height)\n        .tickSizeOuter(0)\n        .tickPadding(6)\n        .tickSizeMinor(-this.height, 0)\n        .labelerOptions({\n          scaleType: this.model.marker.axis_x.scaleType,\n          toolMargin: margin,\n          limitMaxTickNumber: 6\n        });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\")\n        .call(this.xAxisLeft);\n      const zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        const zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n   \n      //hide left axis zero tick\n      const tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n   }\n\n    const isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title\n      .attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0))\n      .style(\"text-anchor\", this.twoSided ? \"end\" : \"\")\n      .attr(\"y\", margin.top * 0.7);\n    this.titleRight\n      .attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing)\n      .attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + (margin.top * 0.4) + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n\n  },\n\n  updateBarsOpacity(duration) {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = this.model.marker.opacityRegular;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n      .style(\"opacity\", d => {\n\n        if (_this.someHighlighted) {\n          //highlight or non-highlight\n          if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n        }\n\n        if (_this.someSelected) {\n          //selected or non-selected\n          return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n        }\n\n        if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n        return OPACITY_REGULAR;\n      });\n\n    this.stackBars.style(\"stroke\", d => _this.model.marker.isSelected(d) ? \"#333\" : null);\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","module.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-stack\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}